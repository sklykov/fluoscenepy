<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.6.1"/>
    <title>fluoscenepy.fluoscene API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>
            <img src="../../favicon.png" class="logo" alt="project logo"/>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#UscopeScene">UscopeScene</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#UscopeScene.__init__">UscopeScene</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.width">width</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.height">height</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.max_pixel_value">max_pixel_value</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.img_type">img_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.acceptable_img_types">acceptable_img_types</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.max_pixel_value_uint8">max_pixel_value_uint8</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.max_pixel_value_uint16">max_pixel_value_uint16</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.shape">shape</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.fluo_objects">fluo_objects</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.shape_types">shape_types</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.image">image</a>
                        </li>
                        <li>
                                <a class="variable" href="#UscopeScene.denoised_image">denoised_image</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.get_random_objects">get_random_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.get_round_objects">get_round_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.set_random_places">set_random_places</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.put_objects_on">put_objects_on</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.spread_objects_on">spread_objects_on</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.recreate_scene">recreate_scene</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.show_scene">show_scene</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.clear_scene">clear_scene</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.is_blank">is_blank</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.add_noise">add_noise</a>
                        </li>
                        <li>
                                <a class="function" href="#UscopeScene.remove_noise">remove_noise</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#FluorObj">FluorObj</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FluorObj.__init__">FluorObj</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.shape_type">shape_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.border_type">border_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.shape_method">shape_method</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.explicit_shape_name">explicit_shape_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.profile">profile</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.radius">radius</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.a">a</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.b">b</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.typical_sizes">typical_sizes</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.valuable_round_shapes">valuable_round_shapes</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.image_type">image_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.center_shifts">center_shifts</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.casted_profile">casted_profile</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.external_upper_coordinates">external_upper_coordinates</a>
                        </li>
                        <li>
                                <a class="variable" href="#FluorObj.within_image">within_image</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.get_shaping_functions">get_shaping_functions</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.get_shape">get_shape</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.get_casted_shape">get_casted_shape</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.crop_shape">crop_shape</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.plot_shape">plot_shape</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.plot_cast_shape">plot_cast_shape</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.set_image_sizes">set_image_sizes</a>
                        </li>
                        <li>
                                <a class="function" href="#FluorObj.set_coordinates">set_coordinates</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#force_precompilation">force_precompilation</a>
            </li>
    </ul>


            <footer>fluoscenepy ver. 0.0.1, 2024 Sergei Klykov</footer>

        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
fluoscenepy<wbr>.fluoscene    </h1>

                        <div class="docstring"><p>Main script for the 'fluoscenepy' package.</p>

<p>@author: Sergei Klykov
@licence: MIT, @year: 2024</p>
</div>

                        <input id="mod-fluoscene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-fluoscene-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="c1"># -*- coding: utf-8 -*-</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">Main script for the &#39;fluoscenepy&#39; package.</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">@author: Sergei Klykov</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="sd">@licence: MIT, @year: 2024</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="c1"># %% Global imports</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">import</span> <span class="nn">random</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Circle</span><span class="p">,</span> <span class="n">Ellipse</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>    <span class="kn">import</span> <span class="nn">numba</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>    <span class="n">numba_installed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>    <span class="n">numba_installed</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="c1"># %% Local (package-scoped) imports</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span> <span class="ow">or</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span> <span class="ow">or</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__mp_main__&quot;</span><span class="p">:</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>    <span class="kn">from</span> <span class="nn">utils.raw_objects_gen</span> <span class="kn">import</span> <span class="n">continuous_shaped_bead</span><span class="p">,</span> <span class="n">discrete_shaped_bead</span><span class="p">,</span> <span class="n">discrete_shaped_ellipse</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>    <span class="k">if</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>        <span class="kn">from</span> <span class="nn">utils.compiled_objects_gen</span> <span class="kn">import</span> <span class="n">discrete_shaped_bead_acc</span><span class="p">,</span> <span class="n">discrete_shaped_ellipse_acc</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="k">else</span><span class="p">:</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>    <span class="kn">from</span> <span class="nn">.utils.raw_objects_gen</span> <span class="kn">import</span> <span class="n">continuous_shaped_bead</span><span class="p">,</span> <span class="n">discrete_shaped_bead</span><span class="p">,</span> <span class="n">discrete_shaped_ellipse</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>    <span class="k">if</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a>        <span class="kn">from</span> <span class="nn">.utils.compiled_objects_gen</span> <span class="kn">import</span> <span class="n">discrete_shaped_bead_acc</span><span class="p">,</span> <span class="n">discrete_shaped_ellipse_acc</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="c1"># %% Scene (image) class def.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="k">class</span> <span class="nc">UscopeScene</span><span class="p">:</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">    Replicate the common fluorescence microscopic image (frame or &#39;scene&#39;).</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">    This class simulates the bright objects with round and elongate shapes as the basic examples of imaged objects. \n</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">    The ratio behind development of this class - to get the ground truth images for image processing workflows tests. \n</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">    For more complex and useful cases, please, check the References.</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">    References</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">    ----------</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">    For the used noise models, see the &#39;add_noise method&#39;.</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="c1"># Class parameters</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">__warn_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">max_pixel_value</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="n">acceptable_img_types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uint8&#39;</span><span class="p">,</span> <span class="s1">&#39;uint16&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="n">max_pixel_value_uint8</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">max_pixel_value_uint16</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span> <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">shape_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="s1">&#39;el&#39;</span><span class="p">];</span> <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="n">__image_cleared</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># for tracking that the scene was cleared (zeroed)</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="n">__available_coordinates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">__binary_placement_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">denoised_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="n">__restricted_coordinates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">__noise_added</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># for tracking that the noise has been added</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">        Initialize the class wrapper for store the current &quot;scene&quot; or microscopic image.</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        Parameters</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a><span class="sd">        ----------</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">        width : int</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">            Width of the scene in pixels.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">        height : int</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a><span class="sd">            Height of the scene in pixels.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a><span class="sd">        image_type : str | np.uint8 | np.uint16 | np.float64, optional</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a><span class="sd">            Image type, for supported ones see the acceptable types. The default is &#39;uint8&#39;.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a><span class="sd">        Raises</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a><span class="sd">        ------</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a><span class="sd">        ValueError</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a><span class="sd">            If provided parameters are inconsistent, e.g. width or height &lt; 2.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="sd">        Returns</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a><span class="sd">        -------</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a><span class="sd">        None.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>        <span class="c1"># Check provided width and height</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided dimensions (</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">) is less than 4&quot;</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>            <span class="n">__warn_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Provided dimensions (</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">) pixels are unrealistic for the common image&quot;</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="c1"># Check an image type</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>        <span class="k">if</span> <span class="n">image_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">:</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided image type &#39;</span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&#39; not in the acceptable list of types: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">))</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>            <span class="k">if</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value_uint16</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="c1"># Initialize zero scene</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>    <span class="c1"># %% Objects specification / generation</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>    <span class="nd">@classmethod</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>    <span class="k">def</span> <span class="nf">get_random_objects</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mean_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">size_std</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>                           <span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shapes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">,</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>                           <span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a><span class="sd">        Generate objects with randomized shape sizes, for shapes: &#39;round&#39;, &#39;ellipse&#39;, &#39;mixed&#39; - last one for randomized choice</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a><span class="sd">        between 2 first ones.</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a><span class="sd">        Objects should be instances of FluorObj() class from this module.</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a><span class="sd">        Parameters</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a><span class="sd">        ----------</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a><span class="sd">        mean_size : Union[float, int, tuple]</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="sd">            Mean size(-s) of randomized objects. Integer or float is supposed to be used for round particles, tuple - for ellipse.</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">        size_std : Union[float, int, tuple]</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">            Standard deviation of mean size(-s).</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="sd">        intensity_range : tuple</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">            (Min, Max) intensities for randomized choice of the maximum intensity along the profile.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a><span class="sd">        n_objects : int, optional</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">            Number of generated objects. The default is 2.</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        shapes : str, optional</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">            Implemented in FluorObj() shapes: &#39;round&#39;, &#39;ellipse&#39; or &#39;mixed&#39; them (randomly selected). The default is &#39;round&#39;.</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">            Image type of the scene on which the objects will be placed and cast to. The default is &#39;uint8&#39;.</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">        verbose_info : bool, optional</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a><span class="sd">            Flag for printing out verbose information about the generation progress (use it for many objects generation). The default is False.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        accelerated : bool, optional</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">            Flag for attempting acceleration of objects shape calculation by using &#39;numba&#39; library compilation.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        Raises</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        ------</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        ValueError</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">            See the provided description.</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">        Returns</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        -------</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">        tuple</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">            Packed instances of FluorObj() class.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>            <span class="n">t_ov_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="k">if</span> <span class="n">shapes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">shape_types</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please provide the supported shape type for generation from a list: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">shape_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>        <span class="n">fl_objects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># for storing generated objects</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">r_std</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># default parameters for round objects</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span> <span class="o">=</span> <span class="n">intensity_range</span>  <span class="c1"># assuming that only 2 values provided</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_objects</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>            <span class="k">if</span> <span class="n">shapes</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">:</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>                <span class="n">shape_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">])</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>                <span class="c1"># Define radius and radius std for round particles from the provided tuples for the ellipses (random choice between a and b)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>                    <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">mean_size</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>                    <span class="n">r</span> <span class="o">=</span> <span class="n">mean_size</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_std</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>                    <span class="n">r_std</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">size_std</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>                    <span class="n">r_std</span> <span class="o">=</span> <span class="n">size_std</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>                <span class="n">shape_type</span> <span class="o">=</span> <span class="n">shapes</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>            <span class="c1"># Random selection of central shifts for placement</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>            <span class="n">i_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="n">j_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># random generation of central pixel shifts</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>            <span class="c1"># Checking that shifts are generated in the subpixel range and correcting it if not</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>            <span class="k">if</span> <span class="n">i_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>                <span class="n">i_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>            <span class="k">if</span> <span class="n">j_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>                <span class="n">j_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>            <span class="n">sign_i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]);</span> <span class="n">sign_j</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]);</span> <span class="n">i_shift</span> <span class="o">*=</span> <span class="n">sign_i</span><span class="p">;</span> <span class="n">j_shift</span> <span class="o">*=</span> <span class="n">sign_j</span>  <span class="c1"># random signs</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="c1"># Random selection of max intensity for the profile casting</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>            <span class="c1"># Round shaped object generation</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>            <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;round&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r_std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">r_std</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_std</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Provided tuple with sizes for round shape object, there expected only single number size&quot;</span><span class="p">)</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mean_size</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">size_std</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>                <span class="c1"># Checking generated radius for consistency</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>                <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>                    <span class="n">radius</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.6</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>                <span class="c1"># Generating the object and calculating its shape, cast and crop it</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>                <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">));</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="n">accelerated</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>            <span class="c1"># Ellipse shaped object generation</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>            <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;ellipse&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;el&#39;</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">mean_size</span><span class="p">;</span> <span class="n">a_std</span><span class="p">,</span> <span class="n">b_std</span> <span class="o">=</span> <span class="n">size_std</span>  <span class="c1"># unpacking tuples assuming 2 of sizes packed there</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>                <span class="n">a_r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">a_std</span><span class="p">);</span> <span class="n">b_r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">b_std</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                <span class="n">angle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># get random orientation for an ellipse</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>                <span class="c1"># Checking generated a, b axes for consistency (min axis &gt;= 0.5, max axis &gt;= 1.0)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>                <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>                    <span class="n">a</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>                <span class="k">elif</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>                    <span class="n">b</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>                <span class="n">max_axis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>                <span class="k">if</span> <span class="n">max_axis</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>                    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">max_axis</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>                        <span class="n">a</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.1</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>                        <span class="n">b</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.1</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>                <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="n">a_r</span><span class="p">,</span> <span class="n">b_r</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">),</span> <span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="n">accelerated</span><span class="p">);</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">()</span>  <span class="c1"># calculate normalized shape and crop it</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>                <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>                    <span class="n">elapsed_time</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated obj. #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2">, elapsed </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated obj. #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2">, elapsed </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> msec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>        <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>            <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_ov_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>            <span class="k">if</span> <span class="n">elapsed_time_ov</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>                <span class="n">elapsed_time_ov</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time_ov</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall generation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall generation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fl_objects</span><span class="p">)</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>    <span class="nd">@staticmethod</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>    <span class="k">def</span> <span class="nf">get_round_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">size_std</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shape_r_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mixed&#39;</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>                          <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">        Generate round shaped objects (as FluorObj class instances) with continuous shapes (see FluorObj class documentation).</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">        Parameters</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        ----------</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">        mean_size : float</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">            Mean size of objects in pixels.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        size_std : float</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">            Standard deviation of objects sizes.</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">        intensity_range : tuple</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">            Intensity range for selection of maximum object intensity.</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">        n_objects : int, optional</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">            Number of generated objects. The default is 2.</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        shape_r_type : str, optional</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">            Acceptable by FluorObj class round and computed shape types. The default is &#39;mixed&#39;.</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a><span class="sd">            Type of image used for a scene. The default is &#39;uint8&#39;.</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a><span class="sd">        Returns</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="sd">        -------</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        tuple</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">            Generated objects.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>        <span class="n">fl_objects</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span> <span class="o">=</span> <span class="n">intensity_range</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="n">shape_types</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="o">.</span><span class="n">valuable_round_shapes</span><span class="p">[:];</span> <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shape_types</span><span class="p">)</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_objects</span><span class="p">):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="c1"># Random selection of central shifts for placement</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>            <span class="n">i_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="n">j_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># random generation of central pixel shifts</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>            <span class="c1"># Checking that shifts are generated in the subpixel range and correcting it if not</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>            <span class="k">if</span> <span class="n">i_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>                <span class="n">i_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="k">if</span> <span class="n">j_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>                <span class="n">j_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mean_size</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">size_std</span><span class="p">)</span>  <span class="c1"># get the radius from Gaussian distribution</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>            <span class="c1"># Random selection of max intensity for the profile casting</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>            <span class="c1"># Checking generated radius for consistency</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>            <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>                <span class="n">radius</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.6</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>            <span class="c1"># If mixed type, selecting randomly the shape type</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>            <span class="k">if</span> <span class="n">shape_r_type</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>                <span class="n">shape_sel_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">shape_types</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>                <span class="n">shape_sel_type</span> <span class="o">=</span> <span class="n">shape_r_type</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>            <span class="c1"># Generating the round shaped object with continuous function used for shape calculation</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>            <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">),</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="n">shape_sel_type</span><span class="p">)</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>            <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">()</span>  <span class="c1"># calculate normalized shape and crop it</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>            <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fl_objects</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>    <span class="c1"># %% Randomly assigning coordinates for objects</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    <span class="k">def</span> <span class="nf">set_random_places</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">overlapping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">touching</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>                          <span class="n">only_within_scene</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">        Set random coordinates within scene (or partially outside) for provided objects.</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">        Parameters</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">        ----------</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        fluo_objects : tuple, optional</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a><span class="sd">            Tuple with generated instances of FluorObj() class. The default is ().</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="sd">        overlapping : bool, optional</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">            If True, the coordinates will be randomly selected from available ones. \n</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a><span class="sd">            If False, the largest object will be placed firstly, and others will be placed after with checking that the object to be placed</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">            are not intersected with the already placed objects on previous iterations. \n</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">            The default is True.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">        touching : bool, optional</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">            Flag for allowing objects to touch by their border pixels. Note that if overlapping is True, this flag ignored.</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">            The default is True.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">        only_within_scene : bool, optional</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a><span class="sd">            If True, the objects will be placed completely within (inside) the scene. \n</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a><span class="sd">            If False, objects may lay partially outside the scene. The default is False.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        verbose_info : bool, optional</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">            Printing out verbose information about performance of placement. The default is False.</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a><span class="sd">        Returns</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">        -------</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">        tuple</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">            With the placed objects.</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="c1"># For making verbose information printouts, check the time performance of placement logic</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">();</span> <span class="n">n_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># height and width of the image for setting the range of coordinates random selection</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>                <span class="n">filtered_fluo_obj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># storing the objects in the list for excluding the not placed objects if they are not overlapped</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>                <span class="n">additional_border</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">touching</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>                    <span class="n">additional_border</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># additional 2 pixels for excluding the pixels close to the object borders</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>            <span class="c1"># If only_within_scene, sort out the objects based on their sizes and place first the largest one, if not - the smallest one</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">or</span> <span class="p">(</span><span class="n">overlapping</span> <span class="ow">and</span> <span class="n">only_within_scene</span><span class="p">):</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>                <span class="n">fluo_objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>  <span class="c1"># convert for applying embedded sorting algorithm</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>            <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                <span class="n">fluo_objects</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                <span class="n">fluo_objects</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>            <span class="c1"># Generating and set random placing coordinates of the upper left pixel for the objects</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            <span class="n">placed_objects</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for printing out the number of placed objects</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>            <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">fluo_objects</span><span class="p">:</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                    <span class="n">h_fl_obj</span><span class="p">,</span> <span class="n">w_fl_obj</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># get object sizes</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                    <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_image_sizes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># force to account for the used scene shape</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>                    <span class="c1"># Placement logic, if overlapping is allowed - just random spreading objects on the scene</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                    <span class="k">if</span> <span class="n">overlapping</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                        <span class="c1"># Depending on the flag, defining smallest and largest coordinates (outside the scene borders or only inside)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                        <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>                            <span class="n">i_smallest</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_smallest</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i_largest</span> <span class="o">=</span> <span class="n">h</span><span class="o">-</span><span class="n">h_fl_obj</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">j_largest</span> <span class="o">=</span> <span class="n">w</span><span class="o">-</span><span class="n">w_fl_obj</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>                            <span class="c1"># smallest placing coordinate = half of object sizes - 1 pixel, analogous for largest coordinates</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>                            <span class="n">i_smallest</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">h_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_smallest</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">w_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>                            <span class="n">i_largest</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">h_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j_largest</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">w_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>                        <span class="c1"># Random selection of i, j coordinates below</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>                        <span class="n">i_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>                        <span class="c1"># Not overlapping, below - place the largest object and create the mask for preventing the overlapping</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>                            <span class="c1"># Generate the meshgrid of all available for placing coordinates (depending on the placement flag)</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">)</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>                                                                <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">)]</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>                                <span class="c1"># Below - keep the possible placement close to bottom and right edges of the scene and remove them later</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>                                                                 <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">)]</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>                            <span class="c1"># Generate and placing objects on the binary mask (instead of the real image or scene)</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">):</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">):</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>                                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>                            <span class="c1"># Exclude the coordinates occupied by the placed object from the available choices for further placements</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>                            <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>                                                   <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)]</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>                            <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>                                    <span class="k">pass</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>                            <span class="n">filtered_fluo_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluo_obj</span><span class="p">)</span>  <span class="c1"># storing the 1st placed and not overlapped objects</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>                            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="p">)</span>  <span class="c1"># shuffle available coordinates</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>                        <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>  <span class="c1"># set random place of the object within the image</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">verbose_info</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>                            <span class="n">placed_objects</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of placed objects:&quot;</span><span class="p">,</span> <span class="n">placed_objects</span><span class="p">,</span> <span class="s2">&quot;out of&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>                        <span class="c1"># Trying to place the object in the randomly selected from remaining coordinates place and checking if there is no</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>                        <span class="c1"># intersections with already placed objects, regulate # of attempts to place below in the while condition</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>                        <span class="n">i_attempts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">available_correcting_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="p">[:]</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>                        <span class="c1"># Adapting max number of attempts</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">:</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                            <span class="n">max_attempts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>                            <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># limiting max number of attempts to find suitable coordinates</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>                        <span class="c1"># Trying to place the object and check for intersections with the other ones</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>                        <span class="n">border_coordinates_deleted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>                        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">placed</span> <span class="ow">and</span> <span class="n">i_attempts</span> <span class="o">&lt;</span> <span class="n">max_attempts</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>                            <span class="n">overlapped</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for checking if the object is overlapped with the occupied place on a binary mask</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>                            <span class="c1"># randomly choose from the available coordinates</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>                                <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">border_coordinates_deleted</span><span class="p">:</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>                                    <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>                                    <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>                            <span class="c1"># Vectorized form of the overlapping check</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                            <span class="n">i_max</span><span class="p">,</span> <span class="n">j_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">i_max</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_max</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>                            <span class="c1"># Define the region of the placement mask for checking</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>                            <span class="k">if</span> <span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>                                <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>                                <span class="n">i_start</span> <span class="o">=</span> <span class="n">i_obj</span> <span class="o">-</span> <span class="n">additional_border</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>                            <span class="k">if</span> <span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>                                <span class="n">j_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>                                <span class="n">j_start</span> <span class="o">=</span> <span class="n">j_obj</span> <span class="o">-</span> <span class="n">additional_border</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>                            <span class="k">if</span> <span class="n">i_obj</span> <span class="o">+</span> <span class="n">h_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span> <span class="o">&gt;</span> <span class="n">i_max</span><span class="p">:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>                                <span class="n">i_finish</span> <span class="o">=</span> <span class="n">i_max</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>                                <span class="n">i_finish</span> <span class="o">=</span> <span class="n">i_obj</span> <span class="o">+</span> <span class="n">h_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>                            <span class="k">if</span> <span class="n">j_obj</span> <span class="o">+</span> <span class="n">w_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span> <span class="o">&gt;</span> <span class="n">j_max</span><span class="p">:</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>                                <span class="n">j_finish</span> <span class="o">=</span> <span class="n">j_max</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>                                <span class="n">j_finish</span> <span class="o">=</span> <span class="n">j_obj</span> <span class="o">+</span> <span class="n">w_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_finish</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_finish</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>                                <span class="n">overlapped</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">i_attempts</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>                                    <span class="n">available_correcting_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">));</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>                                    <span class="k">pass</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>                            <span class="c1"># Check that object placed and if not, delete border pixels for placing (long-lasting function)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapped</span><span class="p">:</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>                                <span class="n">placed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>                                <span class="c1"># Prevent placing out of scene by removing from available coordinates</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                                <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>                                    <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">h_fl_obj</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>                                    <span class="n">coordinates_for_del</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="n">w_fl_obj</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                                    <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>                                        <span class="k">try</span><span class="p">:</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>                                            <span class="n">available_correcting_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>                                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>                                            <span class="k">pass</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>                                    <span class="n">border_coordinates_deleted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>                                <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="k">break</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>                        <span class="c1"># print(&quot;# of made attempts:&quot;, i_attempts)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>                        <span class="c1"># Exclude the coordinates occupied by the placed object from the meshgrid (list with coordinates pares)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>                        <span class="k">if</span> <span class="n">placed</span><span class="p">:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>                            <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>                                                   <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>                                                   <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)]</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>                            <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                                    <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>                                    <span class="k">pass</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                            <span class="c1"># Exclude placed object from binary placement mask</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="p">):</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="p">):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                            <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>  <span class="c1"># if found place, place the object</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                            <span class="n">filtered_fluo_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluo_obj</span><span class="p">)</span>  <span class="c1"># collect for returning only placed object, excluding not placed ones</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                                <span class="n">placed_objects</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of placed objects:&quot;</span><span class="p">,</span> <span class="n">placed_objects</span><span class="p">,</span> <span class="s2">&quot;out of&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>                <span class="n">fluo_objects</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">filtered_fluo_obj</span><span class="p">)</span>  <span class="c1"># convert list -&gt; tuple for returning only placed objects</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>                <span class="c1"># plt.figure(&quot;Binary Placement Mask&quot;); plt.imshow(self.__binary_placement_mask)  # plot the occupied places by the objects</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>                <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placing of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2"> objects takes: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> msec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>                    <span class="n">elapsed_time</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placing of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2"> objects takes: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>        <span class="k">return</span> <span class="n">fluo_objects</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="c1"># %% Put objects on the scene</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>    <span class="k">def</span> <span class="nf">put_objects_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">save_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                       <span class="n">rewrite_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a><span class="sd">        Put the provided objects on the scene by checking pixelwise the provided profiles and in the case of intersection of</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a><span class="sd">        two objects profiles, selecting the maximum intensity from them.</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a><span class="sd">        Parameters</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a><span class="sd">        ----------</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a><span class="sd">        fluo_objects : tuple, optional</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a><span class="sd">            Fluorescent objects, instances of FluorObj class, packed in a tuple. The default is ().</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="sd">        save_objects : bool, optional</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a><span class="sd">            If True, will save (append) objects in the class attribute &#39;fluo_objects&#39;. The default is True. \n</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a><span class="sd">            Note that, if it&#39;s False, then before placing the objects, the scene will be cleared (stored before objects will be removed from it).</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a><span class="sd">        save_only_objects_inside : bool, optional</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="sd">            Save in the class attribute (&#39;fluo_objects&#39;) only objects that are inside the image. The default is False.</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        rewrite_objects : bool, optional</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">            If True, it forces to substitute stored objects in the class attribute &#39;fluo_objects&#39; with the provided ones. The default is False.</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        Returns</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">        -------</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">        None.</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">save_objects</span><span class="p">:</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">clear_scene</span><span class="p">()</span>  <span class="c1"># clear the scene before placing the objects only if there are no saved objects and the flag is False</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">fluo_objects</span><span class="p">:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>                <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">within_image</span> <span class="ow">and</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>                    <span class="n">i_start</span><span class="p">,</span> <span class="n">j_start</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">external_upper_coordinates</span><span class="p">;</span> <span class="n">i_size</span><span class="p">,</span> <span class="n">j_size</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>                    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># for checking that the placing happening within the image</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for counting on the profile</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_start</span><span class="p">,</span> <span class="n">i_start</span><span class="o">+</span><span class="n">i_size</span><span class="p">):</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>                        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># refresh starting column for counting on the object profile</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_start</span><span class="p">,</span> <span class="n">j_start</span><span class="o">+</span><span class="n">j_size</span><span class="p">):</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                                <span class="k">else</span><span class="p">:</span>  <span class="c1"># float image type</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1E-9</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>                            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># next column of the cast profile</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># next row of the cast profile</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="k">if</span> <span class="n">save_objects</span><span class="p">:</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                <span class="n">l_fluo_objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>  <span class="c1"># conversion input tuple to the list</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                <span class="k">if</span> <span class="n">save_only_objects_inside</span><span class="p">:</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>                    <span class="n">l_fluo_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fluo_obj</span> <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">l_fluo_objects</span> <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">within_image</span><span class="p">]</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rewrite_objects</span><span class="p">:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">+</span> <span class="n">l_fluo_objects</span>  <span class="c1"># concatenate 2 lists</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">=</span> <span class="n">l_fluo_objects</span><span class="p">[:]</span>  <span class="c1"># copy the list</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>    <span class="k">def</span> <span class="nf">spread_objects_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="sd">        Compose 2 subsequent methods: self.put_objects_on(self.set_random_places(fluo_objects), save_objects=True).</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a><span class="sd">        So, this method puts the provided objects, which are randomly spread on the scene, and saves them in the attribute.</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">        Parameters</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        ----------</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">        fluo_objects : tuple</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">            Fluorescent objects, instances of FluorObj class, packed in a tuple.</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a><span class="sd">        Returns</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        -------</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        None.</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>    <span class="k">def</span> <span class="nf">recreate_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a><span class="sd">        Recreate the saved objects in the class attribute &#39;fluo_objects&#39; on the cleared before scene.</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        Returns</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">        -------</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">        None.</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">),</span> <span class="n">save_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;The scene is not clear, cannot recreate the scene&quot;</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">==</span> <span class="s2">&quot;The scene is not clear, cannot recreate the scene&quot;</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;There are no stored objects within this class instance&quot;</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">==</span> <span class="s2">&quot;There are no stored objects within this class instance&quot;</span><span class="p">:</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>    <span class="c1"># %% Scene manipulation</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="k">def</span> <span class="nf">show_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">unique_plot_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a><span class="sd">        Show interactively the stored in the class scene (image) by plotting it using matplotlib.</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a><span class="sd">        Parameters</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a><span class="sd">        ----------</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="sd">        color_map</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a><span class="sd">            Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is &#39;viridis&#39;.</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        unique_plot_id: bool, optional</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">            Flag for adding to plot name some random integer id for preventing plots overlapping. The default is True.</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">        Returns</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">        -------</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">        None.</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">height_width_ratio</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">w</span><span class="p">;</span> <span class="n">default_image_size</span> <span class="o">=</span> <span class="mf">5.8</span><span class="p">;</span> <span class="n">additional_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>        <span class="k">elif</span> <span class="n">unique_plot_id</span><span class="p">:</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>            <span class="n">additional_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            <span class="n">figure_name</span> <span class="o">=</span> <span class="s2">&quot;Blank UscopeScene &quot;</span> <span class="o">+</span> <span class="n">str_id</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">additional_id</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>            <span class="n">figure_name</span> <span class="o">=</span> <span class="s2">&quot;UscopeScene &quot;</span> <span class="o">+</span> <span class="n">str_id</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">additional_id</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure_name</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">default_image_size</span><span class="p">,</span> <span class="n">default_image_size</span><span class="o">*</span><span class="n">height_width_ratio</span><span class="p">))</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>    <span class="k">def</span> <span class="nf">clear_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a><span class="sd">        Reinitialize the scene to zero (plain dark background).</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        Returns</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">        -------</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">        None.</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>    <span class="k">def</span> <span class="nf">is_blank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        Returns True, if the scene (image) is blank (zeroed).</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">        Returns</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        -------</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        bool</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">            Value for designation of a blank scene.</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>    <span class="c1"># %% Making scene realistic and useful by adding noise: shot and detector ones</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>    <span class="k">def</span> <span class="nf">add_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mean_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        Add Poisson (signal dependent shot noise) and background (Gaussian or detector) noise.</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        Note that if the called again on the scene, this method will add newly generated noise to the initial image.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a><span class="sd">        Parameters</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="sd">        ----------</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        seed : int, optional</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">            Long integer for initializing pseudorandom generator for repeating generated sequences. The default is None.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="sd">        mean_noise : Union[int, float], optional</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">            Mean for Gaussian noise intensity. The default is None.</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        sigma_noise : Union[int, float], optional</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">            Sigma for Gaussian noise intensity. The default is None.</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a><span class="sd">        References</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        ----------</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        [1] &quot;Imaging in focus: An introduction to denoising bioimages in the era of deep learning&quot;, R.F. Laine,</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        G. Jacquemet, A. Krull (2021)</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">        [2] Online Resource: https://bioimagebook.github.io/chapters/3-fluorescence/3-formation_noise/formation_noise.html</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a><span class="sd">        Returns</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">        -------</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">            The scene added shot (Poisson) and detector (Gaussian) noises.</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>            <span class="c1"># Add the Gaussian noise (background)</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="k">if</span> <span class="n">mean_noise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>                <span class="n">mean_noise</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># 12.5% of the max value</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="k">if</span> <span class="n">sigma_noise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>                <span class="n">sigma_noise</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="n">mean_noise</span>  <span class="c1"># 33% of the mean</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>            <span class="n">noisy_background</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_noise</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># normally distributed noise on background</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="n">noisy_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">noisy_background</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">noisy_background</span><span class="p">)</span>  <span class="c1"># check that all pixel values are positive</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>            <span class="c1"># Substitute the calculated exact pixel value with the Poisson distributed one due to the properties of commonly used cameras</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">raw_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy initial scene without noise</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># restore the initial image by the copying the content of the denoised image</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>            <span class="c1"># Generate and add noise pixelwise</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>                    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>  <span class="c1"># save converted original value with the Poisson-distributed</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noisy_background</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>  <span class="c1"># add Gaussian noise</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                        <span class="k">if</span> <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                            <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span>  <span class="c1"># check that the pixel values are still in range with the image type</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">noisy_background</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="c1"># Casting the noisy image back to the original image format</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="s1">&#39;uint8&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">raw_pixels</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">raw_pixels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># switch the flag for tracking that the noise has been added</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>    <span class="k">def</span> <span class="nf">remove_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a><span class="sd">        Remove added previously noise by copying the stored in &#39;denoise_image&#39; pixel content.</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a><span class="sd">        Returns</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a><span class="sd">        -------</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a><span class="sd">            Initial scene without noise.</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="c1"># %% Object class definition</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="k">class</span> <span class="nc">FluorObj</span><span class="p">:</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">    Modelling the fluorescent bright object with the specified type.</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">    It can be used for embedding it to the &#39;UscopeScene&#39; class for building up the microscopic image.</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>    <span class="c1"># Class parameters</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>    <span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">border_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">shape_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">explicit_shape_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">profile</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>    <span class="n">__acceptable_shape_types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="s1">&#39;curved&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>  <span class="c1"># shape types of the object</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>    <span class="n">__acceptable_border_types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precise&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;computed&#39;</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">];</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>    <span class="n">typical_sizes</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()</span>  <span class="c1"># for storing descriptive parameters for curve describing the shape of the object</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>    <span class="c1"># below - storing names of implemented computing functions for the define continuous shape</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>    <span class="n">__acceptable_shape_methods</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;lorentzian&#39;</span><span class="p">,</span> <span class="s1">&#39;lor&#39;</span><span class="p">,</span> <span class="s1">&#39;derivative of logistic func.&#39;</span><span class="p">,</span> <span class="s1">&#39;dlogf&#39;</span><span class="p">,</span> <span class="s1">&#39;bump square&#39;</span><span class="p">,</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                                        <span class="s1">&#39;bump2&#39;</span><span class="p">,</span> <span class="s1">&#39;bump cube&#39;</span><span class="p">,</span> <span class="s1">&#39;bump3&#39;</span><span class="p">,</span> <span class="s1">&#39;bump ^8&#39;</span><span class="p">,</span> <span class="s1">&#39;bump8&#39;</span><span class="p">,</span> <span class="s1">&#39;smooth circle&#39;</span><span class="p">,</span> <span class="s1">&#39;smcir&#39;</span><span class="p">,</span> <span class="s1">&#39;oversampled circle&#39;</span><span class="p">,</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>                                        <span class="s1">&#39;ovcir&#39;</span><span class="p">,</span> <span class="s1">&#39;undersampled circle&#39;</span><span class="p">,</span> <span class="s1">&#39;uncir&#39;</span><span class="p">,</span> <span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>    <span class="n">valuable_round_shapes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;derivative of logistic func.&#39;</span><span class="p">,</span> <span class="s1">&#39;bump cube&#39;</span><span class="p">,</span> <span class="s1">&#39;bump ^8&#39;</span><span class="p">,</span> <span class="s1">&#39;smooth circle&#39;</span><span class="p">]</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>    <span class="n">image_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>   <span class="c1"># subpixel shift of the center of the object</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>    <span class="n">casted_profile</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># cast normalized profile to the provided image type</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>    <span class="n">__profile_cropped</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for setting if the profile was cropped (zero pixel rows / columns removed)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>    <span class="n">external_upper_coordinates</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># external image coordinates of the upper left pixel</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>    <span class="n">__external_image_sizes</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># sizes of an external image coordinates of the upper left pixel</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="n">within_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for checking that the profile is still within the image</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typical_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>                 <span class="n">border_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;precise&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="s2">        Initialize the class representation of a fluorescent object.</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a><span class="s2">        The difference between used parameters can be observed by plotting of the calculated shapes (profiles) by get_shape() method.</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="s2">        Parameters</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="s2">        ----------</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="s2">        typical_size : Union[float, int, tuple]</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="s2">            Typical sizes of the object, e.g. for a bead - diameter (float or int), for ellipse - tuple with axes a, b</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="s2">            and angle in radians (3 values).</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="s2">        center_shifts : tuple, optional</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="s2">            Shifts in pixels of the object center, should be less than 1px. The default is (0.0, 0.0).</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="s2">        shape_type : str, optional</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="s2">            Supported shape types: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="s2">            Currently implemented: &#39;round&#39; or &#39;r&#39; - for the circular bead object and &#39;ellipse&#39; or &#39;el&#39; - for the ellipse object.</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="s2">            The default is &#39;round&#39;.</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="s2">        border_type : str, optional</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="s2">            Type of intensity of the border pixels calculation. Supported border types: &#39;precise&#39;, &#39;pr&#39;, &#39;computed&#39;, &#39;co&#39;. </span><span class="se">\n</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="s2">            The &#39;computed&#39; or &#39;co&#39; type should be accompanied with the specification of the shape method parameter. </span><span class="se">\n</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="s2">            The &#39;precise&#39; or &#39;pr&#39; type corresponds to the developed counting area of the pixel laying within</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="s2">            the border (e.g., circular) of an object. </span><span class="se">\n</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a><span class="s2">            Note that &#39;computed&#39; type can be used only for &#39;round&#39; objects. The default is &#39;precise&#39;.</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a><span class="s2">        shape_method : str, optional</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="s2">            Shape method calculation, supported ones: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="si">}</span><span class="s2">. The default is &#39;&#39;.</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a><span class="s2">        Raises</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a><span class="s2">        ------</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a><span class="s2">        ValueError</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a><span class="s2">            See the provided error description for details.</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a><span class="s2">        Returns</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a><span class="s2">        -------</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="s2">        None.</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>        <span class="c1"># Sanity checks of the input values</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="k">if</span> <span class="n">shape_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="p">:</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">=</span> <span class="n">shape_type</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided shape type &#39;</span><span class="si">{</span><span class="n">shape_type</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="k">if</span> <span class="n">border_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_border_types</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">=</span> <span class="n">border_type</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided border type &#39;</span><span class="si">{</span><span class="n">border_type</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_border_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>        <span class="c1"># Checking typical sizes depending on the shape type</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>            <span class="n">typical_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span>  <span class="c1"># assuming that the input parameter can be converted to the float type</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>            <span class="k">if</span> <span class="n">typical_size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected typical size (radius) should be larger than 1px, provided: </span><span class="si">{</span><span class="n">typical_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">typical_size</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">=</span> <span class="s1">&#39;precise&#39;</span>  <span class="c1"># default border type for ellipse shape calculation</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For ellipse particle expected length of typical size tuple is equal 3: (a, b, angle)&quot;</span><span class="p">)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">typical_size</span><span class="p">;</span> <span class="n">max_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="n">min_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                    <span class="k">if</span> <span class="n">max_size</span> <span class="o">&lt;</span> <span class="mf">1.5</span> <span class="ow">or</span> <span class="n">min_size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected sizes a, b should be positive, minimal is more than 1px and maximal is more than 1.5px&quot;</span><span class="p">)</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="ow">or</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected angle should be in the range of [-2pi, 2pi]&quot;</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span> <span class="o">=</span> <span class="n">typical_size</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For curved particle expected length of typical size tuple is more than 2&quot;</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span> <span class="o">=</span> <span class="n">typical_size</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;ellipse&#39;</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="c1"># Assigning the explicit border type for making full naming for plots</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">:</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>            <span class="k">if</span> <span class="n">shape_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">=</span> <span class="n">shape_method</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;lor&#39;</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;lorentzian&#39;</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;dlogf&#39;</span><span class="p">:</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;derivative of logistic func.&#39;</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump2&#39;</span><span class="p">:</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump square&#39;</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump3&#39;</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump cube&#39;</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump8&#39;</span><span class="p">:</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump ^8&#39;</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;smcir&#39;</span><span class="p">:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;smooth circle&#39;</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;ovcir&#39;</span><span class="p">:</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;oversampled circle&#39;</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;uncir&#39;</span><span class="p">:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;undersampled circle&#39;</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;circle&#39;</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided shape comp. method &#39;</span><span class="si">{</span><span class="n">shape_method</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="c1"># Check that explicit shape name is not empty</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span><span class="p">:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span><span class="p">[:]</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span><span class="p">[:]</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;precise&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="c1"># Assuming that center shifts provided as the tuple with x shift, y shift floats in pixels</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">center_shifts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>            <span class="n">x_shift</span><span class="p">,</span> <span class="n">y_shift</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One of the shifts &#39;</span><span class="si">{</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2">&#39; are more than 1px, but they are expected to be in the subpixel range&quot;</span><span class="p">)</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="k">def</span> <span class="nf">get_shaping_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        Print out the implemented methods acceptable for the &#39;shape_method&#39; parameter.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a><span class="sd">        Returns</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a><span class="sd">        -------</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a><span class="sd">        str</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a><span class="sd">            Printed out composed informational string.</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>        <span class="n">methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>            <span class="n">methods</span> <span class="o">+=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="n">info_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The implemented types of continuous bell shape functions or acceptable variables for the &#39;shape_method&#39; parameter &quot;</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                    <span class="o">+</span> <span class="s2">&quot;(first - the long naming followed by the shortened version): </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">methods</span><span class="p">)</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">info_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="k">return</span> <span class="n">info_str</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="c1"># %% Calculate and plot shape</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>    <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a><span class="sd">        Calculate and return 2D intensity normalized (to the range [0.0, 1.0]) distribution of the object shape.</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a><span class="sd">        Parameters</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a><span class="sd">        ----------</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a><span class="sd">        center_shifts : tuple, optional</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a><span class="sd">            Shifts in pixels of the object center, should be less than 1px. The default is None.</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a><span class="sd">        accelerated : bool, optional</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a><span class="sd">            Accelerate the computation by using numba library compilation utilities.</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a><span class="sd">            If True, will raise warning if the numba library hasn&#39;t been installed in the environment. The default is False.</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a><span class="sd">        Raises</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a><span class="sd">        ------</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a><span class="sd">        NotImplementedError</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a><span class="sd">            For some set of allowed parameters for class initialization the calculation hasn&#39;t been yet implemented.</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a><span class="sd">        References</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a><span class="sd">        ----------</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a><span class="sd">        Continuously shaped objects are created by adapting the functions from:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a><span class="sd">        [1] https://en.wikipedia.org/wiki/Bell-shaped_function</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a><span class="sd">        &#39;Precisely&#39; shaped objects are created by the custom algorithm, which calculates part of an object still laying</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a><span class="sd">        within the affected (&#39;border&#39;) pixels.</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a><span class="sd">        Returns</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a><span class="sd">        -------</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="sd">        2D shape of the object (intensity representation).</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="k">if</span> <span class="n">center_shifts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">center_shifts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="n">x_shift</span><span class="p">,</span> <span class="n">y_shift</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One of the shifts &#39;</span><span class="si">{</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2">&#39; are more than 1px, &quot;</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                                 <span class="o">+</span> <span class="s2">&quot;but the shifts are expected to be in the subpixel range&quot;</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">):</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">continuous_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">,</span> <span class="n">bead_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;precise&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">):</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">accelerated</span><span class="p">:</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>            <span class="k">elif</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead_acc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                <span class="k">if</span> <span class="n">accelerated</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>                    <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">ellipse_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">accelerated</span><span class="p">:</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="k">elif</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse_acc</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>                <span class="k">if</span> <span class="n">accelerated</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>                    <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This set of input parameters hasn&#39;t yet been implemented&quot;</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set it to the default value, the profile is uncropped</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>    <span class="k">def</span> <span class="nf">get_casted_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_pixel_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                         <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a><span class="sd">        Calculate cast from the computed normalized object shape.</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">        Parameters</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">        ----------</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">        max_pixel_value : int | float (designated as Union)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">            Maximum intensity or pixel value of the object.</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">            Type for casting. The default is &#39;uint8&#39;.</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">        Raises</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">        ------</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        ValueError</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="sd">            If the provided max_pixel_value doesn&#39;t correspond to the provided image type.</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">        Returns</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a><span class="sd">        -------</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">        numpy.ndarray | None (designated as Union)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">            Returns the cast profile or None if the normalized profile hasn&#39;t been calculated.</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>        <span class="k">if</span> <span class="n">image_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">:</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided image type &#39;</span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&#39; not in the acceptable list of types: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">UscopeScene</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">))</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>            <span class="k">if</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint8&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                <span class="k">if</span> <span class="n">max_pixel_value</span> <span class="o">&gt;</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">max_pixel_value_uint8</span> <span class="ow">or</span> <span class="n">max_pixel_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided max pixel value </span><span class="si">{</span><span class="n">max_pixel_value</span><span class="si">}</span><span class="s2"> isn&#39;t compatible with the provided image type: </span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>                <span class="k">if</span> <span class="n">max_pixel_value</span> <span class="o">&gt;</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">max_pixel_value_uint16</span> <span class="ow">or</span> <span class="n">max_pixel_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided max pixel value </span><span class="si">{</span><span class="n">max_pixel_value</span><span class="si">}</span><span class="s2"> isn&#39;t compatible with the provided image type: </span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    <span class="k">def</span> <span class="nf">crop_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">        Crop zero intensity parts (borders) of the computed profile.</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">        Returns</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">        -------</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">            2D cropped profile.</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>  <span class="c1"># checking that the profile has been calculated and not cropped yet</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>            <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_end</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">j_end</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">border_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>                        <span class="n">border_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>                    <span class="k">continue</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                        <span class="n">i_start</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>                        <span class="n">i_end</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>            <span class="n">border_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                        <span class="n">border_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                    <span class="k">continue</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                        <span class="n">j_start</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                        <span class="n">j_end</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span> <span class="k">break</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_end</span><span class="p">]</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_end</span><span class="p">]</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="k">if</span> <span class="n">i_start</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j_start</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i_end</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">j_end</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>    <span class="c1"># %% Plotting methods</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>    <span class="k">def</span> <span class="nf">plot_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">):</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a><span class="sd">        Plot interactively the profile of the object computed by the get_shape() method along with the border of the object.</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a><span class="sd">        Please note that the border will be plotted if the shape hadn&#39;t been cropped before.</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a><span class="sd">        Parameters</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a><span class="sd">        ----------</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a><span class="sd">        color_map</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a><span class="sd">            Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is &#39;viridis&#39;.</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a><span class="sd">        Returns</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a><span class="sd">        -------</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a><span class="sd">        None.</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="n">naming</span> <span class="o">=</span> <span class="s2">&quot;Cropped Shape&quot;</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                <span class="n">naming</span> <span class="o">=</span> <span class="s2">&quot;Shape&quot;</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">naming</span><span class="si">}</span><span class="s2"> with parameters: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span><span class="si">}</span><span class="s2">, center: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">str_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>                <span class="n">axes_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>                <span class="n">axes_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>            <span class="n">plot_patch</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># flag for plotting the patch (Circle or Ellipse)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>                <span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># image sizes</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>                    <span class="n">m_center</span> <span class="o">=</span> <span class="n">m_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                    <span class="n">m_center</span> <span class="o">=</span> <span class="n">m_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>                    <span class="n">n_center</span> <span class="o">=</span> <span class="n">n_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                    <span class="n">n_center</span> <span class="o">=</span> <span class="n">n_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                <span class="n">plot_patch</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># just prevent the plotting the patch on the cropped images</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="k">if</span> <span class="n">plot_patch</span><span class="p">:</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Circle</span><span class="p">((</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">))</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>                                                    <span class="n">angle</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.75</span><span class="p">))</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>    <span class="k">def</span> <span class="nf">plot_cast_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a><span class="sd">        Plot interactively the cast to the provided type profile of the object computed by the get_casted_shape() method.</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a><span class="sd">        Parameters</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a><span class="sd">        ----------</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">        Returns</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a><span class="sd">        -------</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a><span class="sd">        None.</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Casted shape with parameters: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span><span class="si">}</span><span class="s2">, center: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">str_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>    <span class="c1"># %% Containing within the image checks</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>    <span class="k">def</span> <span class="nf">set_image_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_sizes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a><span class="sd">        Set containing this object image sizes packed in the tuple.</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">        Parameters</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">        ----------</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">        image_sizes : tuple</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a><span class="sd">            Expected as (height, width).</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">        Raises</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">        ------</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">        ValueError</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">            If image sizes provided less than 2 pixels.</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">        Returns</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">        -------</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">        None.</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image_sizes</span>  <span class="c1"># expecting packed height, width - also can be called with image.shape (np.ndarray.shape) attribute</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># put the default sizes for always getting False after setting coordinates</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Height and width image is expected to be more than 2 pixels&quot;</span><span class="p">)</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>    <span class="k">def</span> <span class="nf">set_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">        Set coordinates of the left upper coordinates of the profile.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">        Parameters</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">        ----------</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a><span class="sd">        coordinates : tuple</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">            As i - from rows, j - columns.</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">        Returns</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">        -------</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="sd">        bool</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">            True if the image containing the profile (even partially).</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_upper_coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>  <span class="c1"># expecting packed coordinates of the left upper pixel of the profile</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">h_image</span><span class="p">,</span> <span class="n">w_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            <span class="n">i_border_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">j_border_check</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flags for overall checking</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>            <span class="c1"># Below - basic check that the profile still is within image, if even its borders still are in</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">-</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">h_image</span><span class="p">):</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>                <span class="n">i_border_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">-</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">w_image</span><span class="p">):</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>                <span class="n">j_border_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>            <span class="c1"># Additional check that pixels of a shape is still not zero within the image (touching the scene only by border pixels)</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">h_image</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">w_image</span><span class="p">):</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                <span class="k">for</span> <span class="n">i_c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">h</span><span class="p">):</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>                    <span class="k">for</span> <span class="n">j_c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="n">w</span><span class="p">):</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>                        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i_c</span> <span class="o">&lt;</span> <span class="n">h_image</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j_c</span> <span class="o">&lt;</span> <span class="n">w_image</span><span class="p">:</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>                                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>                        <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>                    <span class="k">if</span> <span class="n">additional_containing_check</span><span class="p">:</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>                        <span class="k">break</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>                    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_border_check</span> <span class="ow">and</span> <span class="n">j_border_check</span> <span class="ow">and</span> <span class="n">additional_containing_check</span><span class="p">)</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># explicit setting flag</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>    <span class="c1"># %% Rewriting dunder methods for implementing sorting logic</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">        Implementation of &#39;&lt;&#39; comparison operator for letting the default sorting method to work on list of instances.</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        This method compares only shape sizes multiplication (m, n = self.profile.shape; m*n &lt; other.profile.shape[0]*other.profile.shape[1]).</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        Parameters</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">        ----------</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">        other : FluorObj</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">            Instance of FluorObj() comparison.</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">        Returns</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">        -------</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">        bool</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a><span class="sd">            Result of profile sizes comparison.</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">        Implementation of &#39;==&#39; comparison operator for letting the default sorting method to work on list of instances.</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">        This method compares shape size (m, n = self.profile.shape; m == other.profile.shape[0] and n == other.profile.shape[1])</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">        and also explicit_shape_name attributes of two classes.</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">        Parameters</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a><span class="sd">        ----------</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a><span class="sd">        other : FluorObj</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="sd">            Instance of FluorObj() comparison.</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a><span class="sd">        Returns</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">        -------</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">        bool</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">            Result of mentioned above attributes comparison.</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>            <span class="n">shape_type_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">explicit_shape_name</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="n">shape_sizes_check</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>            <span class="k">return</span> <span class="n">shape_sizes_check</span> <span class="ow">and</span> <span class="n">shape_type_check</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="c1"># %% Overall utility functions</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="k">def</span> <span class="nf">force_precompilation</span><span class="p">():</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">    Force compilation of computing functions for round and ellipse &#39;precise&#39; shaped objects.</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">    Returns</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">    -------</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">    None.</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>    <span class="k">if</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="n">probe_obj</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">);</span> <span class="n">probe_obj</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="k">del</span> <span class="n">probe_obj</span>  <span class="c1"># for round shape</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>        <span class="n">probe_obj</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">2.65</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span><span class="p">));</span> <span class="n">probe_obj</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="k">del</span> <span class="n">probe_obj</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="c1"># %% Tests of different scenarios</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s2">&quot;all&quot;</span><span class="p">);</span> <span class="n">test_computed_centered_beads</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_precise_centered_bead</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_computed_shifted_beads</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>    <span class="n">test_precise_shifted_beads</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_ellipse_centered</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_ellipse_shifted</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_casting</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>    <span class="n">test_cropped_shapes</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_put_objects</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_generate_objects</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_overall_gen</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>    <span class="n">test_precise_shape_gen</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_round_shaped_gen</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_adding_noise</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">test_various_noises</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">shifts</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">)</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>    <span class="n">test_cropping_shifted_circles</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">shifts1</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">);</span> <span class="n">shifts2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.14</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">);</span> <span class="n">shifts3</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.875</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.99</span><span class="p">)</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>    <span class="n">test_compiling_acceleration</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># testing the acceleration through compilation using numba</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>    <span class="n">test_placing_circles</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># testing speed up placing algorithm</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>    <span class="n">prepare_centered_docs_images</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># for making centered sample images for preparing Readme file about this project</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>    <span class="n">prepare_shifted_docs_images</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">shifts_sample</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.24</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>  <span class="c1"># for making shifted sample images for preparing Readme</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>    <span class="n">prepare_scene_samples</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># for preparing illustrative scenes with placed on them objects</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>    <span class="n">prepare_favicon_img</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># generate picture with dense round objects</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>    <span class="c1"># Testing the centered round objects generation</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>    <span class="k">if</span> <span class="n">test_computed_centered_beads</span><span class="p">:</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="n">gb1</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">);</span> <span class="n">gb1</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb1</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>        <span class="n">gb2</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;lor&#39;</span><span class="p">);</span> <span class="n">gb2</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb2</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="n">gb3</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;dlogf&#39;</span><span class="p">);</span> <span class="n">gb3</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb3</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>        <span class="n">gb4</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;bump2&#39;</span><span class="p">);</span> <span class="n">gb4</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb4</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="n">gb5</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;bump3&#39;</span><span class="p">);</span> <span class="n">gb5</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb5</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>        <span class="n">gb6</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;bump8&#39;</span><span class="p">);</span> <span class="n">gb6</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb6</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>        <span class="n">gb7</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;smcir&#39;</span><span class="p">);</span> <span class="n">gb7</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb7</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>        <span class="n">gb9</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;ovcir&#39;</span><span class="p">);</span> <span class="n">gb9</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb9</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="n">gb10</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;uncir&#39;</span><span class="p">);</span> <span class="n">gb10</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb10</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>    <span class="k">if</span> <span class="n">test_precise_centered_bead</span><span class="p">:</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>        <span class="n">gb8</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">);</span> <span class="n">gb8</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb8</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb8</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="n">gb14</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">4.75</span><span class="p">);</span> <span class="n">gb14</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb14</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb14</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>    <span class="c1"># Testing cropping of shifted circles with precise borders</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>    <span class="k">if</span> <span class="n">test_cropping_shifted_circles</span><span class="p">:</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>        <span class="n">gb16</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">3.75</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts1</span><span class="p">);</span> <span class="n">gb16</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb16</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>        <span class="n">gb16</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="mi">201</span><span class="p">);</span> <span class="n">gb16</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb16</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">gb16</span><span class="o">.</span><span class="n">plot_cast_shape</span><span class="p">()</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>        <span class="n">gb17</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">3.75</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts2</span><span class="p">);</span> <span class="n">gb17</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb17</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb17</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>        <span class="n">gb18</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">3.75</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts3</span><span class="p">);</span> <span class="n">gb18</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb18</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">gb18</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb18</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="n">gb20</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">3.75</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb20</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb20</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>        <span class="n">gb20</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="mi">2068</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">);</span> <span class="n">gb20</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb20</span><span class="o">.</span><span class="n">plot_cast_shape</span><span class="p">()</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>    <span class="c1"># Testing the shifted from the center objects generation</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>    <span class="k">if</span> <span class="n">test_computed_shifted_beads</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">test_computed_centered_beads</span><span class="p">:</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="n">gb1</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb1</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb1</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="n">gb2</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;lor&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb2</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb2</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>        <span class="n">gb3</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;dlogf&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb3</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb3</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="n">gb4</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;bump2&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb4</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb4</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>        <span class="n">gb5</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;bump3&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb5</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb5</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>        <span class="n">gb6</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;bump8&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb6</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb6</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>        <span class="n">gb7</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;smcir&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb7</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb7</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>        <span class="n">gb9</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;ovcir&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb9</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb9</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>        <span class="n">gb10</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s1">&#39;uncir&#39;</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb10</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb10</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>    <span class="k">if</span> <span class="n">test_precise_shifted_beads</span><span class="p">:</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>        <span class="n">gb8</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb8</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb8</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb8</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="k">if</span> <span class="n">test_casting</span><span class="p">:</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="n">gb8</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;uint8&#39;</span><span class="p">);</span> <span class="n">gb8</span><span class="o">.</span><span class="n">plot_cast_shape</span><span class="p">()</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>    <span class="c1"># Test of ellipse shaped objects generation</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>    <span class="k">if</span> <span class="n">test_ellipse_centered</span><span class="p">:</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>        <span class="n">gb11</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">));</span> <span class="n">gb11</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb11</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>        <span class="k">if</span> <span class="n">test_casting</span><span class="p">:</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>            <span class="n">gb11</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;uint8&#39;</span><span class="p">);</span> <span class="n">gb11</span><span class="o">.</span><span class="n">plot_cast_shape</span><span class="p">()</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>    <span class="k">if</span> <span class="n">test_ellipse_shifted</span><span class="p">:</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>        <span class="n">gb12</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">));</span> <span class="n">gb12</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb12</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb12</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>        <span class="k">if</span> <span class="n">test_casting</span><span class="p">:</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>            <span class="n">gb12</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;uint8&#39;</span><span class="p">);</span> <span class="n">gb12</span><span class="o">.</span><span class="n">plot_cast_shape</span><span class="p">()</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>    <span class="c1"># Testing cropping of shifted ellipse</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>    <span class="k">if</span> <span class="n">test_cropped_shapes</span><span class="p">:</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="n">gb12</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">4.4</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">));</span> <span class="n">gb12</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb12</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>    <span class="c1"># Testing of putting the manually generated objects on the scene</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>    <span class="k">if</span> <span class="n">test_put_objects</span><span class="p">:</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>        <span class="n">scene</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">21</span><span class="p">);</span> <span class="n">gb8</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.78</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts</span><span class="p">);</span> <span class="n">gb8</span><span class="o">.</span><span class="n">get_shape</span><span class="p">()</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>        <span class="n">gb12</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">4.9</span><span class="p">,</span> <span class="mf">2.8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">));</span> <span class="n">gb12</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb12</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>        <span class="n">gb8</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="mi">254</span><span class="p">);</span> <span class="n">gb8</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb12</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">()</span>  <span class="c1"># gb8.plot_shape(); gb12.plot_shape()</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>        <span class="n">gb8</span><span class="o">.</span><span class="n">set_image_sizes</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span> <span class="n">gb12</span><span class="o">.</span><span class="n">set_image_sizes</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span> <span class="n">gb8</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span> <span class="n">gb12</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>        <span class="n">gb9</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">));</span> <span class="n">gb9</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">gb9</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="mi">251</span><span class="p">)</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>        <span class="n">gb9</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">gb9</span><span class="o">.</span><span class="n">set_image_sizes</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">shape</span><span class="p">);</span> <span class="n">gb9</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">18</span><span class="p">))</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>        <span class="n">scene</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="p">(</span><span class="n">gb8</span><span class="p">,</span> <span class="n">gb12</span><span class="p">));</span> <span class="n">scene</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="p">(</span><span class="n">gb9</span><span class="p">,</span> <span class="p">));</span> <span class="n">scene</span><span class="o">.</span><span class="n">show_scene</span><span class="p">()</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>    <span class="c1"># Testing of generating scenes with various settings</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>    <span class="k">if</span> <span class="n">test_generate_objects</span><span class="p">:</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>        <span class="n">objs</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="mf">4.2</span><span class="p">,</span> <span class="n">size_std</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">shapes</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">230</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="n">n_objects</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="n">objs2</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="p">(</span><span class="mf">7.3</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">size_std</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.19</span><span class="p">),</span> <span class="n">shapes</span><span class="o">=</span><span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">n_objects</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>        <span class="n">scene</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">38</span><span class="p">);</span> <span class="n">objs</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs</span><span class="p">);</span> <span class="n">objs2</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs2</span><span class="p">)</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="n">scene</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs</span><span class="p">);</span> <span class="n">scene</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs2</span><span class="p">,</span> <span class="n">save_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span> <span class="n">scene</span><span class="o">.</span><span class="n">show_scene</span><span class="p">()</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>        <span class="c1"># scene2 = UscopeScene(width=55, height=46); scene2.show_scene()  # will show &#39;Blank&#39; image</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>    <span class="k">if</span> <span class="n">test_overall_gen</span><span class="p">:</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="n">objs3</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="p">(</span><span class="mf">8.3</span><span class="p">,</span> <span class="mf">5.4</span><span class="p">),</span> <span class="n">size_std</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mf">1.19</span><span class="p">),</span> <span class="n">shapes</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">182</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span> <span class="n">n_objects</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>        <span class="n">scene</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">46</span><span class="p">);</span> <span class="n">scene</span><span class="o">.</span><span class="n">spread_objects_on</span><span class="p">(</span><span class="n">objs3</span><span class="p">);</span> <span class="n">scene</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>    <span class="k">if</span> <span class="n">test_precise_shape_gen</span><span class="p">:</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>        <span class="n">objs4</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="p">(</span><span class="mf">6.21</span><span class="p">,</span> <span class="mf">5.36</span><span class="p">),</span> <span class="n">size_std</span><span class="o">=</span><span class="p">(</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">shapes</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">182</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>                                               <span class="n">n_objects</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>        <span class="n">scene</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">28</span><span class="p">);</span> <span class="n">scene2</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">28</span><span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>        <span class="n">objs4_placed</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs4</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>        <span class="n">scene</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs4</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene</span><span class="o">.</span><span class="n">show_scene</span><span class="p">()</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>        <span class="n">objs4_placed2</span> <span class="o">=</span> <span class="n">scene2</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs4</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>        <span class="n">scene2</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs4</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene2</span><span class="o">.</span><span class="n">show_scene</span><span class="p">()</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>    <span class="k">if</span> <span class="n">test_round_shaped_gen</span><span class="p">:</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>        <span class="n">objs5</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_round_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="mf">7.5</span><span class="p">,</span> <span class="n">size_std</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">188</span><span class="p">,</span> <span class="mi">251</span><span class="p">),</span> <span class="n">n_objects</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>        <span class="n">scene3</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>        <span class="n">objs5_pl</span> <span class="o">=</span> <span class="n">scene3</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs5</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>        <span class="n">scene3</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs5</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene3</span><span class="o">.</span><span class="n">show_scene</span><span class="p">()</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>    <span class="k">if</span> <span class="n">test_adding_noise</span><span class="p">:</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>        <span class="n">objs6</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="p">(</span><span class="mf">8.11</span><span class="p">,</span> <span class="mf">6.36</span><span class="p">),</span> <span class="n">size_std</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">),</span> <span class="n">shapes</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">245</span><span class="p">),</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>                                               <span class="n">n_objects</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>        <span class="n">scene</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">41</span><span class="p">)</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>        <span class="n">objs6_placed</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs6</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>        <span class="n">scene</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs6_placed</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="n">str_id</span><span class="o">=</span><span class="s2">&quot;Without additional noise&quot;</span><span class="p">)</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>        <span class="n">scene</span><span class="o">.</span><span class="n">add_noise</span><span class="p">();</span> <span class="n">scene</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="n">str_id</span><span class="o">=</span><span class="s2">&quot;With Poisson  &amp; Gaussian noise&quot;</span><span class="p">)</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>    <span class="c1"># Test adding noise to float image and various mean / sigma values</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>    <span class="k">if</span> <span class="n">test_various_noises</span><span class="p">:</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>        <span class="n">objs6</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="p">(</span><span class="mf">8.61</span><span class="p">,</span> <span class="mf">6.36</span><span class="p">),</span> <span class="n">size_std</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">),</span> <span class="n">shapes</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="mi">245</span><span class="p">),</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>                                               <span class="n">n_objects</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>        <span class="n">scene8</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">37</span><span class="p">)</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>        <span class="n">obj61_p</span> <span class="o">=</span> <span class="n">scene8</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs6</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>        <span class="n">scene8</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">obj61_p</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene8</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;Without additional noise&quot;</span><span class="p">)</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>        <span class="n">scene8</span><span class="o">.</span><span class="n">add_noise</span><span class="p">();</span> <span class="n">scene8</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;With default noise&quot;</span><span class="p">)</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>        <span class="n">scene8</span><span class="o">.</span><span class="n">add_noise</span><span class="p">(</span><span class="n">mean_noise</span><span class="o">=</span><span class="mi">180</span><span class="o">//</span><span class="mi">6</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="o">=</span><span class="mi">180</span><span class="o">//</span><span class="mi">9</span><span class="p">);</span> <span class="n">scene8</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;With stronger noise&quot;</span><span class="p">)</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>        <span class="n">scene8</span><span class="o">.</span><span class="n">add_noise</span><span class="p">(</span><span class="n">mean_noise</span><span class="o">=</span><span class="mi">180</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="o">=</span><span class="mi">180</span><span class="o">//</span><span class="mi">6</span><span class="p">);</span> <span class="n">scene8</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;With much more stronger noise&quot;</span><span class="p">)</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>        <span class="n">scene8</span><span class="o">.</span><span class="n">remove_noise</span><span class="p">();</span> <span class="n">scene8</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;Removed noise&quot;</span><span class="p">)</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>    <span class="c1"># Test reworked algorithm for placing large number of circles that should / not lay within the scene, not touching / overlapping</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>    <span class="k">if</span> <span class="n">test_placing_circles</span><span class="p">:</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>        <span class="n">objs12</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_round_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="mf">8.75</span><span class="p">,</span> <span class="n">size_std</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">),</span> <span class="n">n_objects</span><span class="o">=</span><span class="mi">21</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>        <span class="n">scene12</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">92</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">);</span> <span class="n">scene14</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">92</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">84</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">)</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>        <span class="n">objs12_placed</span> <span class="o">=</span> <span class="n">scene12</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs12</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>        <span class="n">scene12</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs12_placed</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene12</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;Circles within scene&quot;</span><span class="p">)</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>        <span class="n">objs12_pl2</span> <span class="o">=</span> <span class="n">scene14</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs12</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>        <span class="n">scene14</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs12_pl2</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene14</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;Circles partially within scene&quot;</span><span class="p">)</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>        <span class="n">scene15</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">41</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">41</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">);</span> <span class="n">objs12_pl3</span> <span class="o">=</span> <span class="n">scene14</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">objs12</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>        <span class="n">scene15</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">objs12_pl3</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene15</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;Circles default parameters&quot;</span><span class="p">)</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>    <span class="c1"># Preparing images for the documentation (README in the project repo)</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>    <span class="k">if</span> <span class="n">prepare_centered_docs_images</span><span class="p">:</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>        <span class="n">objs1</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s2">&quot;computed&quot;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s2">&quot;oversampled circle&quot;</span><span class="p">)</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>        <span class="n">objs2</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s2">&quot;computed&quot;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>        <span class="n">objs3</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s2">&quot;computed&quot;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s2">&quot;undersampled circle&quot;</span><span class="p">)</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>        <span class="n">objs1</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs1</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">objs2</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs2</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">objs3</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs3</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>        <span class="n">objs4</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">);</span> <span class="n">objs4</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs4</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>        <span class="n">objs5</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">4.8</span><span class="p">);</span> <span class="n">objs5</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs5</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">objs5</span><span class="o">.</span><span class="n">get_shaping_functions</span><span class="p">()</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>        <span class="n">objs6</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">4.8</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s2">&quot;co&quot;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s2">&quot;bump3&quot;</span><span class="p">);</span> <span class="n">objs6</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs6</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>    <span class="k">if</span> <span class="n">prepare_shifted_docs_images</span><span class="p">:</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>        <span class="n">objs7</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts_sample</span><span class="p">,</span> <span class="n">border_type</span><span class="o">=</span><span class="s2">&quot;computed&quot;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>        <span class="n">objs8</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="n">shifts_sample</span><span class="p">)</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>        <span class="n">objs7</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs7</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">objs8</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs8</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>    <span class="k">if</span> <span class="n">prepare_scene_samples</span><span class="p">:</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>        <span class="n">force_precompilation</span><span class="p">()</span>  <span class="c1"># forcing precompilation by numba</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>        <span class="n">samples1</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_random_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="p">(</span><span class="mf">9.11</span><span class="p">,</span> <span class="mf">6.56</span><span class="p">),</span> <span class="n">size_std</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">),</span> <span class="n">shapes</span><span class="o">=</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">185</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>                                                  <span class="n">n_objects</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">accelerated</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>        <span class="n">scene_s</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">72</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>        <span class="n">samples1_pl</span> <span class="o">=</span> <span class="n">scene_s</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">samples1</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>        <span class="n">scene_s</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">samples1_pl</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">scene_s</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;Scene without noise&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>        <span class="n">scene_s</span><span class="o">.</span><span class="n">add_noise</span><span class="p">();</span> <span class="n">scene_s</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="s2">&quot;Scene with added noise (default parameters)&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>    <span class="c1"># Testing acceleration by using numba compilation in the imported module</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>    <span class="k">if</span> <span class="n">test_compiling_acceleration</span><span class="p">:</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>        <span class="n">force_precompilation</span><span class="p">()</span>  <span class="c1"># force precompilation of functions by numba</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>        <span class="c1"># Repeat checks twice for repeatability</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>            <span class="c1"># Computing discrete round shape with the attempt to accelerate computation by using numba compilation in the module</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>            <span class="n">t_ov_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">();</span> <span class="n">objs10</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">12.0</span><span class="p">);</span> <span class="n">objs10</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">objs10</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>            <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_ov_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>            <span class="k">if</span> <span class="n">elapsed_time_ov</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>                <span class="n">elapsed_time_ov</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time_ov</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compiled round shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compiled round shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>            <span class="c1"># Standard computing discrete round shape</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>            <span class="n">t_ov_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">();</span> <span class="n">objs11</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">12.0</span><span class="p">);</span> <span class="n">objs11</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs11</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">()</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>            <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_ov_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>            <span class="k">if</span> <span class="n">elapsed_time_ov</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>                <span class="n">elapsed_time_ov</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time_ov</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard round shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard round shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>            <span class="c1"># Computing discrete ellipse shape with the attempt to accelerate computation by using numba compilation in the module</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>            <span class="n">t_ov_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">();</span> <span class="n">objs12</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>            <span class="n">objs12</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="n">objs12</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_ov_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>            <span class="k">if</span> <span class="n">elapsed_time_ov</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>                <span class="n">elapsed_time_ov</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time_ov</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compiled ellipse shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Compiled ellipse shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>            <span class="c1"># Standard computing discrete ellipse shape</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>            <span class="n">t_ov_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">();</span> <span class="n">objs13</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>            <span class="n">objs13</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">objs13</span><span class="o">.</span><span class="n">plot_shape</span><span class="p">();</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_ov_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>            <span class="k">if</span> <span class="n">elapsed_time_ov</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>                <span class="n">elapsed_time_ov</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time_ov</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard ellipse shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Standard ellipse shape computation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span> <span class="k">del</span> <span class="n">objs10</span><span class="p">,</span> <span class="n">objs11</span><span class="p">,</span> <span class="n">objs12</span><span class="p">,</span> <span class="n">objs13</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>    <span class="k">if</span> <span class="n">prepare_favicon_img</span><span class="p">:</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>        <span class="n">round_objs2</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">get_round_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">size_std</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">intensity_range</span><span class="o">=</span><span class="p">(</span><span class="mi">242</span><span class="p">,</span> <span class="mi">252</span><span class="p">),</span> <span class="n">n_objects</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>        <span class="n">scene_favicon</span> <span class="o">=</span> <span class="n">UscopeScene</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>        <span class="n">round_objs2</span> <span class="o">=</span> <span class="n">scene_favicon</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">round_objs2</span><span class="p">,</span> <span class="n">overlapping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">touching</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only_within_scene</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>        <span class="n">scene_favicon</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">round_objs2</span><span class="p">);</span> <span class="n">scene_favicon</span><span class="o">.</span><span class="n">add_noise</span><span class="p">();</span> <span class="n">scene_favicon</span><span class="o">.</span><span class="n">show_scene</span><span class="p">(</span><span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>        <span class="c1"># Saving generated image by using skimage (although not included in the dependencies)</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>            <span class="kn">import</span> <span class="nn">skimage</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>            <span class="n">skimage</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">imsave</span><span class="p">(</span><span class="s2">&quot;D:</span><span class="se">\\</span><span class="s2">Repos</span><span class="se">\\</span><span class="s2">fluoscenepy</span><span class="se">\\</span><span class="s2">docs</span><span class="se">\\</span><span class="s2">favicon.png&quot;</span><span class="p">,</span> <span class="n">scene_favicon</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>        <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>            <span class="k">pass</span>
</span></pre></div>


            </section>
                <section id="UscopeScene">
                            <input id="UscopeScene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">UscopeScene</span>:

                <label class="view-source-button" for="UscopeScene-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene-38"><a href="#UscopeScene-38"><span class="linenos"> 38</span></a><span class="k">class</span> <span class="nc">UscopeScene</span><span class="p">:</span>
</span><span id="UscopeScene-39"><a href="#UscopeScene-39"><span class="linenos"> 39</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-40"><a href="#UscopeScene-40"><span class="linenos"> 40</span></a><span class="sd">    Replicate the common fluorescence microscopic image (frame or &#39;scene&#39;).</span>
</span><span id="UscopeScene-41"><a href="#UscopeScene-41"><span class="linenos"> 41</span></a>
</span><span id="UscopeScene-42"><a href="#UscopeScene-42"><span class="linenos"> 42</span></a><span class="sd">    This class simulates the bright objects with round and elongate shapes as the basic examples of imaged objects. \n</span>
</span><span id="UscopeScene-43"><a href="#UscopeScene-43"><span class="linenos"> 43</span></a><span class="sd">    The ratio behind development of this class - to get the ground truth images for image processing workflows tests. \n</span>
</span><span id="UscopeScene-44"><a href="#UscopeScene-44"><span class="linenos"> 44</span></a><span class="sd">    For more complex and useful cases, please, check the References.</span>
</span><span id="UscopeScene-45"><a href="#UscopeScene-45"><span class="linenos"> 45</span></a>
</span><span id="UscopeScene-46"><a href="#UscopeScene-46"><span class="linenos"> 46</span></a><span class="sd">    References</span>
</span><span id="UscopeScene-47"><a href="#UscopeScene-47"><span class="linenos"> 47</span></a><span class="sd">    ----------</span>
</span><span id="UscopeScene-48"><a href="#UscopeScene-48"><span class="linenos"> 48</span></a><span class="sd">    For the used noise models, see the &#39;add_noise method&#39;.</span>
</span><span id="UscopeScene-49"><a href="#UscopeScene-49"><span class="linenos"> 49</span></a>
</span><span id="UscopeScene-50"><a href="#UscopeScene-50"><span class="linenos"> 50</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="UscopeScene-51"><a href="#UscopeScene-51"><span class="linenos"> 51</span></a>
</span><span id="UscopeScene-52"><a href="#UscopeScene-52"><span class="linenos"> 52</span></a>    <span class="c1"># Class parameters</span>
</span><span id="UscopeScene-53"><a href="#UscopeScene-53"><span class="linenos"> 53</span></a>    <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="n">__warn_message</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">max_pixel_value</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span>
</span><span id="UscopeScene-54"><a href="#UscopeScene-54"><span class="linenos"> 54</span></a>    <span class="n">acceptable_img_types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;uint8&#39;</span><span class="p">,</span> <span class="s1">&#39;uint16&#39;</span><span class="p">,</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span>
</span><span id="UscopeScene-55"><a href="#UscopeScene-55"><span class="linenos"> 55</span></a>    <span class="n">max_pixel_value_uint8</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="n">max_pixel_value_uint16</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span> <span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
</span><span id="UscopeScene-56"><a href="#UscopeScene-56"><span class="linenos"> 56</span></a>    <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">shape_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mixed&#39;</span><span class="p">,</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="s1">&#39;el&#39;</span><span class="p">];</span> <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="UscopeScene-57"><a href="#UscopeScene-57"><span class="linenos"> 57</span></a>    <span class="n">__image_cleared</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># for tracking that the scene was cleared (zeroed)</span>
</span><span id="UscopeScene-58"><a href="#UscopeScene-58"><span class="linenos"> 58</span></a>    <span class="n">__available_coordinates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">__binary_placement_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">denoised_image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="UscopeScene-59"><a href="#UscopeScene-59"><span class="linenos"> 59</span></a>    <span class="n">__restricted_coordinates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">__noise_added</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># for tracking that the noise has been added</span>
</span><span id="UscopeScene-60"><a href="#UscopeScene-60"><span class="linenos"> 60</span></a>
</span><span id="UscopeScene-61"><a href="#UscopeScene-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">):</span>
</span><span id="UscopeScene-62"><a href="#UscopeScene-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-63"><a href="#UscopeScene-63"><span class="linenos"> 63</span></a><span class="sd">        Initialize the class wrapper for store the current &quot;scene&quot; or microscopic image.</span>
</span><span id="UscopeScene-64"><a href="#UscopeScene-64"><span class="linenos"> 64</span></a>
</span><span id="UscopeScene-65"><a href="#UscopeScene-65"><span class="linenos"> 65</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-66"><a href="#UscopeScene-66"><span class="linenos"> 66</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-67"><a href="#UscopeScene-67"><span class="linenos"> 67</span></a><span class="sd">        width : int</span>
</span><span id="UscopeScene-68"><a href="#UscopeScene-68"><span class="linenos"> 68</span></a><span class="sd">            Width of the scene in pixels.</span>
</span><span id="UscopeScene-69"><a href="#UscopeScene-69"><span class="linenos"> 69</span></a><span class="sd">        height : int</span>
</span><span id="UscopeScene-70"><a href="#UscopeScene-70"><span class="linenos"> 70</span></a><span class="sd">            Height of the scene in pixels.</span>
</span><span id="UscopeScene-71"><a href="#UscopeScene-71"><span class="linenos"> 71</span></a><span class="sd">        image_type : str | np.uint8 | np.uint16 | np.float64, optional</span>
</span><span id="UscopeScene-72"><a href="#UscopeScene-72"><span class="linenos"> 72</span></a><span class="sd">            Image type, for supported ones see the acceptable types. The default is &#39;uint8&#39;.</span>
</span><span id="UscopeScene-73"><a href="#UscopeScene-73"><span class="linenos"> 73</span></a>
</span><span id="UscopeScene-74"><a href="#UscopeScene-74"><span class="linenos"> 74</span></a><span class="sd">        Raises</span>
</span><span id="UscopeScene-75"><a href="#UscopeScene-75"><span class="linenos"> 75</span></a><span class="sd">        ------</span>
</span><span id="UscopeScene-76"><a href="#UscopeScene-76"><span class="linenos"> 76</span></a><span class="sd">        ValueError</span>
</span><span id="UscopeScene-77"><a href="#UscopeScene-77"><span class="linenos"> 77</span></a><span class="sd">            If provided parameters are inconsistent, e.g. width or height &lt; 2.</span>
</span><span id="UscopeScene-78"><a href="#UscopeScene-78"><span class="linenos"> 78</span></a>
</span><span id="UscopeScene-79"><a href="#UscopeScene-79"><span class="linenos"> 79</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-80"><a href="#UscopeScene-80"><span class="linenos"> 80</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-81"><a href="#UscopeScene-81"><span class="linenos"> 81</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene-82"><a href="#UscopeScene-82"><span class="linenos"> 82</span></a>
</span><span id="UscopeScene-83"><a href="#UscopeScene-83"><span class="linenos"> 83</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-84"><a href="#UscopeScene-84"><span class="linenos"> 84</span></a>        <span class="c1"># Check provided width and height</span>
</span><span id="UscopeScene-85"><a href="#UscopeScene-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="UscopeScene-86"><a href="#UscopeScene-86"><span class="linenos"> 86</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided dimensions (</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">) is less than 4&quot;</span><span class="p">)</span>
</span><span id="UscopeScene-87"><a href="#UscopeScene-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
</span><span id="UscopeScene-88"><a href="#UscopeScene-88"><span class="linenos"> 88</span></a>            <span class="n">__warn_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Provided dimensions (</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">) pixels are unrealistic for the common image&quot;</span>
</span><span id="UscopeScene-89"><a href="#UscopeScene-89"><span class="linenos"> 89</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="UscopeScene-90"><a href="#UscopeScene-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span id="UscopeScene-91"><a href="#UscopeScene-91"><span class="linenos"> 91</span></a>        <span class="c1"># Check an image type</span>
</span><span id="UscopeScene-92"><a href="#UscopeScene-92"><span class="linenos"> 92</span></a>        <span class="k">if</span> <span class="n">image_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">:</span>
</span><span id="UscopeScene-93"><a href="#UscopeScene-93"><span class="linenos"> 93</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided image type &#39;</span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&#39; not in the acceptable list of types: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">))</span>
</span><span id="UscopeScene-94"><a href="#UscopeScene-94"><span class="linenos"> 94</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-95"><a href="#UscopeScene-95"><span class="linenos"> 95</span></a>            <span class="k">if</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="UscopeScene-96"><a href="#UscopeScene-96"><span class="linenos"> 96</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value_uint16</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span>
</span><span id="UscopeScene-97"><a href="#UscopeScene-97"><span class="linenos"> 97</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="UscopeScene-98"><a href="#UscopeScene-98"><span class="linenos"> 98</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
</span><span id="UscopeScene-99"><a href="#UscopeScene-99"><span class="linenos"> 99</span></a>        <span class="c1"># Initialize zero scene</span>
</span><span id="UscopeScene-100"><a href="#UscopeScene-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="UscopeScene-101"><a href="#UscopeScene-101"><span class="linenos">101</span></a>
</span><span id="UscopeScene-102"><a href="#UscopeScene-102"><span class="linenos">102</span></a>    <span class="c1"># %% Objects specification / generation</span>
</span><span id="UscopeScene-103"><a href="#UscopeScene-103"><span class="linenos">103</span></a>    <span class="nd">@classmethod</span>
</span><span id="UscopeScene-104"><a href="#UscopeScene-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">get_random_objects</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mean_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">size_std</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="UscopeScene-105"><a href="#UscopeScene-105"><span class="linenos">105</span></a>                           <span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shapes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">,</span>
</span><span id="UscopeScene-106"><a href="#UscopeScene-106"><span class="linenos">106</span></a>                           <span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="UscopeScene-107"><a href="#UscopeScene-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-108"><a href="#UscopeScene-108"><span class="linenos">108</span></a><span class="sd">        Generate objects with randomized shape sizes, for shapes: &#39;round&#39;, &#39;ellipse&#39;, &#39;mixed&#39; - last one for randomized choice</span>
</span><span id="UscopeScene-109"><a href="#UscopeScene-109"><span class="linenos">109</span></a><span class="sd">        between 2 first ones.</span>
</span><span id="UscopeScene-110"><a href="#UscopeScene-110"><span class="linenos">110</span></a>
</span><span id="UscopeScene-111"><a href="#UscopeScene-111"><span class="linenos">111</span></a><span class="sd">        Objects should be instances of FluorObj() class from this module.</span>
</span><span id="UscopeScene-112"><a href="#UscopeScene-112"><span class="linenos">112</span></a>
</span><span id="UscopeScene-113"><a href="#UscopeScene-113"><span class="linenos">113</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-114"><a href="#UscopeScene-114"><span class="linenos">114</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-115"><a href="#UscopeScene-115"><span class="linenos">115</span></a><span class="sd">        mean_size : Union[float, int, tuple]</span>
</span><span id="UscopeScene-116"><a href="#UscopeScene-116"><span class="linenos">116</span></a><span class="sd">            Mean size(-s) of randomized objects. Integer or float is supposed to be used for round particles, tuple - for ellipse.</span>
</span><span id="UscopeScene-117"><a href="#UscopeScene-117"><span class="linenos">117</span></a><span class="sd">        size_std : Union[float, int, tuple]</span>
</span><span id="UscopeScene-118"><a href="#UscopeScene-118"><span class="linenos">118</span></a><span class="sd">            Standard deviation of mean size(-s).</span>
</span><span id="UscopeScene-119"><a href="#UscopeScene-119"><span class="linenos">119</span></a><span class="sd">        intensity_range : tuple</span>
</span><span id="UscopeScene-120"><a href="#UscopeScene-120"><span class="linenos">120</span></a><span class="sd">            (Min, Max) intensities for randomized choice of the maximum intensity along the profile.</span>
</span><span id="UscopeScene-121"><a href="#UscopeScene-121"><span class="linenos">121</span></a><span class="sd">        n_objects : int, optional</span>
</span><span id="UscopeScene-122"><a href="#UscopeScene-122"><span class="linenos">122</span></a><span class="sd">            Number of generated objects. The default is 2.</span>
</span><span id="UscopeScene-123"><a href="#UscopeScene-123"><span class="linenos">123</span></a><span class="sd">        shapes : str, optional</span>
</span><span id="UscopeScene-124"><a href="#UscopeScene-124"><span class="linenos">124</span></a><span class="sd">            Implemented in FluorObj() shapes: &#39;round&#39;, &#39;ellipse&#39; or &#39;mixed&#39; them (randomly selected). The default is &#39;round&#39;.</span>
</span><span id="UscopeScene-125"><a href="#UscopeScene-125"><span class="linenos">125</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="UscopeScene-126"><a href="#UscopeScene-126"><span class="linenos">126</span></a><span class="sd">            Image type of the scene on which the objects will be placed and cast to. The default is &#39;uint8&#39;.</span>
</span><span id="UscopeScene-127"><a href="#UscopeScene-127"><span class="linenos">127</span></a><span class="sd">        verbose_info : bool, optional</span>
</span><span id="UscopeScene-128"><a href="#UscopeScene-128"><span class="linenos">128</span></a><span class="sd">            Flag for printing out verbose information about the generation progress (use it for many objects generation). The default is False.</span>
</span><span id="UscopeScene-129"><a href="#UscopeScene-129"><span class="linenos">129</span></a><span class="sd">        accelerated : bool, optional</span>
</span><span id="UscopeScene-130"><a href="#UscopeScene-130"><span class="linenos">130</span></a><span class="sd">            Flag for attempting acceleration of objects shape calculation by using &#39;numba&#39; library compilation.</span>
</span><span id="UscopeScene-131"><a href="#UscopeScene-131"><span class="linenos">131</span></a>
</span><span id="UscopeScene-132"><a href="#UscopeScene-132"><span class="linenos">132</span></a><span class="sd">        Raises</span>
</span><span id="UscopeScene-133"><a href="#UscopeScene-133"><span class="linenos">133</span></a><span class="sd">        ------</span>
</span><span id="UscopeScene-134"><a href="#UscopeScene-134"><span class="linenos">134</span></a><span class="sd">        ValueError</span>
</span><span id="UscopeScene-135"><a href="#UscopeScene-135"><span class="linenos">135</span></a><span class="sd">            See the provided description.</span>
</span><span id="UscopeScene-136"><a href="#UscopeScene-136"><span class="linenos">136</span></a>
</span><span id="UscopeScene-137"><a href="#UscopeScene-137"><span class="linenos">137</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-138"><a href="#UscopeScene-138"><span class="linenos">138</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-139"><a href="#UscopeScene-139"><span class="linenos">139</span></a><span class="sd">        tuple</span>
</span><span id="UscopeScene-140"><a href="#UscopeScene-140"><span class="linenos">140</span></a><span class="sd">            Packed instances of FluorObj() class.</span>
</span><span id="UscopeScene-141"><a href="#UscopeScene-141"><span class="linenos">141</span></a>
</span><span id="UscopeScene-142"><a href="#UscopeScene-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-143"><a href="#UscopeScene-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene-144"><a href="#UscopeScene-144"><span class="linenos">144</span></a>            <span class="n">t_ov_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="UscopeScene-145"><a href="#UscopeScene-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">shapes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">shape_types</span><span class="p">:</span>
</span><span id="UscopeScene-146"><a href="#UscopeScene-146"><span class="linenos">146</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please provide the supported shape type for generation from a list: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">shape_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="UscopeScene-147"><a href="#UscopeScene-147"><span class="linenos">147</span></a>        <span class="n">fl_objects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># for storing generated objects</span>
</span><span id="UscopeScene-148"><a href="#UscopeScene-148"><span class="linenos">148</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">r_std</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># default parameters for round objects</span>
</span><span id="UscopeScene-149"><a href="#UscopeScene-149"><span class="linenos">149</span></a>        <span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span> <span class="o">=</span> <span class="n">intensity_range</span>  <span class="c1"># assuming that only 2 values provided</span>
</span><span id="UscopeScene-150"><a href="#UscopeScene-150"><span class="linenos">150</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_objects</span><span class="p">):</span>
</span><span id="UscopeScene-151"><a href="#UscopeScene-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene-152"><a href="#UscopeScene-152"><span class="linenos">152</span></a>                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="UscopeScene-153"><a href="#UscopeScene-153"><span class="linenos">153</span></a>            <span class="k">if</span> <span class="n">shapes</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">:</span>
</span><span id="UscopeScene-154"><a href="#UscopeScene-154"><span class="linenos">154</span></a>                <span class="n">shape_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">])</span>
</span><span id="UscopeScene-155"><a href="#UscopeScene-155"><span class="linenos">155</span></a>                <span class="c1"># Define radius and radius std for round particles from the provided tuples for the ellipses (random choice between a and b)</span>
</span><span id="UscopeScene-156"><a href="#UscopeScene-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene-157"><a href="#UscopeScene-157"><span class="linenos">157</span></a>                    <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">mean_size</span><span class="p">)</span>
</span><span id="UscopeScene-158"><a href="#UscopeScene-158"><span class="linenos">158</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-159"><a href="#UscopeScene-159"><span class="linenos">159</span></a>                    <span class="n">r</span> <span class="o">=</span> <span class="n">mean_size</span>
</span><span id="UscopeScene-160"><a href="#UscopeScene-160"><span class="linenos">160</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_std</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene-161"><a href="#UscopeScene-161"><span class="linenos">161</span></a>                    <span class="n">r_std</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">size_std</span><span class="p">)</span>
</span><span id="UscopeScene-162"><a href="#UscopeScene-162"><span class="linenos">162</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-163"><a href="#UscopeScene-163"><span class="linenos">163</span></a>                    <span class="n">r_std</span> <span class="o">=</span> <span class="n">size_std</span>
</span><span id="UscopeScene-164"><a href="#UscopeScene-164"><span class="linenos">164</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-165"><a href="#UscopeScene-165"><span class="linenos">165</span></a>                <span class="n">shape_type</span> <span class="o">=</span> <span class="n">shapes</span>
</span><span id="UscopeScene-166"><a href="#UscopeScene-166"><span class="linenos">166</span></a>            <span class="c1"># Random selection of central shifts for placement</span>
</span><span id="UscopeScene-167"><a href="#UscopeScene-167"><span class="linenos">167</span></a>            <span class="n">i_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="n">j_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># random generation of central pixel shifts</span>
</span><span id="UscopeScene-168"><a href="#UscopeScene-168"><span class="linenos">168</span></a>            <span class="c1"># Checking that shifts are generated in the subpixel range and correcting it if not</span>
</span><span id="UscopeScene-169"><a href="#UscopeScene-169"><span class="linenos">169</span></a>            <span class="k">if</span> <span class="n">i_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene-170"><a href="#UscopeScene-170"><span class="linenos">170</span></a>                <span class="n">i_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene-171"><a href="#UscopeScene-171"><span class="linenos">171</span></a>            <span class="k">if</span> <span class="n">j_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene-172"><a href="#UscopeScene-172"><span class="linenos">172</span></a>                <span class="n">j_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene-173"><a href="#UscopeScene-173"><span class="linenos">173</span></a>            <span class="n">sign_i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]);</span> <span class="n">sign_j</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]);</span> <span class="n">i_shift</span> <span class="o">*=</span> <span class="n">sign_i</span><span class="p">;</span> <span class="n">j_shift</span> <span class="o">*=</span> <span class="n">sign_j</span>  <span class="c1"># random signs</span>
</span><span id="UscopeScene-174"><a href="#UscopeScene-174"><span class="linenos">174</span></a>            <span class="c1"># Random selection of max intensity for the profile casting</span>
</span><span id="UscopeScene-175"><a href="#UscopeScene-175"><span class="linenos">175</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="UscopeScene-176"><a href="#UscopeScene-176"><span class="linenos">176</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene-177"><a href="#UscopeScene-177"><span class="linenos">177</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="UscopeScene-178"><a href="#UscopeScene-178"><span class="linenos">178</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">)</span>
</span><span id="UscopeScene-179"><a href="#UscopeScene-179"><span class="linenos">179</span></a>            <span class="c1"># Round shaped object generation</span>
</span><span id="UscopeScene-180"><a href="#UscopeScene-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;round&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="UscopeScene-181"><a href="#UscopeScene-181"><span class="linenos">181</span></a>                <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r_std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene-182"><a href="#UscopeScene-182"><span class="linenos">182</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">r_std</span><span class="p">)</span>
</span><span id="UscopeScene-183"><a href="#UscopeScene-183"><span class="linenos">183</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-184"><a href="#UscopeScene-184"><span class="linenos">184</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_std</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene-185"><a href="#UscopeScene-185"><span class="linenos">185</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Provided tuple with sizes for round shape object, there expected only single number size&quot;</span><span class="p">)</span>
</span><span id="UscopeScene-186"><a href="#UscopeScene-186"><span class="linenos">186</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mean_size</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">size_std</span><span class="p">)</span>
</span><span id="UscopeScene-187"><a href="#UscopeScene-187"><span class="linenos">187</span></a>                <span class="c1"># Checking generated radius for consistency</span>
</span><span id="UscopeScene-188"><a href="#UscopeScene-188"><span class="linenos">188</span></a>                <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene-189"><a href="#UscopeScene-189"><span class="linenos">189</span></a>                    <span class="n">radius</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.6</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene-190"><a href="#UscopeScene-190"><span class="linenos">190</span></a>                <span class="c1"># Generating the object and calculating its shape, cast and crop it</span>
</span><span id="UscopeScene-191"><a href="#UscopeScene-191"><span class="linenos">191</span></a>                <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">));</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="n">accelerated</span><span class="p">)</span>
</span><span id="UscopeScene-192"><a href="#UscopeScene-192"><span class="linenos">192</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="UscopeScene-193"><a href="#UscopeScene-193"><span class="linenos">193</span></a>            <span class="c1"># Ellipse shaped object generation</span>
</span><span id="UscopeScene-194"><a href="#UscopeScene-194"><span class="linenos">194</span></a>            <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;ellipse&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;el&#39;</span><span class="p">:</span>
</span><span id="UscopeScene-195"><a href="#UscopeScene-195"><span class="linenos">195</span></a>                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">mean_size</span><span class="p">;</span> <span class="n">a_std</span><span class="p">,</span> <span class="n">b_std</span> <span class="o">=</span> <span class="n">size_std</span>  <span class="c1"># unpacking tuples assuming 2 of sizes packed there</span>
</span><span id="UscopeScene-196"><a href="#UscopeScene-196"><span class="linenos">196</span></a>                <span class="n">a_r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">a_std</span><span class="p">);</span> <span class="n">b_r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">b_std</span><span class="p">)</span>
</span><span id="UscopeScene-197"><a href="#UscopeScene-197"><span class="linenos">197</span></a>                <span class="n">angle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># get random orientation for an ellipse</span>
</span><span id="UscopeScene-198"><a href="#UscopeScene-198"><span class="linenos">198</span></a>                <span class="c1"># Checking generated a, b axes for consistency (min axis &gt;= 0.5, max axis &gt;= 1.0)</span>
</span><span id="UscopeScene-199"><a href="#UscopeScene-199"><span class="linenos">199</span></a>                <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene-200"><a href="#UscopeScene-200"><span class="linenos">200</span></a>                    <span class="n">a</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene-201"><a href="#UscopeScene-201"><span class="linenos">201</span></a>                <span class="k">elif</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene-202"><a href="#UscopeScene-202"><span class="linenos">202</span></a>                    <span class="n">b</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene-203"><a href="#UscopeScene-203"><span class="linenos">203</span></a>                <span class="n">max_axis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="UscopeScene-204"><a href="#UscopeScene-204"><span class="linenos">204</span></a>                <span class="k">if</span> <span class="n">max_axis</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene-205"><a href="#UscopeScene-205"><span class="linenos">205</span></a>                    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">max_axis</span><span class="p">:</span>
</span><span id="UscopeScene-206"><a href="#UscopeScene-206"><span class="linenos">206</span></a>                        <span class="n">a</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.1</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</span><span id="UscopeScene-207"><a href="#UscopeScene-207"><span class="linenos">207</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-208"><a href="#UscopeScene-208"><span class="linenos">208</span></a>                        <span class="n">b</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.1</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</span><span id="UscopeScene-209"><a href="#UscopeScene-209"><span class="linenos">209</span></a>                <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="n">a_r</span><span class="p">,</span> <span class="n">b_r</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">),</span> <span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">)</span>
</span><span id="UscopeScene-210"><a href="#UscopeScene-210"><span class="linenos">210</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="n">accelerated</span><span class="p">);</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">()</span>  <span class="c1"># calculate normalized shape and crop it</span>
</span><span id="UscopeScene-211"><a href="#UscopeScene-211"><span class="linenos">211</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="UscopeScene-212"><a href="#UscopeScene-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene-213"><a href="#UscopeScene-213"><span class="linenos">213</span></a>                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="UscopeScene-214"><a href="#UscopeScene-214"><span class="linenos">214</span></a>                <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="UscopeScene-215"><a href="#UscopeScene-215"><span class="linenos">215</span></a>                    <span class="n">elapsed_time</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene-216"><a href="#UscopeScene-216"><span class="linenos">216</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated obj. #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2">, elapsed </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene-217"><a href="#UscopeScene-217"><span class="linenos">217</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-218"><a href="#UscopeScene-218"><span class="linenos">218</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated obj. #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2">, elapsed </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> msec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene-219"><a href="#UscopeScene-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene-220"><a href="#UscopeScene-220"><span class="linenos">220</span></a>            <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_ov_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="UscopeScene-221"><a href="#UscopeScene-221"><span class="linenos">221</span></a>            <span class="k">if</span> <span class="n">elapsed_time_ov</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="UscopeScene-222"><a href="#UscopeScene-222"><span class="linenos">222</span></a>                <span class="n">elapsed_time_ov</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time_ov</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene-223"><a href="#UscopeScene-223"><span class="linenos">223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall generation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene-224"><a href="#UscopeScene-224"><span class="linenos">224</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-225"><a href="#UscopeScene-225"><span class="linenos">225</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall generation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene-226"><a href="#UscopeScene-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fl_objects</span><span class="p">)</span>
</span><span id="UscopeScene-227"><a href="#UscopeScene-227"><span class="linenos">227</span></a>
</span><span id="UscopeScene-228"><a href="#UscopeScene-228"><span class="linenos">228</span></a>    <span class="nd">@staticmethod</span>
</span><span id="UscopeScene-229"><a href="#UscopeScene-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="nf">get_round_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">size_std</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shape_r_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mixed&#39;</span><span class="p">,</span>
</span><span id="UscopeScene-230"><a href="#UscopeScene-230"><span class="linenos">230</span></a>                          <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="UscopeScene-231"><a href="#UscopeScene-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-232"><a href="#UscopeScene-232"><span class="linenos">232</span></a><span class="sd">        Generate round shaped objects (as FluorObj class instances) with continuous shapes (see FluorObj class documentation).</span>
</span><span id="UscopeScene-233"><a href="#UscopeScene-233"><span class="linenos">233</span></a>
</span><span id="UscopeScene-234"><a href="#UscopeScene-234"><span class="linenos">234</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-235"><a href="#UscopeScene-235"><span class="linenos">235</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-236"><a href="#UscopeScene-236"><span class="linenos">236</span></a><span class="sd">        mean_size : float</span>
</span><span id="UscopeScene-237"><a href="#UscopeScene-237"><span class="linenos">237</span></a><span class="sd">            Mean size of objects in pixels.</span>
</span><span id="UscopeScene-238"><a href="#UscopeScene-238"><span class="linenos">238</span></a><span class="sd">        size_std : float</span>
</span><span id="UscopeScene-239"><a href="#UscopeScene-239"><span class="linenos">239</span></a><span class="sd">            Standard deviation of objects sizes.</span>
</span><span id="UscopeScene-240"><a href="#UscopeScene-240"><span class="linenos">240</span></a><span class="sd">        intensity_range : tuple</span>
</span><span id="UscopeScene-241"><a href="#UscopeScene-241"><span class="linenos">241</span></a><span class="sd">            Intensity range for selection of maximum object intensity.</span>
</span><span id="UscopeScene-242"><a href="#UscopeScene-242"><span class="linenos">242</span></a><span class="sd">        n_objects : int, optional</span>
</span><span id="UscopeScene-243"><a href="#UscopeScene-243"><span class="linenos">243</span></a><span class="sd">            Number of generated objects. The default is 2.</span>
</span><span id="UscopeScene-244"><a href="#UscopeScene-244"><span class="linenos">244</span></a><span class="sd">        shape_r_type : str, optional</span>
</span><span id="UscopeScene-245"><a href="#UscopeScene-245"><span class="linenos">245</span></a><span class="sd">            Acceptable by FluorObj class round and computed shape types. The default is &#39;mixed&#39;.</span>
</span><span id="UscopeScene-246"><a href="#UscopeScene-246"><span class="linenos">246</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="UscopeScene-247"><a href="#UscopeScene-247"><span class="linenos">247</span></a><span class="sd">            Type of image used for a scene. The default is &#39;uint8&#39;.</span>
</span><span id="UscopeScene-248"><a href="#UscopeScene-248"><span class="linenos">248</span></a>
</span><span id="UscopeScene-249"><a href="#UscopeScene-249"><span class="linenos">249</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-250"><a href="#UscopeScene-250"><span class="linenos">250</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-251"><a href="#UscopeScene-251"><span class="linenos">251</span></a><span class="sd">        tuple</span>
</span><span id="UscopeScene-252"><a href="#UscopeScene-252"><span class="linenos">252</span></a><span class="sd">            Generated objects.</span>
</span><span id="UscopeScene-253"><a href="#UscopeScene-253"><span class="linenos">253</span></a>
</span><span id="UscopeScene-254"><a href="#UscopeScene-254"><span class="linenos">254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-255"><a href="#UscopeScene-255"><span class="linenos">255</span></a>        <span class="n">fl_objects</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span> <span class="o">=</span> <span class="n">intensity_range</span>
</span><span id="UscopeScene-256"><a href="#UscopeScene-256"><span class="linenos">256</span></a>        <span class="n">shape_types</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="o">.</span><span class="n">valuable_round_shapes</span><span class="p">[:];</span> <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shape_types</span><span class="p">)</span>
</span><span id="UscopeScene-257"><a href="#UscopeScene-257"><span class="linenos">257</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_objects</span><span class="p">):</span>
</span><span id="UscopeScene-258"><a href="#UscopeScene-258"><span class="linenos">258</span></a>            <span class="c1"># Random selection of central shifts for placement</span>
</span><span id="UscopeScene-259"><a href="#UscopeScene-259"><span class="linenos">259</span></a>            <span class="n">i_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="n">j_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># random generation of central pixel shifts</span>
</span><span id="UscopeScene-260"><a href="#UscopeScene-260"><span class="linenos">260</span></a>            <span class="c1"># Checking that shifts are generated in the subpixel range and correcting it if not</span>
</span><span id="UscopeScene-261"><a href="#UscopeScene-261"><span class="linenos">261</span></a>            <span class="k">if</span> <span class="n">i_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene-262"><a href="#UscopeScene-262"><span class="linenos">262</span></a>                <span class="n">i_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene-263"><a href="#UscopeScene-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="n">j_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene-264"><a href="#UscopeScene-264"><span class="linenos">264</span></a>                <span class="n">j_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene-265"><a href="#UscopeScene-265"><span class="linenos">265</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mean_size</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">size_std</span><span class="p">)</span>  <span class="c1"># get the radius from Gaussian distribution</span>
</span><span id="UscopeScene-266"><a href="#UscopeScene-266"><span class="linenos">266</span></a>            <span class="c1"># Random selection of max intensity for the profile casting</span>
</span><span id="UscopeScene-267"><a href="#UscopeScene-267"><span class="linenos">267</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="UscopeScene-268"><a href="#UscopeScene-268"><span class="linenos">268</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene-269"><a href="#UscopeScene-269"><span class="linenos">269</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="UscopeScene-270"><a href="#UscopeScene-270"><span class="linenos">270</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">)</span>
</span><span id="UscopeScene-271"><a href="#UscopeScene-271"><span class="linenos">271</span></a>            <span class="c1"># Checking generated radius for consistency</span>
</span><span id="UscopeScene-272"><a href="#UscopeScene-272"><span class="linenos">272</span></a>            <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene-273"><a href="#UscopeScene-273"><span class="linenos">273</span></a>                <span class="n">radius</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.6</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene-274"><a href="#UscopeScene-274"><span class="linenos">274</span></a>            <span class="c1"># If mixed type, selecting randomly the shape type</span>
</span><span id="UscopeScene-275"><a href="#UscopeScene-275"><span class="linenos">275</span></a>            <span class="k">if</span> <span class="n">shape_r_type</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">:</span>
</span><span id="UscopeScene-276"><a href="#UscopeScene-276"><span class="linenos">276</span></a>                <span class="n">shape_sel_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">shape_types</span><span class="p">)</span>
</span><span id="UscopeScene-277"><a href="#UscopeScene-277"><span class="linenos">277</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-278"><a href="#UscopeScene-278"><span class="linenos">278</span></a>                <span class="n">shape_sel_type</span> <span class="o">=</span> <span class="n">shape_r_type</span>
</span><span id="UscopeScene-279"><a href="#UscopeScene-279"><span class="linenos">279</span></a>            <span class="c1"># Generating the round shaped object with continuous function used for shape calculation</span>
</span><span id="UscopeScene-280"><a href="#UscopeScene-280"><span class="linenos">280</span></a>            <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">),</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="n">shape_sel_type</span><span class="p">)</span>
</span><span id="UscopeScene-281"><a href="#UscopeScene-281"><span class="linenos">281</span></a>            <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">()</span>  <span class="c1"># calculate normalized shape and crop it</span>
</span><span id="UscopeScene-282"><a href="#UscopeScene-282"><span class="linenos">282</span></a>            <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="UscopeScene-283"><a href="#UscopeScene-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fl_objects</span><span class="p">)</span>
</span><span id="UscopeScene-284"><a href="#UscopeScene-284"><span class="linenos">284</span></a>
</span><span id="UscopeScene-285"><a href="#UscopeScene-285"><span class="linenos">285</span></a>    <span class="c1"># %% Randomly assigning coordinates for objects</span>
</span><span id="UscopeScene-286"><a href="#UscopeScene-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">set_random_places</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">overlapping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">touching</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="UscopeScene-287"><a href="#UscopeScene-287"><span class="linenos">287</span></a>                          <span class="n">only_within_scene</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="UscopeScene-288"><a href="#UscopeScene-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-289"><a href="#UscopeScene-289"><span class="linenos">289</span></a><span class="sd">        Set random coordinates within scene (or partially outside) for provided objects.</span>
</span><span id="UscopeScene-290"><a href="#UscopeScene-290"><span class="linenos">290</span></a>
</span><span id="UscopeScene-291"><a href="#UscopeScene-291"><span class="linenos">291</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-292"><a href="#UscopeScene-292"><span class="linenos">292</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-293"><a href="#UscopeScene-293"><span class="linenos">293</span></a><span class="sd">        fluo_objects : tuple, optional</span>
</span><span id="UscopeScene-294"><a href="#UscopeScene-294"><span class="linenos">294</span></a><span class="sd">            Tuple with generated instances of FluorObj() class. The default is ().</span>
</span><span id="UscopeScene-295"><a href="#UscopeScene-295"><span class="linenos">295</span></a><span class="sd">        overlapping : bool, optional</span>
</span><span id="UscopeScene-296"><a href="#UscopeScene-296"><span class="linenos">296</span></a><span class="sd">            If True, the coordinates will be randomly selected from available ones. \n</span>
</span><span id="UscopeScene-297"><a href="#UscopeScene-297"><span class="linenos">297</span></a><span class="sd">            If False, the largest object will be placed firstly, and others will be placed after with checking that the object to be placed</span>
</span><span id="UscopeScene-298"><a href="#UscopeScene-298"><span class="linenos">298</span></a><span class="sd">            are not intersected with the already placed objects on previous iterations. \n</span>
</span><span id="UscopeScene-299"><a href="#UscopeScene-299"><span class="linenos">299</span></a><span class="sd">            The default is True.</span>
</span><span id="UscopeScene-300"><a href="#UscopeScene-300"><span class="linenos">300</span></a><span class="sd">        touching : bool, optional</span>
</span><span id="UscopeScene-301"><a href="#UscopeScene-301"><span class="linenos">301</span></a><span class="sd">            Flag for allowing objects to touch by their border pixels. Note that if overlapping is True, this flag ignored.</span>
</span><span id="UscopeScene-302"><a href="#UscopeScene-302"><span class="linenos">302</span></a><span class="sd">            The default is True.</span>
</span><span id="UscopeScene-303"><a href="#UscopeScene-303"><span class="linenos">303</span></a><span class="sd">        only_within_scene : bool, optional</span>
</span><span id="UscopeScene-304"><a href="#UscopeScene-304"><span class="linenos">304</span></a><span class="sd">            If True, the objects will be placed completely within (inside) the scene. \n</span>
</span><span id="UscopeScene-305"><a href="#UscopeScene-305"><span class="linenos">305</span></a><span class="sd">            If False, objects may lay partially outside the scene. The default is False.</span>
</span><span id="UscopeScene-306"><a href="#UscopeScene-306"><span class="linenos">306</span></a><span class="sd">        verbose_info : bool, optional</span>
</span><span id="UscopeScene-307"><a href="#UscopeScene-307"><span class="linenos">307</span></a><span class="sd">            Printing out verbose information about performance of placement. The default is False.</span>
</span><span id="UscopeScene-308"><a href="#UscopeScene-308"><span class="linenos">308</span></a>
</span><span id="UscopeScene-309"><a href="#UscopeScene-309"><span class="linenos">309</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-310"><a href="#UscopeScene-310"><span class="linenos">310</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-311"><a href="#UscopeScene-311"><span class="linenos">311</span></a><span class="sd">        tuple</span>
</span><span id="UscopeScene-312"><a href="#UscopeScene-312"><span class="linenos">312</span></a><span class="sd">            With the placed objects.</span>
</span><span id="UscopeScene-313"><a href="#UscopeScene-313"><span class="linenos">313</span></a>
</span><span id="UscopeScene-314"><a href="#UscopeScene-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-315"><a href="#UscopeScene-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-316"><a href="#UscopeScene-316"><span class="linenos">316</span></a>            <span class="c1"># For making verbose information printouts, check the time performance of placement logic</span>
</span><span id="UscopeScene-317"><a href="#UscopeScene-317"><span class="linenos">317</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene-318"><a href="#UscopeScene-318"><span class="linenos">318</span></a>                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">();</span> <span class="n">n_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>
</span><span id="UscopeScene-319"><a href="#UscopeScene-319"><span class="linenos">319</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># height and width of the image for setting the range of coordinates random selection</span>
</span><span id="UscopeScene-320"><a href="#UscopeScene-320"><span class="linenos">320</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene-321"><a href="#UscopeScene-321"><span class="linenos">321</span></a>                <span class="n">filtered_fluo_obj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># storing the objects in the list for excluding the not placed objects if they are not overlapped</span>
</span><span id="UscopeScene-322"><a href="#UscopeScene-322"><span class="linenos">322</span></a>                <span class="n">additional_border</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="UscopeScene-323"><a href="#UscopeScene-323"><span class="linenos">323</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">touching</span><span class="p">:</span>
</span><span id="UscopeScene-324"><a href="#UscopeScene-324"><span class="linenos">324</span></a>                    <span class="n">additional_border</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># additional 2 pixels for excluding the pixels close to the object borders</span>
</span><span id="UscopeScene-325"><a href="#UscopeScene-325"><span class="linenos">325</span></a>            <span class="c1"># If only_within_scene, sort out the objects based on their sizes and place first the largest one, if not - the smallest one</span>
</span><span id="UscopeScene-326"><a href="#UscopeScene-326"><span class="linenos">326</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">or</span> <span class="p">(</span><span class="n">overlapping</span> <span class="ow">and</span> <span class="n">only_within_scene</span><span class="p">):</span>
</span><span id="UscopeScene-327"><a href="#UscopeScene-327"><span class="linenos">327</span></a>                <span class="n">fluo_objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>  <span class="c1"># convert for applying embedded sorting algorithm</span>
</span><span id="UscopeScene-328"><a href="#UscopeScene-328"><span class="linenos">328</span></a>            <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene-329"><a href="#UscopeScene-329"><span class="linenos">329</span></a>                <span class="n">fluo_objects</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene-330"><a href="#UscopeScene-330"><span class="linenos">330</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene-331"><a href="#UscopeScene-331"><span class="linenos">331</span></a>                <span class="n">fluo_objects</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="UscopeScene-332"><a href="#UscopeScene-332"><span class="linenos">332</span></a>            <span class="c1"># Generating and set random placing coordinates of the upper left pixel for the objects</span>
</span><span id="UscopeScene-333"><a href="#UscopeScene-333"><span class="linenos">333</span></a>            <span class="n">placed_objects</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for printing out the number of placed objects</span>
</span><span id="UscopeScene-334"><a href="#UscopeScene-334"><span class="linenos">334</span></a>            <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">fluo_objects</span><span class="p">:</span>
</span><span id="UscopeScene-335"><a href="#UscopeScene-335"><span class="linenos">335</span></a>                <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene-336"><a href="#UscopeScene-336"><span class="linenos">336</span></a>                    <span class="n">h_fl_obj</span><span class="p">,</span> <span class="n">w_fl_obj</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># get object sizes</span>
</span><span id="UscopeScene-337"><a href="#UscopeScene-337"><span class="linenos">337</span></a>                    <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_image_sizes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># force to account for the used scene shape</span>
</span><span id="UscopeScene-338"><a href="#UscopeScene-338"><span class="linenos">338</span></a>                    <span class="c1"># Placement logic, if overlapping is allowed - just random spreading objects on the scene</span>
</span><span id="UscopeScene-339"><a href="#UscopeScene-339"><span class="linenos">339</span></a>                    <span class="k">if</span> <span class="n">overlapping</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="UscopeScene-340"><a href="#UscopeScene-340"><span class="linenos">340</span></a>                        <span class="c1"># Depending on the flag, defining smallest and largest coordinates (outside the scene borders or only inside)</span>
</span><span id="UscopeScene-341"><a href="#UscopeScene-341"><span class="linenos">341</span></a>                        <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene-342"><a href="#UscopeScene-342"><span class="linenos">342</span></a>                            <span class="n">i_smallest</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_smallest</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i_largest</span> <span class="o">=</span> <span class="n">h</span><span class="o">-</span><span class="n">h_fl_obj</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">j_largest</span> <span class="o">=</span> <span class="n">w</span><span class="o">-</span><span class="n">w_fl_obj</span><span class="o">-</span><span class="mi">1</span>
</span><span id="UscopeScene-343"><a href="#UscopeScene-343"><span class="linenos">343</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-344"><a href="#UscopeScene-344"><span class="linenos">344</span></a>                            <span class="c1"># smallest placing coordinate = half of object sizes - 1 pixel, analogous for largest coordinates</span>
</span><span id="UscopeScene-345"><a href="#UscopeScene-345"><span class="linenos">345</span></a>                            <span class="n">i_smallest</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">h_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_smallest</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">w_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="UscopeScene-346"><a href="#UscopeScene-346"><span class="linenos">346</span></a>                            <span class="n">i_largest</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">h_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j_largest</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">w_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="UscopeScene-347"><a href="#UscopeScene-347"><span class="linenos">347</span></a>                        <span class="c1"># Random selection of i, j coordinates below</span>
</span><span id="UscopeScene-348"><a href="#UscopeScene-348"><span class="linenos">348</span></a>                        <span class="n">i_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene-349"><a href="#UscopeScene-349"><span class="linenos">349</span></a>                        <span class="c1"># Not overlapping, below - place the largest object and create the mask for preventing the overlapping</span>
</span><span id="UscopeScene-350"><a href="#UscopeScene-350"><span class="linenos">350</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene-351"><a href="#UscopeScene-351"><span class="linenos">351</span></a>                            <span class="c1"># Generate the meshgrid of all available for placing coordinates (depending on the placement flag)</span>
</span><span id="UscopeScene-352"><a href="#UscopeScene-352"><span class="linenos">352</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene-353"><a href="#UscopeScene-353"><span class="linenos">353</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">)</span>
</span><span id="UscopeScene-354"><a href="#UscopeScene-354"><span class="linenos">354</span></a>                                                                <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">)]</span>
</span><span id="UscopeScene-355"><a href="#UscopeScene-355"><span class="linenos">355</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-356"><a href="#UscopeScene-356"><span class="linenos">356</span></a>                                <span class="c1"># Below - keep the possible placement close to bottom and right edges of the scene and remove them later</span>
</span><span id="UscopeScene-357"><a href="#UscopeScene-357"><span class="linenos">357</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="UscopeScene-358"><a href="#UscopeScene-358"><span class="linenos">358</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">)</span>
</span><span id="UscopeScene-359"><a href="#UscopeScene-359"><span class="linenos">359</span></a>                                                                 <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">)]</span>
</span><span id="UscopeScene-360"><a href="#UscopeScene-360"><span class="linenos">360</span></a>                            <span class="c1"># Generate and placing objects on the binary mask (instead of the real image or scene)</span>
</span><span id="UscopeScene-361"><a href="#UscopeScene-361"><span class="linenos">361</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
</span><span id="UscopeScene-362"><a href="#UscopeScene-362"><span class="linenos">362</span></a>                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">):</span>
</span><span id="UscopeScene-363"><a href="#UscopeScene-363"><span class="linenos">363</span></a>                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">):</span>
</span><span id="UscopeScene-364"><a href="#UscopeScene-364"><span class="linenos">364</span></a>                                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="UscopeScene-365"><a href="#UscopeScene-365"><span class="linenos">365</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="UscopeScene-366"><a href="#UscopeScene-366"><span class="linenos">366</span></a>                            <span class="c1"># Exclude the coordinates occupied by the placed object from the available choices for further placements</span>
</span><span id="UscopeScene-367"><a href="#UscopeScene-367"><span class="linenos">367</span></a>                            <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)</span>
</span><span id="UscopeScene-368"><a href="#UscopeScene-368"><span class="linenos">368</span></a>                                                   <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)]</span>
</span><span id="UscopeScene-369"><a href="#UscopeScene-369"><span class="linenos">369</span></a>                            <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="UscopeScene-370"><a href="#UscopeScene-370"><span class="linenos">370</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene-371"><a href="#UscopeScene-371"><span class="linenos">371</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene-372"><a href="#UscopeScene-372"><span class="linenos">372</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene-373"><a href="#UscopeScene-373"><span class="linenos">373</span></a>                                    <span class="k">pass</span>
</span><span id="UscopeScene-374"><a href="#UscopeScene-374"><span class="linenos">374</span></a>                            <span class="n">filtered_fluo_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluo_obj</span><span class="p">)</span>  <span class="c1"># storing the 1st placed and not overlapped objects</span>
</span><span id="UscopeScene-375"><a href="#UscopeScene-375"><span class="linenos">375</span></a>                            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="p">)</span>  <span class="c1"># shuffle available coordinates</span>
</span><span id="UscopeScene-376"><a href="#UscopeScene-376"><span class="linenos">376</span></a>                        <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>  <span class="c1"># set random place of the object within the image</span>
</span><span id="UscopeScene-377"><a href="#UscopeScene-377"><span class="linenos">377</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">verbose_info</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene-378"><a href="#UscopeScene-378"><span class="linenos">378</span></a>                            <span class="n">placed_objects</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of placed objects:&quot;</span><span class="p">,</span> <span class="n">placed_objects</span><span class="p">,</span> <span class="s2">&quot;out of&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="UscopeScene-379"><a href="#UscopeScene-379"><span class="linenos">379</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-380"><a href="#UscopeScene-380"><span class="linenos">380</span></a>                        <span class="c1"># Trying to place the object in the randomly selected from remaining coordinates place and checking if there is no</span>
</span><span id="UscopeScene-381"><a href="#UscopeScene-381"><span class="linenos">381</span></a>                        <span class="c1"># intersections with already placed objects, regulate # of attempts to place below in the while condition</span>
</span><span id="UscopeScene-382"><a href="#UscopeScene-382"><span class="linenos">382</span></a>                        <span class="n">i_attempts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">available_correcting_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="p">[:]</span>
</span><span id="UscopeScene-383"><a href="#UscopeScene-383"><span class="linenos">383</span></a>                        <span class="c1"># Adapting max number of attempts</span>
</span><span id="UscopeScene-384"><a href="#UscopeScene-384"><span class="linenos">384</span></a>                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">:</span>
</span><span id="UscopeScene-385"><a href="#UscopeScene-385"><span class="linenos">385</span></a>                            <span class="n">max_attempts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene-386"><a href="#UscopeScene-386"><span class="linenos">386</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-387"><a href="#UscopeScene-387"><span class="linenos">387</span></a>                            <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># limiting max number of attempts to find suitable coordinates</span>
</span><span id="UscopeScene-388"><a href="#UscopeScene-388"><span class="linenos">388</span></a>                        <span class="c1"># Trying to place the object and check for intersections with the other ones</span>
</span><span id="UscopeScene-389"><a href="#UscopeScene-389"><span class="linenos">389</span></a>                        <span class="n">border_coordinates_deleted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="UscopeScene-390"><a href="#UscopeScene-390"><span class="linenos">390</span></a>                        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">placed</span> <span class="ow">and</span> <span class="n">i_attempts</span> <span class="o">&lt;</span> <span class="n">max_attempts</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-391"><a href="#UscopeScene-391"><span class="linenos">391</span></a>                            <span class="n">overlapped</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for checking if the object is overlapped with the occupied place on a binary mask</span>
</span><span id="UscopeScene-392"><a href="#UscopeScene-392"><span class="linenos">392</span></a>                            <span class="c1"># randomly choose from the available coordinates</span>
</span><span id="UscopeScene-393"><a href="#UscopeScene-393"><span class="linenos">393</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene-394"><a href="#UscopeScene-394"><span class="linenos">394</span></a>                                <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene-395"><a href="#UscopeScene-395"><span class="linenos">395</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-396"><a href="#UscopeScene-396"><span class="linenos">396</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">border_coordinates_deleted</span><span class="p">:</span>
</span><span id="UscopeScene-397"><a href="#UscopeScene-397"><span class="linenos">397</span></a>                                    <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene-398"><a href="#UscopeScene-398"><span class="linenos">398</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-399"><a href="#UscopeScene-399"><span class="linenos">399</span></a>                                    <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene-400"><a href="#UscopeScene-400"><span class="linenos">400</span></a>                            <span class="c1"># Vectorized form of the overlapping check</span>
</span><span id="UscopeScene-401"><a href="#UscopeScene-401"><span class="linenos">401</span></a>                            <span class="n">i_max</span><span class="p">,</span> <span class="n">j_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">i_max</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_max</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="UscopeScene-402"><a href="#UscopeScene-402"><span class="linenos">402</span></a>                            <span class="c1"># Define the region of the placement mask for checking</span>
</span><span id="UscopeScene-403"><a href="#UscopeScene-403"><span class="linenos">403</span></a>                            <span class="k">if</span> <span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-404"><a href="#UscopeScene-404"><span class="linenos">404</span></a>                                <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="UscopeScene-405"><a href="#UscopeScene-405"><span class="linenos">405</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-406"><a href="#UscopeScene-406"><span class="linenos">406</span></a>                                <span class="n">i_start</span> <span class="o">=</span> <span class="n">i_obj</span> <span class="o">-</span> <span class="n">additional_border</span>
</span><span id="UscopeScene-407"><a href="#UscopeScene-407"><span class="linenos">407</span></a>                            <span class="k">if</span> <span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-408"><a href="#UscopeScene-408"><span class="linenos">408</span></a>                                <span class="n">j_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="UscopeScene-409"><a href="#UscopeScene-409"><span class="linenos">409</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-410"><a href="#UscopeScene-410"><span class="linenos">410</span></a>                                <span class="n">j_start</span> <span class="o">=</span> <span class="n">j_obj</span> <span class="o">-</span> <span class="n">additional_border</span>
</span><span id="UscopeScene-411"><a href="#UscopeScene-411"><span class="linenos">411</span></a>                            <span class="k">if</span> <span class="n">i_obj</span> <span class="o">+</span> <span class="n">h_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span> <span class="o">&gt;</span> <span class="n">i_max</span><span class="p">:</span>
</span><span id="UscopeScene-412"><a href="#UscopeScene-412"><span class="linenos">412</span></a>                                <span class="n">i_finish</span> <span class="o">=</span> <span class="n">i_max</span>
</span><span id="UscopeScene-413"><a href="#UscopeScene-413"><span class="linenos">413</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-414"><a href="#UscopeScene-414"><span class="linenos">414</span></a>                                <span class="n">i_finish</span> <span class="o">=</span> <span class="n">i_obj</span> <span class="o">+</span> <span class="n">h_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span>
</span><span id="UscopeScene-415"><a href="#UscopeScene-415"><span class="linenos">415</span></a>                            <span class="k">if</span> <span class="n">j_obj</span> <span class="o">+</span> <span class="n">w_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span> <span class="o">&gt;</span> <span class="n">j_max</span><span class="p">:</span>
</span><span id="UscopeScene-416"><a href="#UscopeScene-416"><span class="linenos">416</span></a>                                <span class="n">j_finish</span> <span class="o">=</span> <span class="n">j_max</span>
</span><span id="UscopeScene-417"><a href="#UscopeScene-417"><span class="linenos">417</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-418"><a href="#UscopeScene-418"><span class="linenos">418</span></a>                                <span class="n">j_finish</span> <span class="o">=</span> <span class="n">j_obj</span> <span class="o">+</span> <span class="n">w_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span>
</span><span id="UscopeScene-419"><a href="#UscopeScene-419"><span class="linenos">419</span></a>                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_finish</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_finish</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-420"><a href="#UscopeScene-420"><span class="linenos">420</span></a>                                <span class="n">overlapped</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">i_attempts</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="UscopeScene-421"><a href="#UscopeScene-421"><span class="linenos">421</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene-422"><a href="#UscopeScene-422"><span class="linenos">422</span></a>                                    <span class="n">available_correcting_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">));</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>
</span><span id="UscopeScene-423"><a href="#UscopeScene-423"><span class="linenos">423</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene-424"><a href="#UscopeScene-424"><span class="linenos">424</span></a>                                    <span class="k">pass</span>
</span><span id="UscopeScene-425"><a href="#UscopeScene-425"><span class="linenos">425</span></a>                            <span class="c1"># Check that object placed and if not, delete border pixels for placing (long-lasting function)</span>
</span><span id="UscopeScene-426"><a href="#UscopeScene-426"><span class="linenos">426</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapped</span><span class="p">:</span>
</span><span id="UscopeScene-427"><a href="#UscopeScene-427"><span class="linenos">427</span></a>                                <span class="n">placed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
</span><span id="UscopeScene-428"><a href="#UscopeScene-428"><span class="linenos">428</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-429"><a href="#UscopeScene-429"><span class="linenos">429</span></a>                                <span class="c1"># Prevent placing out of scene by removing from available coordinates</span>
</span><span id="UscopeScene-430"><a href="#UscopeScene-430"><span class="linenos">430</span></a>                                <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene-431"><a href="#UscopeScene-431"><span class="linenos">431</span></a>                                    <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">h_fl_obj</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="UscopeScene-432"><a href="#UscopeScene-432"><span class="linenos">432</span></a>                                    <span class="n">coordinates_for_del</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="n">w_fl_obj</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="UscopeScene-433"><a href="#UscopeScene-433"><span class="linenos">433</span></a>                                    <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="UscopeScene-434"><a href="#UscopeScene-434"><span class="linenos">434</span></a>                                        <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene-435"><a href="#UscopeScene-435"><span class="linenos">435</span></a>                                            <span class="n">available_correcting_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene-436"><a href="#UscopeScene-436"><span class="linenos">436</span></a>                                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene-437"><a href="#UscopeScene-437"><span class="linenos">437</span></a>                                            <span class="k">pass</span>
</span><span id="UscopeScene-438"><a href="#UscopeScene-438"><span class="linenos">438</span></a>                                    <span class="n">border_coordinates_deleted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="UscopeScene-439"><a href="#UscopeScene-439"><span class="linenos">439</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-440"><a href="#UscopeScene-440"><span class="linenos">440</span></a>                                <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="k">break</span>
</span><span id="UscopeScene-441"><a href="#UscopeScene-441"><span class="linenos">441</span></a>                        <span class="c1"># print(&quot;# of made attempts:&quot;, i_attempts)</span>
</span><span id="UscopeScene-442"><a href="#UscopeScene-442"><span class="linenos">442</span></a>                        <span class="c1"># Exclude the coordinates occupied by the placed object from the meshgrid (list with coordinates pares)</span>
</span><span id="UscopeScene-443"><a href="#UscopeScene-443"><span class="linenos">443</span></a>                        <span class="k">if</span> <span class="n">placed</span><span class="p">:</span>
</span><span id="UscopeScene-444"><a href="#UscopeScene-444"><span class="linenos">444</span></a>                            <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span>
</span><span id="UscopeScene-445"><a href="#UscopeScene-445"><span class="linenos">445</span></a>                                                   <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)</span>
</span><span id="UscopeScene-446"><a href="#UscopeScene-446"><span class="linenos">446</span></a>                                                   <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)]</span>
</span><span id="UscopeScene-447"><a href="#UscopeScene-447"><span class="linenos">447</span></a>                            <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="UscopeScene-448"><a href="#UscopeScene-448"><span class="linenos">448</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene-449"><a href="#UscopeScene-449"><span class="linenos">449</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene-450"><a href="#UscopeScene-450"><span class="linenos">450</span></a>                                    <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene-451"><a href="#UscopeScene-451"><span class="linenos">451</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene-452"><a href="#UscopeScene-452"><span class="linenos">452</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene-453"><a href="#UscopeScene-453"><span class="linenos">453</span></a>                                    <span class="k">pass</span>
</span><span id="UscopeScene-454"><a href="#UscopeScene-454"><span class="linenos">454</span></a>                            <span class="c1"># Exclude placed object from binary placement mask</span>
</span><span id="UscopeScene-455"><a href="#UscopeScene-455"><span class="linenos">455</span></a>                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="p">):</span>
</span><span id="UscopeScene-456"><a href="#UscopeScene-456"><span class="linenos">456</span></a>                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="p">):</span>
</span><span id="UscopeScene-457"><a href="#UscopeScene-457"><span class="linenos">457</span></a>                                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="UscopeScene-458"><a href="#UscopeScene-458"><span class="linenos">458</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="UscopeScene-459"><a href="#UscopeScene-459"><span class="linenos">459</span></a>                            <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>  <span class="c1"># if found place, place the object</span>
</span><span id="UscopeScene-460"><a href="#UscopeScene-460"><span class="linenos">460</span></a>                            <span class="n">filtered_fluo_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluo_obj</span><span class="p">)</span>  <span class="c1"># collect for returning only placed object, excluding not placed ones</span>
</span><span id="UscopeScene-461"><a href="#UscopeScene-461"><span class="linenos">461</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene-462"><a href="#UscopeScene-462"><span class="linenos">462</span></a>                                <span class="n">placed_objects</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="UscopeScene-463"><a href="#UscopeScene-463"><span class="linenos">463</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of placed objects:&quot;</span><span class="p">,</span> <span class="n">placed_objects</span><span class="p">,</span> <span class="s2">&quot;out of&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="UscopeScene-464"><a href="#UscopeScene-464"><span class="linenos">464</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene-465"><a href="#UscopeScene-465"><span class="linenos">465</span></a>                <span class="n">fluo_objects</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">filtered_fluo_obj</span><span class="p">)</span>  <span class="c1"># convert list -&gt; tuple for returning only placed objects</span>
</span><span id="UscopeScene-466"><a href="#UscopeScene-466"><span class="linenos">466</span></a>                <span class="c1"># plt.figure(&quot;Binary Placement Mask&quot;); plt.imshow(self.__binary_placement_mask)  # plot the occupied places by the objects</span>
</span><span id="UscopeScene-467"><a href="#UscopeScene-467"><span class="linenos">467</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene-468"><a href="#UscopeScene-468"><span class="linenos">468</span></a>                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="UscopeScene-469"><a href="#UscopeScene-469"><span class="linenos">469</span></a>                <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="UscopeScene-470"><a href="#UscopeScene-470"><span class="linenos">470</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placing of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2"> objects takes: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> msec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene-471"><a href="#UscopeScene-471"><span class="linenos">471</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-472"><a href="#UscopeScene-472"><span class="linenos">472</span></a>                    <span class="n">elapsed_time</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene-473"><a href="#UscopeScene-473"><span class="linenos">473</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placing of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2"> objects takes: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene-474"><a href="#UscopeScene-474"><span class="linenos">474</span></a>        <span class="k">return</span> <span class="n">fluo_objects</span>
</span><span id="UscopeScene-475"><a href="#UscopeScene-475"><span class="linenos">475</span></a>
</span><span id="UscopeScene-476"><a href="#UscopeScene-476"><span class="linenos">476</span></a>    <span class="c1"># %% Put objects on the scene</span>
</span><span id="UscopeScene-477"><a href="#UscopeScene-477"><span class="linenos">477</span></a>    <span class="k">def</span> <span class="nf">put_objects_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">save_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="UscopeScene-478"><a href="#UscopeScene-478"><span class="linenos">478</span></a>                       <span class="n">rewrite_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="UscopeScene-479"><a href="#UscopeScene-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-480"><a href="#UscopeScene-480"><span class="linenos">480</span></a><span class="sd">        Put the provided objects on the scene by checking pixelwise the provided profiles and in the case of intersection of</span>
</span><span id="UscopeScene-481"><a href="#UscopeScene-481"><span class="linenos">481</span></a><span class="sd">        two objects profiles, selecting the maximum intensity from them.</span>
</span><span id="UscopeScene-482"><a href="#UscopeScene-482"><span class="linenos">482</span></a>
</span><span id="UscopeScene-483"><a href="#UscopeScene-483"><span class="linenos">483</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-484"><a href="#UscopeScene-484"><span class="linenos">484</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-485"><a href="#UscopeScene-485"><span class="linenos">485</span></a><span class="sd">        fluo_objects : tuple, optional</span>
</span><span id="UscopeScene-486"><a href="#UscopeScene-486"><span class="linenos">486</span></a><span class="sd">            Fluorescent objects, instances of FluorObj class, packed in a tuple. The default is ().</span>
</span><span id="UscopeScene-487"><a href="#UscopeScene-487"><span class="linenos">487</span></a><span class="sd">        save_objects : bool, optional</span>
</span><span id="UscopeScene-488"><a href="#UscopeScene-488"><span class="linenos">488</span></a><span class="sd">            If True, will save (append) objects in the class attribute &#39;fluo_objects&#39;. The default is True. \n</span>
</span><span id="UscopeScene-489"><a href="#UscopeScene-489"><span class="linenos">489</span></a><span class="sd">            Note that, if it&#39;s False, then before placing the objects, the scene will be cleared (stored before objects will be removed from it).</span>
</span><span id="UscopeScene-490"><a href="#UscopeScene-490"><span class="linenos">490</span></a><span class="sd">        save_only_objects_inside : bool, optional</span>
</span><span id="UscopeScene-491"><a href="#UscopeScene-491"><span class="linenos">491</span></a><span class="sd">            Save in the class attribute (&#39;fluo_objects&#39;) only objects that are inside the image. The default is False.</span>
</span><span id="UscopeScene-492"><a href="#UscopeScene-492"><span class="linenos">492</span></a><span class="sd">        rewrite_objects : bool, optional</span>
</span><span id="UscopeScene-493"><a href="#UscopeScene-493"><span class="linenos">493</span></a><span class="sd">            If True, it forces to substitute stored objects in the class attribute &#39;fluo_objects&#39; with the provided ones. The default is False.</span>
</span><span id="UscopeScene-494"><a href="#UscopeScene-494"><span class="linenos">494</span></a>
</span><span id="UscopeScene-495"><a href="#UscopeScene-495"><span class="linenos">495</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-496"><a href="#UscopeScene-496"><span class="linenos">496</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-497"><a href="#UscopeScene-497"><span class="linenos">497</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene-498"><a href="#UscopeScene-498"><span class="linenos">498</span></a>
</span><span id="UscopeScene-499"><a href="#UscopeScene-499"><span class="linenos">499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-500"><a href="#UscopeScene-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-501"><a href="#UscopeScene-501"><span class="linenos">501</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">save_objects</span><span class="p">:</span>
</span><span id="UscopeScene-502"><a href="#UscopeScene-502"><span class="linenos">502</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">clear_scene</span><span class="p">()</span>  <span class="c1"># clear the scene before placing the objects only if there are no saved objects and the flag is False</span>
</span><span id="UscopeScene-503"><a href="#UscopeScene-503"><span class="linenos">503</span></a>            <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">fluo_objects</span><span class="p">:</span>
</span><span id="UscopeScene-504"><a href="#UscopeScene-504"><span class="linenos">504</span></a>                <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">within_image</span> <span class="ow">and</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene-505"><a href="#UscopeScene-505"><span class="linenos">505</span></a>                    <span class="n">i_start</span><span class="p">,</span> <span class="n">j_start</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">external_upper_coordinates</span><span class="p">;</span> <span class="n">i_size</span><span class="p">,</span> <span class="n">j_size</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="o">.</span><span class="n">shape</span>
</span><span id="UscopeScene-506"><a href="#UscopeScene-506"><span class="linenos">506</span></a>                    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># for checking that the placing happening within the image</span>
</span><span id="UscopeScene-507"><a href="#UscopeScene-507"><span class="linenos">507</span></a>                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for counting on the profile</span>
</span><span id="UscopeScene-508"><a href="#UscopeScene-508"><span class="linenos">508</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_start</span><span class="p">,</span> <span class="n">i_start</span><span class="o">+</span><span class="n">i_size</span><span class="p">):</span>
</span><span id="UscopeScene-509"><a href="#UscopeScene-509"><span class="linenos">509</span></a>                        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># refresh starting column for counting on the object profile</span>
</span><span id="UscopeScene-510"><a href="#UscopeScene-510"><span class="linenos">510</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_start</span><span class="p">,</span> <span class="n">j_start</span><span class="o">+</span><span class="n">j_size</span><span class="p">):</span>
</span><span id="UscopeScene-511"><a href="#UscopeScene-511"><span class="linenos">511</span></a>                            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">:</span>
</span><span id="UscopeScene-512"><a href="#UscopeScene-512"><span class="linenos">512</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="UscopeScene-513"><a href="#UscopeScene-513"><span class="linenos">513</span></a>                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-514"><a href="#UscopeScene-514"><span class="linenos">514</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span>
</span><span id="UscopeScene-515"><a href="#UscopeScene-515"><span class="linenos">515</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-516"><a href="#UscopeScene-516"><span class="linenos">516</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
</span><span id="UscopeScene-517"><a href="#UscopeScene-517"><span class="linenos">517</span></a>                                <span class="k">else</span><span class="p">:</span>  <span class="c1"># float image type</span>
</span><span id="UscopeScene-518"><a href="#UscopeScene-518"><span class="linenos">518</span></a>                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1E-9</span><span class="p">:</span>
</span><span id="UscopeScene-519"><a href="#UscopeScene-519"><span class="linenos">519</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span>
</span><span id="UscopeScene-520"><a href="#UscopeScene-520"><span class="linenos">520</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-521"><a href="#UscopeScene-521"><span class="linenos">521</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
</span><span id="UscopeScene-522"><a href="#UscopeScene-522"><span class="linenos">522</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene-523"><a href="#UscopeScene-523"><span class="linenos">523</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="UscopeScene-524"><a href="#UscopeScene-524"><span class="linenos">524</span></a>                            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># next column of the cast profile</span>
</span><span id="UscopeScene-525"><a href="#UscopeScene-525"><span class="linenos">525</span></a>                        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># next row of the cast profile</span>
</span><span id="UscopeScene-526"><a href="#UscopeScene-526"><span class="linenos">526</span></a>            <span class="k">if</span> <span class="n">save_objects</span><span class="p">:</span>
</span><span id="UscopeScene-527"><a href="#UscopeScene-527"><span class="linenos">527</span></a>                <span class="n">l_fluo_objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>  <span class="c1"># conversion input tuple to the list</span>
</span><span id="UscopeScene-528"><a href="#UscopeScene-528"><span class="linenos">528</span></a>                <span class="k">if</span> <span class="n">save_only_objects_inside</span><span class="p">:</span>
</span><span id="UscopeScene-529"><a href="#UscopeScene-529"><span class="linenos">529</span></a>                    <span class="n">l_fluo_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fluo_obj</span> <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">l_fluo_objects</span> <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">within_image</span><span class="p">]</span>
</span><span id="UscopeScene-530"><a href="#UscopeScene-530"><span class="linenos">530</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rewrite_objects</span><span class="p">:</span>
</span><span id="UscopeScene-531"><a href="#UscopeScene-531"><span class="linenos">531</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">+</span> <span class="n">l_fluo_objects</span>  <span class="c1"># concatenate 2 lists</span>
</span><span id="UscopeScene-532"><a href="#UscopeScene-532"><span class="linenos">532</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-533"><a href="#UscopeScene-533"><span class="linenos">533</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">=</span> <span class="n">l_fluo_objects</span><span class="p">[:]</span>  <span class="c1"># copy the list</span>
</span><span id="UscopeScene-534"><a href="#UscopeScene-534"><span class="linenos">534</span></a>
</span><span id="UscopeScene-535"><a href="#UscopeScene-535"><span class="linenos">535</span></a>    <span class="k">def</span> <span class="nf">spread_objects_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene-536"><a href="#UscopeScene-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-537"><a href="#UscopeScene-537"><span class="linenos">537</span></a><span class="sd">        Compose 2 subsequent methods: self.put_objects_on(self.set_random_places(fluo_objects), save_objects=True).</span>
</span><span id="UscopeScene-538"><a href="#UscopeScene-538"><span class="linenos">538</span></a>
</span><span id="UscopeScene-539"><a href="#UscopeScene-539"><span class="linenos">539</span></a><span class="sd">        So, this method puts the provided objects, which are randomly spread on the scene, and saves them in the attribute.</span>
</span><span id="UscopeScene-540"><a href="#UscopeScene-540"><span class="linenos">540</span></a>
</span><span id="UscopeScene-541"><a href="#UscopeScene-541"><span class="linenos">541</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-542"><a href="#UscopeScene-542"><span class="linenos">542</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-543"><a href="#UscopeScene-543"><span class="linenos">543</span></a><span class="sd">        fluo_objects : tuple</span>
</span><span id="UscopeScene-544"><a href="#UscopeScene-544"><span class="linenos">544</span></a><span class="sd">            Fluorescent objects, instances of FluorObj class, packed in a tuple.</span>
</span><span id="UscopeScene-545"><a href="#UscopeScene-545"><span class="linenos">545</span></a>
</span><span id="UscopeScene-546"><a href="#UscopeScene-546"><span class="linenos">546</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-547"><a href="#UscopeScene-547"><span class="linenos">547</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-548"><a href="#UscopeScene-548"><span class="linenos">548</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene-549"><a href="#UscopeScene-549"><span class="linenos">549</span></a>
</span><span id="UscopeScene-550"><a href="#UscopeScene-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-551"><a href="#UscopeScene-551"><span class="linenos">551</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="UscopeScene-552"><a href="#UscopeScene-552"><span class="linenos">552</span></a>
</span><span id="UscopeScene-553"><a href="#UscopeScene-553"><span class="linenos">553</span></a>    <span class="k">def</span> <span class="nf">recreate_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="UscopeScene-554"><a href="#UscopeScene-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-555"><a href="#UscopeScene-555"><span class="linenos">555</span></a><span class="sd">        Recreate the saved objects in the class attribute &#39;fluo_objects&#39; on the cleared before scene.</span>
</span><span id="UscopeScene-556"><a href="#UscopeScene-556"><span class="linenos">556</span></a>
</span><span id="UscopeScene-557"><a href="#UscopeScene-557"><span class="linenos">557</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-558"><a href="#UscopeScene-558"><span class="linenos">558</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-559"><a href="#UscopeScene-559"><span class="linenos">559</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene-560"><a href="#UscopeScene-560"><span class="linenos">560</span></a>
</span><span id="UscopeScene-561"><a href="#UscopeScene-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-562"><a href="#UscopeScene-562"><span class="linenos">562</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene-563"><a href="#UscopeScene-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">),</span> <span class="n">save_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="UscopeScene-564"><a href="#UscopeScene-564"><span class="linenos">564</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene-565"><a href="#UscopeScene-565"><span class="linenos">565</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-566"><a href="#UscopeScene-566"><span class="linenos">566</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;The scene is not clear, cannot recreate the scene&quot;</span>
</span><span id="UscopeScene-567"><a href="#UscopeScene-567"><span class="linenos">567</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="UscopeScene-568"><a href="#UscopeScene-568"><span class="linenos">568</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">==</span> <span class="s2">&quot;The scene is not clear, cannot recreate the scene&quot;</span><span class="p">:</span>
</span><span id="UscopeScene-569"><a href="#UscopeScene-569"><span class="linenos">569</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="UscopeScene-570"><a href="#UscopeScene-570"><span class="linenos">570</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-571"><a href="#UscopeScene-571"><span class="linenos">571</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-572"><a href="#UscopeScene-572"><span class="linenos">572</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;There are no stored objects within this class instance&quot;</span>
</span><span id="UscopeScene-573"><a href="#UscopeScene-573"><span class="linenos">573</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="UscopeScene-574"><a href="#UscopeScene-574"><span class="linenos">574</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">==</span> <span class="s2">&quot;There are no stored objects within this class instance&quot;</span><span class="p">:</span>
</span><span id="UscopeScene-575"><a href="#UscopeScene-575"><span class="linenos">575</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="UscopeScene-576"><a href="#UscopeScene-576"><span class="linenos">576</span></a>
</span><span id="UscopeScene-577"><a href="#UscopeScene-577"><span class="linenos">577</span></a>    <span class="c1"># %% Scene manipulation</span>
</span><span id="UscopeScene-578"><a href="#UscopeScene-578"><span class="linenos">578</span></a>    <span class="k">def</span> <span class="nf">show_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">unique_plot_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="UscopeScene-579"><a href="#UscopeScene-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-580"><a href="#UscopeScene-580"><span class="linenos">580</span></a><span class="sd">        Show interactively the stored in the class scene (image) by plotting it using matplotlib.</span>
</span><span id="UscopeScene-581"><a href="#UscopeScene-581"><span class="linenos">581</span></a>
</span><span id="UscopeScene-582"><a href="#UscopeScene-582"><span class="linenos">582</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-583"><a href="#UscopeScene-583"><span class="linenos">583</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-584"><a href="#UscopeScene-584"><span class="linenos">584</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="UscopeScene-585"><a href="#UscopeScene-585"><span class="linenos">585</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="UscopeScene-586"><a href="#UscopeScene-586"><span class="linenos">586</span></a><span class="sd">        color_map</span>
</span><span id="UscopeScene-587"><a href="#UscopeScene-587"><span class="linenos">587</span></a><span class="sd">            Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is &#39;viridis&#39;.</span>
</span><span id="UscopeScene-588"><a href="#UscopeScene-588"><span class="linenos">588</span></a><span class="sd">        unique_plot_id: bool, optional</span>
</span><span id="UscopeScene-589"><a href="#UscopeScene-589"><span class="linenos">589</span></a><span class="sd">            Flag for adding to plot name some random integer id for preventing plots overlapping. The default is True.</span>
</span><span id="UscopeScene-590"><a href="#UscopeScene-590"><span class="linenos">590</span></a>
</span><span id="UscopeScene-591"><a href="#UscopeScene-591"><span class="linenos">591</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-592"><a href="#UscopeScene-592"><span class="linenos">592</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-593"><a href="#UscopeScene-593"><span class="linenos">593</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene-594"><a href="#UscopeScene-594"><span class="linenos">594</span></a>
</span><span id="UscopeScene-595"><a href="#UscopeScene-595"><span class="linenos">595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-596"><a href="#UscopeScene-596"><span class="linenos">596</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">height_width_ratio</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">w</span><span class="p">;</span> <span class="n">default_image_size</span> <span class="o">=</span> <span class="mf">5.8</span><span class="p">;</span> <span class="n">additional_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="UscopeScene-597"><a href="#UscopeScene-597"><span class="linenos">597</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene-598"><a href="#UscopeScene-598"><span class="linenos">598</span></a>            <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="UscopeScene-599"><a href="#UscopeScene-599"><span class="linenos">599</span></a>        <span class="k">elif</span> <span class="n">unique_plot_id</span><span class="p">:</span>
</span><span id="UscopeScene-600"><a href="#UscopeScene-600"><span class="linenos">600</span></a>            <span class="n">additional_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="UscopeScene-601"><a href="#UscopeScene-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="UscopeScene-602"><a href="#UscopeScene-602"><span class="linenos">602</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="UscopeScene-603"><a href="#UscopeScene-603"><span class="linenos">603</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene-604"><a href="#UscopeScene-604"><span class="linenos">604</span></a>            <span class="n">figure_name</span> <span class="o">=</span> <span class="s2">&quot;Blank UscopeScene &quot;</span> <span class="o">+</span> <span class="n">str_id</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">additional_id</span>
</span><span id="UscopeScene-605"><a href="#UscopeScene-605"><span class="linenos">605</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-606"><a href="#UscopeScene-606"><span class="linenos">606</span></a>            <span class="n">figure_name</span> <span class="o">=</span> <span class="s2">&quot;UscopeScene &quot;</span> <span class="o">+</span> <span class="n">str_id</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">additional_id</span>
</span><span id="UscopeScene-607"><a href="#UscopeScene-607"><span class="linenos">607</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure_name</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">default_image_size</span><span class="p">,</span> <span class="n">default_image_size</span><span class="o">*</span><span class="n">height_width_ratio</span><span class="p">))</span>
</span><span id="UscopeScene-608"><a href="#UscopeScene-608"><span class="linenos">608</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene-609"><a href="#UscopeScene-609"><span class="linenos">609</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="UscopeScene-610"><a href="#UscopeScene-610"><span class="linenos">610</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene-611"><a href="#UscopeScene-611"><span class="linenos">611</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="UscopeScene-612"><a href="#UscopeScene-612"><span class="linenos">612</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="UscopeScene-613"><a href="#UscopeScene-613"><span class="linenos">613</span></a>
</span><span id="UscopeScene-614"><a href="#UscopeScene-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">clear_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="UscopeScene-615"><a href="#UscopeScene-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-616"><a href="#UscopeScene-616"><span class="linenos">616</span></a><span class="sd">        Reinitialize the scene to zero (plain dark background).</span>
</span><span id="UscopeScene-617"><a href="#UscopeScene-617"><span class="linenos">617</span></a>
</span><span id="UscopeScene-618"><a href="#UscopeScene-618"><span class="linenos">618</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-619"><a href="#UscopeScene-619"><span class="linenos">619</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-620"><a href="#UscopeScene-620"><span class="linenos">620</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene-621"><a href="#UscopeScene-621"><span class="linenos">621</span></a>
</span><span id="UscopeScene-622"><a href="#UscopeScene-622"><span class="linenos">622</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-623"><a href="#UscopeScene-623"><span class="linenos">623</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene-624"><a href="#UscopeScene-624"><span class="linenos">624</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="UscopeScene-625"><a href="#UscopeScene-625"><span class="linenos">625</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="UscopeScene-626"><a href="#UscopeScene-626"><span class="linenos">626</span></a>
</span><span id="UscopeScene-627"><a href="#UscopeScene-627"><span class="linenos">627</span></a>    <span class="k">def</span> <span class="nf">is_blank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="UscopeScene-628"><a href="#UscopeScene-628"><span class="linenos">628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-629"><a href="#UscopeScene-629"><span class="linenos">629</span></a><span class="sd">        Returns True, if the scene (image) is blank (zeroed).</span>
</span><span id="UscopeScene-630"><a href="#UscopeScene-630"><span class="linenos">630</span></a>
</span><span id="UscopeScene-631"><a href="#UscopeScene-631"><span class="linenos">631</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-632"><a href="#UscopeScene-632"><span class="linenos">632</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-633"><a href="#UscopeScene-633"><span class="linenos">633</span></a><span class="sd">        bool</span>
</span><span id="UscopeScene-634"><a href="#UscopeScene-634"><span class="linenos">634</span></a><span class="sd">            Value for designation of a blank scene.</span>
</span><span id="UscopeScene-635"><a href="#UscopeScene-635"><span class="linenos">635</span></a>
</span><span id="UscopeScene-636"><a href="#UscopeScene-636"><span class="linenos">636</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-637"><a href="#UscopeScene-637"><span class="linenos">637</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span>
</span><span id="UscopeScene-638"><a href="#UscopeScene-638"><span class="linenos">638</span></a>
</span><span id="UscopeScene-639"><a href="#UscopeScene-639"><span class="linenos">639</span></a>    <span class="c1"># %% Making scene realistic and useful by adding noise: shot and detector ones</span>
</span><span id="UscopeScene-640"><a href="#UscopeScene-640"><span class="linenos">640</span></a>    <span class="k">def</span> <span class="nf">add_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mean_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="UscopeScene-641"><a href="#UscopeScene-641"><span class="linenos">641</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-642"><a href="#UscopeScene-642"><span class="linenos">642</span></a><span class="sd">        Add Poisson (signal dependent shot noise) and background (Gaussian or detector) noise.</span>
</span><span id="UscopeScene-643"><a href="#UscopeScene-643"><span class="linenos">643</span></a>
</span><span id="UscopeScene-644"><a href="#UscopeScene-644"><span class="linenos">644</span></a><span class="sd">        Note that if the called again on the scene, this method will add newly generated noise to the initial image.</span>
</span><span id="UscopeScene-645"><a href="#UscopeScene-645"><span class="linenos">645</span></a>
</span><span id="UscopeScene-646"><a href="#UscopeScene-646"><span class="linenos">646</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene-647"><a href="#UscopeScene-647"><span class="linenos">647</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-648"><a href="#UscopeScene-648"><span class="linenos">648</span></a><span class="sd">        seed : int, optional</span>
</span><span id="UscopeScene-649"><a href="#UscopeScene-649"><span class="linenos">649</span></a><span class="sd">            Long integer for initializing pseudorandom generator for repeating generated sequences. The default is None.</span>
</span><span id="UscopeScene-650"><a href="#UscopeScene-650"><span class="linenos">650</span></a><span class="sd">        mean_noise : Union[int, float], optional</span>
</span><span id="UscopeScene-651"><a href="#UscopeScene-651"><span class="linenos">651</span></a><span class="sd">            Mean for Gaussian noise intensity. The default is None.</span>
</span><span id="UscopeScene-652"><a href="#UscopeScene-652"><span class="linenos">652</span></a><span class="sd">        sigma_noise : Union[int, float], optional</span>
</span><span id="UscopeScene-653"><a href="#UscopeScene-653"><span class="linenos">653</span></a><span class="sd">            Sigma for Gaussian noise intensity. The default is None.</span>
</span><span id="UscopeScene-654"><a href="#UscopeScene-654"><span class="linenos">654</span></a>
</span><span id="UscopeScene-655"><a href="#UscopeScene-655"><span class="linenos">655</span></a><span class="sd">        References</span>
</span><span id="UscopeScene-656"><a href="#UscopeScene-656"><span class="linenos">656</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene-657"><a href="#UscopeScene-657"><span class="linenos">657</span></a><span class="sd">        [1] &quot;Imaging in focus: An introduction to denoising bioimages in the era of deep learning&quot;, R.F. Laine,</span>
</span><span id="UscopeScene-658"><a href="#UscopeScene-658"><span class="linenos">658</span></a><span class="sd">        G. Jacquemet, A. Krull (2021)</span>
</span><span id="UscopeScene-659"><a href="#UscopeScene-659"><span class="linenos">659</span></a><span class="sd">        [2] Online Resource: https://bioimagebook.github.io/chapters/3-fluorescence/3-formation_noise/formation_noise.html</span>
</span><span id="UscopeScene-660"><a href="#UscopeScene-660"><span class="linenos">660</span></a>
</span><span id="UscopeScene-661"><a href="#UscopeScene-661"><span class="linenos">661</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-662"><a href="#UscopeScene-662"><span class="linenos">662</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-663"><a href="#UscopeScene-663"><span class="linenos">663</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="UscopeScene-664"><a href="#UscopeScene-664"><span class="linenos">664</span></a><span class="sd">            The scene added shot (Poisson) and detector (Gaussian) noises.</span>
</span><span id="UscopeScene-665"><a href="#UscopeScene-665"><span class="linenos">665</span></a>
</span><span id="UscopeScene-666"><a href="#UscopeScene-666"><span class="linenos">666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-667"><a href="#UscopeScene-667"><span class="linenos">667</span></a>        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene-668"><a href="#UscopeScene-668"><span class="linenos">668</span></a>            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</span><span id="UscopeScene-669"><a href="#UscopeScene-669"><span class="linenos">669</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-670"><a href="#UscopeScene-670"><span class="linenos">670</span></a>            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="UscopeScene-671"><a href="#UscopeScene-671"><span class="linenos">671</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene-672"><a href="#UscopeScene-672"><span class="linenos">672</span></a>            <span class="c1"># Add the Gaussian noise (background)</span>
</span><span id="UscopeScene-673"><a href="#UscopeScene-673"><span class="linenos">673</span></a>            <span class="k">if</span> <span class="n">mean_noise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene-674"><a href="#UscopeScene-674"><span class="linenos">674</span></a>                <span class="n">mean_noise</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># 12.5% of the max value</span>
</span><span id="UscopeScene-675"><a href="#UscopeScene-675"><span class="linenos">675</span></a>            <span class="k">if</span> <span class="n">sigma_noise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene-676"><a href="#UscopeScene-676"><span class="linenos">676</span></a>                <span class="n">sigma_noise</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="n">mean_noise</span>  <span class="c1"># 33% of the mean</span>
</span><span id="UscopeScene-677"><a href="#UscopeScene-677"><span class="linenos">677</span></a>            <span class="n">noisy_background</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_noise</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># normally distributed noise on background</span>
</span><span id="UscopeScene-678"><a href="#UscopeScene-678"><span class="linenos">678</span></a>            <span class="n">noisy_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">noisy_background</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">noisy_background</span><span class="p">)</span>  <span class="c1"># check that all pixel values are positive</span>
</span><span id="UscopeScene-679"><a href="#UscopeScene-679"><span class="linenos">679</span></a>            <span class="c1"># Substitute the calculated exact pixel value with the Poisson distributed one due to the properties of commonly used cameras</span>
</span><span id="UscopeScene-680"><a href="#UscopeScene-680"><span class="linenos">680</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">raw_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="UscopeScene-681"><a href="#UscopeScene-681"><span class="linenos">681</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span><span class="p">:</span>
</span><span id="UscopeScene-682"><a href="#UscopeScene-682"><span class="linenos">682</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy initial scene without noise</span>
</span><span id="UscopeScene-683"><a href="#UscopeScene-683"><span class="linenos">683</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-684"><a href="#UscopeScene-684"><span class="linenos">684</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># restore the initial image by the copying the content of the denoised image</span>
</span><span id="UscopeScene-685"><a href="#UscopeScene-685"><span class="linenos">685</span></a>            <span class="c1"># Generate and add noise pixelwise</span>
</span><span id="UscopeScene-686"><a href="#UscopeScene-686"><span class="linenos">686</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
</span><span id="UscopeScene-687"><a href="#UscopeScene-687"><span class="linenos">687</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
</span><span id="UscopeScene-688"><a href="#UscopeScene-688"><span class="linenos">688</span></a>                    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="UscopeScene-689"><a href="#UscopeScene-689"><span class="linenos">689</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>  <span class="c1"># save converted original value with the Poisson-distributed</span>
</span><span id="UscopeScene-690"><a href="#UscopeScene-690"><span class="linenos">690</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noisy_background</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>  <span class="c1"># add Gaussian noise</span>
</span><span id="UscopeScene-691"><a href="#UscopeScene-691"><span class="linenos">691</span></a>                        <span class="k">if</span> <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span><span class="p">:</span>
</span><span id="UscopeScene-692"><a href="#UscopeScene-692"><span class="linenos">692</span></a>                            <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span>  <span class="c1"># check that the pixel values are still in range with the image type</span>
</span><span id="UscopeScene-693"><a href="#UscopeScene-693"><span class="linenos">693</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-694"><a href="#UscopeScene-694"><span class="linenos">694</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">noisy_background</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
</span><span id="UscopeScene-695"><a href="#UscopeScene-695"><span class="linenos">695</span></a>            <span class="c1"># Casting the noisy image back to the original image format</span>
</span><span id="UscopeScene-696"><a href="#UscopeScene-696"><span class="linenos">696</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="s1">&#39;uint8&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="UscopeScene-697"><a href="#UscopeScene-697"><span class="linenos">697</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">raw_pixels</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="UscopeScene-698"><a href="#UscopeScene-698"><span class="linenos">698</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene-699"><a href="#UscopeScene-699"><span class="linenos">699</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">raw_pixels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="UscopeScene-700"><a href="#UscopeScene-700"><span class="linenos">700</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># switch the flag for tracking that the noise has been added</span>
</span><span id="UscopeScene-701"><a href="#UscopeScene-701"><span class="linenos">701</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="UscopeScene-702"><a href="#UscopeScene-702"><span class="linenos">702</span></a>
</span><span id="UscopeScene-703"><a href="#UscopeScene-703"><span class="linenos">703</span></a>    <span class="k">def</span> <span class="nf">remove_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="UscopeScene-704"><a href="#UscopeScene-704"><span class="linenos">704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene-705"><a href="#UscopeScene-705"><span class="linenos">705</span></a><span class="sd">        Remove added previously noise by copying the stored in &#39;denoise_image&#39; pixel content.</span>
</span><span id="UscopeScene-706"><a href="#UscopeScene-706"><span class="linenos">706</span></a>
</span><span id="UscopeScene-707"><a href="#UscopeScene-707"><span class="linenos">707</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene-708"><a href="#UscopeScene-708"><span class="linenos">708</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene-709"><a href="#UscopeScene-709"><span class="linenos">709</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="UscopeScene-710"><a href="#UscopeScene-710"><span class="linenos">710</span></a><span class="sd">            Initial scene without noise.</span>
</span><span id="UscopeScene-711"><a href="#UscopeScene-711"><span class="linenos">711</span></a>
</span><span id="UscopeScene-712"><a href="#UscopeScene-712"><span class="linenos">712</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene-713"><a href="#UscopeScene-713"><span class="linenos">713</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene-714"><a href="#UscopeScene-714"><span class="linenos">714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="UscopeScene-715"><a href="#UscopeScene-715"><span class="linenos">715</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span></pre></div>


            <div class="docstring"><p>Replicate the common fluorescence microscopic image (frame or 'scene').</p>

<p>This class simulates the bright objects with round and elongate shapes as the basic examples of imaged objects. </p>

<p>The ratio behind development of this class - to get the ground truth images for image processing workflows tests. </p>

<p>For more complex and useful cases, please, check the References.</p>

<h2 id="references">References</h2>

<p>For the used noise models, see the 'add_noise method'.</p>
</div>


                            <div id="UscopeScene.__init__" class="classattr">
                                        <input id="UscopeScene.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">UscopeScene</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">width</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">height</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span></span>)</span>

                <label class="view-source-button" for="UscopeScene.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.__init__-61"><a href="#UscopeScene.__init__-61"><span class="linenos"> 61</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">):</span>
</span><span id="UscopeScene.__init__-62"><a href="#UscopeScene.__init__-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.__init__-63"><a href="#UscopeScene.__init__-63"><span class="linenos"> 63</span></a><span class="sd">        Initialize the class wrapper for store the current &quot;scene&quot; or microscopic image.</span>
</span><span id="UscopeScene.__init__-64"><a href="#UscopeScene.__init__-64"><span class="linenos"> 64</span></a>
</span><span id="UscopeScene.__init__-65"><a href="#UscopeScene.__init__-65"><span class="linenos"> 65</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.__init__-66"><a href="#UscopeScene.__init__-66"><span class="linenos"> 66</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.__init__-67"><a href="#UscopeScene.__init__-67"><span class="linenos"> 67</span></a><span class="sd">        width : int</span>
</span><span id="UscopeScene.__init__-68"><a href="#UscopeScene.__init__-68"><span class="linenos"> 68</span></a><span class="sd">            Width of the scene in pixels.</span>
</span><span id="UscopeScene.__init__-69"><a href="#UscopeScene.__init__-69"><span class="linenos"> 69</span></a><span class="sd">        height : int</span>
</span><span id="UscopeScene.__init__-70"><a href="#UscopeScene.__init__-70"><span class="linenos"> 70</span></a><span class="sd">            Height of the scene in pixels.</span>
</span><span id="UscopeScene.__init__-71"><a href="#UscopeScene.__init__-71"><span class="linenos"> 71</span></a><span class="sd">        image_type : str | np.uint8 | np.uint16 | np.float64, optional</span>
</span><span id="UscopeScene.__init__-72"><a href="#UscopeScene.__init__-72"><span class="linenos"> 72</span></a><span class="sd">            Image type, for supported ones see the acceptable types. The default is &#39;uint8&#39;.</span>
</span><span id="UscopeScene.__init__-73"><a href="#UscopeScene.__init__-73"><span class="linenos"> 73</span></a>
</span><span id="UscopeScene.__init__-74"><a href="#UscopeScene.__init__-74"><span class="linenos"> 74</span></a><span class="sd">        Raises</span>
</span><span id="UscopeScene.__init__-75"><a href="#UscopeScene.__init__-75"><span class="linenos"> 75</span></a><span class="sd">        ------</span>
</span><span id="UscopeScene.__init__-76"><a href="#UscopeScene.__init__-76"><span class="linenos"> 76</span></a><span class="sd">        ValueError</span>
</span><span id="UscopeScene.__init__-77"><a href="#UscopeScene.__init__-77"><span class="linenos"> 77</span></a><span class="sd">            If provided parameters are inconsistent, e.g. width or height &lt; 2.</span>
</span><span id="UscopeScene.__init__-78"><a href="#UscopeScene.__init__-78"><span class="linenos"> 78</span></a>
</span><span id="UscopeScene.__init__-79"><a href="#UscopeScene.__init__-79"><span class="linenos"> 79</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.__init__-80"><a href="#UscopeScene.__init__-80"><span class="linenos"> 80</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.__init__-81"><a href="#UscopeScene.__init__-81"><span class="linenos"> 81</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene.__init__-82"><a href="#UscopeScene.__init__-82"><span class="linenos"> 82</span></a>
</span><span id="UscopeScene.__init__-83"><a href="#UscopeScene.__init__-83"><span class="linenos"> 83</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.__init__-84"><a href="#UscopeScene.__init__-84"><span class="linenos"> 84</span></a>        <span class="c1"># Check provided width and height</span>
</span><span id="UscopeScene.__init__-85"><a href="#UscopeScene.__init__-85"><span class="linenos"> 85</span></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="UscopeScene.__init__-86"><a href="#UscopeScene.__init__-86"><span class="linenos"> 86</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided dimensions (</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">) is less than 4&quot;</span><span class="p">)</span>
</span><span id="UscopeScene.__init__-87"><a href="#UscopeScene.__init__-87"><span class="linenos"> 87</span></a>        <span class="k">if</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="ow">or</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
</span><span id="UscopeScene.__init__-88"><a href="#UscopeScene.__init__-88"><span class="linenos"> 88</span></a>            <span class="n">__warn_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Provided dimensions (</span><span class="si">{</span><span class="n">width</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">height</span><span class="si">}</span><span class="s2">) pixels are unrealistic for the common image&quot;</span>
</span><span id="UscopeScene.__init__-89"><a href="#UscopeScene.__init__-89"><span class="linenos"> 89</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="UscopeScene.__init__-90"><a href="#UscopeScene.__init__-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
</span><span id="UscopeScene.__init__-91"><a href="#UscopeScene.__init__-91"><span class="linenos"> 91</span></a>        <span class="c1"># Check an image type</span>
</span><span id="UscopeScene.__init__-92"><a href="#UscopeScene.__init__-92"><span class="linenos"> 92</span></a>        <span class="k">if</span> <span class="n">image_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">:</span>
</span><span id="UscopeScene.__init__-93"><a href="#UscopeScene.__init__-93"><span class="linenos"> 93</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided image type &#39;</span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&#39; not in the acceptable list of types: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">))</span>
</span><span id="UscopeScene.__init__-94"><a href="#UscopeScene.__init__-94"><span class="linenos"> 94</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.__init__-95"><a href="#UscopeScene.__init__-95"><span class="linenos"> 95</span></a>            <span class="k">if</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="UscopeScene.__init__-96"><a href="#UscopeScene.__init__-96"><span class="linenos"> 96</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value_uint16</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span>
</span><span id="UscopeScene.__init__-97"><a href="#UscopeScene.__init__-97"><span class="linenos"> 97</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="UscopeScene.__init__-98"><a href="#UscopeScene.__init__-98"><span class="linenos"> 98</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
</span><span id="UscopeScene.__init__-99"><a href="#UscopeScene.__init__-99"><span class="linenos"> 99</span></a>        <span class="c1"># Initialize zero scene</span>
</span><span id="UscopeScene.__init__-100"><a href="#UscopeScene.__init__-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">);</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the class wrapper for store the current "scene" or microscopic image.</p>

<h2 id="parameters">Parameters</h2>

<p>width : int
    Width of the scene in pixels.
height : int
    Height of the scene in pixels.
image_type : str | np.uint8 | np.uint16 | np.float64, optional
    Image type, for supported ones see the acceptable types. The default is 'uint8'.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If provided parameters are inconsistent, e.g. width or height &lt; 2.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="UscopeScene.width" class="classattr">
                                <div class="attr variable">
            <span class="name">width</span><span class="annotation">: int</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.width"></a>
    
    

                            </div>
                            <div id="UscopeScene.height" class="classattr">
                                <div class="attr variable">
            <span class="name">height</span><span class="annotation">: int</span>        =
<span class="default_value">4</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.height"></a>
    
    

                            </div>
                            <div id="UscopeScene.max_pixel_value" class="classattr">
                                <div class="attr variable">
            <span class="name">max_pixel_value</span>        =
<span class="default_value">255</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.max_pixel_value"></a>
    
    

                            </div>
                            <div id="UscopeScene.img_type" class="classattr">
                                <div class="attr variable">
            <span class="name">img_type</span>        =
<span class="default_value">&lt;class &#39;numpy.uint8&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.img_type"></a>
    
    

                            </div>
                            <div id="UscopeScene.acceptable_img_types" class="classattr">
                                <div class="attr variable">
            <span class="name">acceptable_img_types</span><span class="annotation">: list</span>        =
<span class="default_value">[&#39;uint8&#39;, &#39;uint16&#39;, &#39;float&#39;, &lt;class &#39;numpy.uint8&#39;&gt;, &lt;class &#39;numpy.uint16&#39;&gt;, &lt;class &#39;numpy.float64&#39;&gt;]</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.acceptable_img_types"></a>
    
    

                            </div>
                            <div id="UscopeScene.max_pixel_value_uint8" class="classattr">
                                <div class="attr variable">
            <span class="name">max_pixel_value_uint8</span><span class="annotation">: int</span>        =
<span class="default_value">255</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.max_pixel_value_uint8"></a>
    
    

                            </div>
                            <div id="UscopeScene.max_pixel_value_uint16" class="classattr">
                                <div class="attr variable">
            <span class="name">max_pixel_value_uint16</span><span class="annotation">: int</span>        =
<span class="default_value">65535</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.max_pixel_value_uint16"></a>
    
    

                            </div>
                            <div id="UscopeScene.shape" class="classattr">
                                <div class="attr variable">
            <span class="name">shape</span><span class="annotation">: tuple</span>        =
<span class="default_value">(4, 4)</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.shape"></a>
    
    

                            </div>
                            <div id="UscopeScene.fluo_objects" class="classattr">
                                <div class="attr variable">
            <span class="name">fluo_objects</span><span class="annotation">: list</span>        =
<span class="default_value">[]</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.fluo_objects"></a>
    
    

                            </div>
                            <div id="UscopeScene.shape_types" class="classattr">
                                <div class="attr variable">
            <span class="name">shape_types</span>        =
<span class="default_value">[&#39;mixed&#39;, &#39;round&#39;, &#39;r&#39;, &#39;ellipse&#39;, &#39;el&#39;]</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.shape_types"></a>
    
    

                            </div>
                            <div id="UscopeScene.image" class="classattr">
                                <div class="attr variable">
            <span class="name">image</span><span class="annotation">: numpy.ndarray</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.image"></a>
    
    

                            </div>
                            <div id="UscopeScene.denoised_image" class="classattr">
                                <div class="attr variable">
            <span class="name">denoised_image</span><span class="annotation">: numpy.ndarray</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#UscopeScene.denoised_image"></a>
    
    

                            </div>
                            <div id="UscopeScene.get_random_objects" class="classattr">
                                        <input id="UscopeScene.get_random_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">get_random_objects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">mean_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span>,</span><span class="param">	<span class="n">size_std</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span>,</span><span class="param">	<span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span>,</span><span class="param">	<span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">shapes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span>,</span><span class="param">	<span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span>,</span><span class="param">	<span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="UscopeScene.get_random_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.get_random_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.get_random_objects-103"><a href="#UscopeScene.get_random_objects-103"><span class="linenos">103</span></a>    <span class="nd">@classmethod</span>
</span><span id="UscopeScene.get_random_objects-104"><a href="#UscopeScene.get_random_objects-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">get_random_objects</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">mean_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">size_std</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span>
</span><span id="UscopeScene.get_random_objects-105"><a href="#UscopeScene.get_random_objects-105"><span class="linenos">105</span></a>                           <span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shapes</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">,</span>
</span><span id="UscopeScene.get_random_objects-106"><a href="#UscopeScene.get_random_objects-106"><span class="linenos">106</span></a>                           <span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-107"><a href="#UscopeScene.get_random_objects-107"><span class="linenos">107</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.get_random_objects-108"><a href="#UscopeScene.get_random_objects-108"><span class="linenos">108</span></a><span class="sd">        Generate objects with randomized shape sizes, for shapes: &#39;round&#39;, &#39;ellipse&#39;, &#39;mixed&#39; - last one for randomized choice</span>
</span><span id="UscopeScene.get_random_objects-109"><a href="#UscopeScene.get_random_objects-109"><span class="linenos">109</span></a><span class="sd">        between 2 first ones.</span>
</span><span id="UscopeScene.get_random_objects-110"><a href="#UscopeScene.get_random_objects-110"><span class="linenos">110</span></a>
</span><span id="UscopeScene.get_random_objects-111"><a href="#UscopeScene.get_random_objects-111"><span class="linenos">111</span></a><span class="sd">        Objects should be instances of FluorObj() class from this module.</span>
</span><span id="UscopeScene.get_random_objects-112"><a href="#UscopeScene.get_random_objects-112"><span class="linenos">112</span></a>
</span><span id="UscopeScene.get_random_objects-113"><a href="#UscopeScene.get_random_objects-113"><span class="linenos">113</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.get_random_objects-114"><a href="#UscopeScene.get_random_objects-114"><span class="linenos">114</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.get_random_objects-115"><a href="#UscopeScene.get_random_objects-115"><span class="linenos">115</span></a><span class="sd">        mean_size : Union[float, int, tuple]</span>
</span><span id="UscopeScene.get_random_objects-116"><a href="#UscopeScene.get_random_objects-116"><span class="linenos">116</span></a><span class="sd">            Mean size(-s) of randomized objects. Integer or float is supposed to be used for round particles, tuple - for ellipse.</span>
</span><span id="UscopeScene.get_random_objects-117"><a href="#UscopeScene.get_random_objects-117"><span class="linenos">117</span></a><span class="sd">        size_std : Union[float, int, tuple]</span>
</span><span id="UscopeScene.get_random_objects-118"><a href="#UscopeScene.get_random_objects-118"><span class="linenos">118</span></a><span class="sd">            Standard deviation of mean size(-s).</span>
</span><span id="UscopeScene.get_random_objects-119"><a href="#UscopeScene.get_random_objects-119"><span class="linenos">119</span></a><span class="sd">        intensity_range : tuple</span>
</span><span id="UscopeScene.get_random_objects-120"><a href="#UscopeScene.get_random_objects-120"><span class="linenos">120</span></a><span class="sd">            (Min, Max) intensities for randomized choice of the maximum intensity along the profile.</span>
</span><span id="UscopeScene.get_random_objects-121"><a href="#UscopeScene.get_random_objects-121"><span class="linenos">121</span></a><span class="sd">        n_objects : int, optional</span>
</span><span id="UscopeScene.get_random_objects-122"><a href="#UscopeScene.get_random_objects-122"><span class="linenos">122</span></a><span class="sd">            Number of generated objects. The default is 2.</span>
</span><span id="UscopeScene.get_random_objects-123"><a href="#UscopeScene.get_random_objects-123"><span class="linenos">123</span></a><span class="sd">        shapes : str, optional</span>
</span><span id="UscopeScene.get_random_objects-124"><a href="#UscopeScene.get_random_objects-124"><span class="linenos">124</span></a><span class="sd">            Implemented in FluorObj() shapes: &#39;round&#39;, &#39;ellipse&#39; or &#39;mixed&#39; them (randomly selected). The default is &#39;round&#39;.</span>
</span><span id="UscopeScene.get_random_objects-125"><a href="#UscopeScene.get_random_objects-125"><span class="linenos">125</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="UscopeScene.get_random_objects-126"><a href="#UscopeScene.get_random_objects-126"><span class="linenos">126</span></a><span class="sd">            Image type of the scene on which the objects will be placed and cast to. The default is &#39;uint8&#39;.</span>
</span><span id="UscopeScene.get_random_objects-127"><a href="#UscopeScene.get_random_objects-127"><span class="linenos">127</span></a><span class="sd">        verbose_info : bool, optional</span>
</span><span id="UscopeScene.get_random_objects-128"><a href="#UscopeScene.get_random_objects-128"><span class="linenos">128</span></a><span class="sd">            Flag for printing out verbose information about the generation progress (use it for many objects generation). The default is False.</span>
</span><span id="UscopeScene.get_random_objects-129"><a href="#UscopeScene.get_random_objects-129"><span class="linenos">129</span></a><span class="sd">        accelerated : bool, optional</span>
</span><span id="UscopeScene.get_random_objects-130"><a href="#UscopeScene.get_random_objects-130"><span class="linenos">130</span></a><span class="sd">            Flag for attempting acceleration of objects shape calculation by using &#39;numba&#39; library compilation.</span>
</span><span id="UscopeScene.get_random_objects-131"><a href="#UscopeScene.get_random_objects-131"><span class="linenos">131</span></a>
</span><span id="UscopeScene.get_random_objects-132"><a href="#UscopeScene.get_random_objects-132"><span class="linenos">132</span></a><span class="sd">        Raises</span>
</span><span id="UscopeScene.get_random_objects-133"><a href="#UscopeScene.get_random_objects-133"><span class="linenos">133</span></a><span class="sd">        ------</span>
</span><span id="UscopeScene.get_random_objects-134"><a href="#UscopeScene.get_random_objects-134"><span class="linenos">134</span></a><span class="sd">        ValueError</span>
</span><span id="UscopeScene.get_random_objects-135"><a href="#UscopeScene.get_random_objects-135"><span class="linenos">135</span></a><span class="sd">            See the provided description.</span>
</span><span id="UscopeScene.get_random_objects-136"><a href="#UscopeScene.get_random_objects-136"><span class="linenos">136</span></a>
</span><span id="UscopeScene.get_random_objects-137"><a href="#UscopeScene.get_random_objects-137"><span class="linenos">137</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.get_random_objects-138"><a href="#UscopeScene.get_random_objects-138"><span class="linenos">138</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.get_random_objects-139"><a href="#UscopeScene.get_random_objects-139"><span class="linenos">139</span></a><span class="sd">        tuple</span>
</span><span id="UscopeScene.get_random_objects-140"><a href="#UscopeScene.get_random_objects-140"><span class="linenos">140</span></a><span class="sd">            Packed instances of FluorObj() class.</span>
</span><span id="UscopeScene.get_random_objects-141"><a href="#UscopeScene.get_random_objects-141"><span class="linenos">141</span></a>
</span><span id="UscopeScene.get_random_objects-142"><a href="#UscopeScene.get_random_objects-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.get_random_objects-143"><a href="#UscopeScene.get_random_objects-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-144"><a href="#UscopeScene.get_random_objects-144"><span class="linenos">144</span></a>            <span class="n">t_ov_1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="UscopeScene.get_random_objects-145"><a href="#UscopeScene.get_random_objects-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="n">shapes</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">shape_types</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-146"><a href="#UscopeScene.get_random_objects-146"><span class="linenos">146</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please provide the supported shape type for generation from a list: </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">shape_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-147"><a href="#UscopeScene.get_random_objects-147"><span class="linenos">147</span></a>        <span class="n">fl_objects</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># for storing generated objects</span>
</span><span id="UscopeScene.get_random_objects-148"><a href="#UscopeScene.get_random_objects-148"><span class="linenos">148</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">r_std</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># default parameters for round objects</span>
</span><span id="UscopeScene.get_random_objects-149"><a href="#UscopeScene.get_random_objects-149"><span class="linenos">149</span></a>        <span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span> <span class="o">=</span> <span class="n">intensity_range</span>  <span class="c1"># assuming that only 2 values provided</span>
</span><span id="UscopeScene.get_random_objects-150"><a href="#UscopeScene.get_random_objects-150"><span class="linenos">150</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_objects</span><span class="p">):</span>
</span><span id="UscopeScene.get_random_objects-151"><a href="#UscopeScene.get_random_objects-151"><span class="linenos">151</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-152"><a href="#UscopeScene.get_random_objects-152"><span class="linenos">152</span></a>                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
</span><span id="UscopeScene.get_random_objects-153"><a href="#UscopeScene.get_random_objects-153"><span class="linenos">153</span></a>            <span class="k">if</span> <span class="n">shapes</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-154"><a href="#UscopeScene.get_random_objects-154"><span class="linenos">154</span></a>                <span class="n">shape_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">])</span>
</span><span id="UscopeScene.get_random_objects-155"><a href="#UscopeScene.get_random_objects-155"><span class="linenos">155</span></a>                <span class="c1"># Define radius and radius std for round particles from the provided tuples for the ellipses (random choice between a and b)</span>
</span><span id="UscopeScene.get_random_objects-156"><a href="#UscopeScene.get_random_objects-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene.get_random_objects-157"><a href="#UscopeScene.get_random_objects-157"><span class="linenos">157</span></a>                    <span class="n">r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">mean_size</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-158"><a href="#UscopeScene.get_random_objects-158"><span class="linenos">158</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-159"><a href="#UscopeScene.get_random_objects-159"><span class="linenos">159</span></a>                    <span class="n">r</span> <span class="o">=</span> <span class="n">mean_size</span>
</span><span id="UscopeScene.get_random_objects-160"><a href="#UscopeScene.get_random_objects-160"><span class="linenos">160</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_std</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene.get_random_objects-161"><a href="#UscopeScene.get_random_objects-161"><span class="linenos">161</span></a>                    <span class="n">r_std</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">size_std</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-162"><a href="#UscopeScene.get_random_objects-162"><span class="linenos">162</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-163"><a href="#UscopeScene.get_random_objects-163"><span class="linenos">163</span></a>                    <span class="n">r_std</span> <span class="o">=</span> <span class="n">size_std</span>
</span><span id="UscopeScene.get_random_objects-164"><a href="#UscopeScene.get_random_objects-164"><span class="linenos">164</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-165"><a href="#UscopeScene.get_random_objects-165"><span class="linenos">165</span></a>                <span class="n">shape_type</span> <span class="o">=</span> <span class="n">shapes</span>
</span><span id="UscopeScene.get_random_objects-166"><a href="#UscopeScene.get_random_objects-166"><span class="linenos">166</span></a>            <span class="c1"># Random selection of central shifts for placement</span>
</span><span id="UscopeScene.get_random_objects-167"><a href="#UscopeScene.get_random_objects-167"><span class="linenos">167</span></a>            <span class="n">i_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="n">j_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># random generation of central pixel shifts</span>
</span><span id="UscopeScene.get_random_objects-168"><a href="#UscopeScene.get_random_objects-168"><span class="linenos">168</span></a>            <span class="c1"># Checking that shifts are generated in the subpixel range and correcting it if not</span>
</span><span id="UscopeScene.get_random_objects-169"><a href="#UscopeScene.get_random_objects-169"><span class="linenos">169</span></a>            <span class="k">if</span> <span class="n">i_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-170"><a href="#UscopeScene.get_random_objects-170"><span class="linenos">170</span></a>                <span class="n">i_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene.get_random_objects-171"><a href="#UscopeScene.get_random_objects-171"><span class="linenos">171</span></a>            <span class="k">if</span> <span class="n">j_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-172"><a href="#UscopeScene.get_random_objects-172"><span class="linenos">172</span></a>                <span class="n">j_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene.get_random_objects-173"><a href="#UscopeScene.get_random_objects-173"><span class="linenos">173</span></a>            <span class="n">sign_i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]);</span> <span class="n">sign_j</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]);</span> <span class="n">i_shift</span> <span class="o">*=</span> <span class="n">sign_i</span><span class="p">;</span> <span class="n">j_shift</span> <span class="o">*=</span> <span class="n">sign_j</span>  <span class="c1"># random signs</span>
</span><span id="UscopeScene.get_random_objects-174"><a href="#UscopeScene.get_random_objects-174"><span class="linenos">174</span></a>            <span class="c1"># Random selection of max intensity for the profile casting</span>
</span><span id="UscopeScene.get_random_objects-175"><a href="#UscopeScene.get_random_objects-175"><span class="linenos">175</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="UscopeScene.get_random_objects-176"><a href="#UscopeScene.get_random_objects-176"><span class="linenos">176</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-177"><a href="#UscopeScene.get_random_objects-177"><span class="linenos">177</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="UscopeScene.get_random_objects-178"><a href="#UscopeScene.get_random_objects-178"><span class="linenos">178</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-179"><a href="#UscopeScene.get_random_objects-179"><span class="linenos">179</span></a>            <span class="c1"># Round shaped object generation</span>
</span><span id="UscopeScene.get_random_objects-180"><a href="#UscopeScene.get_random_objects-180"><span class="linenos">180</span></a>            <span class="k">if</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;round&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-181"><a href="#UscopeScene.get_random_objects-181"><span class="linenos">181</span></a>                <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">r_std</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-182"><a href="#UscopeScene.get_random_objects-182"><span class="linenos">182</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">r_std</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-183"><a href="#UscopeScene.get_random_objects-183"><span class="linenos">183</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-184"><a href="#UscopeScene.get_random_objects-184"><span class="linenos">184</span></a>                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mean_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">size_std</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene.get_random_objects-185"><a href="#UscopeScene.get_random_objects-185"><span class="linenos">185</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Provided tuple with sizes for round shape object, there expected only single number size&quot;</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-186"><a href="#UscopeScene.get_random_objects-186"><span class="linenos">186</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mean_size</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">size_std</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-187"><a href="#UscopeScene.get_random_objects-187"><span class="linenos">187</span></a>                <span class="c1"># Checking generated radius for consistency</span>
</span><span id="UscopeScene.get_random_objects-188"><a href="#UscopeScene.get_random_objects-188"><span class="linenos">188</span></a>                <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-189"><a href="#UscopeScene.get_random_objects-189"><span class="linenos">189</span></a>                    <span class="n">radius</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.6</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-190"><a href="#UscopeScene.get_random_objects-190"><span class="linenos">190</span></a>                <span class="c1"># Generating the object and calculating its shape, cast and crop it</span>
</span><span id="UscopeScene.get_random_objects-191"><a href="#UscopeScene.get_random_objects-191"><span class="linenos">191</span></a>                <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">));</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="n">accelerated</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-192"><a href="#UscopeScene.get_random_objects-192"><span class="linenos">192</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">();</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-193"><a href="#UscopeScene.get_random_objects-193"><span class="linenos">193</span></a>            <span class="c1"># Ellipse shaped object generation</span>
</span><span id="UscopeScene.get_random_objects-194"><a href="#UscopeScene.get_random_objects-194"><span class="linenos">194</span></a>            <span class="k">elif</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;ellipse&#39;</span> <span class="ow">or</span> <span class="n">shape_type</span> <span class="o">==</span> <span class="s1">&#39;el&#39;</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-195"><a href="#UscopeScene.get_random_objects-195"><span class="linenos">195</span></a>                <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">mean_size</span><span class="p">;</span> <span class="n">a_std</span><span class="p">,</span> <span class="n">b_std</span> <span class="o">=</span> <span class="n">size_std</span>  <span class="c1"># unpacking tuples assuming 2 of sizes packed there</span>
</span><span id="UscopeScene.get_random_objects-196"><a href="#UscopeScene.get_random_objects-196"><span class="linenos">196</span></a>                <span class="n">a_r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">a_std</span><span class="p">);</span> <span class="n">b_r</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">b_std</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-197"><a href="#UscopeScene.get_random_objects-197"><span class="linenos">197</span></a>                <span class="n">angle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>  <span class="c1"># get random orientation for an ellipse</span>
</span><span id="UscopeScene.get_random_objects-198"><a href="#UscopeScene.get_random_objects-198"><span class="linenos">198</span></a>                <span class="c1"># Checking generated a, b axes for consistency (min axis &gt;= 0.5, max axis &gt;= 1.0)</span>
</span><span id="UscopeScene.get_random_objects-199"><a href="#UscopeScene.get_random_objects-199"><span class="linenos">199</span></a>                <span class="k">if</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-200"><a href="#UscopeScene.get_random_objects-200"><span class="linenos">200</span></a>                    <span class="n">a</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-201"><a href="#UscopeScene.get_random_objects-201"><span class="linenos">201</span></a>                <span class="k">elif</span> <span class="n">b</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-202"><a href="#UscopeScene.get_random_objects-202"><span class="linenos">202</span></a>                    <span class="n">b</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.6</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-203"><a href="#UscopeScene.get_random_objects-203"><span class="linenos">203</span></a>                <span class="n">max_axis</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-204"><a href="#UscopeScene.get_random_objects-204"><span class="linenos">204</span></a>                <span class="k">if</span> <span class="n">max_axis</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-205"><a href="#UscopeScene.get_random_objects-205"><span class="linenos">205</span></a>                    <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">max_axis</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-206"><a href="#UscopeScene.get_random_objects-206"><span class="linenos">206</span></a>                        <span class="n">a</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.1</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-207"><a href="#UscopeScene.get_random_objects-207"><span class="linenos">207</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-208"><a href="#UscopeScene.get_random_objects-208"><span class="linenos">208</span></a>                        <span class="n">b</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">1.1</span><span class="o">-</span><span class="n">b</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-209"><a href="#UscopeScene.get_random_objects-209"><span class="linenos">209</span></a>                <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="n">a_r</span><span class="p">,</span> <span class="n">b_r</span><span class="p">,</span> <span class="n">angle</span><span class="p">),</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">),</span> <span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-210"><a href="#UscopeScene.get_random_objects-210"><span class="linenos">210</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="n">accelerated</span><span class="p">);</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">()</span>  <span class="c1"># calculate normalized shape and crop it</span>
</span><span id="UscopeScene.get_random_objects-211"><a href="#UscopeScene.get_random_objects-211"><span class="linenos">211</span></a>                <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-212"><a href="#UscopeScene.get_random_objects-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-213"><a href="#UscopeScene.get_random_objects-213"><span class="linenos">213</span></a>                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="UscopeScene.get_random_objects-214"><a href="#UscopeScene.get_random_objects-214"><span class="linenos">214</span></a>                <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-215"><a href="#UscopeScene.get_random_objects-215"><span class="linenos">215</span></a>                    <span class="n">elapsed_time</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-216"><a href="#UscopeScene.get_random_objects-216"><span class="linenos">216</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated obj. #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2">, elapsed </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-217"><a href="#UscopeScene.get_random_objects-217"><span class="linenos">217</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-218"><a href="#UscopeScene.get_random_objects-218"><span class="linenos">218</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated obj. #</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2">, elapsed </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> msec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-219"><a href="#UscopeScene.get_random_objects-219"><span class="linenos">219</span></a>        <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-220"><a href="#UscopeScene.get_random_objects-220"><span class="linenos">220</span></a>            <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t_ov_1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="UscopeScene.get_random_objects-221"><a href="#UscopeScene.get_random_objects-221"><span class="linenos">221</span></a>            <span class="k">if</span> <span class="n">elapsed_time_ov</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-222"><a href="#UscopeScene.get_random_objects-222"><span class="linenos">222</span></a>                <span class="n">elapsed_time_ov</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time_ov</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time_ov</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-223"><a href="#UscopeScene.get_random_objects-223"><span class="linenos">223</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall generation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-224"><a href="#UscopeScene.get_random_objects-224"><span class="linenos">224</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_random_objects-225"><a href="#UscopeScene.get_random_objects-225"><span class="linenos">225</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Overall generation took </span><span class="si">{</span><span class="n">elapsed_time_ov</span><span class="si">}</span><span class="s2"> milliseconds&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene.get_random_objects-226"><a href="#UscopeScene.get_random_objects-226"><span class="linenos">226</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fl_objects</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate objects with randomized shape sizes, for shapes: 'round', 'ellipse', 'mixed' - last one for randomized choice
between 2 first ones.</p>

<p>Objects should be instances of FluorObj() class from this module.</p>

<h2 id="parameters">Parameters</h2>

<p>mean_size : Union[float, int, tuple]
    Mean size(-s) of randomized objects. Integer or float is supposed to be used for round particles, tuple - for ellipse.
size_std : Union[float, int, tuple]
    Standard deviation of mean size(-s).
intensity_range : tuple
    (Min, Max) intensities for randomized choice of the maximum intensity along the profile.
n_objects : int, optional
    Number of generated objects. The default is 2.
shapes : str, optional
    Implemented in FluorObj() shapes: 'round', 'ellipse' or 'mixed' them (randomly selected). The default is 'round'.
image_type : Union[str, np.uint8, np.uint16, np.float64], optional
    Image type of the scene on which the objects will be placed and cast to. The default is 'uint8'.
verbose_info : bool, optional
    Flag for printing out verbose information about the generation progress (use it for many objects generation). The default is False.
accelerated : bool, optional
    Flag for attempting acceleration of objects shape calculation by using 'numba' library compilation.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    See the provided description.</p>

<h2 id="returns">Returns</h2>

<p>tuple
    Packed instances of FluorObj() class.</p>
</div>


                            </div>
                            <div id="UscopeScene.get_round_objects" class="classattr">
                                        <input id="UscopeScene.get_round_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_round_objects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">mean_size</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">size_std</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span>,</span><span class="param">	<span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>,</span><span class="param">	<span class="n">shape_r_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mixed&#39;</span>,</span><span class="param">	<span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="UscopeScene.get_round_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.get_round_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.get_round_objects-228"><a href="#UscopeScene.get_round_objects-228"><span class="linenos">228</span></a>    <span class="nd">@staticmethod</span>
</span><span id="UscopeScene.get_round_objects-229"><a href="#UscopeScene.get_round_objects-229"><span class="linenos">229</span></a>    <span class="k">def</span> <span class="nf">get_round_objects</span><span class="p">(</span><span class="n">mean_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">size_std</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">intensity_range</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">n_objects</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">shape_r_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;mixed&#39;</span><span class="p">,</span>
</span><span id="UscopeScene.get_round_objects-230"><a href="#UscopeScene.get_round_objects-230"><span class="linenos">230</span></a>                          <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="UscopeScene.get_round_objects-231"><a href="#UscopeScene.get_round_objects-231"><span class="linenos">231</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.get_round_objects-232"><a href="#UscopeScene.get_round_objects-232"><span class="linenos">232</span></a><span class="sd">        Generate round shaped objects (as FluorObj class instances) with continuous shapes (see FluorObj class documentation).</span>
</span><span id="UscopeScene.get_round_objects-233"><a href="#UscopeScene.get_round_objects-233"><span class="linenos">233</span></a>
</span><span id="UscopeScene.get_round_objects-234"><a href="#UscopeScene.get_round_objects-234"><span class="linenos">234</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.get_round_objects-235"><a href="#UscopeScene.get_round_objects-235"><span class="linenos">235</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.get_round_objects-236"><a href="#UscopeScene.get_round_objects-236"><span class="linenos">236</span></a><span class="sd">        mean_size : float</span>
</span><span id="UscopeScene.get_round_objects-237"><a href="#UscopeScene.get_round_objects-237"><span class="linenos">237</span></a><span class="sd">            Mean size of objects in pixels.</span>
</span><span id="UscopeScene.get_round_objects-238"><a href="#UscopeScene.get_round_objects-238"><span class="linenos">238</span></a><span class="sd">        size_std : float</span>
</span><span id="UscopeScene.get_round_objects-239"><a href="#UscopeScene.get_round_objects-239"><span class="linenos">239</span></a><span class="sd">            Standard deviation of objects sizes.</span>
</span><span id="UscopeScene.get_round_objects-240"><a href="#UscopeScene.get_round_objects-240"><span class="linenos">240</span></a><span class="sd">        intensity_range : tuple</span>
</span><span id="UscopeScene.get_round_objects-241"><a href="#UscopeScene.get_round_objects-241"><span class="linenos">241</span></a><span class="sd">            Intensity range for selection of maximum object intensity.</span>
</span><span id="UscopeScene.get_round_objects-242"><a href="#UscopeScene.get_round_objects-242"><span class="linenos">242</span></a><span class="sd">        n_objects : int, optional</span>
</span><span id="UscopeScene.get_round_objects-243"><a href="#UscopeScene.get_round_objects-243"><span class="linenos">243</span></a><span class="sd">            Number of generated objects. The default is 2.</span>
</span><span id="UscopeScene.get_round_objects-244"><a href="#UscopeScene.get_round_objects-244"><span class="linenos">244</span></a><span class="sd">        shape_r_type : str, optional</span>
</span><span id="UscopeScene.get_round_objects-245"><a href="#UscopeScene.get_round_objects-245"><span class="linenos">245</span></a><span class="sd">            Acceptable by FluorObj class round and computed shape types. The default is &#39;mixed&#39;.</span>
</span><span id="UscopeScene.get_round_objects-246"><a href="#UscopeScene.get_round_objects-246"><span class="linenos">246</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="UscopeScene.get_round_objects-247"><a href="#UscopeScene.get_round_objects-247"><span class="linenos">247</span></a><span class="sd">            Type of image used for a scene. The default is &#39;uint8&#39;.</span>
</span><span id="UscopeScene.get_round_objects-248"><a href="#UscopeScene.get_round_objects-248"><span class="linenos">248</span></a>
</span><span id="UscopeScene.get_round_objects-249"><a href="#UscopeScene.get_round_objects-249"><span class="linenos">249</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.get_round_objects-250"><a href="#UscopeScene.get_round_objects-250"><span class="linenos">250</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.get_round_objects-251"><a href="#UscopeScene.get_round_objects-251"><span class="linenos">251</span></a><span class="sd">        tuple</span>
</span><span id="UscopeScene.get_round_objects-252"><a href="#UscopeScene.get_round_objects-252"><span class="linenos">252</span></a><span class="sd">            Generated objects.</span>
</span><span id="UscopeScene.get_round_objects-253"><a href="#UscopeScene.get_round_objects-253"><span class="linenos">253</span></a>
</span><span id="UscopeScene.get_round_objects-254"><a href="#UscopeScene.get_round_objects-254"><span class="linenos">254</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.get_round_objects-255"><a href="#UscopeScene.get_round_objects-255"><span class="linenos">255</span></a>        <span class="n">fl_objects</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span> <span class="o">=</span> <span class="n">intensity_range</span>
</span><span id="UscopeScene.get_round_objects-256"><a href="#UscopeScene.get_round_objects-256"><span class="linenos">256</span></a>        <span class="n">shape_types</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="o">.</span><span class="n">valuable_round_shapes</span><span class="p">[:];</span> <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shape_types</span><span class="p">)</span>
</span><span id="UscopeScene.get_round_objects-257"><a href="#UscopeScene.get_round_objects-257"><span class="linenos">257</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_objects</span><span class="p">):</span>
</span><span id="UscopeScene.get_round_objects-258"><a href="#UscopeScene.get_round_objects-258"><span class="linenos">258</span></a>            <span class="c1"># Random selection of central shifts for placement</span>
</span><span id="UscopeScene.get_round_objects-259"><a href="#UscopeScene.get_round_objects-259"><span class="linenos">259</span></a>            <span class="n">i_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">);</span> <span class="n">j_shift</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># random generation of central pixel shifts</span>
</span><span id="UscopeScene.get_round_objects-260"><a href="#UscopeScene.get_round_objects-260"><span class="linenos">260</span></a>            <span class="c1"># Checking that shifts are generated in the subpixel range and correcting it if not</span>
</span><span id="UscopeScene.get_round_objects-261"><a href="#UscopeScene.get_round_objects-261"><span class="linenos">261</span></a>            <span class="k">if</span> <span class="n">i_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene.get_round_objects-262"><a href="#UscopeScene.get_round_objects-262"><span class="linenos">262</span></a>                <span class="n">i_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene.get_round_objects-263"><a href="#UscopeScene.get_round_objects-263"><span class="linenos">263</span></a>            <span class="k">if</span> <span class="n">j_shift</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="UscopeScene.get_round_objects-264"><a href="#UscopeScene.get_round_objects-264"><span class="linenos">264</span></a>                <span class="n">j_shift</span> <span class="o">-=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="mf">0.25</span>
</span><span id="UscopeScene.get_round_objects-265"><a href="#UscopeScene.get_round_objects-265"><span class="linenos">265</span></a>            <span class="n">radius</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">gauss</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mean_size</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">size_std</span><span class="p">)</span>  <span class="c1"># get the radius from Gaussian distribution</span>
</span><span id="UscopeScene.get_round_objects-266"><a href="#UscopeScene.get_round_objects-266"><span class="linenos">266</span></a>            <span class="c1"># Random selection of max intensity for the profile casting</span>
</span><span id="UscopeScene.get_round_objects-267"><a href="#UscopeScene.get_round_objects-267"><span class="linenos">267</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="UscopeScene.get_round_objects-268"><a href="#UscopeScene.get_round_objects-268"><span class="linenos">268</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">max_intensity</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene.get_round_objects-269"><a href="#UscopeScene.get_round_objects-269"><span class="linenos">269</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="UscopeScene.get_round_objects-270"><a href="#UscopeScene.get_round_objects-270"><span class="linenos">270</span></a>                <span class="n">fl_intensity</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">min_intensity</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">max_intensity</span><span class="p">)</span>
</span><span id="UscopeScene.get_round_objects-271"><a href="#UscopeScene.get_round_objects-271"><span class="linenos">271</span></a>            <span class="c1"># Checking generated radius for consistency</span>
</span><span id="UscopeScene.get_round_objects-272"><a href="#UscopeScene.get_round_objects-272"><span class="linenos">272</span></a>            <span class="k">if</span> <span class="n">radius</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
</span><span id="UscopeScene.get_round_objects-273"><a href="#UscopeScene.get_round_objects-273"><span class="linenos">273</span></a>                <span class="n">radius</span> <span class="o">+=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mf">0.6</span><span class="o">-</span><span class="n">radius</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</span><span id="UscopeScene.get_round_objects-274"><a href="#UscopeScene.get_round_objects-274"><span class="linenos">274</span></a>            <span class="c1"># If mixed type, selecting randomly the shape type</span>
</span><span id="UscopeScene.get_round_objects-275"><a href="#UscopeScene.get_round_objects-275"><span class="linenos">275</span></a>            <span class="k">if</span> <span class="n">shape_r_type</span> <span class="o">==</span> <span class="s1">&#39;mixed&#39;</span><span class="p">:</span>
</span><span id="UscopeScene.get_round_objects-276"><a href="#UscopeScene.get_round_objects-276"><span class="linenos">276</span></a>                <span class="n">shape_sel_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">shape_types</span><span class="p">)</span>
</span><span id="UscopeScene.get_round_objects-277"><a href="#UscopeScene.get_round_objects-277"><span class="linenos">277</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.get_round_objects-278"><a href="#UscopeScene.get_round_objects-278"><span class="linenos">278</span></a>                <span class="n">shape_sel_type</span> <span class="o">=</span> <span class="n">shape_r_type</span>
</span><span id="UscopeScene.get_round_objects-279"><a href="#UscopeScene.get_round_objects-279"><span class="linenos">279</span></a>            <span class="c1"># Generating the round shaped object with continuous function used for shape calculation</span>
</span><span id="UscopeScene.get_round_objects-280"><a href="#UscopeScene.get_round_objects-280"><span class="linenos">280</span></a>            <span class="n">fl_object</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">center_shifts</span><span class="o">=</span><span class="p">(</span><span class="n">i_shift</span><span class="p">,</span> <span class="n">j_shift</span><span class="p">),</span> <span class="n">border_type</span><span class="o">=</span><span class="s1">&#39;co&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="o">=</span><span class="n">shape_sel_type</span><span class="p">)</span>
</span><span id="UscopeScene.get_round_objects-281"><a href="#UscopeScene.get_round_objects-281"><span class="linenos">281</span></a>            <span class="n">fl_object</span><span class="o">.</span><span class="n">get_shape</span><span class="p">();</span> <span class="n">fl_object</span><span class="o">.</span><span class="n">crop_shape</span><span class="p">()</span>  <span class="c1"># calculate normalized shape and crop it</span>
</span><span id="UscopeScene.get_round_objects-282"><a href="#UscopeScene.get_round_objects-282"><span class="linenos">282</span></a>            <span class="n">fl_object</span><span class="o">.</span><span class="n">get_casted_shape</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">=</span><span class="n">fl_intensity</span><span class="p">,</span> <span class="n">image_type</span><span class="o">=</span><span class="n">image_type</span><span class="p">);</span> <span class="n">fl_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fl_object</span><span class="p">)</span>
</span><span id="UscopeScene.get_round_objects-283"><a href="#UscopeScene.get_round_objects-283"><span class="linenos">283</span></a>        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fl_objects</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Generate round shaped objects (as FluorObj class instances) with continuous shapes (see FluorObj class documentation).</p>

<h2 id="parameters">Parameters</h2>

<p>mean_size : float
    Mean size of objects in pixels.
size_std : float
    Standard deviation of objects sizes.
intensity_range : tuple
    Intensity range for selection of maximum object intensity.
n_objects : int, optional
    Number of generated objects. The default is 2.
shape_r_type : str, optional
    Acceptable by FluorObj class round and computed shape types. The default is 'mixed'.
image_type : Union[str, np.uint8, np.uint16, np.float64], optional
    Type of image used for a scene. The default is 'uint8'.</p>

<h2 id="returns">Returns</h2>

<p>tuple
    Generated objects.</p>
</div>


                            </div>
                            <div id="UscopeScene.set_random_places" class="classattr">
                                        <input id="UscopeScene.set_random_places-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_random_places</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">overlapping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">touching</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">only_within_scene</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="UscopeScene.set_random_places-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.set_random_places"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.set_random_places-286"><a href="#UscopeScene.set_random_places-286"><span class="linenos">286</span></a>    <span class="k">def</span> <span class="nf">set_random_places</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">overlapping</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">touching</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="UscopeScene.set_random_places-287"><a href="#UscopeScene.set_random_places-287"><span class="linenos">287</span></a>                          <span class="n">only_within_scene</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">verbose_info</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-288"><a href="#UscopeScene.set_random_places-288"><span class="linenos">288</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.set_random_places-289"><a href="#UscopeScene.set_random_places-289"><span class="linenos">289</span></a><span class="sd">        Set random coordinates within scene (or partially outside) for provided objects.</span>
</span><span id="UscopeScene.set_random_places-290"><a href="#UscopeScene.set_random_places-290"><span class="linenos">290</span></a>
</span><span id="UscopeScene.set_random_places-291"><a href="#UscopeScene.set_random_places-291"><span class="linenos">291</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.set_random_places-292"><a href="#UscopeScene.set_random_places-292"><span class="linenos">292</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.set_random_places-293"><a href="#UscopeScene.set_random_places-293"><span class="linenos">293</span></a><span class="sd">        fluo_objects : tuple, optional</span>
</span><span id="UscopeScene.set_random_places-294"><a href="#UscopeScene.set_random_places-294"><span class="linenos">294</span></a><span class="sd">            Tuple with generated instances of FluorObj() class. The default is ().</span>
</span><span id="UscopeScene.set_random_places-295"><a href="#UscopeScene.set_random_places-295"><span class="linenos">295</span></a><span class="sd">        overlapping : bool, optional</span>
</span><span id="UscopeScene.set_random_places-296"><a href="#UscopeScene.set_random_places-296"><span class="linenos">296</span></a><span class="sd">            If True, the coordinates will be randomly selected from available ones. \n</span>
</span><span id="UscopeScene.set_random_places-297"><a href="#UscopeScene.set_random_places-297"><span class="linenos">297</span></a><span class="sd">            If False, the largest object will be placed firstly, and others will be placed after with checking that the object to be placed</span>
</span><span id="UscopeScene.set_random_places-298"><a href="#UscopeScene.set_random_places-298"><span class="linenos">298</span></a><span class="sd">            are not intersected with the already placed objects on previous iterations. \n</span>
</span><span id="UscopeScene.set_random_places-299"><a href="#UscopeScene.set_random_places-299"><span class="linenos">299</span></a><span class="sd">            The default is True.</span>
</span><span id="UscopeScene.set_random_places-300"><a href="#UscopeScene.set_random_places-300"><span class="linenos">300</span></a><span class="sd">        touching : bool, optional</span>
</span><span id="UscopeScene.set_random_places-301"><a href="#UscopeScene.set_random_places-301"><span class="linenos">301</span></a><span class="sd">            Flag for allowing objects to touch by their border pixels. Note that if overlapping is True, this flag ignored.</span>
</span><span id="UscopeScene.set_random_places-302"><a href="#UscopeScene.set_random_places-302"><span class="linenos">302</span></a><span class="sd">            The default is True.</span>
</span><span id="UscopeScene.set_random_places-303"><a href="#UscopeScene.set_random_places-303"><span class="linenos">303</span></a><span class="sd">        only_within_scene : bool, optional</span>
</span><span id="UscopeScene.set_random_places-304"><a href="#UscopeScene.set_random_places-304"><span class="linenos">304</span></a><span class="sd">            If True, the objects will be placed completely within (inside) the scene. \n</span>
</span><span id="UscopeScene.set_random_places-305"><a href="#UscopeScene.set_random_places-305"><span class="linenos">305</span></a><span class="sd">            If False, objects may lay partially outside the scene. The default is False.</span>
</span><span id="UscopeScene.set_random_places-306"><a href="#UscopeScene.set_random_places-306"><span class="linenos">306</span></a><span class="sd">        verbose_info : bool, optional</span>
</span><span id="UscopeScene.set_random_places-307"><a href="#UscopeScene.set_random_places-307"><span class="linenos">307</span></a><span class="sd">            Printing out verbose information about performance of placement. The default is False.</span>
</span><span id="UscopeScene.set_random_places-308"><a href="#UscopeScene.set_random_places-308"><span class="linenos">308</span></a>
</span><span id="UscopeScene.set_random_places-309"><a href="#UscopeScene.set_random_places-309"><span class="linenos">309</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.set_random_places-310"><a href="#UscopeScene.set_random_places-310"><span class="linenos">310</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.set_random_places-311"><a href="#UscopeScene.set_random_places-311"><span class="linenos">311</span></a><span class="sd">        tuple</span>
</span><span id="UscopeScene.set_random_places-312"><a href="#UscopeScene.set_random_places-312"><span class="linenos">312</span></a><span class="sd">            With the placed objects.</span>
</span><span id="UscopeScene.set_random_places-313"><a href="#UscopeScene.set_random_places-313"><span class="linenos">313</span></a>
</span><span id="UscopeScene.set_random_places-314"><a href="#UscopeScene.set_random_places-314"><span class="linenos">314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.set_random_places-315"><a href="#UscopeScene.set_random_places-315"><span class="linenos">315</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-316"><a href="#UscopeScene.set_random_places-316"><span class="linenos">316</span></a>            <span class="c1"># For making verbose information printouts, check the time performance of placement logic</span>
</span><span id="UscopeScene.set_random_places-317"><a href="#UscopeScene.set_random_places-317"><span class="linenos">317</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-318"><a href="#UscopeScene.set_random_places-318"><span class="linenos">318</span></a>                <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">();</span> <span class="n">n_objects</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-319"><a href="#UscopeScene.set_random_places-319"><span class="linenos">319</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># height and width of the image for setting the range of coordinates random selection</span>
</span><span id="UscopeScene.set_random_places-320"><a href="#UscopeScene.set_random_places-320"><span class="linenos">320</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-321"><a href="#UscopeScene.set_random_places-321"><span class="linenos">321</span></a>                <span class="n">filtered_fluo_obj</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># storing the objects in the list for excluding the not placed objects if they are not overlapped</span>
</span><span id="UscopeScene.set_random_places-322"><a href="#UscopeScene.set_random_places-322"><span class="linenos">322</span></a>                <span class="n">additional_border</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="UscopeScene.set_random_places-323"><a href="#UscopeScene.set_random_places-323"><span class="linenos">323</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">touching</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-324"><a href="#UscopeScene.set_random_places-324"><span class="linenos">324</span></a>                    <span class="n">additional_border</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># additional 2 pixels for excluding the pixels close to the object borders</span>
</span><span id="UscopeScene.set_random_places-325"><a href="#UscopeScene.set_random_places-325"><span class="linenos">325</span></a>            <span class="c1"># If only_within_scene, sort out the objects based on their sizes and place first the largest one, if not - the smallest one</span>
</span><span id="UscopeScene.set_random_places-326"><a href="#UscopeScene.set_random_places-326"><span class="linenos">326</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">or</span> <span class="p">(</span><span class="n">overlapping</span> <span class="ow">and</span> <span class="n">only_within_scene</span><span class="p">):</span>
</span><span id="UscopeScene.set_random_places-327"><a href="#UscopeScene.set_random_places-327"><span class="linenos">327</span></a>                <span class="n">fluo_objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>  <span class="c1"># convert for applying embedded sorting algorithm</span>
</span><span id="UscopeScene.set_random_places-328"><a href="#UscopeScene.set_random_places-328"><span class="linenos">328</span></a>            <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-329"><a href="#UscopeScene.set_random_places-329"><span class="linenos">329</span></a>                <span class="n">fluo_objects</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-330"><a href="#UscopeScene.set_random_places-330"><span class="linenos">330</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-331"><a href="#UscopeScene.set_random_places-331"><span class="linenos">331</span></a>                <span class="n">fluo_objects</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="UscopeScene.set_random_places-332"><a href="#UscopeScene.set_random_places-332"><span class="linenos">332</span></a>            <span class="c1"># Generating and set random placing coordinates of the upper left pixel for the objects</span>
</span><span id="UscopeScene.set_random_places-333"><a href="#UscopeScene.set_random_places-333"><span class="linenos">333</span></a>            <span class="n">placed_objects</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for printing out the number of placed objects</span>
</span><span id="UscopeScene.set_random_places-334"><a href="#UscopeScene.set_random_places-334"><span class="linenos">334</span></a>            <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">fluo_objects</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-335"><a href="#UscopeScene.set_random_places-335"><span class="linenos">335</span></a>                <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-336"><a href="#UscopeScene.set_random_places-336"><span class="linenos">336</span></a>                    <span class="n">h_fl_obj</span><span class="p">,</span> <span class="n">w_fl_obj</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># get object sizes</span>
</span><span id="UscopeScene.set_random_places-337"><a href="#UscopeScene.set_random_places-337"><span class="linenos">337</span></a>                    <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_image_sizes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># force to account for the used scene shape</span>
</span><span id="UscopeScene.set_random_places-338"><a href="#UscopeScene.set_random_places-338"><span class="linenos">338</span></a>                    <span class="c1"># Placement logic, if overlapping is allowed - just random spreading objects on the scene</span>
</span><span id="UscopeScene.set_random_places-339"><a href="#UscopeScene.set_random_places-339"><span class="linenos">339</span></a>                    <span class="k">if</span> <span class="n">overlapping</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">overlapping</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="UscopeScene.set_random_places-340"><a href="#UscopeScene.set_random_places-340"><span class="linenos">340</span></a>                        <span class="c1"># Depending on the flag, defining smallest and largest coordinates (outside the scene borders or only inside)</span>
</span><span id="UscopeScene.set_random_places-341"><a href="#UscopeScene.set_random_places-341"><span class="linenos">341</span></a>                        <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-342"><a href="#UscopeScene.set_random_places-342"><span class="linenos">342</span></a>                            <span class="n">i_smallest</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_smallest</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i_largest</span> <span class="o">=</span> <span class="n">h</span><span class="o">-</span><span class="n">h_fl_obj</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">j_largest</span> <span class="o">=</span> <span class="n">w</span><span class="o">-</span><span class="n">w_fl_obj</span><span class="o">-</span><span class="mi">1</span>
</span><span id="UscopeScene.set_random_places-343"><a href="#UscopeScene.set_random_places-343"><span class="linenos">343</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-344"><a href="#UscopeScene.set_random_places-344"><span class="linenos">344</span></a>                            <span class="c1"># smallest placing coordinate = half of object sizes - 1 pixel, analogous for largest coordinates</span>
</span><span id="UscopeScene.set_random_places-345"><a href="#UscopeScene.set_random_places-345"><span class="linenos">345</span></a>                            <span class="n">i_smallest</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">h_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_smallest</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">w_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="UscopeScene.set_random_places-346"><a href="#UscopeScene.set_random_places-346"><span class="linenos">346</span></a>                            <span class="n">i_largest</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">h_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">j_largest</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">w_fl_obj</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
</span><span id="UscopeScene.set_random_places-347"><a href="#UscopeScene.set_random_places-347"><span class="linenos">347</span></a>                        <span class="c1"># Random selection of i, j coordinates below</span>
</span><span id="UscopeScene.set_random_places-348"><a href="#UscopeScene.set_random_places-348"><span class="linenos">348</span></a>                        <span class="n">i_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-349"><a href="#UscopeScene.set_random_places-349"><span class="linenos">349</span></a>                        <span class="c1"># Not overlapping, below - place the largest object and create the mask for preventing the overlapping</span>
</span><span id="UscopeScene.set_random_places-350"><a href="#UscopeScene.set_random_places-350"><span class="linenos">350</span></a>                        <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-351"><a href="#UscopeScene.set_random_places-351"><span class="linenos">351</span></a>                            <span class="c1"># Generate the meshgrid of all available for placing coordinates (depending on the placement flag)</span>
</span><span id="UscopeScene.set_random_places-352"><a href="#UscopeScene.set_random_places-352"><span class="linenos">352</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-353"><a href="#UscopeScene.set_random_places-353"><span class="linenos">353</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-354"><a href="#UscopeScene.set_random_places-354"><span class="linenos">354</span></a>                                                                <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">)]</span>
</span><span id="UscopeScene.set_random_places-355"><a href="#UscopeScene.set_random_places-355"><span class="linenos">355</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-356"><a href="#UscopeScene.set_random_places-356"><span class="linenos">356</span></a>                                <span class="c1"># Below - keep the possible placement close to bottom and right edges of the scene and remove them later</span>
</span><span id="UscopeScene.set_random_places-357"><a href="#UscopeScene.set_random_places-357"><span class="linenos">357</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="UscopeScene.set_random_places-358"><a href="#UscopeScene.set_random_places-358"><span class="linenos">358</span></a>                                <span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_a</span><span class="p">,</span> <span class="n">j_a</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_smallest</span><span class="p">,</span> <span class="n">i_largest</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-359"><a href="#UscopeScene.set_random_places-359"><span class="linenos">359</span></a>                                                                 <span class="k">for</span> <span class="n">j_a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_smallest</span><span class="p">,</span> <span class="n">j_largest</span><span class="p">)]</span>
</span><span id="UscopeScene.set_random_places-360"><a href="#UscopeScene.set_random_places-360"><span class="linenos">360</span></a>                            <span class="c1"># Generate and placing objects on the binary mask (instead of the real image or scene)</span>
</span><span id="UscopeScene.set_random_places-361"><a href="#UscopeScene.set_random_places-361"><span class="linenos">361</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint8&#39;</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-362"><a href="#UscopeScene.set_random_places-362"><span class="linenos">362</span></a>                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">):</span>
</span><span id="UscopeScene.set_random_places-363"><a href="#UscopeScene.set_random_places-363"><span class="linenos">363</span></a>                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">):</span>
</span><span id="UscopeScene.set_random_places-364"><a href="#UscopeScene.set_random_places-364"><span class="linenos">364</span></a>                                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="UscopeScene.set_random_places-365"><a href="#UscopeScene.set_random_places-365"><span class="linenos">365</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="UscopeScene.set_random_places-366"><a href="#UscopeScene.set_random_places-366"><span class="linenos">366</span></a>                            <span class="c1"># Exclude the coordinates occupied by the placed object from the available choices for further placements</span>
</span><span id="UscopeScene.set_random_places-367"><a href="#UscopeScene.set_random_places-367"><span class="linenos">367</span></a>                            <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-368"><a href="#UscopeScene.set_random_places-368"><span class="linenos">368</span></a>                                                   <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)]</span>
</span><span id="UscopeScene.set_random_places-369"><a href="#UscopeScene.set_random_places-369"><span class="linenos">369</span></a>                            <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-370"><a href="#UscopeScene.set_random_places-370"><span class="linenos">370</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-371"><a href="#UscopeScene.set_random_places-371"><span class="linenos">371</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-372"><a href="#UscopeScene.set_random_places-372"><span class="linenos">372</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-373"><a href="#UscopeScene.set_random_places-373"><span class="linenos">373</span></a>                                    <span class="k">pass</span>
</span><span id="UscopeScene.set_random_places-374"><a href="#UscopeScene.set_random_places-374"><span class="linenos">374</span></a>                            <span class="n">filtered_fluo_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluo_obj</span><span class="p">)</span>  <span class="c1"># storing the 1st placed and not overlapped objects</span>
</span><span id="UscopeScene.set_random_places-375"><a href="#UscopeScene.set_random_places-375"><span class="linenos">375</span></a>                            <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="p">)</span>  <span class="c1"># shuffle available coordinates</span>
</span><span id="UscopeScene.set_random_places-376"><a href="#UscopeScene.set_random_places-376"><span class="linenos">376</span></a>                        <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>  <span class="c1"># set random place of the object within the image</span>
</span><span id="UscopeScene.set_random_places-377"><a href="#UscopeScene.set_random_places-377"><span class="linenos">377</span></a>                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">verbose_info</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-378"><a href="#UscopeScene.set_random_places-378"><span class="linenos">378</span></a>                            <span class="n">placed_objects</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of placed objects:&quot;</span><span class="p">,</span> <span class="n">placed_objects</span><span class="p">,</span> <span class="s2">&quot;out of&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="UscopeScene.set_random_places-379"><a href="#UscopeScene.set_random_places-379"><span class="linenos">379</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-380"><a href="#UscopeScene.set_random_places-380"><span class="linenos">380</span></a>                        <span class="c1"># Trying to place the object in the randomly selected from remaining coordinates place and checking if there is no</span>
</span><span id="UscopeScene.set_random_places-381"><a href="#UscopeScene.set_random_places-381"><span class="linenos">381</span></a>                        <span class="c1"># intersections with already placed objects, regulate # of attempts to place below in the while condition</span>
</span><span id="UscopeScene.set_random_places-382"><a href="#UscopeScene.set_random_places-382"><span class="linenos">382</span></a>                        <span class="n">i_attempts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">available_correcting_coordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="p">[:]</span>
</span><span id="UscopeScene.set_random_places-383"><a href="#UscopeScene.set_random_places-383"><span class="linenos">383</span></a>                        <span class="c1"># Adapting max number of attempts</span>
</span><span id="UscopeScene.set_random_places-384"><a href="#UscopeScene.set_random_places-384"><span class="linenos">384</span></a>                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">150</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-385"><a href="#UscopeScene.set_random_places-385"><span class="linenos">385</span></a>                            <span class="n">max_attempts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-386"><a href="#UscopeScene.set_random_places-386"><span class="linenos">386</span></a>                        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-387"><a href="#UscopeScene.set_random_places-387"><span class="linenos">387</span></a>                            <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># limiting max number of attempts to find suitable coordinates</span>
</span><span id="UscopeScene.set_random_places-388"><a href="#UscopeScene.set_random_places-388"><span class="linenos">388</span></a>                        <span class="c1"># Trying to place the object and check for intersections with the other ones</span>
</span><span id="UscopeScene.set_random_places-389"><a href="#UscopeScene.set_random_places-389"><span class="linenos">389</span></a>                        <span class="n">border_coordinates_deleted</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="UscopeScene.set_random_places-390"><a href="#UscopeScene.set_random_places-390"><span class="linenos">390</span></a>                        <span class="k">while</span> <span class="p">(</span><span class="ow">not</span> <span class="n">placed</span> <span class="ow">and</span> <span class="n">i_attempts</span> <span class="o">&lt;</span> <span class="n">max_attempts</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-391"><a href="#UscopeScene.set_random_places-391"><span class="linenos">391</span></a>                            <span class="n">overlapped</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for checking if the object is overlapped with the occupied place on a binary mask</span>
</span><span id="UscopeScene.set_random_places-392"><a href="#UscopeScene.set_random_places-392"><span class="linenos">392</span></a>                            <span class="c1"># randomly choose from the available coordinates</span>
</span><span id="UscopeScene.set_random_places-393"><a href="#UscopeScene.set_random_places-393"><span class="linenos">393</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-394"><a href="#UscopeScene.set_random_places-394"><span class="linenos">394</span></a>                                <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-395"><a href="#UscopeScene.set_random_places-395"><span class="linenos">395</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-396"><a href="#UscopeScene.set_random_places-396"><span class="linenos">396</span></a>                                <span class="k">if</span> <span class="ow">not</span> <span class="n">border_coordinates_deleted</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-397"><a href="#UscopeScene.set_random_places-397"><span class="linenos">397</span></a>                                    <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-398"><a href="#UscopeScene.set_random_places-398"><span class="linenos">398</span></a>                                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-399"><a href="#UscopeScene.set_random_places-399"><span class="linenos">399</span></a>                                    <span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-400"><a href="#UscopeScene.set_random_places-400"><span class="linenos">400</span></a>                            <span class="c1"># Vectorized form of the overlapping check</span>
</span><span id="UscopeScene.set_random_places-401"><a href="#UscopeScene.set_random_places-401"><span class="linenos">401</span></a>                            <span class="n">i_max</span><span class="p">,</span> <span class="n">j_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">i_max</span> <span class="o">-=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j_max</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="UscopeScene.set_random_places-402"><a href="#UscopeScene.set_random_places-402"><span class="linenos">402</span></a>                            <span class="c1"># Define the region of the placement mask for checking</span>
</span><span id="UscopeScene.set_random_places-403"><a href="#UscopeScene.set_random_places-403"><span class="linenos">403</span></a>                            <span class="k">if</span> <span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-404"><a href="#UscopeScene.set_random_places-404"><span class="linenos">404</span></a>                                <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="UscopeScene.set_random_places-405"><a href="#UscopeScene.set_random_places-405"><span class="linenos">405</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-406"><a href="#UscopeScene.set_random_places-406"><span class="linenos">406</span></a>                                <span class="n">i_start</span> <span class="o">=</span> <span class="n">i_obj</span> <span class="o">-</span> <span class="n">additional_border</span>
</span><span id="UscopeScene.set_random_places-407"><a href="#UscopeScene.set_random_places-407"><span class="linenos">407</span></a>                            <span class="k">if</span> <span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-408"><a href="#UscopeScene.set_random_places-408"><span class="linenos">408</span></a>                                <span class="n">j_start</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="UscopeScene.set_random_places-409"><a href="#UscopeScene.set_random_places-409"><span class="linenos">409</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-410"><a href="#UscopeScene.set_random_places-410"><span class="linenos">410</span></a>                                <span class="n">j_start</span> <span class="o">=</span> <span class="n">j_obj</span> <span class="o">-</span> <span class="n">additional_border</span>
</span><span id="UscopeScene.set_random_places-411"><a href="#UscopeScene.set_random_places-411"><span class="linenos">411</span></a>                            <span class="k">if</span> <span class="n">i_obj</span> <span class="o">+</span> <span class="n">h_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span> <span class="o">&gt;</span> <span class="n">i_max</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-412"><a href="#UscopeScene.set_random_places-412"><span class="linenos">412</span></a>                                <span class="n">i_finish</span> <span class="o">=</span> <span class="n">i_max</span>
</span><span id="UscopeScene.set_random_places-413"><a href="#UscopeScene.set_random_places-413"><span class="linenos">413</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-414"><a href="#UscopeScene.set_random_places-414"><span class="linenos">414</span></a>                                <span class="n">i_finish</span> <span class="o">=</span> <span class="n">i_obj</span> <span class="o">+</span> <span class="n">h_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span>
</span><span id="UscopeScene.set_random_places-415"><a href="#UscopeScene.set_random_places-415"><span class="linenos">415</span></a>                            <span class="k">if</span> <span class="n">j_obj</span> <span class="o">+</span> <span class="n">w_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span> <span class="o">&gt;</span> <span class="n">j_max</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-416"><a href="#UscopeScene.set_random_places-416"><span class="linenos">416</span></a>                                <span class="n">j_finish</span> <span class="o">=</span> <span class="n">j_max</span>
</span><span id="UscopeScene.set_random_places-417"><a href="#UscopeScene.set_random_places-417"><span class="linenos">417</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-418"><a href="#UscopeScene.set_random_places-418"><span class="linenos">418</span></a>                                <span class="n">j_finish</span> <span class="o">=</span> <span class="n">j_obj</span> <span class="o">+</span> <span class="n">w_fl_obj</span> <span class="o">+</span> <span class="n">additional_border</span>
</span><span id="UscopeScene.set_random_places-419"><a href="#UscopeScene.set_random_places-419"><span class="linenos">419</span></a>                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_finish</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_finish</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-420"><a href="#UscopeScene.set_random_places-420"><span class="linenos">420</span></a>                                <span class="n">overlapped</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">i_attempts</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="UscopeScene.set_random_places-421"><a href="#UscopeScene.set_random_places-421"><span class="linenos">421</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-422"><a href="#UscopeScene.set_random_places-422"><span class="linenos">422</span></a>                                    <span class="n">available_correcting_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">));</span> <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>
</span><span id="UscopeScene.set_random_places-423"><a href="#UscopeScene.set_random_places-423"><span class="linenos">423</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-424"><a href="#UscopeScene.set_random_places-424"><span class="linenos">424</span></a>                                    <span class="k">pass</span>
</span><span id="UscopeScene.set_random_places-425"><a href="#UscopeScene.set_random_places-425"><span class="linenos">425</span></a>                            <span class="c1"># Check that object placed and if not, delete border pixels for placing (long-lasting function)</span>
</span><span id="UscopeScene.set_random_places-426"><a href="#UscopeScene.set_random_places-426"><span class="linenos">426</span></a>                            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapped</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-427"><a href="#UscopeScene.set_random_places-427"><span class="linenos">427</span></a>                                <span class="n">placed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
</span><span id="UscopeScene.set_random_places-428"><a href="#UscopeScene.set_random_places-428"><span class="linenos">428</span></a>                            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-429"><a href="#UscopeScene.set_random_places-429"><span class="linenos">429</span></a>                                <span class="c1"># Prevent placing out of scene by removing from available coordinates</span>
</span><span id="UscopeScene.set_random_places-430"><a href="#UscopeScene.set_random_places-430"><span class="linenos">430</span></a>                                <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-431"><a href="#UscopeScene.set_random_places-431"><span class="linenos">431</span></a>                                    <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">h_fl_obj</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="UscopeScene.set_random_places-432"><a href="#UscopeScene.set_random_places-432"><span class="linenos">432</span></a>                                    <span class="n">coordinates_for_del</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span> <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">h</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="o">-</span><span class="n">w_fl_obj</span><span class="p">,</span> <span class="n">w</span><span class="o">-</span><span class="mi">2</span><span class="p">)]</span>
</span><span id="UscopeScene.set_random_places-433"><a href="#UscopeScene.set_random_places-433"><span class="linenos">433</span></a>                                    <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-434"><a href="#UscopeScene.set_random_places-434"><span class="linenos">434</span></a>                                        <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-435"><a href="#UscopeScene.set_random_places-435"><span class="linenos">435</span></a>                                            <span class="n">available_correcting_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-436"><a href="#UscopeScene.set_random_places-436"><span class="linenos">436</span></a>                                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-437"><a href="#UscopeScene.set_random_places-437"><span class="linenos">437</span></a>                                            <span class="k">pass</span>
</span><span id="UscopeScene.set_random_places-438"><a href="#UscopeScene.set_random_places-438"><span class="linenos">438</span></a>                                    <span class="n">border_coordinates_deleted</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="UscopeScene.set_random_places-439"><a href="#UscopeScene.set_random_places-439"><span class="linenos">439</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">available_correcting_coordinates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-440"><a href="#UscopeScene.set_random_places-440"><span class="linenos">440</span></a>                                <span class="n">placed</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="k">break</span>
</span><span id="UscopeScene.set_random_places-441"><a href="#UscopeScene.set_random_places-441"><span class="linenos">441</span></a>                        <span class="c1"># print(&quot;# of made attempts:&quot;, i_attempts)</span>
</span><span id="UscopeScene.set_random_places-442"><a href="#UscopeScene.set_random_places-442"><span class="linenos">442</span></a>                        <span class="c1"># Exclude the coordinates occupied by the placed object from the meshgrid (list with coordinates pares)</span>
</span><span id="UscopeScene.set_random_places-443"><a href="#UscopeScene.set_random_places-443"><span class="linenos">443</span></a>                        <span class="k">if</span> <span class="n">placed</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-444"><a href="#UscopeScene.set_random_places-444"><span class="linenos">444</span></a>                            <span class="n">coordinates_for_del</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i_exc</span><span class="p">,</span> <span class="n">j_exc</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-445"><a href="#UscopeScene.set_random_places-445"><span class="linenos">445</span></a>                                                   <span class="k">for</span> <span class="n">i_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-446"><a href="#UscopeScene.set_random_places-446"><span class="linenos">446</span></a>                                                   <span class="k">for</span> <span class="n">j_exc</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="o">-</span><span class="n">additional_border</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="o">+</span><span class="n">additional_border</span><span class="p">)]</span>
</span><span id="UscopeScene.set_random_places-447"><a href="#UscopeScene.set_random_places-447"><span class="linenos">447</span></a>                            <span class="k">for</span> <span class="n">del_coord</span> <span class="ow">in</span> <span class="n">coordinates_for_del</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-448"><a href="#UscopeScene.set_random_places-448"><span class="linenos">448</span></a>                                <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-449"><a href="#UscopeScene.set_random_places-449"><span class="linenos">449</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__available_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-450"><a href="#UscopeScene.set_random_places-450"><span class="linenos">450</span></a>                                    <span class="k">if</span> <span class="n">only_within_scene</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-451"><a href="#UscopeScene.set_random_places-451"><span class="linenos">451</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__restricted_coordinates</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">del_coord</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-452"><a href="#UscopeScene.set_random_places-452"><span class="linenos">452</span></a>                                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-453"><a href="#UscopeScene.set_random_places-453"><span class="linenos">453</span></a>                                    <span class="k">pass</span>
</span><span id="UscopeScene.set_random_places-454"><a href="#UscopeScene.set_random_places-454"><span class="linenos">454</span></a>                            <span class="c1"># Exclude placed object from binary placement mask</span>
</span><span id="UscopeScene.set_random_places-455"><a href="#UscopeScene.set_random_places-455"><span class="linenos">455</span></a>                            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">i_obj</span><span class="o">+</span><span class="n">h_fl_obj</span><span class="p">):</span>
</span><span id="UscopeScene.set_random_places-456"><a href="#UscopeScene.set_random_places-456"><span class="linenos">456</span></a>                                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="o">+</span><span class="n">w_fl_obj</span><span class="p">):</span>
</span><span id="UscopeScene.set_random_places-457"><a href="#UscopeScene.set_random_places-457"><span class="linenos">457</span></a>                                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="UscopeScene.set_random_places-458"><a href="#UscopeScene.set_random_places-458"><span class="linenos">458</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="UscopeScene.set_random_places-459"><a href="#UscopeScene.set_random_places-459"><span class="linenos">459</span></a>                            <span class="n">fluo_obj</span><span class="o">.</span><span class="n">set_coordinates</span><span class="p">((</span><span class="n">i_obj</span><span class="p">,</span> <span class="n">j_obj</span><span class="p">))</span>  <span class="c1"># if found place, place the object</span>
</span><span id="UscopeScene.set_random_places-460"><a href="#UscopeScene.set_random_places-460"><span class="linenos">460</span></a>                            <span class="n">filtered_fluo_obj</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fluo_obj</span><span class="p">)</span>  <span class="c1"># collect for returning only placed object, excluding not placed ones</span>
</span><span id="UscopeScene.set_random_places-461"><a href="#UscopeScene.set_random_places-461"><span class="linenos">461</span></a>                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-462"><a href="#UscopeScene.set_random_places-462"><span class="linenos">462</span></a>                                <span class="n">placed_objects</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="UscopeScene.set_random_places-463"><a href="#UscopeScene.set_random_places-463"><span class="linenos">463</span></a>                                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;# of placed objects:&quot;</span><span class="p">,</span> <span class="n">placed_objects</span><span class="p">,</span> <span class="s2">&quot;out of&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span><span id="UscopeScene.set_random_places-464"><a href="#UscopeScene.set_random_places-464"><span class="linenos">464</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">overlapping</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-465"><a href="#UscopeScene.set_random_places-465"><span class="linenos">465</span></a>                <span class="n">fluo_objects</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">filtered_fluo_obj</span><span class="p">)</span>  <span class="c1"># convert list -&gt; tuple for returning only placed objects</span>
</span><span id="UscopeScene.set_random_places-466"><a href="#UscopeScene.set_random_places-466"><span class="linenos">466</span></a>                <span class="c1"># plt.figure(&quot;Binary Placement Mask&quot;); plt.imshow(self.__binary_placement_mask)  # plot the occupied places by the objects</span>
</span><span id="UscopeScene.set_random_places-467"><a href="#UscopeScene.set_random_places-467"><span class="linenos">467</span></a>            <span class="k">if</span> <span class="n">verbose_info</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-468"><a href="#UscopeScene.set_random_places-468"><span class="linenos">468</span></a>                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">1000.0</span><span class="o">*</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span><span class="p">),</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="UscopeScene.set_random_places-469"><a href="#UscopeScene.set_random_places-469"><span class="linenos">469</span></a>                <span class="k">if</span> <span class="n">elapsed_time</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-470"><a href="#UscopeScene.set_random_places-470"><span class="linenos">470</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placing of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2"> objects takes: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> msec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-471"><a href="#UscopeScene.set_random_places-471"><span class="linenos">471</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.set_random_places-472"><a href="#UscopeScene.set_random_places-472"><span class="linenos">472</span></a>                    <span class="n">elapsed_time</span> <span class="o">/=</span> <span class="mf">1000.0</span><span class="p">;</span> <span class="n">elapsed_time</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">elapsed_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-473"><a href="#UscopeScene.set_random_places-473"><span class="linenos">473</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Placing of </span><span class="si">{</span><span class="n">n_objects</span><span class="si">}</span><span class="s2"> objects takes: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2"> sec&quot;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="UscopeScene.set_random_places-474"><a href="#UscopeScene.set_random_places-474"><span class="linenos">474</span></a>        <span class="k">return</span> <span class="n">fluo_objects</span>
</span></pre></div>


            <div class="docstring"><p>Set random coordinates within scene (or partially outside) for provided objects.</p>

<h2 id="parameters">Parameters</h2>

<p>fluo_objects : tuple, optional
    Tuple with generated instances of FluorObj() class. The default is ().
overlapping : bool, optional
    If True, the coordinates will be randomly selected from available ones. </p>

<pre><code>If False, the largest object will be placed firstly, and others will be placed after with checking that the object to be placed
are not intersected with the already placed objects on previous iterations. 

The default is True.
</code></pre>

<p>touching : bool, optional
    Flag for allowing objects to touch by their border pixels. Note that if overlapping is True, this flag ignored.
    The default is True.
only_within_scene : bool, optional
    If True, the objects will be placed completely within (inside) the scene. </p>

<pre><code>If False, objects may lay partially outside the scene. The default is False.
</code></pre>

<p>verbose_info : bool, optional
    Printing out verbose information about performance of placement. The default is False.</p>

<h2 id="returns">Returns</h2>

<p>tuple
    With the placed objects.</p>
</div>


                            </div>
                            <div id="UscopeScene.put_objects_on" class="classattr">
                                        <input id="UscopeScene.put_objects_on-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">put_objects_on</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()</span>,</span><span class="param">	<span class="n">save_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">save_only_objects_inside</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">rewrite_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="UscopeScene.put_objects_on-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.put_objects_on"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.put_objects_on-477"><a href="#UscopeScene.put_objects_on-477"><span class="linenos">477</span></a>    <span class="k">def</span> <span class="nf">put_objects_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(),</span> <span class="n">save_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">save_only_objects_inside</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="UscopeScene.put_objects_on-478"><a href="#UscopeScene.put_objects_on-478"><span class="linenos">478</span></a>                       <span class="n">rewrite_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="UscopeScene.put_objects_on-479"><a href="#UscopeScene.put_objects_on-479"><span class="linenos">479</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.put_objects_on-480"><a href="#UscopeScene.put_objects_on-480"><span class="linenos">480</span></a><span class="sd">        Put the provided objects on the scene by checking pixelwise the provided profiles and in the case of intersection of</span>
</span><span id="UscopeScene.put_objects_on-481"><a href="#UscopeScene.put_objects_on-481"><span class="linenos">481</span></a><span class="sd">        two objects profiles, selecting the maximum intensity from them.</span>
</span><span id="UscopeScene.put_objects_on-482"><a href="#UscopeScene.put_objects_on-482"><span class="linenos">482</span></a>
</span><span id="UscopeScene.put_objects_on-483"><a href="#UscopeScene.put_objects_on-483"><span class="linenos">483</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.put_objects_on-484"><a href="#UscopeScene.put_objects_on-484"><span class="linenos">484</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.put_objects_on-485"><a href="#UscopeScene.put_objects_on-485"><span class="linenos">485</span></a><span class="sd">        fluo_objects : tuple, optional</span>
</span><span id="UscopeScene.put_objects_on-486"><a href="#UscopeScene.put_objects_on-486"><span class="linenos">486</span></a><span class="sd">            Fluorescent objects, instances of FluorObj class, packed in a tuple. The default is ().</span>
</span><span id="UscopeScene.put_objects_on-487"><a href="#UscopeScene.put_objects_on-487"><span class="linenos">487</span></a><span class="sd">        save_objects : bool, optional</span>
</span><span id="UscopeScene.put_objects_on-488"><a href="#UscopeScene.put_objects_on-488"><span class="linenos">488</span></a><span class="sd">            If True, will save (append) objects in the class attribute &#39;fluo_objects&#39;. The default is True. \n</span>
</span><span id="UscopeScene.put_objects_on-489"><a href="#UscopeScene.put_objects_on-489"><span class="linenos">489</span></a><span class="sd">            Note that, if it&#39;s False, then before placing the objects, the scene will be cleared (stored before objects will be removed from it).</span>
</span><span id="UscopeScene.put_objects_on-490"><a href="#UscopeScene.put_objects_on-490"><span class="linenos">490</span></a><span class="sd">        save_only_objects_inside : bool, optional</span>
</span><span id="UscopeScene.put_objects_on-491"><a href="#UscopeScene.put_objects_on-491"><span class="linenos">491</span></a><span class="sd">            Save in the class attribute (&#39;fluo_objects&#39;) only objects that are inside the image. The default is False.</span>
</span><span id="UscopeScene.put_objects_on-492"><a href="#UscopeScene.put_objects_on-492"><span class="linenos">492</span></a><span class="sd">        rewrite_objects : bool, optional</span>
</span><span id="UscopeScene.put_objects_on-493"><a href="#UscopeScene.put_objects_on-493"><span class="linenos">493</span></a><span class="sd">            If True, it forces to substitute stored objects in the class attribute &#39;fluo_objects&#39; with the provided ones. The default is False.</span>
</span><span id="UscopeScene.put_objects_on-494"><a href="#UscopeScene.put_objects_on-494"><span class="linenos">494</span></a>
</span><span id="UscopeScene.put_objects_on-495"><a href="#UscopeScene.put_objects_on-495"><span class="linenos">495</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.put_objects_on-496"><a href="#UscopeScene.put_objects_on-496"><span class="linenos">496</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.put_objects_on-497"><a href="#UscopeScene.put_objects_on-497"><span class="linenos">497</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene.put_objects_on-498"><a href="#UscopeScene.put_objects_on-498"><span class="linenos">498</span></a>
</span><span id="UscopeScene.put_objects_on-499"><a href="#UscopeScene.put_objects_on-499"><span class="linenos">499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.put_objects_on-500"><a href="#UscopeScene.put_objects_on-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-501"><a href="#UscopeScene.put_objects_on-501"><span class="linenos">501</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">save_objects</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-502"><a href="#UscopeScene.put_objects_on-502"><span class="linenos">502</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">clear_scene</span><span class="p">()</span>  <span class="c1"># clear the scene before placing the objects only if there are no saved objects and the flag is False</span>
</span><span id="UscopeScene.put_objects_on-503"><a href="#UscopeScene.put_objects_on-503"><span class="linenos">503</span></a>            <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">fluo_objects</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-504"><a href="#UscopeScene.put_objects_on-504"><span class="linenos">504</span></a>                <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">within_image</span> <span class="ow">and</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-505"><a href="#UscopeScene.put_objects_on-505"><span class="linenos">505</span></a>                    <span class="n">i_start</span><span class="p">,</span> <span class="n">j_start</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">external_upper_coordinates</span><span class="p">;</span> <span class="n">i_size</span><span class="p">,</span> <span class="n">j_size</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="o">.</span><span class="n">shape</span>
</span><span id="UscopeScene.put_objects_on-506"><a href="#UscopeScene.put_objects_on-506"><span class="linenos">506</span></a>                    <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># for checking that the placing happening within the image</span>
</span><span id="UscopeScene.put_objects_on-507"><a href="#UscopeScene.put_objects_on-507"><span class="linenos">507</span></a>                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># for counting on the profile</span>
</span><span id="UscopeScene.put_objects_on-508"><a href="#UscopeScene.put_objects_on-508"><span class="linenos">508</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i_start</span><span class="p">,</span> <span class="n">i_start</span><span class="o">+</span><span class="n">i_size</span><span class="p">):</span>
</span><span id="UscopeScene.put_objects_on-509"><a href="#UscopeScene.put_objects_on-509"><span class="linenos">509</span></a>                        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># refresh starting column for counting on the object profile</span>
</span><span id="UscopeScene.put_objects_on-510"><a href="#UscopeScene.put_objects_on-510"><span class="linenos">510</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j_start</span><span class="p">,</span> <span class="n">j_start</span><span class="o">+</span><span class="n">j_size</span><span class="p">):</span>
</span><span id="UscopeScene.put_objects_on-511"><a href="#UscopeScene.put_objects_on-511"><span class="linenos">511</span></a>                            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">h</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">w</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-512"><a href="#UscopeScene.put_objects_on-512"><span class="linenos">512</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-513"><a href="#UscopeScene.put_objects_on-513"><span class="linenos">513</span></a>                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-514"><a href="#UscopeScene.put_objects_on-514"><span class="linenos">514</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span>
</span><span id="UscopeScene.put_objects_on-515"><a href="#UscopeScene.put_objects_on-515"><span class="linenos">515</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-516"><a href="#UscopeScene.put_objects_on-516"><span class="linenos">516</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
</span><span id="UscopeScene.put_objects_on-517"><a href="#UscopeScene.put_objects_on-517"><span class="linenos">517</span></a>                                <span class="k">else</span><span class="p">:</span>  <span class="c1"># float image type</span>
</span><span id="UscopeScene.put_objects_on-518"><a href="#UscopeScene.put_objects_on-518"><span class="linenos">518</span></a>                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1E-9</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-519"><a href="#UscopeScene.put_objects_on-519"><span class="linenos">519</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span>
</span><span id="UscopeScene.put_objects_on-520"><a href="#UscopeScene.put_objects_on-520"><span class="linenos">520</span></a>                                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-521"><a href="#UscopeScene.put_objects_on-521"><span class="linenos">521</span></a>                                        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">])</span>
</span><span id="UscopeScene.put_objects_on-522"><a href="#UscopeScene.put_objects_on-522"><span class="linenos">522</span></a>                                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-523"><a href="#UscopeScene.put_objects_on-523"><span class="linenos">523</span></a>                                    <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="UscopeScene.put_objects_on-524"><a href="#UscopeScene.put_objects_on-524"><span class="linenos">524</span></a>                            <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># next column of the cast profile</span>
</span><span id="UscopeScene.put_objects_on-525"><a href="#UscopeScene.put_objects_on-525"><span class="linenos">525</span></a>                        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># next row of the cast profile</span>
</span><span id="UscopeScene.put_objects_on-526"><a href="#UscopeScene.put_objects_on-526"><span class="linenos">526</span></a>            <span class="k">if</span> <span class="n">save_objects</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-527"><a href="#UscopeScene.put_objects_on-527"><span class="linenos">527</span></a>                <span class="n">l_fluo_objects</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">)</span>  <span class="c1"># conversion input tuple to the list</span>
</span><span id="UscopeScene.put_objects_on-528"><a href="#UscopeScene.put_objects_on-528"><span class="linenos">528</span></a>                <span class="k">if</span> <span class="n">save_only_objects_inside</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-529"><a href="#UscopeScene.put_objects_on-529"><span class="linenos">529</span></a>                    <span class="n">l_fluo_objects</span> <span class="o">=</span> <span class="p">[</span><span class="n">fluo_obj</span> <span class="k">for</span> <span class="n">fluo_obj</span> <span class="ow">in</span> <span class="n">l_fluo_objects</span> <span class="k">if</span> <span class="n">fluo_obj</span><span class="o">.</span><span class="n">within_image</span><span class="p">]</span>
</span><span id="UscopeScene.put_objects_on-530"><a href="#UscopeScene.put_objects_on-530"><span class="linenos">530</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">rewrite_objects</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-531"><a href="#UscopeScene.put_objects_on-531"><span class="linenos">531</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">+</span> <span class="n">l_fluo_objects</span>  <span class="c1"># concatenate 2 lists</span>
</span><span id="UscopeScene.put_objects_on-532"><a href="#UscopeScene.put_objects_on-532"><span class="linenos">532</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.put_objects_on-533"><a href="#UscopeScene.put_objects_on-533"><span class="linenos">533</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span> <span class="o">=</span> <span class="n">l_fluo_objects</span><span class="p">[:]</span>  <span class="c1"># copy the list</span>
</span></pre></div>


            <div class="docstring"><p>Put the provided objects on the scene by checking pixelwise the provided profiles and in the case of intersection of
two objects profiles, selecting the maximum intensity from them.</p>

<h2 id="parameters">Parameters</h2>

<p>fluo_objects : tuple, optional
    Fluorescent objects, instances of FluorObj class, packed in a tuple. The default is ().
save_objects : bool, optional
    If True, will save (append) objects in the class attribute 'fluo_objects'. The default is True. </p>

<pre><code>Note that, if it's False, then before placing the objects, the scene will be cleared (stored before objects will be removed from it).
</code></pre>

<p>save_only_objects_inside : bool, optional
    Save in the class attribute ('fluo_objects') only objects that are inside the image. The default is False.
rewrite_objects : bool, optional
    If True, it forces to substitute stored objects in the class attribute 'fluo_objects' with the provided ones. The default is False.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="UscopeScene.spread_objects_on" class="classattr">
                                        <input id="UscopeScene.spread_objects_on-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">spread_objects_on</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="UscopeScene.spread_objects_on-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.spread_objects_on"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.spread_objects_on-535"><a href="#UscopeScene.spread_objects_on-535"><span class="linenos">535</span></a>    <span class="k">def</span> <span class="nf">spread_objects_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fluo_objects</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="UscopeScene.spread_objects_on-536"><a href="#UscopeScene.spread_objects_on-536"><span class="linenos">536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.spread_objects_on-537"><a href="#UscopeScene.spread_objects_on-537"><span class="linenos">537</span></a><span class="sd">        Compose 2 subsequent methods: self.put_objects_on(self.set_random_places(fluo_objects), save_objects=True).</span>
</span><span id="UscopeScene.spread_objects_on-538"><a href="#UscopeScene.spread_objects_on-538"><span class="linenos">538</span></a>
</span><span id="UscopeScene.spread_objects_on-539"><a href="#UscopeScene.spread_objects_on-539"><span class="linenos">539</span></a><span class="sd">        So, this method puts the provided objects, which are randomly spread on the scene, and saves them in the attribute.</span>
</span><span id="UscopeScene.spread_objects_on-540"><a href="#UscopeScene.spread_objects_on-540"><span class="linenos">540</span></a>
</span><span id="UscopeScene.spread_objects_on-541"><a href="#UscopeScene.spread_objects_on-541"><span class="linenos">541</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.spread_objects_on-542"><a href="#UscopeScene.spread_objects_on-542"><span class="linenos">542</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.spread_objects_on-543"><a href="#UscopeScene.spread_objects_on-543"><span class="linenos">543</span></a><span class="sd">        fluo_objects : tuple</span>
</span><span id="UscopeScene.spread_objects_on-544"><a href="#UscopeScene.spread_objects_on-544"><span class="linenos">544</span></a><span class="sd">            Fluorescent objects, instances of FluorObj class, packed in a tuple.</span>
</span><span id="UscopeScene.spread_objects_on-545"><a href="#UscopeScene.spread_objects_on-545"><span class="linenos">545</span></a>
</span><span id="UscopeScene.spread_objects_on-546"><a href="#UscopeScene.spread_objects_on-546"><span class="linenos">546</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.spread_objects_on-547"><a href="#UscopeScene.spread_objects_on-547"><span class="linenos">547</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.spread_objects_on-548"><a href="#UscopeScene.spread_objects_on-548"><span class="linenos">548</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene.spread_objects_on-549"><a href="#UscopeScene.spread_objects_on-549"><span class="linenos">549</span></a>
</span><span id="UscopeScene.spread_objects_on-550"><a href="#UscopeScene.spread_objects_on-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.spread_objects_on-551"><a href="#UscopeScene.spread_objects_on-551"><span class="linenos">551</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">set_random_places</span><span class="p">(</span><span class="n">fluo_objects</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Compose 2 subsequent methods: self.put_objects_on(self.set_random_places(fluo_objects), save_objects=True).</p>

<p>So, this method puts the provided objects, which are randomly spread on the scene, and saves them in the attribute.</p>

<h2 id="parameters">Parameters</h2>

<p>fluo_objects : tuple
    Fluorescent objects, instances of FluorObj class, packed in a tuple.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="UscopeScene.recreate_scene" class="classattr">
                                        <input id="UscopeScene.recreate_scene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">recreate_scene</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="UscopeScene.recreate_scene-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.recreate_scene"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.recreate_scene-553"><a href="#UscopeScene.recreate_scene-553"><span class="linenos">553</span></a>    <span class="k">def</span> <span class="nf">recreate_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="UscopeScene.recreate_scene-554"><a href="#UscopeScene.recreate_scene-554"><span class="linenos">554</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.recreate_scene-555"><a href="#UscopeScene.recreate_scene-555"><span class="linenos">555</span></a><span class="sd">        Recreate the saved objects in the class attribute &#39;fluo_objects&#39; on the cleared before scene.</span>
</span><span id="UscopeScene.recreate_scene-556"><a href="#UscopeScene.recreate_scene-556"><span class="linenos">556</span></a>
</span><span id="UscopeScene.recreate_scene-557"><a href="#UscopeScene.recreate_scene-557"><span class="linenos">557</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.recreate_scene-558"><a href="#UscopeScene.recreate_scene-558"><span class="linenos">558</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.recreate_scene-559"><a href="#UscopeScene.recreate_scene-559"><span class="linenos">559</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene.recreate_scene-560"><a href="#UscopeScene.recreate_scene-560"><span class="linenos">560</span></a>
</span><span id="UscopeScene.recreate_scene-561"><a href="#UscopeScene.recreate_scene-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.recreate_scene-562"><a href="#UscopeScene.recreate_scene-562"><span class="linenos">562</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene.recreate_scene-563"><a href="#UscopeScene.recreate_scene-563"><span class="linenos">563</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">put_objects_on</span><span class="p">(</span><span class="n">fluo_objects</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">),</span> <span class="n">save_objects</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="UscopeScene.recreate_scene-564"><a href="#UscopeScene.recreate_scene-564"><span class="linenos">564</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene.recreate_scene-565"><a href="#UscopeScene.recreate_scene-565"><span class="linenos">565</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.recreate_scene-566"><a href="#UscopeScene.recreate_scene-566"><span class="linenos">566</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;The scene is not clear, cannot recreate the scene&quot;</span>
</span><span id="UscopeScene.recreate_scene-567"><a href="#UscopeScene.recreate_scene-567"><span class="linenos">567</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="UscopeScene.recreate_scene-568"><a href="#UscopeScene.recreate_scene-568"><span class="linenos">568</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">==</span> <span class="s2">&quot;The scene is not clear, cannot recreate the scene&quot;</span><span class="p">:</span>
</span><span id="UscopeScene.recreate_scene-569"><a href="#UscopeScene.recreate_scene-569"><span class="linenos">569</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="UscopeScene.recreate_scene-570"><a href="#UscopeScene.recreate_scene-570"><span class="linenos">570</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fluo_objects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.recreate_scene-571"><a href="#UscopeScene.recreate_scene-571"><span class="linenos">571</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.recreate_scene-572"><a href="#UscopeScene.recreate_scene-572"><span class="linenos">572</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;There are no stored objects within this class instance&quot;</span>
</span><span id="UscopeScene.recreate_scene-573"><a href="#UscopeScene.recreate_scene-573"><span class="linenos">573</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="UscopeScene.recreate_scene-574"><a href="#UscopeScene.recreate_scene-574"><span class="linenos">574</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">==</span> <span class="s2">&quot;There are no stored objects within this class instance&quot;</span><span class="p">:</span>
</span><span id="UscopeScene.recreate_scene-575"><a href="#UscopeScene.recreate_scene-575"><span class="linenos">575</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Recreate the saved objects in the class attribute 'fluo_objects' on the cleared before scene.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="UscopeScene.show_scene" class="classattr">
                                        <input id="UscopeScene.show_scene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show_scene</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span>,</span><span class="param">	<span class="n">unique_plot_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="UscopeScene.show_scene-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.show_scene"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.show_scene-578"><a href="#UscopeScene.show_scene-578"><span class="linenos">578</span></a>    <span class="k">def</span> <span class="nf">show_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">unique_plot_id</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
</span><span id="UscopeScene.show_scene-579"><a href="#UscopeScene.show_scene-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.show_scene-580"><a href="#UscopeScene.show_scene-580"><span class="linenos">580</span></a><span class="sd">        Show interactively the stored in the class scene (image) by plotting it using matplotlib.</span>
</span><span id="UscopeScene.show_scene-581"><a href="#UscopeScene.show_scene-581"><span class="linenos">581</span></a>
</span><span id="UscopeScene.show_scene-582"><a href="#UscopeScene.show_scene-582"><span class="linenos">582</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.show_scene-583"><a href="#UscopeScene.show_scene-583"><span class="linenos">583</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.show_scene-584"><a href="#UscopeScene.show_scene-584"><span class="linenos">584</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="UscopeScene.show_scene-585"><a href="#UscopeScene.show_scene-585"><span class="linenos">585</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="UscopeScene.show_scene-586"><a href="#UscopeScene.show_scene-586"><span class="linenos">586</span></a><span class="sd">        color_map</span>
</span><span id="UscopeScene.show_scene-587"><a href="#UscopeScene.show_scene-587"><span class="linenos">587</span></a><span class="sd">            Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is &#39;viridis&#39;.</span>
</span><span id="UscopeScene.show_scene-588"><a href="#UscopeScene.show_scene-588"><span class="linenos">588</span></a><span class="sd">        unique_plot_id: bool, optional</span>
</span><span id="UscopeScene.show_scene-589"><a href="#UscopeScene.show_scene-589"><span class="linenos">589</span></a><span class="sd">            Flag for adding to plot name some random integer id for preventing plots overlapping. The default is True.</span>
</span><span id="UscopeScene.show_scene-590"><a href="#UscopeScene.show_scene-590"><span class="linenos">590</span></a>
</span><span id="UscopeScene.show_scene-591"><a href="#UscopeScene.show_scene-591"><span class="linenos">591</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.show_scene-592"><a href="#UscopeScene.show_scene-592"><span class="linenos">592</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.show_scene-593"><a href="#UscopeScene.show_scene-593"><span class="linenos">593</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene.show_scene-594"><a href="#UscopeScene.show_scene-594"><span class="linenos">594</span></a>
</span><span id="UscopeScene.show_scene-595"><a href="#UscopeScene.show_scene-595"><span class="linenos">595</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.show_scene-596"><a href="#UscopeScene.show_scene-596"><span class="linenos">596</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">height_width_ratio</span> <span class="o">=</span> <span class="n">h</span><span class="o">/</span><span class="n">w</span><span class="p">;</span> <span class="n">default_image_size</span> <span class="o">=</span> <span class="mf">5.8</span><span class="p">;</span> <span class="n">additional_id</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="UscopeScene.show_scene-597"><a href="#UscopeScene.show_scene-597"><span class="linenos">597</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="UscopeScene.show_scene-598"><a href="#UscopeScene.show_scene-598"><span class="linenos">598</span></a>            <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="UscopeScene.show_scene-599"><a href="#UscopeScene.show_scene-599"><span class="linenos">599</span></a>        <span class="k">elif</span> <span class="n">unique_plot_id</span><span class="p">:</span>
</span><span id="UscopeScene.show_scene-600"><a href="#UscopeScene.show_scene-600"><span class="linenos">600</span></a>            <span class="n">additional_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="UscopeScene.show_scene-601"><a href="#UscopeScene.show_scene-601"><span class="linenos">601</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="UscopeScene.show_scene-602"><a href="#UscopeScene.show_scene-602"><span class="linenos">602</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="UscopeScene.show_scene-603"><a href="#UscopeScene.show_scene-603"><span class="linenos">603</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene.show_scene-604"><a href="#UscopeScene.show_scene-604"><span class="linenos">604</span></a>            <span class="n">figure_name</span> <span class="o">=</span> <span class="s2">&quot;Blank UscopeScene &quot;</span> <span class="o">+</span> <span class="n">str_id</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">additional_id</span>
</span><span id="UscopeScene.show_scene-605"><a href="#UscopeScene.show_scene-605"><span class="linenos">605</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.show_scene-606"><a href="#UscopeScene.show_scene-606"><span class="linenos">606</span></a>            <span class="n">figure_name</span> <span class="o">=</span> <span class="s2">&quot;UscopeScene &quot;</span> <span class="o">+</span> <span class="n">str_id</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">additional_id</span>
</span><span id="UscopeScene.show_scene-607"><a href="#UscopeScene.show_scene-607"><span class="linenos">607</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figure_name</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">default_image_size</span><span class="p">,</span> <span class="n">default_image_size</span><span class="o">*</span><span class="n">height_width_ratio</span><span class="p">))</span>
</span><span id="UscopeScene.show_scene-608"><a href="#UscopeScene.show_scene-608"><span class="linenos">608</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="UscopeScene.show_scene-609"><a href="#UscopeScene.show_scene-609"><span class="linenos">609</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="UscopeScene.show_scene-610"><a href="#UscopeScene.show_scene-610"><span class="linenos">610</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="UscopeScene.show_scene-611"><a href="#UscopeScene.show_scene-611"><span class="linenos">611</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="UscopeScene.show_scene-612"><a href="#UscopeScene.show_scene-612"><span class="linenos">612</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Show interactively the stored in the class scene (image) by plotting it using matplotlib.</p>

<h2 id="parameters">Parameters</h2>

<p>str_id : str, optional
    Unique string id for plotting several plots with unique Figure() names. The default is "".
color_map
    Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is 'viridis'.
unique_plot_id: bool, optional
    Flag for adding to plot name some random integer id for preventing plots overlapping. The default is True.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="UscopeScene.clear_scene" class="classattr">
                                        <input id="UscopeScene.clear_scene-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clear_scene</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="UscopeScene.clear_scene-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.clear_scene"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.clear_scene-614"><a href="#UscopeScene.clear_scene-614"><span class="linenos">614</span></a>    <span class="k">def</span> <span class="nf">clear_scene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="UscopeScene.clear_scene-615"><a href="#UscopeScene.clear_scene-615"><span class="linenos">615</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.clear_scene-616"><a href="#UscopeScene.clear_scene-616"><span class="linenos">616</span></a><span class="sd">        Reinitialize the scene to zero (plain dark background).</span>
</span><span id="UscopeScene.clear_scene-617"><a href="#UscopeScene.clear_scene-617"><span class="linenos">617</span></a>
</span><span id="UscopeScene.clear_scene-618"><a href="#UscopeScene.clear_scene-618"><span class="linenos">618</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.clear_scene-619"><a href="#UscopeScene.clear_scene-619"><span class="linenos">619</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.clear_scene-620"><a href="#UscopeScene.clear_scene-620"><span class="linenos">620</span></a><span class="sd">        None.</span>
</span><span id="UscopeScene.clear_scene-621"><a href="#UscopeScene.clear_scene-621"><span class="linenos">621</span></a>
</span><span id="UscopeScene.clear_scene-622"><a href="#UscopeScene.clear_scene-622"><span class="linenos">622</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.clear_scene-623"><a href="#UscopeScene.clear_scene-623"><span class="linenos">623</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene.clear_scene-624"><a href="#UscopeScene.clear_scene-624"><span class="linenos">624</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="UscopeScene.clear_scene-625"><a href="#UscopeScene.clear_scene-625"><span class="linenos">625</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__binary_placement_mask</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Reinitialize the scene to zero (plain dark background).</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="UscopeScene.is_blank" class="classattr">
                                        <input id="UscopeScene.is_blank-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_blank</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="UscopeScene.is_blank-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.is_blank"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.is_blank-627"><a href="#UscopeScene.is_blank-627"><span class="linenos">627</span></a>    <span class="k">def</span> <span class="nf">is_blank</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="UscopeScene.is_blank-628"><a href="#UscopeScene.is_blank-628"><span class="linenos">628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.is_blank-629"><a href="#UscopeScene.is_blank-629"><span class="linenos">629</span></a><span class="sd">        Returns True, if the scene (image) is blank (zeroed).</span>
</span><span id="UscopeScene.is_blank-630"><a href="#UscopeScene.is_blank-630"><span class="linenos">630</span></a>
</span><span id="UscopeScene.is_blank-631"><a href="#UscopeScene.is_blank-631"><span class="linenos">631</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.is_blank-632"><a href="#UscopeScene.is_blank-632"><span class="linenos">632</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.is_blank-633"><a href="#UscopeScene.is_blank-633"><span class="linenos">633</span></a><span class="sd">        bool</span>
</span><span id="UscopeScene.is_blank-634"><a href="#UscopeScene.is_blank-634"><span class="linenos">634</span></a><span class="sd">            Value for designation of a blank scene.</span>
</span><span id="UscopeScene.is_blank-635"><a href="#UscopeScene.is_blank-635"><span class="linenos">635</span></a>
</span><span id="UscopeScene.is_blank-636"><a href="#UscopeScene.is_blank-636"><span class="linenos">636</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.is_blank-637"><a href="#UscopeScene.is_blank-637"><span class="linenos">637</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span>
</span></pre></div>


            <div class="docstring"><p>Returns True, if the scene (image) is blank (zeroed).</p>

<h2 id="returns">Returns</h2>

<p>bool
    Value for designation of a blank scene.</p>
</div>


                            </div>
                            <div id="UscopeScene.add_noise" class="classattr">
                                        <input id="UscopeScene.add_noise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_noise</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mean_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">sigma_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="UscopeScene.add_noise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.add_noise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.add_noise-640"><a href="#UscopeScene.add_noise-640"><span class="linenos">640</span></a>    <span class="k">def</span> <span class="nf">add_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mean_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-641"><a href="#UscopeScene.add_noise-641"><span class="linenos">641</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.add_noise-642"><a href="#UscopeScene.add_noise-642"><span class="linenos">642</span></a><span class="sd">        Add Poisson (signal dependent shot noise) and background (Gaussian or detector) noise.</span>
</span><span id="UscopeScene.add_noise-643"><a href="#UscopeScene.add_noise-643"><span class="linenos">643</span></a>
</span><span id="UscopeScene.add_noise-644"><a href="#UscopeScene.add_noise-644"><span class="linenos">644</span></a><span class="sd">        Note that if the called again on the scene, this method will add newly generated noise to the initial image.</span>
</span><span id="UscopeScene.add_noise-645"><a href="#UscopeScene.add_noise-645"><span class="linenos">645</span></a>
</span><span id="UscopeScene.add_noise-646"><a href="#UscopeScene.add_noise-646"><span class="linenos">646</span></a><span class="sd">        Parameters</span>
</span><span id="UscopeScene.add_noise-647"><a href="#UscopeScene.add_noise-647"><span class="linenos">647</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.add_noise-648"><a href="#UscopeScene.add_noise-648"><span class="linenos">648</span></a><span class="sd">        seed : int, optional</span>
</span><span id="UscopeScene.add_noise-649"><a href="#UscopeScene.add_noise-649"><span class="linenos">649</span></a><span class="sd">            Long integer for initializing pseudorandom generator for repeating generated sequences. The default is None.</span>
</span><span id="UscopeScene.add_noise-650"><a href="#UscopeScene.add_noise-650"><span class="linenos">650</span></a><span class="sd">        mean_noise : Union[int, float], optional</span>
</span><span id="UscopeScene.add_noise-651"><a href="#UscopeScene.add_noise-651"><span class="linenos">651</span></a><span class="sd">            Mean for Gaussian noise intensity. The default is None.</span>
</span><span id="UscopeScene.add_noise-652"><a href="#UscopeScene.add_noise-652"><span class="linenos">652</span></a><span class="sd">        sigma_noise : Union[int, float], optional</span>
</span><span id="UscopeScene.add_noise-653"><a href="#UscopeScene.add_noise-653"><span class="linenos">653</span></a><span class="sd">            Sigma for Gaussian noise intensity. The default is None.</span>
</span><span id="UscopeScene.add_noise-654"><a href="#UscopeScene.add_noise-654"><span class="linenos">654</span></a>
</span><span id="UscopeScene.add_noise-655"><a href="#UscopeScene.add_noise-655"><span class="linenos">655</span></a><span class="sd">        References</span>
</span><span id="UscopeScene.add_noise-656"><a href="#UscopeScene.add_noise-656"><span class="linenos">656</span></a><span class="sd">        ----------</span>
</span><span id="UscopeScene.add_noise-657"><a href="#UscopeScene.add_noise-657"><span class="linenos">657</span></a><span class="sd">        [1] &quot;Imaging in focus: An introduction to denoising bioimages in the era of deep learning&quot;, R.F. Laine,</span>
</span><span id="UscopeScene.add_noise-658"><a href="#UscopeScene.add_noise-658"><span class="linenos">658</span></a><span class="sd">        G. Jacquemet, A. Krull (2021)</span>
</span><span id="UscopeScene.add_noise-659"><a href="#UscopeScene.add_noise-659"><span class="linenos">659</span></a><span class="sd">        [2] Online Resource: https://bioimagebook.github.io/chapters/3-fluorescence/3-formation_noise/formation_noise.html</span>
</span><span id="UscopeScene.add_noise-660"><a href="#UscopeScene.add_noise-660"><span class="linenos">660</span></a>
</span><span id="UscopeScene.add_noise-661"><a href="#UscopeScene.add_noise-661"><span class="linenos">661</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.add_noise-662"><a href="#UscopeScene.add_noise-662"><span class="linenos">662</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.add_noise-663"><a href="#UscopeScene.add_noise-663"><span class="linenos">663</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="UscopeScene.add_noise-664"><a href="#UscopeScene.add_noise-664"><span class="linenos">664</span></a><span class="sd">            The scene added shot (Poisson) and detector (Gaussian) noises.</span>
</span><span id="UscopeScene.add_noise-665"><a href="#UscopeScene.add_noise-665"><span class="linenos">665</span></a>
</span><span id="UscopeScene.add_noise-666"><a href="#UscopeScene.add_noise-666"><span class="linenos">666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.add_noise-667"><a href="#UscopeScene.add_noise-667"><span class="linenos">667</span></a>        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-668"><a href="#UscopeScene.add_noise-668"><span class="linenos">668</span></a>            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">()</span>
</span><span id="UscopeScene.add_noise-669"><a href="#UscopeScene.add_noise-669"><span class="linenos">669</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-670"><a href="#UscopeScene.add_noise-670"><span class="linenos">670</span></a>            <span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="UscopeScene.add_noise-671"><a href="#UscopeScene.add_noise-671"><span class="linenos">671</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__image_cleared</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-672"><a href="#UscopeScene.add_noise-672"><span class="linenos">672</span></a>            <span class="c1"># Add the Gaussian noise (background)</span>
</span><span id="UscopeScene.add_noise-673"><a href="#UscopeScene.add_noise-673"><span class="linenos">673</span></a>            <span class="k">if</span> <span class="n">mean_noise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-674"><a href="#UscopeScene.add_noise-674"><span class="linenos">674</span></a>                <span class="n">mean_noise</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">)</span>  <span class="c1"># 12.5% of the max value</span>
</span><span id="UscopeScene.add_noise-675"><a href="#UscopeScene.add_noise-675"><span class="linenos">675</span></a>            <span class="k">if</span> <span class="n">sigma_noise</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-676"><a href="#UscopeScene.add_noise-676"><span class="linenos">676</span></a>                <span class="n">sigma_noise</span> <span class="o">=</span> <span class="mf">0.33</span><span class="o">*</span><span class="n">mean_noise</span>  <span class="c1"># 33% of the mean</span>
</span><span id="UscopeScene.add_noise-677"><a href="#UscopeScene.add_noise-677"><span class="linenos">677</span></a>            <span class="n">noisy_background</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_noise</span><span class="p">,</span> <span class="n">sigma_noise</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># normally distributed noise on background</span>
</span><span id="UscopeScene.add_noise-678"><a href="#UscopeScene.add_noise-678"><span class="linenos">678</span></a>            <span class="n">noisy_background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">noisy_background</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">noisy_background</span><span class="p">)</span>  <span class="c1"># check that all pixel values are positive</span>
</span><span id="UscopeScene.add_noise-679"><a href="#UscopeScene.add_noise-679"><span class="linenos">679</span></a>            <span class="c1"># Substitute the calculated exact pixel value with the Poisson distributed one due to the properties of commonly used cameras</span>
</span><span id="UscopeScene.add_noise-680"><a href="#UscopeScene.add_noise-680"><span class="linenos">680</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">raw_pixels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="UscopeScene.add_noise-681"><a href="#UscopeScene.add_noise-681"><span class="linenos">681</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-682"><a href="#UscopeScene.add_noise-682"><span class="linenos">682</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># copy initial scene without noise</span>
</span><span id="UscopeScene.add_noise-683"><a href="#UscopeScene.add_noise-683"><span class="linenos">683</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-684"><a href="#UscopeScene.add_noise-684"><span class="linenos">684</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># restore the initial image by the copying the content of the denoised image</span>
</span><span id="UscopeScene.add_noise-685"><a href="#UscopeScene.add_noise-685"><span class="linenos">685</span></a>            <span class="c1"># Generate and add noise pixelwise</span>
</span><span id="UscopeScene.add_noise-686"><a href="#UscopeScene.add_noise-686"><span class="linenos">686</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
</span><span id="UscopeScene.add_noise-687"><a href="#UscopeScene.add_noise-687"><span class="linenos">687</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
</span><span id="UscopeScene.add_noise-688"><a href="#UscopeScene.add_noise-688"><span class="linenos">688</span></a>                    <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-689"><a href="#UscopeScene.add_noise-689"><span class="linenos">689</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>  <span class="c1"># save converted original value with the Poisson-distributed</span>
</span><span id="UscopeScene.add_noise-690"><a href="#UscopeScene.add_noise-690"><span class="linenos">690</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noisy_background</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>  <span class="c1"># add Gaussian noise</span>
</span><span id="UscopeScene.add_noise-691"><a href="#UscopeScene.add_noise-691"><span class="linenos">691</span></a>                        <span class="k">if</span> <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-692"><a href="#UscopeScene.add_noise-692"><span class="linenos">692</span></a>                            <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_pixel_value</span>  <span class="c1"># check that the pixel values are still in range with the image type</span>
</span><span id="UscopeScene.add_noise-693"><a href="#UscopeScene.add_noise-693"><span class="linenos">693</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-694"><a href="#UscopeScene.add_noise-694"><span class="linenos">694</span></a>                        <span class="n">raw_pixels</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">noisy_background</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
</span><span id="UscopeScene.add_noise-695"><a href="#UscopeScene.add_noise-695"><span class="linenos">695</span></a>            <span class="c1"># Casting the noisy image back to the original image format</span>
</span><span id="UscopeScene.add_noise-696"><a href="#UscopeScene.add_noise-696"><span class="linenos">696</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="o">==</span> <span class="s1">&#39;uint8&#39;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-697"><a href="#UscopeScene.add_noise-697"><span class="linenos">697</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">raw_pixels</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="UscopeScene.add_noise-698"><a href="#UscopeScene.add_noise-698"><span class="linenos">698</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="UscopeScene.add_noise-699"><a href="#UscopeScene.add_noise-699"><span class="linenos">699</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">raw_pixels</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_type</span><span class="p">)</span>
</span><span id="UscopeScene.add_noise-700"><a href="#UscopeScene.add_noise-700"><span class="linenos">700</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># switch the flag for tracking that the noise has been added</span>
</span><span id="UscopeScene.add_noise-701"><a href="#UscopeScene.add_noise-701"><span class="linenos">701</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span></pre></div>


            <div class="docstring"><p>Add Poisson (signal dependent shot noise) and background (Gaussian or detector) noise.</p>

<p>Note that if the called again on the scene, this method will add newly generated noise to the initial image.</p>

<h2 id="parameters">Parameters</h2>

<p>seed : int, optional
    Long integer for initializing pseudorandom generator for repeating generated sequences. The default is None.
mean_noise : Union[int, float], optional
    Mean for Gaussian noise intensity. The default is None.
sigma_noise : Union[int, float], optional
    Sigma for Gaussian noise intensity. The default is None.</p>

<h2 id="references">References</h2>

<p>[1] "Imaging in focus: An introduction to denoising bioimages in the era of deep learning", R.F. Laine,
G. Jacquemet, A. Krull (2021)
[2] Online Resource: <a href="https://bioimagebook.github.io/chapters/3-fluorescence/3-formation_noise/formation_noise.html">https://bioimagebook.github.io/chapters/3-fluorescence/3-formation_noise/formation_noise.html</a></p>

<h2 id="returns">Returns</h2>

<p>numpy.ndarray
    The scene added shot (Poisson) and detector (Gaussian) noises.</p>
</div>


                            </div>
                            <div id="UscopeScene.remove_noise" class="classattr">
                                        <input id="UscopeScene.remove_noise-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_noise</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="UscopeScene.remove_noise-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#UscopeScene.remove_noise"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="UscopeScene.remove_noise-703"><a href="#UscopeScene.remove_noise-703"><span class="linenos">703</span></a>    <span class="k">def</span> <span class="nf">remove_noise</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="UscopeScene.remove_noise-704"><a href="#UscopeScene.remove_noise-704"><span class="linenos">704</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="UscopeScene.remove_noise-705"><a href="#UscopeScene.remove_noise-705"><span class="linenos">705</span></a><span class="sd">        Remove added previously noise by copying the stored in &#39;denoise_image&#39; pixel content.</span>
</span><span id="UscopeScene.remove_noise-706"><a href="#UscopeScene.remove_noise-706"><span class="linenos">706</span></a>
</span><span id="UscopeScene.remove_noise-707"><a href="#UscopeScene.remove_noise-707"><span class="linenos">707</span></a><span class="sd">        Returns</span>
</span><span id="UscopeScene.remove_noise-708"><a href="#UscopeScene.remove_noise-708"><span class="linenos">708</span></a><span class="sd">        -------</span>
</span><span id="UscopeScene.remove_noise-709"><a href="#UscopeScene.remove_noise-709"><span class="linenos">709</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="UscopeScene.remove_noise-710"><a href="#UscopeScene.remove_noise-710"><span class="linenos">710</span></a><span class="sd">            Initial scene without noise.</span>
</span><span id="UscopeScene.remove_noise-711"><a href="#UscopeScene.remove_noise-711"><span class="linenos">711</span></a>
</span><span id="UscopeScene.remove_noise-712"><a href="#UscopeScene.remove_noise-712"><span class="linenos">712</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="UscopeScene.remove_noise-713"><a href="#UscopeScene.remove_noise-713"><span class="linenos">713</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="UscopeScene.remove_noise-714"><a href="#UscopeScene.remove_noise-714"><span class="linenos">714</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span><span class="o">.</span><span class="n">copy</span><span class="p">();</span> <span class="bp">self</span><span class="o">.</span><span class="n">__noise_added</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised_image</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="UscopeScene.remove_noise-715"><a href="#UscopeScene.remove_noise-715"><span class="linenos">715</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span></pre></div>


            <div class="docstring"><p>Remove added previously noise by copying the stored in 'denoise_image' pixel content.</p>

<h2 id="returns">Returns</h2>

<p>numpy.ndarray
    Initial scene without noise.</p>
</div>


                            </div>
                </section>
                <section id="FluorObj">
                            <input id="FluorObj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FluorObj</span>:

                <label class="view-source-button" for="FluorObj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj-719"><a href="#FluorObj-719"><span class="linenos"> 719</span></a><span class="k">class</span> <span class="nc">FluorObj</span><span class="p">:</span>
</span><span id="FluorObj-720"><a href="#FluorObj-720"><span class="linenos"> 720</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-721"><a href="#FluorObj-721"><span class="linenos"> 721</span></a><span class="sd">    Modelling the fluorescent bright object with the specified type.</span>
</span><span id="FluorObj-722"><a href="#FluorObj-722"><span class="linenos"> 722</span></a>
</span><span id="FluorObj-723"><a href="#FluorObj-723"><span class="linenos"> 723</span></a><span class="sd">    It can be used for embedding it to the &#39;UscopeScene&#39; class for building up the microscopic image.</span>
</span><span id="FluorObj-724"><a href="#FluorObj-724"><span class="linenos"> 724</span></a>
</span><span id="FluorObj-725"><a href="#FluorObj-725"><span class="linenos"> 725</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FluorObj-726"><a href="#FluorObj-726"><span class="linenos"> 726</span></a>
</span><span id="FluorObj-727"><a href="#FluorObj-727"><span class="linenos"> 727</span></a>    <span class="c1"># Class parameters</span>
</span><span id="FluorObj-728"><a href="#FluorObj-728"><span class="linenos"> 728</span></a>    <span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">border_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">shape_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">explicit_shape_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">profile</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FluorObj-729"><a href="#FluorObj-729"><span class="linenos"> 729</span></a>    <span class="n">__acceptable_shape_types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="s1">&#39;el&#39;</span><span class="p">,</span> <span class="s1">&#39;curved&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>  <span class="c1"># shape types of the object</span>
</span><span id="FluorObj-730"><a href="#FluorObj-730"><span class="linenos"> 730</span></a>    <span class="n">__acceptable_border_types</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;precise&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">,</span> <span class="s1">&#39;computed&#39;</span><span class="p">,</span> <span class="s1">&#39;co&#39;</span><span class="p">];</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="FluorObj-731"><a href="#FluorObj-731"><span class="linenos"> 731</span></a>    <span class="n">typical_sizes</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">()</span>  <span class="c1"># for storing descriptive parameters for curve describing the shape of the object</span>
</span><span id="FluorObj-732"><a href="#FluorObj-732"><span class="linenos"> 732</span></a>    <span class="c1"># below - storing names of implemented computing functions for the define continuous shape</span>
</span><span id="FluorObj-733"><a href="#FluorObj-733"><span class="linenos"> 733</span></a>    <span class="n">__acceptable_shape_methods</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="s1">&#39;lorentzian&#39;</span><span class="p">,</span> <span class="s1">&#39;lor&#39;</span><span class="p">,</span> <span class="s1">&#39;derivative of logistic func.&#39;</span><span class="p">,</span> <span class="s1">&#39;dlogf&#39;</span><span class="p">,</span> <span class="s1">&#39;bump square&#39;</span><span class="p">,</span>
</span><span id="FluorObj-734"><a href="#FluorObj-734"><span class="linenos"> 734</span></a>                                        <span class="s1">&#39;bump2&#39;</span><span class="p">,</span> <span class="s1">&#39;bump cube&#39;</span><span class="p">,</span> <span class="s1">&#39;bump3&#39;</span><span class="p">,</span> <span class="s1">&#39;bump ^8&#39;</span><span class="p">,</span> <span class="s1">&#39;bump8&#39;</span><span class="p">,</span> <span class="s1">&#39;smooth circle&#39;</span><span class="p">,</span> <span class="s1">&#39;smcir&#39;</span><span class="p">,</span> <span class="s1">&#39;oversampled circle&#39;</span><span class="p">,</span>
</span><span id="FluorObj-735"><a href="#FluorObj-735"><span class="linenos"> 735</span></a>                                        <span class="s1">&#39;ovcir&#39;</span><span class="p">,</span> <span class="s1">&#39;undersampled circle&#39;</span><span class="p">,</span> <span class="s1">&#39;uncir&#39;</span><span class="p">,</span> <span class="s1">&#39;circle&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">]</span>
</span><span id="FluorObj-736"><a href="#FluorObj-736"><span class="linenos"> 736</span></a>    <span class="n">valuable_round_shapes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gaussian&#39;</span><span class="p">,</span> <span class="s1">&#39;derivative of logistic func.&#39;</span><span class="p">,</span> <span class="s1">&#39;bump cube&#39;</span><span class="p">,</span> <span class="s1">&#39;bump ^8&#39;</span><span class="p">,</span> <span class="s1">&#39;smooth circle&#39;</span><span class="p">]</span>
</span><span id="FluorObj-737"><a href="#FluorObj-737"><span class="linenos"> 737</span></a>    <span class="n">image_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>   <span class="c1"># subpixel shift of the center of the object</span>
</span><span id="FluorObj-738"><a href="#FluorObj-738"><span class="linenos"> 738</span></a>    <span class="n">casted_profile</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># cast normalized profile to the provided image type</span>
</span><span id="FluorObj-739"><a href="#FluorObj-739"><span class="linenos"> 739</span></a>    <span class="n">__profile_cropped</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for setting if the profile was cropped (zero pixel rows / columns removed)</span>
</span><span id="FluorObj-740"><a href="#FluorObj-740"><span class="linenos"> 740</span></a>    <span class="n">external_upper_coordinates</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># external image coordinates of the upper left pixel</span>
</span><span id="FluorObj-741"><a href="#FluorObj-741"><span class="linenos"> 741</span></a>    <span class="n">__external_image_sizes</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>   <span class="c1"># sizes of an external image coordinates of the upper left pixel</span>
</span><span id="FluorObj-742"><a href="#FluorObj-742"><span class="linenos"> 742</span></a>    <span class="n">within_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flag for checking that the profile is still within the image</span>
</span><span id="FluorObj-743"><a href="#FluorObj-743"><span class="linenos"> 743</span></a>
</span><span id="FluorObj-744"><a href="#FluorObj-744"><span class="linenos"> 744</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typical_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span>
</span><span id="FluorObj-745"><a href="#FluorObj-745"><span class="linenos"> 745</span></a>                 <span class="n">border_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;precise&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="FluorObj-746"><a href="#FluorObj-746"><span class="linenos"> 746</span></a>        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="FluorObj-747"><a href="#FluorObj-747"><span class="linenos"> 747</span></a><span class="s2">        Initialize the class representation of a fluorescent object.</span>
</span><span id="FluorObj-748"><a href="#FluorObj-748"><span class="linenos"> 748</span></a>
</span><span id="FluorObj-749"><a href="#FluorObj-749"><span class="linenos"> 749</span></a><span class="s2">        The difference between used parameters can be observed by plotting of the calculated shapes (profiles) by get_shape() method.</span>
</span><span id="FluorObj-750"><a href="#FluorObj-750"><span class="linenos"> 750</span></a>
</span><span id="FluorObj-751"><a href="#FluorObj-751"><span class="linenos"> 751</span></a><span class="s2">        Parameters</span>
</span><span id="FluorObj-752"><a href="#FluorObj-752"><span class="linenos"> 752</span></a><span class="s2">        ----------</span>
</span><span id="FluorObj-753"><a href="#FluorObj-753"><span class="linenos"> 753</span></a><span class="s2">        typical_size : Union[float, int, tuple]</span>
</span><span id="FluorObj-754"><a href="#FluorObj-754"><span class="linenos"> 754</span></a><span class="s2">            Typical sizes of the object, e.g. for a bead - diameter (float or int), for ellipse - tuple with axes a, b</span>
</span><span id="FluorObj-755"><a href="#FluorObj-755"><span class="linenos"> 755</span></a><span class="s2">            and angle in radians (3 values).</span>
</span><span id="FluorObj-756"><a href="#FluorObj-756"><span class="linenos"> 756</span></a><span class="s2">        center_shifts : tuple, optional</span>
</span><span id="FluorObj-757"><a href="#FluorObj-757"><span class="linenos"> 757</span></a><span class="s2">            Shifts in pixels of the object center, should be less than 1px. The default is (0.0, 0.0).</span>
</span><span id="FluorObj-758"><a href="#FluorObj-758"><span class="linenos"> 758</span></a><span class="s2">        shape_type : str, optional</span>
</span><span id="FluorObj-759"><a href="#FluorObj-759"><span class="linenos"> 759</span></a><span class="s2">            Supported shape types: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span>
</span><span id="FluorObj-760"><a href="#FluorObj-760"><span class="linenos"> 760</span></a><span class="s2">            Currently implemented: &#39;round&#39; or &#39;r&#39; - for the circular bead object and &#39;ellipse&#39; or &#39;el&#39; - for the ellipse object.</span>
</span><span id="FluorObj-761"><a href="#FluorObj-761"><span class="linenos"> 761</span></a><span class="s2">            The default is &#39;round&#39;.</span>
</span><span id="FluorObj-762"><a href="#FluorObj-762"><span class="linenos"> 762</span></a><span class="s2">        border_type : str, optional</span>
</span><span id="FluorObj-763"><a href="#FluorObj-763"><span class="linenos"> 763</span></a><span class="s2">            Type of intensity of the border pixels calculation. Supported border types: &#39;precise&#39;, &#39;pr&#39;, &#39;computed&#39;, &#39;co&#39;. </span><span class="se">\n</span>
</span><span id="FluorObj-764"><a href="#FluorObj-764"><span class="linenos"> 764</span></a><span class="s2">            The &#39;computed&#39; or &#39;co&#39; type should be accompanied with the specification of the shape method parameter. </span><span class="se">\n</span>
</span><span id="FluorObj-765"><a href="#FluorObj-765"><span class="linenos"> 765</span></a><span class="s2">            The &#39;precise&#39; or &#39;pr&#39; type corresponds to the developed counting area of the pixel laying within</span>
</span><span id="FluorObj-766"><a href="#FluorObj-766"><span class="linenos"> 766</span></a><span class="s2">            the border (e.g., circular) of an object. </span><span class="se">\n</span>
</span><span id="FluorObj-767"><a href="#FluorObj-767"><span class="linenos"> 767</span></a><span class="s2">            Note that &#39;computed&#39; type can be used only for &#39;round&#39; objects. The default is &#39;precise&#39;.</span>
</span><span id="FluorObj-768"><a href="#FluorObj-768"><span class="linenos"> 768</span></a><span class="s2">        shape_method : str, optional</span>
</span><span id="FluorObj-769"><a href="#FluorObj-769"><span class="linenos"> 769</span></a><span class="s2">            Shape method calculation, supported ones: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="si">}</span><span class="s2">. The default is &#39;&#39;.</span>
</span><span id="FluorObj-770"><a href="#FluorObj-770"><span class="linenos"> 770</span></a>
</span><span id="FluorObj-771"><a href="#FluorObj-771"><span class="linenos"> 771</span></a><span class="s2">        Raises</span>
</span><span id="FluorObj-772"><a href="#FluorObj-772"><span class="linenos"> 772</span></a><span class="s2">        ------</span>
</span><span id="FluorObj-773"><a href="#FluorObj-773"><span class="linenos"> 773</span></a><span class="s2">        ValueError</span>
</span><span id="FluorObj-774"><a href="#FluorObj-774"><span class="linenos"> 774</span></a><span class="s2">            See the provided error description for details.</span>
</span><span id="FluorObj-775"><a href="#FluorObj-775"><span class="linenos"> 775</span></a>
</span><span id="FluorObj-776"><a href="#FluorObj-776"><span class="linenos"> 776</span></a><span class="s2">        Returns</span>
</span><span id="FluorObj-777"><a href="#FluorObj-777"><span class="linenos"> 777</span></a><span class="s2">        -------</span>
</span><span id="FluorObj-778"><a href="#FluorObj-778"><span class="linenos"> 778</span></a><span class="s2">        None.</span>
</span><span id="FluorObj-779"><a href="#FluorObj-779"><span class="linenos"> 779</span></a>
</span><span id="FluorObj-780"><a href="#FluorObj-780"><span class="linenos"> 780</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-781"><a href="#FluorObj-781"><span class="linenos"> 781</span></a>        <span class="c1"># Sanity checks of the input values</span>
</span><span id="FluorObj-782"><a href="#FluorObj-782"><span class="linenos"> 782</span></a>        <span class="k">if</span> <span class="n">shape_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="p">:</span>
</span><span id="FluorObj-783"><a href="#FluorObj-783"><span class="linenos"> 783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">=</span> <span class="n">shape_type</span>
</span><span id="FluorObj-784"><a href="#FluorObj-784"><span class="linenos"> 784</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-785"><a href="#FluorObj-785"><span class="linenos"> 785</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided shape type &#39;</span><span class="si">{</span><span class="n">shape_type</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-786"><a href="#FluorObj-786"><span class="linenos"> 786</span></a>        <span class="k">if</span> <span class="n">border_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_border_types</span><span class="p">:</span>
</span><span id="FluorObj-787"><a href="#FluorObj-787"><span class="linenos"> 787</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">=</span> <span class="n">border_type</span>
</span><span id="FluorObj-788"><a href="#FluorObj-788"><span class="linenos"> 788</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-789"><a href="#FluorObj-789"><span class="linenos"> 789</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided border type &#39;</span><span class="si">{</span><span class="n">border_type</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_border_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-790"><a href="#FluorObj-790"><span class="linenos"> 790</span></a>        <span class="c1"># Checking typical sizes depending on the shape type</span>
</span><span id="FluorObj-791"><a href="#FluorObj-791"><span class="linenos"> 791</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
</span><span id="FluorObj-792"><a href="#FluorObj-792"><span class="linenos"> 792</span></a>            <span class="n">typical_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span>  <span class="c1"># assuming that the input parameter can be converted to the float type</span>
</span><span id="FluorObj-793"><a href="#FluorObj-793"><span class="linenos"> 793</span></a>            <span class="k">if</span> <span class="n">typical_size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj-794"><a href="#FluorObj-794"><span class="linenos"> 794</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected typical size (radius) should be larger than 1px, provided: </span><span class="si">{</span><span class="n">typical_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-795"><a href="#FluorObj-795"><span class="linenos"> 795</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-796"><a href="#FluorObj-796"><span class="linenos"> 796</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">typical_size</span>
</span><span id="FluorObj-797"><a href="#FluorObj-797"><span class="linenos"> 797</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-798"><a href="#FluorObj-798"><span class="linenos"> 798</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj-799"><a href="#FluorObj-799"><span class="linenos"> 799</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">=</span> <span class="s1">&#39;precise&#39;</span>  <span class="c1"># default border type for ellipse shape calculation</span>
</span><span id="FluorObj-800"><a href="#FluorObj-800"><span class="linenos"> 800</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="FluorObj-801"><a href="#FluorObj-801"><span class="linenos"> 801</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For ellipse particle expected length of typical size tuple is equal 3: (a, b, angle)&quot;</span><span class="p">)</span>
</span><span id="FluorObj-802"><a href="#FluorObj-802"><span class="linenos"> 802</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-803"><a href="#FluorObj-803"><span class="linenos"> 803</span></a>                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">typical_size</span><span class="p">;</span> <span class="n">max_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="n">min_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="FluorObj-804"><a href="#FluorObj-804"><span class="linenos"> 804</span></a>                    <span class="k">if</span> <span class="n">max_size</span> <span class="o">&lt;</span> <span class="mf">1.5</span> <span class="ow">or</span> <span class="n">min_size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj-805"><a href="#FluorObj-805"><span class="linenos"> 805</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected sizes a, b should be positive, minimal is more than 1px and maximal is more than 1.5px&quot;</span><span class="p">)</span>
</span><span id="FluorObj-806"><a href="#FluorObj-806"><span class="linenos"> 806</span></a>                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="ow">or</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
</span><span id="FluorObj-807"><a href="#FluorObj-807"><span class="linenos"> 807</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected angle should be in the range of [-2pi, 2pi]&quot;</span><span class="p">)</span>
</span><span id="FluorObj-808"><a href="#FluorObj-808"><span class="linenos"> 808</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span> <span class="o">=</span> <span class="n">typical_size</span>
</span><span id="FluorObj-809"><a href="#FluorObj-809"><span class="linenos"> 809</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-810"><a href="#FluorObj-810"><span class="linenos"> 810</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj-811"><a href="#FluorObj-811"><span class="linenos"> 811</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For curved particle expected length of typical size tuple is more than 2&quot;</span><span class="p">)</span>
</span><span id="FluorObj-812"><a href="#FluorObj-812"><span class="linenos"> 812</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-813"><a href="#FluorObj-813"><span class="linenos"> 813</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span> <span class="o">=</span> <span class="n">typical_size</span>
</span><span id="FluorObj-814"><a href="#FluorObj-814"><span class="linenos"> 814</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj-815"><a href="#FluorObj-815"><span class="linenos"> 815</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;ellipse&#39;</span>
</span><span id="FluorObj-816"><a href="#FluorObj-816"><span class="linenos"> 816</span></a>        <span class="c1"># Assigning the explicit border type for making full naming for plots</span>
</span><span id="FluorObj-817"><a href="#FluorObj-817"><span class="linenos"> 817</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">:</span>
</span><span id="FluorObj-818"><a href="#FluorObj-818"><span class="linenos"> 818</span></a>            <span class="k">if</span> <span class="n">shape_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">:</span>
</span><span id="FluorObj-819"><a href="#FluorObj-819"><span class="linenos"> 819</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">=</span> <span class="n">shape_method</span>
</span><span id="FluorObj-820"><a href="#FluorObj-820"><span class="linenos"> 820</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
</span><span id="FluorObj-821"><a href="#FluorObj-821"><span class="linenos"> 821</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>
</span><span id="FluorObj-822"><a href="#FluorObj-822"><span class="linenos"> 822</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;lor&#39;</span><span class="p">:</span>
</span><span id="FluorObj-823"><a href="#FluorObj-823"><span class="linenos"> 823</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;lorentzian&#39;</span>
</span><span id="FluorObj-824"><a href="#FluorObj-824"><span class="linenos"> 824</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;dlogf&#39;</span><span class="p">:</span>
</span><span id="FluorObj-825"><a href="#FluorObj-825"><span class="linenos"> 825</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;derivative of logistic func.&#39;</span>
</span><span id="FluorObj-826"><a href="#FluorObj-826"><span class="linenos"> 826</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump2&#39;</span><span class="p">:</span>
</span><span id="FluorObj-827"><a href="#FluorObj-827"><span class="linenos"> 827</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump square&#39;</span>
</span><span id="FluorObj-828"><a href="#FluorObj-828"><span class="linenos"> 828</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump3&#39;</span><span class="p">:</span>
</span><span id="FluorObj-829"><a href="#FluorObj-829"><span class="linenos"> 829</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump cube&#39;</span>
</span><span id="FluorObj-830"><a href="#FluorObj-830"><span class="linenos"> 830</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump8&#39;</span><span class="p">:</span>
</span><span id="FluorObj-831"><a href="#FluorObj-831"><span class="linenos"> 831</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump ^8&#39;</span>
</span><span id="FluorObj-832"><a href="#FluorObj-832"><span class="linenos"> 832</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;smcir&#39;</span><span class="p">:</span>
</span><span id="FluorObj-833"><a href="#FluorObj-833"><span class="linenos"> 833</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;smooth circle&#39;</span>
</span><span id="FluorObj-834"><a href="#FluorObj-834"><span class="linenos"> 834</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;ovcir&#39;</span><span class="p">:</span>
</span><span id="FluorObj-835"><a href="#FluorObj-835"><span class="linenos"> 835</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;oversampled circle&#39;</span>
</span><span id="FluorObj-836"><a href="#FluorObj-836"><span class="linenos"> 836</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;uncir&#39;</span><span class="p">:</span>
</span><span id="FluorObj-837"><a href="#FluorObj-837"><span class="linenos"> 837</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;undersampled circle&#39;</span>
</span><span id="FluorObj-838"><a href="#FluorObj-838"><span class="linenos"> 838</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
</span><span id="FluorObj-839"><a href="#FluorObj-839"><span class="linenos"> 839</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;circle&#39;</span>
</span><span id="FluorObj-840"><a href="#FluorObj-840"><span class="linenos"> 840</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-841"><a href="#FluorObj-841"><span class="linenos"> 841</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided shape comp. method &#39;</span><span class="si">{</span><span class="n">shape_method</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-842"><a href="#FluorObj-842"><span class="linenos"> 842</span></a>        <span class="c1"># Check that explicit shape name is not empty</span>
</span><span id="FluorObj-843"><a href="#FluorObj-843"><span class="linenos"> 843</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj-844"><a href="#FluorObj-844"><span class="linenos"> 844</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span><span class="p">:</span>
</span><span id="FluorObj-845"><a href="#FluorObj-845"><span class="linenos"> 845</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span><span class="p">[:]</span>
</span><span id="FluorObj-846"><a href="#FluorObj-846"><span class="linenos"> 846</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">:</span>
</span><span id="FluorObj-847"><a href="#FluorObj-847"><span class="linenos"> 847</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span><span class="p">[:]</span>
</span><span id="FluorObj-848"><a href="#FluorObj-848"><span class="linenos"> 848</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;precise&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">:</span>
</span><span id="FluorObj-849"><a href="#FluorObj-849"><span class="linenos"> 849</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
</span><span id="FluorObj-850"><a href="#FluorObj-850"><span class="linenos"> 850</span></a>        <span class="c1"># Assuming that center shifts provided as the tuple with x shift, y shift floats in pixels</span>
</span><span id="FluorObj-851"><a href="#FluorObj-851"><span class="linenos"> 851</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">center_shifts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj-852"><a href="#FluorObj-852"><span class="linenos"> 852</span></a>            <span class="n">x_shift</span><span class="p">,</span> <span class="n">y_shift</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj-853"><a href="#FluorObj-853"><span class="linenos"> 853</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj-854"><a href="#FluorObj-854"><span class="linenos"> 854</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj-855"><a href="#FluorObj-855"><span class="linenos"> 855</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-856"><a href="#FluorObj-856"><span class="linenos"> 856</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One of the shifts &#39;</span><span class="si">{</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2">&#39; are more than 1px, but they are expected to be in the subpixel range&quot;</span><span class="p">)</span>
</span><span id="FluorObj-857"><a href="#FluorObj-857"><span class="linenos"> 857</span></a>
</span><span id="FluorObj-858"><a href="#FluorObj-858"><span class="linenos"> 858</span></a>    <span class="k">def</span> <span class="nf">get_shaping_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FluorObj-859"><a href="#FluorObj-859"><span class="linenos"> 859</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-860"><a href="#FluorObj-860"><span class="linenos"> 860</span></a><span class="sd">        Print out the implemented methods acceptable for the &#39;shape_method&#39; parameter.</span>
</span><span id="FluorObj-861"><a href="#FluorObj-861"><span class="linenos"> 861</span></a>
</span><span id="FluorObj-862"><a href="#FluorObj-862"><span class="linenos"> 862</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-863"><a href="#FluorObj-863"><span class="linenos"> 863</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-864"><a href="#FluorObj-864"><span class="linenos"> 864</span></a><span class="sd">        str</span>
</span><span id="FluorObj-865"><a href="#FluorObj-865"><span class="linenos"> 865</span></a><span class="sd">            Printed out composed informational string.</span>
</span><span id="FluorObj-866"><a href="#FluorObj-866"><span class="linenos"> 866</span></a>
</span><span id="FluorObj-867"><a href="#FluorObj-867"><span class="linenos"> 867</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-868"><a href="#FluorObj-868"><span class="linenos"> 868</span></a>        <span class="n">methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FluorObj-869"><a href="#FluorObj-869"><span class="linenos"> 869</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="FluorObj-870"><a href="#FluorObj-870"><span class="linenos"> 870</span></a>            <span class="n">methods</span> <span class="o">+=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="FluorObj-871"><a href="#FluorObj-871"><span class="linenos"> 871</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="FluorObj-872"><a href="#FluorObj-872"><span class="linenos"> 872</span></a>        <span class="n">info_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The implemented types of continuous bell shape functions or acceptable variables for the &#39;shape_method&#39; parameter &quot;</span>
</span><span id="FluorObj-873"><a href="#FluorObj-873"><span class="linenos"> 873</span></a>                    <span class="o">+</span> <span class="s2">&quot;(first - the long naming followed by the shortened version): </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">methods</span><span class="p">)</span>
</span><span id="FluorObj-874"><a href="#FluorObj-874"><span class="linenos"> 874</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">info_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FluorObj-875"><a href="#FluorObj-875"><span class="linenos"> 875</span></a>        <span class="k">return</span> <span class="n">info_str</span>
</span><span id="FluorObj-876"><a href="#FluorObj-876"><span class="linenos"> 876</span></a>
</span><span id="FluorObj-877"><a href="#FluorObj-877"><span class="linenos"> 877</span></a>    <span class="c1"># %% Calculate and plot shape</span>
</span><span id="FluorObj-878"><a href="#FluorObj-878"><span class="linenos"> 878</span></a>    <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="FluorObj-879"><a href="#FluorObj-879"><span class="linenos"> 879</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-880"><a href="#FluorObj-880"><span class="linenos"> 880</span></a><span class="sd">        Calculate and return 2D intensity normalized (to the range [0.0, 1.0]) distribution of the object shape.</span>
</span><span id="FluorObj-881"><a href="#FluorObj-881"><span class="linenos"> 881</span></a>
</span><span id="FluorObj-882"><a href="#FluorObj-882"><span class="linenos"> 882</span></a>
</span><span id="FluorObj-883"><a href="#FluorObj-883"><span class="linenos"> 883</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-884"><a href="#FluorObj-884"><span class="linenos"> 884</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-885"><a href="#FluorObj-885"><span class="linenos"> 885</span></a><span class="sd">        center_shifts : tuple, optional</span>
</span><span id="FluorObj-886"><a href="#FluorObj-886"><span class="linenos"> 886</span></a><span class="sd">            Shifts in pixels of the object center, should be less than 1px. The default is None.</span>
</span><span id="FluorObj-887"><a href="#FluorObj-887"><span class="linenos"> 887</span></a><span class="sd">        accelerated : bool, optional</span>
</span><span id="FluorObj-888"><a href="#FluorObj-888"><span class="linenos"> 888</span></a><span class="sd">            Accelerate the computation by using numba library compilation utilities.</span>
</span><span id="FluorObj-889"><a href="#FluorObj-889"><span class="linenos"> 889</span></a><span class="sd">            If True, will raise warning if the numba library hasn&#39;t been installed in the environment. The default is False.</span>
</span><span id="FluorObj-890"><a href="#FluorObj-890"><span class="linenos"> 890</span></a>
</span><span id="FluorObj-891"><a href="#FluorObj-891"><span class="linenos"> 891</span></a><span class="sd">        Raises</span>
</span><span id="FluorObj-892"><a href="#FluorObj-892"><span class="linenos"> 892</span></a><span class="sd">        ------</span>
</span><span id="FluorObj-893"><a href="#FluorObj-893"><span class="linenos"> 893</span></a><span class="sd">        NotImplementedError</span>
</span><span id="FluorObj-894"><a href="#FluorObj-894"><span class="linenos"> 894</span></a><span class="sd">            For some set of allowed parameters for class initialization the calculation hasn&#39;t been yet implemented.</span>
</span><span id="FluorObj-895"><a href="#FluorObj-895"><span class="linenos"> 895</span></a>
</span><span id="FluorObj-896"><a href="#FluorObj-896"><span class="linenos"> 896</span></a><span class="sd">        References</span>
</span><span id="FluorObj-897"><a href="#FluorObj-897"><span class="linenos"> 897</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-898"><a href="#FluorObj-898"><span class="linenos"> 898</span></a><span class="sd">        Continuously shaped objects are created by adapting the functions from:</span>
</span><span id="FluorObj-899"><a href="#FluorObj-899"><span class="linenos"> 899</span></a><span class="sd">        [1] https://en.wikipedia.org/wiki/Bell-shaped_function</span>
</span><span id="FluorObj-900"><a href="#FluorObj-900"><span class="linenos"> 900</span></a><span class="sd">        &#39;Precisely&#39; shaped objects are created by the custom algorithm, which calculates part of an object still laying</span>
</span><span id="FluorObj-901"><a href="#FluorObj-901"><span class="linenos"> 901</span></a><span class="sd">        within the affected (&#39;border&#39;) pixels.</span>
</span><span id="FluorObj-902"><a href="#FluorObj-902"><span class="linenos"> 902</span></a>
</span><span id="FluorObj-903"><a href="#FluorObj-903"><span class="linenos"> 903</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-904"><a href="#FluorObj-904"><span class="linenos"> 904</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-905"><a href="#FluorObj-905"><span class="linenos"> 905</span></a><span class="sd">        2D shape of the object (intensity representation).</span>
</span><span id="FluorObj-906"><a href="#FluorObj-906"><span class="linenos"> 906</span></a>
</span><span id="FluorObj-907"><a href="#FluorObj-907"><span class="linenos"> 907</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-908"><a href="#FluorObj-908"><span class="linenos"> 908</span></a>        <span class="k">if</span> <span class="n">center_shifts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">center_shifts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj-909"><a href="#FluorObj-909"><span class="linenos"> 909</span></a>            <span class="n">x_shift</span><span class="p">,</span> <span class="n">y_shift</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj-910"><a href="#FluorObj-910"><span class="linenos"> 910</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj-911"><a href="#FluorObj-911"><span class="linenos"> 911</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj-912"><a href="#FluorObj-912"><span class="linenos"> 912</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-913"><a href="#FluorObj-913"><span class="linenos"> 913</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One of the shifts &#39;</span><span class="si">{</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2">&#39; are more than 1px, &quot;</span>
</span><span id="FluorObj-914"><a href="#FluorObj-914"><span class="linenos"> 914</span></a>                                 <span class="o">+</span> <span class="s2">&quot;but the shifts are expected to be in the subpixel range&quot;</span><span class="p">)</span>
</span><span id="FluorObj-915"><a href="#FluorObj-915"><span class="linenos"> 915</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">):</span>
</span><span id="FluorObj-916"><a href="#FluorObj-916"><span class="linenos"> 916</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">continuous_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">,</span> <span class="n">bead_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span><span class="p">)</span>
</span><span id="FluorObj-917"><a href="#FluorObj-917"><span class="linenos"> 917</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;precise&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">):</span>
</span><span id="FluorObj-918"><a href="#FluorObj-918"><span class="linenos"> 918</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">accelerated</span><span class="p">:</span>
</span><span id="FluorObj-919"><a href="#FluorObj-919"><span class="linenos"> 919</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj-920"><a href="#FluorObj-920"><span class="linenos"> 920</span></a>            <span class="k">elif</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj-921"><a href="#FluorObj-921"><span class="linenos"> 921</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead_acc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj-922"><a href="#FluorObj-922"><span class="linenos"> 922</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-923"><a href="#FluorObj-923"><span class="linenos"> 923</span></a>                <span class="k">if</span> <span class="n">accelerated</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj-924"><a href="#FluorObj-924"><span class="linenos"> 924</span></a>                    <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="FluorObj-925"><a href="#FluorObj-925"><span class="linenos"> 925</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="FluorObj-926"><a href="#FluorObj-926"><span class="linenos"> 926</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj-927"><a href="#FluorObj-927"><span class="linenos"> 927</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj-928"><a href="#FluorObj-928"><span class="linenos"> 928</span></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">ellipse_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="FluorObj-929"><a href="#FluorObj-929"><span class="linenos"> 929</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">accelerated</span><span class="p">:</span>
</span><span id="FluorObj-930"><a href="#FluorObj-930"><span class="linenos"> 930</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj-931"><a href="#FluorObj-931"><span class="linenos"> 931</span></a>            <span class="k">elif</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj-932"><a href="#FluorObj-932"><span class="linenos"> 932</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse_acc</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj-933"><a href="#FluorObj-933"><span class="linenos"> 933</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-934"><a href="#FluorObj-934"><span class="linenos"> 934</span></a>                <span class="k">if</span> <span class="n">accelerated</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj-935"><a href="#FluorObj-935"><span class="linenos"> 935</span></a>                    <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="FluorObj-936"><a href="#FluorObj-936"><span class="linenos"> 936</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="FluorObj-937"><a href="#FluorObj-937"><span class="linenos"> 937</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj-938"><a href="#FluorObj-938"><span class="linenos"> 938</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-939"><a href="#FluorObj-939"><span class="linenos"> 939</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This set of input parameters hasn&#39;t yet been implemented&quot;</span><span class="p">)</span>
</span><span id="FluorObj-940"><a href="#FluorObj-940"><span class="linenos"> 940</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set it to the default value, the profile is uncropped</span>
</span><span id="FluorObj-941"><a href="#FluorObj-941"><span class="linenos"> 941</span></a>
</span><span id="FluorObj-942"><a href="#FluorObj-942"><span class="linenos"> 942</span></a>    <span class="k">def</span> <span class="nf">get_casted_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_pixel_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="FluorObj-943"><a href="#FluorObj-943"><span class="linenos"> 943</span></a>                         <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="FluorObj-944"><a href="#FluorObj-944"><span class="linenos"> 944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-945"><a href="#FluorObj-945"><span class="linenos"> 945</span></a><span class="sd">        Calculate cast from the computed normalized object shape.</span>
</span><span id="FluorObj-946"><a href="#FluorObj-946"><span class="linenos"> 946</span></a>
</span><span id="FluorObj-947"><a href="#FluorObj-947"><span class="linenos"> 947</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-948"><a href="#FluorObj-948"><span class="linenos"> 948</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-949"><a href="#FluorObj-949"><span class="linenos"> 949</span></a><span class="sd">        max_pixel_value : int | float (designated as Union)</span>
</span><span id="FluorObj-950"><a href="#FluorObj-950"><span class="linenos"> 950</span></a><span class="sd">            Maximum intensity or pixel value of the object.</span>
</span><span id="FluorObj-951"><a href="#FluorObj-951"><span class="linenos"> 951</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="FluorObj-952"><a href="#FluorObj-952"><span class="linenos"> 952</span></a><span class="sd">            Type for casting. The default is &#39;uint8&#39;.</span>
</span><span id="FluorObj-953"><a href="#FluorObj-953"><span class="linenos"> 953</span></a>
</span><span id="FluorObj-954"><a href="#FluorObj-954"><span class="linenos"> 954</span></a><span class="sd">        Raises</span>
</span><span id="FluorObj-955"><a href="#FluorObj-955"><span class="linenos"> 955</span></a><span class="sd">        ------</span>
</span><span id="FluorObj-956"><a href="#FluorObj-956"><span class="linenos"> 956</span></a><span class="sd">        ValueError</span>
</span><span id="FluorObj-957"><a href="#FluorObj-957"><span class="linenos"> 957</span></a><span class="sd">            If the provided max_pixel_value doesn&#39;t correspond to the provided image type.</span>
</span><span id="FluorObj-958"><a href="#FluorObj-958"><span class="linenos"> 958</span></a>
</span><span id="FluorObj-959"><a href="#FluorObj-959"><span class="linenos"> 959</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-960"><a href="#FluorObj-960"><span class="linenos"> 960</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-961"><a href="#FluorObj-961"><span class="linenos"> 961</span></a><span class="sd">        numpy.ndarray | None (designated as Union)</span>
</span><span id="FluorObj-962"><a href="#FluorObj-962"><span class="linenos"> 962</span></a><span class="sd">            Returns the cast profile or None if the normalized profile hasn&#39;t been calculated.</span>
</span><span id="FluorObj-963"><a href="#FluorObj-963"><span class="linenos"> 963</span></a>
</span><span id="FluorObj-964"><a href="#FluorObj-964"><span class="linenos"> 964</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-965"><a href="#FluorObj-965"><span class="linenos"> 965</span></a>        <span class="k">if</span> <span class="n">image_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">:</span>
</span><span id="FluorObj-966"><a href="#FluorObj-966"><span class="linenos"> 966</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided image type &#39;</span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&#39; not in the acceptable list of types: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">UscopeScene</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">))</span>
</span><span id="FluorObj-967"><a href="#FluorObj-967"><span class="linenos"> 967</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj-968"><a href="#FluorObj-968"><span class="linenos"> 968</span></a>            <span class="k">if</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint8&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="FluorObj-969"><a href="#FluorObj-969"><span class="linenos"> 969</span></a>                <span class="k">if</span> <span class="n">max_pixel_value</span> <span class="o">&gt;</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">max_pixel_value_uint8</span> <span class="ow">or</span> <span class="n">max_pixel_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj-970"><a href="#FluorObj-970"><span class="linenos"> 970</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided max pixel value </span><span class="si">{</span><span class="n">max_pixel_value</span><span class="si">}</span><span class="s2"> isn&#39;t compatible with the provided image type: </span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-971"><a href="#FluorObj-971"><span class="linenos"> 971</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="FluorObj-972"><a href="#FluorObj-972"><span class="linenos"> 972</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="FluorObj-973"><a href="#FluorObj-973"><span class="linenos"> 973</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="FluorObj-974"><a href="#FluorObj-974"><span class="linenos"> 974</span></a>                <span class="k">if</span> <span class="n">max_pixel_value</span> <span class="o">&gt;</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">max_pixel_value_uint16</span> <span class="ow">or</span> <span class="n">max_pixel_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj-975"><a href="#FluorObj-975"><span class="linenos"> 975</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided max pixel value </span><span class="si">{</span><span class="n">max_pixel_value</span><span class="si">}</span><span class="s2"> isn&#39;t compatible with the provided image type: </span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-976"><a href="#FluorObj-976"><span class="linenos"> 976</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="FluorObj-977"><a href="#FluorObj-977"><span class="linenos"> 977</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="FluorObj-978"><a href="#FluorObj-978"><span class="linenos"> 978</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="FluorObj-979"><a href="#FluorObj-979"><span class="linenos"> 979</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
</span><span id="FluorObj-980"><a href="#FluorObj-980"><span class="linenos"> 980</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="FluorObj-981"><a href="#FluorObj-981"><span class="linenos"> 981</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-982"><a href="#FluorObj-982"><span class="linenos"> 982</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="FluorObj-983"><a href="#FluorObj-983"><span class="linenos"> 983</span></a>
</span><span id="FluorObj-984"><a href="#FluorObj-984"><span class="linenos"> 984</span></a>    <span class="k">def</span> <span class="nf">crop_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="FluorObj-985"><a href="#FluorObj-985"><span class="linenos"> 985</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-986"><a href="#FluorObj-986"><span class="linenos"> 986</span></a><span class="sd">        Crop zero intensity parts (borders) of the computed profile.</span>
</span><span id="FluorObj-987"><a href="#FluorObj-987"><span class="linenos"> 987</span></a>
</span><span id="FluorObj-988"><a href="#FluorObj-988"><span class="linenos"> 988</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-989"><a href="#FluorObj-989"><span class="linenos"> 989</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-990"><a href="#FluorObj-990"><span class="linenos"> 990</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="FluorObj-991"><a href="#FluorObj-991"><span class="linenos"> 991</span></a><span class="sd">            2D cropped profile.</span>
</span><span id="FluorObj-992"><a href="#FluorObj-992"><span class="linenos"> 992</span></a>
</span><span id="FluorObj-993"><a href="#FluorObj-993"><span class="linenos"> 993</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-994"><a href="#FluorObj-994"><span class="linenos"> 994</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>  <span class="c1"># checking that the profile has been calculated and not cropped yet</span>
</span><span id="FluorObj-995"><a href="#FluorObj-995"><span class="linenos"> 995</span></a>            <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_end</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">j_end</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">border_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FluorObj-996"><a href="#FluorObj-996"><span class="linenos"> 996</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="FluorObj-997"><a href="#FluorObj-997"><span class="linenos"> 997</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj-998"><a href="#FluorObj-998"><span class="linenos"> 998</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj-999"><a href="#FluorObj-999"><span class="linenos"> 999</span></a>                        <span class="n">border_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj-1000"><a href="#FluorObj-1000"><span class="linenos">1000</span></a>                    <span class="k">continue</span>
</span><span id="FluorObj-1001"><a href="#FluorObj-1001"><span class="linenos">1001</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1002"><a href="#FluorObj-1002"><span class="linenos">1002</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj-1003"><a href="#FluorObj-1003"><span class="linenos">1003</span></a>                        <span class="n">i_start</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
</span><span id="FluorObj-1004"><a href="#FluorObj-1004"><span class="linenos">1004</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1005"><a href="#FluorObj-1005"><span class="linenos">1005</span></a>                        <span class="n">i_end</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span>
</span><span id="FluorObj-1006"><a href="#FluorObj-1006"><span class="linenos">1006</span></a>            <span class="n">border_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FluorObj-1007"><a href="#FluorObj-1007"><span class="linenos">1007</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="FluorObj-1008"><a href="#FluorObj-1008"><span class="linenos">1008</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj-1009"><a href="#FluorObj-1009"><span class="linenos">1009</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj-1010"><a href="#FluorObj-1010"><span class="linenos">1010</span></a>                        <span class="n">border_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj-1011"><a href="#FluorObj-1011"><span class="linenos">1011</span></a>                    <span class="k">continue</span>
</span><span id="FluorObj-1012"><a href="#FluorObj-1012"><span class="linenos">1012</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1013"><a href="#FluorObj-1013"><span class="linenos">1013</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj-1014"><a href="#FluorObj-1014"><span class="linenos">1014</span></a>                        <span class="n">j_start</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
</span><span id="FluorObj-1015"><a href="#FluorObj-1015"><span class="linenos">1015</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1016"><a href="#FluorObj-1016"><span class="linenos">1016</span></a>                        <span class="n">j_end</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span> <span class="k">break</span>
</span><span id="FluorObj-1017"><a href="#FluorObj-1017"><span class="linenos">1017</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_end</span><span class="p">]</span>
</span><span id="FluorObj-1018"><a href="#FluorObj-1018"><span class="linenos">1018</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj-1019"><a href="#FluorObj-1019"><span class="linenos">1019</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_end</span><span class="p">]</span>
</span><span id="FluorObj-1020"><a href="#FluorObj-1020"><span class="linenos">1020</span></a>            <span class="k">if</span> <span class="n">i_start</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j_start</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i_end</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">j_end</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
</span><span id="FluorObj-1021"><a href="#FluorObj-1021"><span class="linenos">1021</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj-1022"><a href="#FluorObj-1022"><span class="linenos">1022</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
</span><span id="FluorObj-1023"><a href="#FluorObj-1023"><span class="linenos">1023</span></a>
</span><span id="FluorObj-1024"><a href="#FluorObj-1024"><span class="linenos">1024</span></a>    <span class="c1"># %% Plotting methods</span>
</span><span id="FluorObj-1025"><a href="#FluorObj-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="nf">plot_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">):</span>
</span><span id="FluorObj-1026"><a href="#FluorObj-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-1027"><a href="#FluorObj-1027"><span class="linenos">1027</span></a><span class="sd">        Plot interactively the profile of the object computed by the get_shape() method along with the border of the object.</span>
</span><span id="FluorObj-1028"><a href="#FluorObj-1028"><span class="linenos">1028</span></a>
</span><span id="FluorObj-1029"><a href="#FluorObj-1029"><span class="linenos">1029</span></a><span class="sd">        Please note that the border will be plotted if the shape hadn&#39;t been cropped before.</span>
</span><span id="FluorObj-1030"><a href="#FluorObj-1030"><span class="linenos">1030</span></a>
</span><span id="FluorObj-1031"><a href="#FluorObj-1031"><span class="linenos">1031</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-1032"><a href="#FluorObj-1032"><span class="linenos">1032</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-1033"><a href="#FluorObj-1033"><span class="linenos">1033</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="FluorObj-1034"><a href="#FluorObj-1034"><span class="linenos">1034</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="FluorObj-1035"><a href="#FluorObj-1035"><span class="linenos">1035</span></a><span class="sd">        color_map</span>
</span><span id="FluorObj-1036"><a href="#FluorObj-1036"><span class="linenos">1036</span></a><span class="sd">            Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is &#39;viridis&#39;.</span>
</span><span id="FluorObj-1037"><a href="#FluorObj-1037"><span class="linenos">1037</span></a>
</span><span id="FluorObj-1038"><a href="#FluorObj-1038"><span class="linenos">1038</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-1039"><a href="#FluorObj-1039"><span class="linenos">1039</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-1040"><a href="#FluorObj-1040"><span class="linenos">1040</span></a><span class="sd">        None.</span>
</span><span id="FluorObj-1041"><a href="#FluorObj-1041"><span class="linenos">1041</span></a>
</span><span id="FluorObj-1042"><a href="#FluorObj-1042"><span class="linenos">1042</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-1043"><a href="#FluorObj-1043"><span class="linenos">1043</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="FluorObj-1044"><a href="#FluorObj-1044"><span class="linenos">1044</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="FluorObj-1045"><a href="#FluorObj-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj-1046"><a href="#FluorObj-1046"><span class="linenos">1046</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>
</span><span id="FluorObj-1047"><a href="#FluorObj-1047"><span class="linenos">1047</span></a>                <span class="n">naming</span> <span class="o">=</span> <span class="s2">&quot;Cropped Shape&quot;</span>
</span><span id="FluorObj-1048"><a href="#FluorObj-1048"><span class="linenos">1048</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1049"><a href="#FluorObj-1049"><span class="linenos">1049</span></a>                <span class="n">naming</span> <span class="o">=</span> <span class="s2">&quot;Shape&quot;</span>
</span><span id="FluorObj-1050"><a href="#FluorObj-1050"><span class="linenos">1050</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj-1051"><a href="#FluorObj-1051"><span class="linenos">1051</span></a>                <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="FluorObj-1052"><a href="#FluorObj-1052"><span class="linenos">1052</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">naming</span><span class="si">}</span><span class="s2"> with parameters: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span><span class="si">}</span><span class="s2">, center: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">str_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-1053"><a href="#FluorObj-1053"><span class="linenos">1053</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="FluorObj-1054"><a href="#FluorObj-1054"><span class="linenos">1054</span></a>                <span class="n">axes_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="FluorObj-1055"><a href="#FluorObj-1055"><span class="linenos">1055</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="FluorObj-1056"><a href="#FluorObj-1056"><span class="linenos">1056</span></a>                <span class="n">axes_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="FluorObj-1057"><a href="#FluorObj-1057"><span class="linenos">1057</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="FluorObj-1058"><a href="#FluorObj-1058"><span class="linenos">1058</span></a>            <span class="n">plot_patch</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># flag for plotting the patch (Circle or Ellipse)</span>
</span><span id="FluorObj-1059"><a href="#FluorObj-1059"><span class="linenos">1059</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>
</span><span id="FluorObj-1060"><a href="#FluorObj-1060"><span class="linenos">1060</span></a>                <span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># image sizes</span>
</span><span id="FluorObj-1061"><a href="#FluorObj-1061"><span class="linenos">1061</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
</span><span id="FluorObj-1062"><a href="#FluorObj-1062"><span class="linenos">1062</span></a>                    <span class="n">m_center</span> <span class="o">=</span> <span class="n">m_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
</span><span id="FluorObj-1063"><a href="#FluorObj-1063"><span class="linenos">1063</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj-1064"><a href="#FluorObj-1064"><span class="linenos">1064</span></a>                    <span class="n">m_center</span> <span class="o">=</span> <span class="n">m_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="FluorObj-1065"><a href="#FluorObj-1065"><span class="linenos">1065</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
</span><span id="FluorObj-1066"><a href="#FluorObj-1066"><span class="linenos">1066</span></a>                    <span class="n">n_center</span> <span class="o">=</span> <span class="n">n_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
</span><span id="FluorObj-1067"><a href="#FluorObj-1067"><span class="linenos">1067</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj-1068"><a href="#FluorObj-1068"><span class="linenos">1068</span></a>                    <span class="n">n_center</span> <span class="o">=</span> <span class="n">n_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="FluorObj-1069"><a href="#FluorObj-1069"><span class="linenos">1069</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1070"><a href="#FluorObj-1070"><span class="linenos">1070</span></a>                <span class="n">plot_patch</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># just prevent the plotting the patch on the cropped images</span>
</span><span id="FluorObj-1071"><a href="#FluorObj-1071"><span class="linenos">1071</span></a>            <span class="k">if</span> <span class="n">plot_patch</span><span class="p">:</span>
</span><span id="FluorObj-1072"><a href="#FluorObj-1072"><span class="linenos">1072</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
</span><span id="FluorObj-1073"><a href="#FluorObj-1073"><span class="linenos">1073</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Circle</span><span class="p">((</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">))</span>
</span><span id="FluorObj-1074"><a href="#FluorObj-1074"><span class="linenos">1074</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="FluorObj-1075"><a href="#FluorObj-1075"><span class="linenos">1075</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj-1076"><a href="#FluorObj-1076"><span class="linenos">1076</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="FluorObj-1077"><a href="#FluorObj-1077"><span class="linenos">1077</span></a>                                                    <span class="n">angle</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
</span><span id="FluorObj-1078"><a href="#FluorObj-1078"><span class="linenos">1078</span></a>                                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.75</span><span class="p">))</span>
</span><span id="FluorObj-1079"><a href="#FluorObj-1079"><span class="linenos">1079</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="FluorObj-1080"><a href="#FluorObj-1080"><span class="linenos">1080</span></a>
</span><span id="FluorObj-1081"><a href="#FluorObj-1081"><span class="linenos">1081</span></a>    <span class="k">def</span> <span class="nf">plot_cast_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="FluorObj-1082"><a href="#FluorObj-1082"><span class="linenos">1082</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-1083"><a href="#FluorObj-1083"><span class="linenos">1083</span></a><span class="sd">        Plot interactively the cast to the provided type profile of the object computed by the get_casted_shape() method.</span>
</span><span id="FluorObj-1084"><a href="#FluorObj-1084"><span class="linenos">1084</span></a>
</span><span id="FluorObj-1085"><a href="#FluorObj-1085"><span class="linenos">1085</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-1086"><a href="#FluorObj-1086"><span class="linenos">1086</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-1087"><a href="#FluorObj-1087"><span class="linenos">1087</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="FluorObj-1088"><a href="#FluorObj-1088"><span class="linenos">1088</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="FluorObj-1089"><a href="#FluorObj-1089"><span class="linenos">1089</span></a>
</span><span id="FluorObj-1090"><a href="#FluorObj-1090"><span class="linenos">1090</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-1091"><a href="#FluorObj-1091"><span class="linenos">1091</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-1092"><a href="#FluorObj-1092"><span class="linenos">1092</span></a><span class="sd">        None.</span>
</span><span id="FluorObj-1093"><a href="#FluorObj-1093"><span class="linenos">1093</span></a>
</span><span id="FluorObj-1094"><a href="#FluorObj-1094"><span class="linenos">1094</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-1095"><a href="#FluorObj-1095"><span class="linenos">1095</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="FluorObj-1096"><a href="#FluorObj-1096"><span class="linenos">1096</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="FluorObj-1097"><a href="#FluorObj-1097"><span class="linenos">1097</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj-1098"><a href="#FluorObj-1098"><span class="linenos">1098</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj-1099"><a href="#FluorObj-1099"><span class="linenos">1099</span></a>                <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="FluorObj-1100"><a href="#FluorObj-1100"><span class="linenos">1100</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Casted shape with parameters: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span><span class="si">}</span><span class="s2">, center: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">str_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj-1101"><a href="#FluorObj-1101"><span class="linenos">1101</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="FluorObj-1102"><a href="#FluorObj-1102"><span class="linenos">1102</span></a>
</span><span id="FluorObj-1103"><a href="#FluorObj-1103"><span class="linenos">1103</span></a>    <span class="c1"># %% Containing within the image checks</span>
</span><span id="FluorObj-1104"><a href="#FluorObj-1104"><span class="linenos">1104</span></a>    <span class="k">def</span> <span class="nf">set_image_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_sizes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="FluorObj-1105"><a href="#FluorObj-1105"><span class="linenos">1105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-1106"><a href="#FluorObj-1106"><span class="linenos">1106</span></a><span class="sd">        Set containing this object image sizes packed in the tuple.</span>
</span><span id="FluorObj-1107"><a href="#FluorObj-1107"><span class="linenos">1107</span></a>
</span><span id="FluorObj-1108"><a href="#FluorObj-1108"><span class="linenos">1108</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-1109"><a href="#FluorObj-1109"><span class="linenos">1109</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-1110"><a href="#FluorObj-1110"><span class="linenos">1110</span></a><span class="sd">        image_sizes : tuple</span>
</span><span id="FluorObj-1111"><a href="#FluorObj-1111"><span class="linenos">1111</span></a><span class="sd">            Expected as (height, width).</span>
</span><span id="FluorObj-1112"><a href="#FluorObj-1112"><span class="linenos">1112</span></a>
</span><span id="FluorObj-1113"><a href="#FluorObj-1113"><span class="linenos">1113</span></a><span class="sd">        Raises</span>
</span><span id="FluorObj-1114"><a href="#FluorObj-1114"><span class="linenos">1114</span></a><span class="sd">        ------</span>
</span><span id="FluorObj-1115"><a href="#FluorObj-1115"><span class="linenos">1115</span></a><span class="sd">        ValueError</span>
</span><span id="FluorObj-1116"><a href="#FluorObj-1116"><span class="linenos">1116</span></a><span class="sd">            If image sizes provided less than 2 pixels.</span>
</span><span id="FluorObj-1117"><a href="#FluorObj-1117"><span class="linenos">1117</span></a>
</span><span id="FluorObj-1118"><a href="#FluorObj-1118"><span class="linenos">1118</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-1119"><a href="#FluorObj-1119"><span class="linenos">1119</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-1120"><a href="#FluorObj-1120"><span class="linenos">1120</span></a><span class="sd">        None.</span>
</span><span id="FluorObj-1121"><a href="#FluorObj-1121"><span class="linenos">1121</span></a>
</span><span id="FluorObj-1122"><a href="#FluorObj-1122"><span class="linenos">1122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-1123"><a href="#FluorObj-1123"><span class="linenos">1123</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image_sizes</span>  <span class="c1"># expecting packed height, width - also can be called with image.shape (np.ndarray.shape) attribute</span>
</span><span id="FluorObj-1124"><a href="#FluorObj-1124"><span class="linenos">1124</span></a>        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj-1125"><a href="#FluorObj-1125"><span class="linenos">1125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</span><span id="FluorObj-1126"><a href="#FluorObj-1126"><span class="linenos">1126</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1127"><a href="#FluorObj-1127"><span class="linenos">1127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># put the default sizes for always getting False after setting coordinates</span>
</span><span id="FluorObj-1128"><a href="#FluorObj-1128"><span class="linenos">1128</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Height and width image is expected to be more than 2 pixels&quot;</span><span class="p">)</span>
</span><span id="FluorObj-1129"><a href="#FluorObj-1129"><span class="linenos">1129</span></a>
</span><span id="FluorObj-1130"><a href="#FluorObj-1130"><span class="linenos">1130</span></a>    <span class="k">def</span> <span class="nf">set_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="FluorObj-1131"><a href="#FluorObj-1131"><span class="linenos">1131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-1132"><a href="#FluorObj-1132"><span class="linenos">1132</span></a><span class="sd">        Set coordinates of the left upper coordinates of the profile.</span>
</span><span id="FluorObj-1133"><a href="#FluorObj-1133"><span class="linenos">1133</span></a>
</span><span id="FluorObj-1134"><a href="#FluorObj-1134"><span class="linenos">1134</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-1135"><a href="#FluorObj-1135"><span class="linenos">1135</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-1136"><a href="#FluorObj-1136"><span class="linenos">1136</span></a><span class="sd">        coordinates : tuple</span>
</span><span id="FluorObj-1137"><a href="#FluorObj-1137"><span class="linenos">1137</span></a><span class="sd">            As i - from rows, j - columns.</span>
</span><span id="FluorObj-1138"><a href="#FluorObj-1138"><span class="linenos">1138</span></a>
</span><span id="FluorObj-1139"><a href="#FluorObj-1139"><span class="linenos">1139</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-1140"><a href="#FluorObj-1140"><span class="linenos">1140</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-1141"><a href="#FluorObj-1141"><span class="linenos">1141</span></a><span class="sd">        bool</span>
</span><span id="FluorObj-1142"><a href="#FluorObj-1142"><span class="linenos">1142</span></a><span class="sd">            True if the image containing the profile (even partially).</span>
</span><span id="FluorObj-1143"><a href="#FluorObj-1143"><span class="linenos">1143</span></a>
</span><span id="FluorObj-1144"><a href="#FluorObj-1144"><span class="linenos">1144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-1145"><a href="#FluorObj-1145"><span class="linenos">1145</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_upper_coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>  <span class="c1"># expecting packed coordinates of the left upper pixel of the profile</span>
</span><span id="FluorObj-1146"><a href="#FluorObj-1146"><span class="linenos">1146</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj-1147"><a href="#FluorObj-1147"><span class="linenos">1147</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">h_image</span><span class="p">,</span> <span class="n">w_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span>
</span><span id="FluorObj-1148"><a href="#FluorObj-1148"><span class="linenos">1148</span></a>            <span class="n">i_border_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">j_border_check</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flags for overall checking</span>
</span><span id="FluorObj-1149"><a href="#FluorObj-1149"><span class="linenos">1149</span></a>            <span class="c1"># Below - basic check that the profile still is within image, if even its borders still are in</span>
</span><span id="FluorObj-1150"><a href="#FluorObj-1150"><span class="linenos">1150</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">-</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">h_image</span><span class="p">):</span>
</span><span id="FluorObj-1151"><a href="#FluorObj-1151"><span class="linenos">1151</span></a>                <span class="n">i_border_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj-1152"><a href="#FluorObj-1152"><span class="linenos">1152</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">-</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">w_image</span><span class="p">):</span>
</span><span id="FluorObj-1153"><a href="#FluorObj-1153"><span class="linenos">1153</span></a>                <span class="n">j_border_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj-1154"><a href="#FluorObj-1154"><span class="linenos">1154</span></a>            <span class="c1"># Additional check that pixels of a shape is still not zero within the image (touching the scene only by border pixels)</span>
</span><span id="FluorObj-1155"><a href="#FluorObj-1155"><span class="linenos">1155</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">h_image</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">w_image</span><span class="p">):</span>
</span><span id="FluorObj-1156"><a href="#FluorObj-1156"><span class="linenos">1156</span></a>                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FluorObj-1157"><a href="#FluorObj-1157"><span class="linenos">1157</span></a>                <span class="k">for</span> <span class="n">i_c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">h</span><span class="p">):</span>
</span><span id="FluorObj-1158"><a href="#FluorObj-1158"><span class="linenos">1158</span></a>                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FluorObj-1159"><a href="#FluorObj-1159"><span class="linenos">1159</span></a>                    <span class="k">for</span> <span class="n">j_c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="n">w</span><span class="p">):</span>
</span><span id="FluorObj-1160"><a href="#FluorObj-1160"><span class="linenos">1160</span></a>                        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FluorObj-1161"><a href="#FluorObj-1161"><span class="linenos">1161</span></a>                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i_c</span> <span class="o">&lt;</span> <span class="n">h_image</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j_c</span> <span class="o">&lt;</span> <span class="n">w_image</span><span class="p">:</span>
</span><span id="FluorObj-1162"><a href="#FluorObj-1162"><span class="linenos">1162</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj-1163"><a href="#FluorObj-1163"><span class="linenos">1163</span></a>                                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
</span><span id="FluorObj-1164"><a href="#FluorObj-1164"><span class="linenos">1164</span></a>                        <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FluorObj-1165"><a href="#FluorObj-1165"><span class="linenos">1165</span></a>                    <span class="k">if</span> <span class="n">additional_containing_check</span><span class="p">:</span>
</span><span id="FluorObj-1166"><a href="#FluorObj-1166"><span class="linenos">1166</span></a>                        <span class="k">break</span>
</span><span id="FluorObj-1167"><a href="#FluorObj-1167"><span class="linenos">1167</span></a>                    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FluorObj-1168"><a href="#FluorObj-1168"><span class="linenos">1168</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1169"><a href="#FluorObj-1169"><span class="linenos">1169</span></a>                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj-1170"><a href="#FluorObj-1170"><span class="linenos">1170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_border_check</span> <span class="ow">and</span> <span class="n">j_border_check</span> <span class="ow">and</span> <span class="n">additional_containing_check</span><span class="p">)</span>
</span><span id="FluorObj-1171"><a href="#FluorObj-1171"><span class="linenos">1171</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1172"><a href="#FluorObj-1172"><span class="linenos">1172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># explicit setting flag</span>
</span><span id="FluorObj-1173"><a href="#FluorObj-1173"><span class="linenos">1173</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span>
</span><span id="FluorObj-1174"><a href="#FluorObj-1174"><span class="linenos">1174</span></a>
</span><span id="FluorObj-1175"><a href="#FluorObj-1175"><span class="linenos">1175</span></a>    <span class="c1"># %% Rewriting dunder methods for implementing sorting logic</span>
</span><span id="FluorObj-1176"><a href="#FluorObj-1176"><span class="linenos">1176</span></a>    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="FluorObj-1177"><a href="#FluorObj-1177"><span class="linenos">1177</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-1178"><a href="#FluorObj-1178"><span class="linenos">1178</span></a><span class="sd">        Implementation of &#39;&lt;&#39; comparison operator for letting the default sorting method to work on list of instances.</span>
</span><span id="FluorObj-1179"><a href="#FluorObj-1179"><span class="linenos">1179</span></a>
</span><span id="FluorObj-1180"><a href="#FluorObj-1180"><span class="linenos">1180</span></a><span class="sd">        This method compares only shape sizes multiplication (m, n = self.profile.shape; m*n &lt; other.profile.shape[0]*other.profile.shape[1]).</span>
</span><span id="FluorObj-1181"><a href="#FluorObj-1181"><span class="linenos">1181</span></a>
</span><span id="FluorObj-1182"><a href="#FluorObj-1182"><span class="linenos">1182</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-1183"><a href="#FluorObj-1183"><span class="linenos">1183</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-1184"><a href="#FluorObj-1184"><span class="linenos">1184</span></a><span class="sd">        other : FluorObj</span>
</span><span id="FluorObj-1185"><a href="#FluorObj-1185"><span class="linenos">1185</span></a><span class="sd">            Instance of FluorObj() comparison.</span>
</span><span id="FluorObj-1186"><a href="#FluorObj-1186"><span class="linenos">1186</span></a>
</span><span id="FluorObj-1187"><a href="#FluorObj-1187"><span class="linenos">1187</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-1188"><a href="#FluorObj-1188"><span class="linenos">1188</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-1189"><a href="#FluorObj-1189"><span class="linenos">1189</span></a><span class="sd">        bool</span>
</span><span id="FluorObj-1190"><a href="#FluorObj-1190"><span class="linenos">1190</span></a><span class="sd">            Result of profile sizes comparison.</span>
</span><span id="FluorObj-1191"><a href="#FluorObj-1191"><span class="linenos">1191</span></a>
</span><span id="FluorObj-1192"><a href="#FluorObj-1192"><span class="linenos">1192</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-1193"><a href="#FluorObj-1193"><span class="linenos">1193</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj-1194"><a href="#FluorObj-1194"><span class="linenos">1194</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="FluorObj-1195"><a href="#FluorObj-1195"><span class="linenos">1195</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1196"><a href="#FluorObj-1196"><span class="linenos">1196</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="FluorObj-1197"><a href="#FluorObj-1197"><span class="linenos">1197</span></a>
</span><span id="FluorObj-1198"><a href="#FluorObj-1198"><span class="linenos">1198</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="FluorObj-1199"><a href="#FluorObj-1199"><span class="linenos">1199</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj-1200"><a href="#FluorObj-1200"><span class="linenos">1200</span></a><span class="sd">        Implementation of &#39;==&#39; comparison operator for letting the default sorting method to work on list of instances.</span>
</span><span id="FluorObj-1201"><a href="#FluorObj-1201"><span class="linenos">1201</span></a>
</span><span id="FluorObj-1202"><a href="#FluorObj-1202"><span class="linenos">1202</span></a><span class="sd">        This method compares shape size (m, n = self.profile.shape; m == other.profile.shape[0] and n == other.profile.shape[1])</span>
</span><span id="FluorObj-1203"><a href="#FluorObj-1203"><span class="linenos">1203</span></a><span class="sd">        and also explicit_shape_name attributes of two classes.</span>
</span><span id="FluorObj-1204"><a href="#FluorObj-1204"><span class="linenos">1204</span></a>
</span><span id="FluorObj-1205"><a href="#FluorObj-1205"><span class="linenos">1205</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj-1206"><a href="#FluorObj-1206"><span class="linenos">1206</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj-1207"><a href="#FluorObj-1207"><span class="linenos">1207</span></a><span class="sd">        other : FluorObj</span>
</span><span id="FluorObj-1208"><a href="#FluorObj-1208"><span class="linenos">1208</span></a><span class="sd">            Instance of FluorObj() comparison.</span>
</span><span id="FluorObj-1209"><a href="#FluorObj-1209"><span class="linenos">1209</span></a>
</span><span id="FluorObj-1210"><a href="#FluorObj-1210"><span class="linenos">1210</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj-1211"><a href="#FluorObj-1211"><span class="linenos">1211</span></a><span class="sd">        -------</span>
</span><span id="FluorObj-1212"><a href="#FluorObj-1212"><span class="linenos">1212</span></a><span class="sd">        bool</span>
</span><span id="FluorObj-1213"><a href="#FluorObj-1213"><span class="linenos">1213</span></a><span class="sd">            Result of mentioned above attributes comparison.</span>
</span><span id="FluorObj-1214"><a href="#FluorObj-1214"><span class="linenos">1214</span></a>
</span><span id="FluorObj-1215"><a href="#FluorObj-1215"><span class="linenos">1215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj-1216"><a href="#FluorObj-1216"><span class="linenos">1216</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj-1217"><a href="#FluorObj-1217"><span class="linenos">1217</span></a>            <span class="n">shape_type_check</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">explicit_shape_name</span>
</span><span id="FluorObj-1218"><a href="#FluorObj-1218"><span class="linenos">1218</span></a>            <span class="n">shape_sizes_check</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="FluorObj-1219"><a href="#FluorObj-1219"><span class="linenos">1219</span></a>            <span class="k">return</span> <span class="n">shape_sizes_check</span> <span class="ow">and</span> <span class="n">shape_type_check</span>
</span><span id="FluorObj-1220"><a href="#FluorObj-1220"><span class="linenos">1220</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj-1221"><a href="#FluorObj-1221"><span class="linenos">1221</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Modelling the fluorescent bright object with the specified type.</p>

<p>It can be used for embedding it to the 'UscopeScene' class for building up the microscopic image.</p>
</div>


                            <div id="FluorObj.__init__" class="classattr">
                                        <input id="FluorObj.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">FluorObj</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">typical_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]</span>,</span><span class="param">	<span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>,</span><span class="param">	<span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span>,</span><span class="param">	<span class="n">border_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;precise&#39;</span>,</span><span class="param">	<span class="n">shape_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span>)</span>

                <label class="view-source-button" for="FluorObj.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.__init__-744"><a href="#FluorObj.__init__-744"><span class="linenos">744</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typical_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">],</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span> <span class="n">shape_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;round&#39;</span><span class="p">,</span>
</span><span id="FluorObj.__init__-745"><a href="#FluorObj.__init__-745"><span class="linenos">745</span></a>                 <span class="n">border_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;precise&#39;</span><span class="p">,</span> <span class="n">shape_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
</span><span id="FluorObj.__init__-746"><a href="#FluorObj.__init__-746"><span class="linenos">746</span></a>        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="FluorObj.__init__-747"><a href="#FluorObj.__init__-747"><span class="linenos">747</span></a><span class="s2">        Initialize the class representation of a fluorescent object.</span>
</span><span id="FluorObj.__init__-748"><a href="#FluorObj.__init__-748"><span class="linenos">748</span></a>
</span><span id="FluorObj.__init__-749"><a href="#FluorObj.__init__-749"><span class="linenos">749</span></a><span class="s2">        The difference between used parameters can be observed by plotting of the calculated shapes (profiles) by get_shape() method.</span>
</span><span id="FluorObj.__init__-750"><a href="#FluorObj.__init__-750"><span class="linenos">750</span></a>
</span><span id="FluorObj.__init__-751"><a href="#FluorObj.__init__-751"><span class="linenos">751</span></a><span class="s2">        Parameters</span>
</span><span id="FluorObj.__init__-752"><a href="#FluorObj.__init__-752"><span class="linenos">752</span></a><span class="s2">        ----------</span>
</span><span id="FluorObj.__init__-753"><a href="#FluorObj.__init__-753"><span class="linenos">753</span></a><span class="s2">        typical_size : Union[float, int, tuple]</span>
</span><span id="FluorObj.__init__-754"><a href="#FluorObj.__init__-754"><span class="linenos">754</span></a><span class="s2">            Typical sizes of the object, e.g. for a bead - diameter (float or int), for ellipse - tuple with axes a, b</span>
</span><span id="FluorObj.__init__-755"><a href="#FluorObj.__init__-755"><span class="linenos">755</span></a><span class="s2">            and angle in radians (3 values).</span>
</span><span id="FluorObj.__init__-756"><a href="#FluorObj.__init__-756"><span class="linenos">756</span></a><span class="s2">        center_shifts : tuple, optional</span>
</span><span id="FluorObj.__init__-757"><a href="#FluorObj.__init__-757"><span class="linenos">757</span></a><span class="s2">            Shifts in pixels of the object center, should be less than 1px. The default is (0.0, 0.0).</span>
</span><span id="FluorObj.__init__-758"><a href="#FluorObj.__init__-758"><span class="linenos">758</span></a><span class="s2">        shape_type : str, optional</span>
</span><span id="FluorObj.__init__-759"><a href="#FluorObj.__init__-759"><span class="linenos">759</span></a><span class="s2">            Supported shape types: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="si">}</span><span class="s2">. </span><span class="se">\n</span>
</span><span id="FluorObj.__init__-760"><a href="#FluorObj.__init__-760"><span class="linenos">760</span></a><span class="s2">            Currently implemented: &#39;round&#39; or &#39;r&#39; - for the circular bead object and &#39;ellipse&#39; or &#39;el&#39; - for the ellipse object.</span>
</span><span id="FluorObj.__init__-761"><a href="#FluorObj.__init__-761"><span class="linenos">761</span></a><span class="s2">            The default is &#39;round&#39;.</span>
</span><span id="FluorObj.__init__-762"><a href="#FluorObj.__init__-762"><span class="linenos">762</span></a><span class="s2">        border_type : str, optional</span>
</span><span id="FluorObj.__init__-763"><a href="#FluorObj.__init__-763"><span class="linenos">763</span></a><span class="s2">            Type of intensity of the border pixels calculation. Supported border types: &#39;precise&#39;, &#39;pr&#39;, &#39;computed&#39;, &#39;co&#39;. </span><span class="se">\n</span>
</span><span id="FluorObj.__init__-764"><a href="#FluorObj.__init__-764"><span class="linenos">764</span></a><span class="s2">            The &#39;computed&#39; or &#39;co&#39; type should be accompanied with the specification of the shape method parameter. </span><span class="se">\n</span>
</span><span id="FluorObj.__init__-765"><a href="#FluorObj.__init__-765"><span class="linenos">765</span></a><span class="s2">            The &#39;precise&#39; or &#39;pr&#39; type corresponds to the developed counting area of the pixel laying within</span>
</span><span id="FluorObj.__init__-766"><a href="#FluorObj.__init__-766"><span class="linenos">766</span></a><span class="s2">            the border (e.g., circular) of an object. </span><span class="se">\n</span>
</span><span id="FluorObj.__init__-767"><a href="#FluorObj.__init__-767"><span class="linenos">767</span></a><span class="s2">            Note that &#39;computed&#39; type can be used only for &#39;round&#39; objects. The default is &#39;precise&#39;.</span>
</span><span id="FluorObj.__init__-768"><a href="#FluorObj.__init__-768"><span class="linenos">768</span></a><span class="s2">        shape_method : str, optional</span>
</span><span id="FluorObj.__init__-769"><a href="#FluorObj.__init__-769"><span class="linenos">769</span></a><span class="s2">            Shape method calculation, supported ones: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="si">}</span><span class="s2">. The default is &#39;&#39;.</span>
</span><span id="FluorObj.__init__-770"><a href="#FluorObj.__init__-770"><span class="linenos">770</span></a>
</span><span id="FluorObj.__init__-771"><a href="#FluorObj.__init__-771"><span class="linenos">771</span></a><span class="s2">        Raises</span>
</span><span id="FluorObj.__init__-772"><a href="#FluorObj.__init__-772"><span class="linenos">772</span></a><span class="s2">        ------</span>
</span><span id="FluorObj.__init__-773"><a href="#FluorObj.__init__-773"><span class="linenos">773</span></a><span class="s2">        ValueError</span>
</span><span id="FluorObj.__init__-774"><a href="#FluorObj.__init__-774"><span class="linenos">774</span></a><span class="s2">            See the provided error description for details.</span>
</span><span id="FluorObj.__init__-775"><a href="#FluorObj.__init__-775"><span class="linenos">775</span></a>
</span><span id="FluorObj.__init__-776"><a href="#FluorObj.__init__-776"><span class="linenos">776</span></a><span class="s2">        Returns</span>
</span><span id="FluorObj.__init__-777"><a href="#FluorObj.__init__-777"><span class="linenos">777</span></a><span class="s2">        -------</span>
</span><span id="FluorObj.__init__-778"><a href="#FluorObj.__init__-778"><span class="linenos">778</span></a><span class="s2">        None.</span>
</span><span id="FluorObj.__init__-779"><a href="#FluorObj.__init__-779"><span class="linenos">779</span></a>
</span><span id="FluorObj.__init__-780"><a href="#FluorObj.__init__-780"><span class="linenos">780</span></a><span class="s2">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.__init__-781"><a href="#FluorObj.__init__-781"><span class="linenos">781</span></a>        <span class="c1"># Sanity checks of the input values</span>
</span><span id="FluorObj.__init__-782"><a href="#FluorObj.__init__-782"><span class="linenos">782</span></a>        <span class="k">if</span> <span class="n">shape_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="p">:</span>
</span><span id="FluorObj.__init__-783"><a href="#FluorObj.__init__-783"><span class="linenos">783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">=</span> <span class="n">shape_type</span>
</span><span id="FluorObj.__init__-784"><a href="#FluorObj.__init__-784"><span class="linenos">784</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-785"><a href="#FluorObj.__init__-785"><span class="linenos">785</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided shape type &#39;</span><span class="si">{</span><span class="n">shape_type</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-786"><a href="#FluorObj.__init__-786"><span class="linenos">786</span></a>        <span class="k">if</span> <span class="n">border_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_border_types</span><span class="p">:</span>
</span><span id="FluorObj.__init__-787"><a href="#FluorObj.__init__-787"><span class="linenos">787</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">=</span> <span class="n">border_type</span>
</span><span id="FluorObj.__init__-788"><a href="#FluorObj.__init__-788"><span class="linenos">788</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-789"><a href="#FluorObj.__init__-789"><span class="linenos">789</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided border type &#39;</span><span class="si">{</span><span class="n">border_type</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_border_types</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-790"><a href="#FluorObj.__init__-790"><span class="linenos">790</span></a>        <span class="c1"># Checking typical sizes depending on the shape type</span>
</span><span id="FluorObj.__init__-791"><a href="#FluorObj.__init__-791"><span class="linenos">791</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-792"><a href="#FluorObj.__init__-792"><span class="linenos">792</span></a>            <span class="n">typical_size</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span>  <span class="c1"># assuming that the input parameter can be converted to the float type</span>
</span><span id="FluorObj.__init__-793"><a href="#FluorObj.__init__-793"><span class="linenos">793</span></a>            <span class="k">if</span> <span class="n">typical_size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj.__init__-794"><a href="#FluorObj.__init__-794"><span class="linenos">794</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expected typical size (radius) should be larger than 1px, provided: </span><span class="si">{</span><span class="n">typical_size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-795"><a href="#FluorObj.__init__-795"><span class="linenos">795</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-796"><a href="#FluorObj.__init__-796"><span class="linenos">796</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">typical_size</span>
</span><span id="FluorObj.__init__-797"><a href="#FluorObj.__init__-797"><span class="linenos">797</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-798"><a href="#FluorObj.__init__-798"><span class="linenos">798</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-799"><a href="#FluorObj.__init__-799"><span class="linenos">799</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">=</span> <span class="s1">&#39;precise&#39;</span>  <span class="c1"># default border type for ellipse shape calculation</span>
</span><span id="FluorObj.__init__-800"><a href="#FluorObj.__init__-800"><span class="linenos">800</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="FluorObj.__init__-801"><a href="#FluorObj.__init__-801"><span class="linenos">801</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For ellipse particle expected length of typical size tuple is equal 3: (a, b, angle)&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-802"><a href="#FluorObj.__init__-802"><span class="linenos">802</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-803"><a href="#FluorObj.__init__-803"><span class="linenos">803</span></a>                    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">typical_size</span><span class="p">;</span> <span class="n">max_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span> <span class="n">min_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="FluorObj.__init__-804"><a href="#FluorObj.__init__-804"><span class="linenos">804</span></a>                    <span class="k">if</span> <span class="n">max_size</span> <span class="o">&lt;</span> <span class="mf">1.5</span> <span class="ow">or</span> <span class="n">min_size</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj.__init__-805"><a href="#FluorObj.__init__-805"><span class="linenos">805</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected sizes a, b should be positive, minimal is more than 1px and maximal is more than 1.5px&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-806"><a href="#FluorObj.__init__-806"><span class="linenos">806</span></a>                    <span class="k">if</span> <span class="n">angle</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="ow">or</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
</span><span id="FluorObj.__init__-807"><a href="#FluorObj.__init__-807"><span class="linenos">807</span></a>                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Expected angle should be in the range of [-2pi, 2pi]&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-808"><a href="#FluorObj.__init__-808"><span class="linenos">808</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span> <span class="o">=</span> <span class="n">typical_size</span>
</span><span id="FluorObj.__init__-809"><a href="#FluorObj.__init__-809"><span class="linenos">809</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-810"><a href="#FluorObj.__init__-810"><span class="linenos">810</span></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">typical_size</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj.__init__-811"><a href="#FluorObj.__init__-811"><span class="linenos">811</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;For curved particle expected length of typical size tuple is more than 2&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-812"><a href="#FluorObj.__init__-812"><span class="linenos">812</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-813"><a href="#FluorObj.__init__-813"><span class="linenos">813</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span> <span class="o">=</span> <span class="n">typical_size</span>
</span><span id="FluorObj.__init__-814"><a href="#FluorObj.__init__-814"><span class="linenos">814</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-815"><a href="#FluorObj.__init__-815"><span class="linenos">815</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;ellipse&#39;</span>
</span><span id="FluorObj.__init__-816"><a href="#FluorObj.__init__-816"><span class="linenos">816</span></a>        <span class="c1"># Assigning the explicit border type for making full naming for plots</span>
</span><span id="FluorObj.__init__-817"><a href="#FluorObj.__init__-817"><span class="linenos">817</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-818"><a href="#FluorObj.__init__-818"><span class="linenos">818</span></a>            <span class="k">if</span> <span class="n">shape_method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">:</span>
</span><span id="FluorObj.__init__-819"><a href="#FluorObj.__init__-819"><span class="linenos">819</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">=</span> <span class="n">shape_method</span>
</span><span id="FluorObj.__init__-820"><a href="#FluorObj.__init__-820"><span class="linenos">820</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;g&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-821"><a href="#FluorObj.__init__-821"><span class="linenos">821</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;gaussian&#39;</span>
</span><span id="FluorObj.__init__-822"><a href="#FluorObj.__init__-822"><span class="linenos">822</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;lor&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-823"><a href="#FluorObj.__init__-823"><span class="linenos">823</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;lorentzian&#39;</span>
</span><span id="FluorObj.__init__-824"><a href="#FluorObj.__init__-824"><span class="linenos">824</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;dlogf&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-825"><a href="#FluorObj.__init__-825"><span class="linenos">825</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;derivative of logistic func.&#39;</span>
</span><span id="FluorObj.__init__-826"><a href="#FluorObj.__init__-826"><span class="linenos">826</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump2&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-827"><a href="#FluorObj.__init__-827"><span class="linenos">827</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump square&#39;</span>
</span><span id="FluorObj.__init__-828"><a href="#FluorObj.__init__-828"><span class="linenos">828</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump3&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-829"><a href="#FluorObj.__init__-829"><span class="linenos">829</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump cube&#39;</span>
</span><span id="FluorObj.__init__-830"><a href="#FluorObj.__init__-830"><span class="linenos">830</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;bump8&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-831"><a href="#FluorObj.__init__-831"><span class="linenos">831</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;bump ^8&#39;</span>
</span><span id="FluorObj.__init__-832"><a href="#FluorObj.__init__-832"><span class="linenos">832</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;smcir&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-833"><a href="#FluorObj.__init__-833"><span class="linenos">833</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;smooth circle&#39;</span>
</span><span id="FluorObj.__init__-834"><a href="#FluorObj.__init__-834"><span class="linenos">834</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;ovcir&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-835"><a href="#FluorObj.__init__-835"><span class="linenos">835</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;oversampled circle&#39;</span>
</span><span id="FluorObj.__init__-836"><a href="#FluorObj.__init__-836"><span class="linenos">836</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;uncir&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-837"><a href="#FluorObj.__init__-837"><span class="linenos">837</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;undersampled circle&#39;</span>
</span><span id="FluorObj.__init__-838"><a href="#FluorObj.__init__-838"><span class="linenos">838</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-839"><a href="#FluorObj.__init__-839"><span class="linenos">839</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s1">&#39;circle&#39;</span>
</span><span id="FluorObj.__init__-840"><a href="#FluorObj.__init__-840"><span class="linenos">840</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-841"><a href="#FluorObj.__init__-841"><span class="linenos">841</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided shape comp. method &#39;</span><span class="si">{</span><span class="n">shape_method</span><span class="si">}</span><span class="s2">&#39; not in acceptable list </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.__init__-842"><a href="#FluorObj.__init__-842"><span class="linenos">842</span></a>        <span class="c1"># Check that explicit shape name is not empty</span>
</span><span id="FluorObj.__init__-843"><a href="#FluorObj.__init__-843"><span class="linenos">843</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj.__init__-844"><a href="#FluorObj.__init__-844"><span class="linenos">844</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-845"><a href="#FluorObj.__init__-845"><span class="linenos">845</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span><span class="p">[:]</span>
</span><span id="FluorObj.__init__-846"><a href="#FluorObj.__init__-846"><span class="linenos">846</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-847"><a href="#FluorObj.__init__-847"><span class="linenos">847</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span><span class="p">[:]</span>
</span><span id="FluorObj.__init__-848"><a href="#FluorObj.__init__-848"><span class="linenos">848</span></a>            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;precise&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">:</span>
</span><span id="FluorObj.__init__-849"><a href="#FluorObj.__init__-849"><span class="linenos">849</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span> <span class="o">=</span> <span class="s2">&quot;round&quot;</span>
</span><span id="FluorObj.__init__-850"><a href="#FluorObj.__init__-850"><span class="linenos">850</span></a>        <span class="c1"># Assuming that center shifts provided as the tuple with x shift, y shift floats in pixels</span>
</span><span id="FluorObj.__init__-851"><a href="#FluorObj.__init__-851"><span class="linenos">851</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">center_shifts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj.__init__-852"><a href="#FluorObj.__init__-852"><span class="linenos">852</span></a>            <span class="n">x_shift</span><span class="p">,</span> <span class="n">y_shift</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj.__init__-853"><a href="#FluorObj.__init__-853"><span class="linenos">853</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj.__init__-854"><a href="#FluorObj.__init__-854"><span class="linenos">854</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj.__init__-855"><a href="#FluorObj.__init__-855"><span class="linenos">855</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.__init__-856"><a href="#FluorObj.__init__-856"><span class="linenos">856</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One of the shifts &#39;</span><span class="si">{</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2">&#39; are more than 1px, but they are expected to be in the subpixel range&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="FluorObj.shape_type" class="classattr">
                                <div class="attr variable">
            <span class="name">shape_type</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.shape_type"></a>
    
    

                            </div>
                            <div id="FluorObj.border_type" class="classattr">
                                <div class="attr variable">
            <span class="name">border_type</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.border_type"></a>
    
    

                            </div>
                            <div id="FluorObj.shape_method" class="classattr">
                                <div class="attr variable">
            <span class="name">shape_method</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.shape_method"></a>
    
    

                            </div>
                            <div id="FluorObj.explicit_shape_name" class="classattr">
                                <div class="attr variable">
            <span class="name">explicit_shape_name</span><span class="annotation">: str</span>        =
<span class="default_value">&#39;&#39;</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.explicit_shape_name"></a>
    
    

                            </div>
                            <div id="FluorObj.profile" class="classattr">
                                <div class="attr variable">
            <span class="name">profile</span><span class="annotation">: numpy.ndarray</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.profile"></a>
    
    

                            </div>
                            <div id="FluorObj.radius" class="classattr">
                                <div class="attr variable">
            <span class="name">radius</span><span class="annotation">: float</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.radius"></a>
    
    

                            </div>
                            <div id="FluorObj.a" class="classattr">
                                <div class="attr variable">
            <span class="name">a</span><span class="annotation">: float</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.a"></a>
    
    

                            </div>
                            <div id="FluorObj.b" class="classattr">
                                <div class="attr variable">
            <span class="name">b</span><span class="annotation">: float</span>        =
<span class="default_value">0.0</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.b"></a>
    
    

                            </div>
                            <div id="FluorObj.typical_sizes" class="classattr">
                                <div class="attr variable">
            <span class="name">typical_sizes</span><span class="annotation">: tuple</span>        =
<span class="default_value">()</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.typical_sizes"></a>
    
    

                            </div>
                            <div id="FluorObj.valuable_round_shapes" class="classattr">
                                <div class="attr variable">
            <span class="name">valuable_round_shapes</span><span class="annotation">: list</span>        =
<span class="default_value">[&#39;gaussian&#39;, &#39;derivative of logistic func.&#39;, &#39;bump cube&#39;, &#39;bump ^8&#39;, &#39;smooth circle&#39;]</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.valuable_round_shapes"></a>
    
    

                            </div>
                            <div id="FluorObj.image_type" class="classattr">
                                <div class="attr variable">
            <span class="name">image_type</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.image_type"></a>
    
    

                            </div>
                            <div id="FluorObj.center_shifts" class="classattr">
                                <div class="attr variable">
            <span class="name">center_shifts</span><span class="annotation">: tuple</span>        =
<span class="default_value">(0.0, 0.0)</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.center_shifts"></a>
    
    

                            </div>
                            <div id="FluorObj.casted_profile" class="classattr">
                                <div class="attr variable">
            <span class="name">casted_profile</span><span class="annotation">: numpy.ndarray</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.casted_profile"></a>
    
    

                            </div>
                            <div id="FluorObj.external_upper_coordinates" class="classattr">
                                <div class="attr variable">
            <span class="name">external_upper_coordinates</span><span class="annotation">: tuple</span>        =
<span class="default_value">(0, 0)</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.external_upper_coordinates"></a>
    
    

                            </div>
                            <div id="FluorObj.within_image" class="classattr">
                                <div class="attr variable">
            <span class="name">within_image</span><span class="annotation">: bool</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#FluorObj.within_image"></a>
    
    

                            </div>
                            <div id="FluorObj.get_shaping_functions" class="classattr">
                                        <input id="FluorObj.get_shaping_functions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_shaping_functions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="FluorObj.get_shaping_functions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.get_shaping_functions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.get_shaping_functions-858"><a href="#FluorObj.get_shaping_functions-858"><span class="linenos">858</span></a>    <span class="k">def</span> <span class="nf">get_shaping_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FluorObj.get_shaping_functions-859"><a href="#FluorObj.get_shaping_functions-859"><span class="linenos">859</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.get_shaping_functions-860"><a href="#FluorObj.get_shaping_functions-860"><span class="linenos">860</span></a><span class="sd">        Print out the implemented methods acceptable for the &#39;shape_method&#39; parameter.</span>
</span><span id="FluorObj.get_shaping_functions-861"><a href="#FluorObj.get_shaping_functions-861"><span class="linenos">861</span></a>
</span><span id="FluorObj.get_shaping_functions-862"><a href="#FluorObj.get_shaping_functions-862"><span class="linenos">862</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.get_shaping_functions-863"><a href="#FluorObj.get_shaping_functions-863"><span class="linenos">863</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.get_shaping_functions-864"><a href="#FluorObj.get_shaping_functions-864"><span class="linenos">864</span></a><span class="sd">        str</span>
</span><span id="FluorObj.get_shaping_functions-865"><a href="#FluorObj.get_shaping_functions-865"><span class="linenos">865</span></a><span class="sd">            Printed out composed informational string.</span>
</span><span id="FluorObj.get_shaping_functions-866"><a href="#FluorObj.get_shaping_functions-866"><span class="linenos">866</span></a>
</span><span id="FluorObj.get_shaping_functions-867"><a href="#FluorObj.get_shaping_functions-867"><span class="linenos">867</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.get_shaping_functions-868"><a href="#FluorObj.get_shaping_functions-868"><span class="linenos">868</span></a>        <span class="n">methods</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FluorObj.get_shaping_functions-869"><a href="#FluorObj.get_shaping_functions-869"><span class="linenos">869</span></a>        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
</span><span id="FluorObj.get_shaping_functions-870"><a href="#FluorObj.get_shaping_functions-870"><span class="linenos">870</span></a>            <span class="n">methods</span> <span class="o">+=</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot; or &quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__acceptable_shape_methods</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="FluorObj.get_shaping_functions-871"><a href="#FluorObj.get_shaping_functions-871"><span class="linenos">871</span></a>            <span class="n">i</span> <span class="o">+=</span> <span class="mi">2</span>
</span><span id="FluorObj.get_shaping_functions-872"><a href="#FluorObj.get_shaping_functions-872"><span class="linenos">872</span></a>        <span class="n">info_str</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;The implemented types of continuous bell shape functions or acceptable variables for the &#39;shape_method&#39; parameter &quot;</span>
</span><span id="FluorObj.get_shaping_functions-873"><a href="#FluorObj.get_shaping_functions-873"><span class="linenos">873</span></a>                    <span class="o">+</span> <span class="s2">&quot;(first - the long naming followed by the shortened version): </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">methods</span><span class="p">)</span>
</span><span id="FluorObj.get_shaping_functions-874"><a href="#FluorObj.get_shaping_functions-874"><span class="linenos">874</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">info_str</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FluorObj.get_shaping_functions-875"><a href="#FluorObj.get_shaping_functions-875"><span class="linenos">875</span></a>        <span class="k">return</span> <span class="n">info_str</span>
</span></pre></div>


            <div class="docstring"><p>Print out the implemented methods acceptable for the 'shape_method' parameter.</p>

<h2 id="returns">Returns</h2>

<p>str
    Printed out composed informational string.</p>
</div>


                            </div>
                            <div id="FluorObj.get_shape" class="classattr">
                                        <input id="FluorObj.get_shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_shape</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="FluorObj.get_shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.get_shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.get_shape-878"><a href="#FluorObj.get_shape-878"><span class="linenos">878</span></a>    <span class="k">def</span> <span class="nf">get_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_shifts</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">accelerated</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-879"><a href="#FluorObj.get_shape-879"><span class="linenos">879</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.get_shape-880"><a href="#FluorObj.get_shape-880"><span class="linenos">880</span></a><span class="sd">        Calculate and return 2D intensity normalized (to the range [0.0, 1.0]) distribution of the object shape.</span>
</span><span id="FluorObj.get_shape-881"><a href="#FluorObj.get_shape-881"><span class="linenos">881</span></a>
</span><span id="FluorObj.get_shape-882"><a href="#FluorObj.get_shape-882"><span class="linenos">882</span></a>
</span><span id="FluorObj.get_shape-883"><a href="#FluorObj.get_shape-883"><span class="linenos">883</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj.get_shape-884"><a href="#FluorObj.get_shape-884"><span class="linenos">884</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj.get_shape-885"><a href="#FluorObj.get_shape-885"><span class="linenos">885</span></a><span class="sd">        center_shifts : tuple, optional</span>
</span><span id="FluorObj.get_shape-886"><a href="#FluorObj.get_shape-886"><span class="linenos">886</span></a><span class="sd">            Shifts in pixels of the object center, should be less than 1px. The default is None.</span>
</span><span id="FluorObj.get_shape-887"><a href="#FluorObj.get_shape-887"><span class="linenos">887</span></a><span class="sd">        accelerated : bool, optional</span>
</span><span id="FluorObj.get_shape-888"><a href="#FluorObj.get_shape-888"><span class="linenos">888</span></a><span class="sd">            Accelerate the computation by using numba library compilation utilities.</span>
</span><span id="FluorObj.get_shape-889"><a href="#FluorObj.get_shape-889"><span class="linenos">889</span></a><span class="sd">            If True, will raise warning if the numba library hasn&#39;t been installed in the environment. The default is False.</span>
</span><span id="FluorObj.get_shape-890"><a href="#FluorObj.get_shape-890"><span class="linenos">890</span></a>
</span><span id="FluorObj.get_shape-891"><a href="#FluorObj.get_shape-891"><span class="linenos">891</span></a><span class="sd">        Raises</span>
</span><span id="FluorObj.get_shape-892"><a href="#FluorObj.get_shape-892"><span class="linenos">892</span></a><span class="sd">        ------</span>
</span><span id="FluorObj.get_shape-893"><a href="#FluorObj.get_shape-893"><span class="linenos">893</span></a><span class="sd">        NotImplementedError</span>
</span><span id="FluorObj.get_shape-894"><a href="#FluorObj.get_shape-894"><span class="linenos">894</span></a><span class="sd">            For some set of allowed parameters for class initialization the calculation hasn&#39;t been yet implemented.</span>
</span><span id="FluorObj.get_shape-895"><a href="#FluorObj.get_shape-895"><span class="linenos">895</span></a>
</span><span id="FluorObj.get_shape-896"><a href="#FluorObj.get_shape-896"><span class="linenos">896</span></a><span class="sd">        References</span>
</span><span id="FluorObj.get_shape-897"><a href="#FluorObj.get_shape-897"><span class="linenos">897</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj.get_shape-898"><a href="#FluorObj.get_shape-898"><span class="linenos">898</span></a><span class="sd">        Continuously shaped objects are created by adapting the functions from:</span>
</span><span id="FluorObj.get_shape-899"><a href="#FluorObj.get_shape-899"><span class="linenos">899</span></a><span class="sd">        [1] https://en.wikipedia.org/wiki/Bell-shaped_function</span>
</span><span id="FluorObj.get_shape-900"><a href="#FluorObj.get_shape-900"><span class="linenos">900</span></a><span class="sd">        &#39;Precisely&#39; shaped objects are created by the custom algorithm, which calculates part of an object still laying</span>
</span><span id="FluorObj.get_shape-901"><a href="#FluorObj.get_shape-901"><span class="linenos">901</span></a><span class="sd">        within the affected (&#39;border&#39;) pixels.</span>
</span><span id="FluorObj.get_shape-902"><a href="#FluorObj.get_shape-902"><span class="linenos">902</span></a>
</span><span id="FluorObj.get_shape-903"><a href="#FluorObj.get_shape-903"><span class="linenos">903</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.get_shape-904"><a href="#FluorObj.get_shape-904"><span class="linenos">904</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.get_shape-905"><a href="#FluorObj.get_shape-905"><span class="linenos">905</span></a><span class="sd">        2D shape of the object (intensity representation).</span>
</span><span id="FluorObj.get_shape-906"><a href="#FluorObj.get_shape-906"><span class="linenos">906</span></a>
</span><span id="FluorObj.get_shape-907"><a href="#FluorObj.get_shape-907"><span class="linenos">907</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.get_shape-908"><a href="#FluorObj.get_shape-908"><span class="linenos">908</span></a>        <span class="k">if</span> <span class="n">center_shifts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">center_shifts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-909"><a href="#FluorObj.get_shape-909"><span class="linenos">909</span></a>            <span class="n">x_shift</span><span class="p">,</span> <span class="n">y_shift</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj.get_shape-910"><a href="#FluorObj.get_shape-910"><span class="linenos">910</span></a>            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_shift</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-911"><a href="#FluorObj.get_shape-911"><span class="linenos">911</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span> <span class="o">=</span> <span class="n">center_shifts</span>
</span><span id="FluorObj.get_shape-912"><a href="#FluorObj.get_shape-912"><span class="linenos">912</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-913"><a href="#FluorObj.get_shape-913"><span class="linenos">913</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One of the shifts &#39;</span><span class="si">{</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2">&#39; are more than 1px, &quot;</span>
</span><span id="FluorObj.get_shape-914"><a href="#FluorObj.get_shape-914"><span class="linenos">914</span></a>                                 <span class="o">+</span> <span class="s2">&quot;but the shifts are expected to be in the subpixel range&quot;</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-915"><a href="#FluorObj.get_shape-915"><span class="linenos">915</span></a>        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;computed&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;co&quot;</span><span class="p">):</span>
</span><span id="FluorObj.get_shape-916"><a href="#FluorObj.get_shape-916"><span class="linenos">916</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">continuous_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">,</span> <span class="n">bead_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_method</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-917"><a href="#FluorObj.get_shape-917"><span class="linenos">917</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;precise&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">border_type</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">):</span>
</span><span id="FluorObj.get_shape-918"><a href="#FluorObj.get_shape-918"><span class="linenos">918</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">accelerated</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-919"><a href="#FluorObj.get_shape-919"><span class="linenos">919</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-920"><a href="#FluorObj.get_shape-920"><span class="linenos">920</span></a>            <span class="k">elif</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-921"><a href="#FluorObj.get_shape-921"><span class="linenos">921</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead_acc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-922"><a href="#FluorObj.get_shape-922"><span class="linenos">922</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-923"><a href="#FluorObj.get_shape-923"><span class="linenos">923</span></a>                <span class="k">if</span> <span class="n">accelerated</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-924"><a href="#FluorObj.get_shape-924"><span class="linenos">924</span></a>                    <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="FluorObj.get_shape-925"><a href="#FluorObj.get_shape-925"><span class="linenos">925</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-926"><a href="#FluorObj.get_shape-926"><span class="linenos">926</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_bead</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-927"><a href="#FluorObj.get_shape-927"><span class="linenos">927</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-928"><a href="#FluorObj.get_shape-928"><span class="linenos">928</span></a>            <span class="n">sizes</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="n">ellipse_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="FluorObj.get_shape-929"><a href="#FluorObj.get_shape-929"><span class="linenos">929</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">accelerated</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-930"><a href="#FluorObj.get_shape-930"><span class="linenos">930</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-931"><a href="#FluorObj.get_shape-931"><span class="linenos">931</span></a>            <span class="k">elif</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-932"><a href="#FluorObj.get_shape-932"><span class="linenos">932</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse_acc</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-933"><a href="#FluorObj.get_shape-933"><span class="linenos">933</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-934"><a href="#FluorObj.get_shape-934"><span class="linenos">934</span></a>                <span class="k">if</span> <span class="n">accelerated</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-935"><a href="#FluorObj.get_shape-935"><span class="linenos">935</span></a>                    <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="FluorObj.get_shape-936"><a href="#FluorObj.get_shape-936"><span class="linenos">936</span></a>                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-937"><a href="#FluorObj.get_shape-937"><span class="linenos">937</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="n">discrete_shaped_ellipse</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">ellipse_angle</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-938"><a href="#FluorObj.get_shape-938"><span class="linenos">938</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.get_shape-939"><a href="#FluorObj.get_shape-939"><span class="linenos">939</span></a>            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;This set of input parameters hasn&#39;t yet been implemented&quot;</span><span class="p">)</span>
</span><span id="FluorObj.get_shape-940"><a href="#FluorObj.get_shape-940"><span class="linenos">940</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># set it to the default value, the profile is uncropped</span>
</span></pre></div>


            <div class="docstring"><p>Calculate and return 2D intensity normalized (to the range [0.0, 1.0]) distribution of the object shape.</p>

<h2 id="parameters">Parameters</h2>

<p>center_shifts : tuple, optional
    Shifts in pixels of the object center, should be less than 1px. The default is None.
accelerated : bool, optional
    Accelerate the computation by using numba library compilation utilities.
    If True, will raise warning if the numba library hasn't been installed in the environment. The default is False.</p>

<h2 id="raises">Raises</h2>

<p>NotImplementedError
    For some set of allowed parameters for class initialization the calculation hasn't been yet implemented.</p>

<h2 id="references">References</h2>

<p>Continuously shaped objects are created by adapting the functions from:
[1] <a href="https://en.wikipedia.org/wiki/Bell-shaped_function">https://en.wikipedia.org/wiki/Bell-shaped_function</a>
'Precisely' shaped objects are created by the custom algorithm, which calculates part of an object still laying
within the affected ('border') pixels.</p>

<h2 id="returns">Returns</h2>

<p>2D shape of the object (intensity representation).</p>
</div>


                            </div>
                            <div id="FluorObj.get_casted_shape" class="classattr">
                                        <input id="FluorObj.get_casted_shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_casted_shape</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">max_pixel_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>,</span><span class="param">	<span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FluorObj.get_casted_shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.get_casted_shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.get_casted_shape-942"><a href="#FluorObj.get_casted_shape-942"><span class="linenos">942</span></a>    <span class="k">def</span> <span class="nf">get_casted_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_pixel_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="FluorObj.get_casted_shape-943"><a href="#FluorObj.get_casted_shape-943"><span class="linenos">943</span></a>                         <span class="n">image_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uint8&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span><span id="FluorObj.get_casted_shape-944"><a href="#FluorObj.get_casted_shape-944"><span class="linenos">944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.get_casted_shape-945"><a href="#FluorObj.get_casted_shape-945"><span class="linenos">945</span></a><span class="sd">        Calculate cast from the computed normalized object shape.</span>
</span><span id="FluorObj.get_casted_shape-946"><a href="#FluorObj.get_casted_shape-946"><span class="linenos">946</span></a>
</span><span id="FluorObj.get_casted_shape-947"><a href="#FluorObj.get_casted_shape-947"><span class="linenos">947</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj.get_casted_shape-948"><a href="#FluorObj.get_casted_shape-948"><span class="linenos">948</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj.get_casted_shape-949"><a href="#FluorObj.get_casted_shape-949"><span class="linenos">949</span></a><span class="sd">        max_pixel_value : int | float (designated as Union)</span>
</span><span id="FluorObj.get_casted_shape-950"><a href="#FluorObj.get_casted_shape-950"><span class="linenos">950</span></a><span class="sd">            Maximum intensity or pixel value of the object.</span>
</span><span id="FluorObj.get_casted_shape-951"><a href="#FluorObj.get_casted_shape-951"><span class="linenos">951</span></a><span class="sd">        image_type : Union[str, np.uint8, np.uint16, np.float64], optional</span>
</span><span id="FluorObj.get_casted_shape-952"><a href="#FluorObj.get_casted_shape-952"><span class="linenos">952</span></a><span class="sd">            Type for casting. The default is &#39;uint8&#39;.</span>
</span><span id="FluorObj.get_casted_shape-953"><a href="#FluorObj.get_casted_shape-953"><span class="linenos">953</span></a>
</span><span id="FluorObj.get_casted_shape-954"><a href="#FluorObj.get_casted_shape-954"><span class="linenos">954</span></a><span class="sd">        Raises</span>
</span><span id="FluorObj.get_casted_shape-955"><a href="#FluorObj.get_casted_shape-955"><span class="linenos">955</span></a><span class="sd">        ------</span>
</span><span id="FluorObj.get_casted_shape-956"><a href="#FluorObj.get_casted_shape-956"><span class="linenos">956</span></a><span class="sd">        ValueError</span>
</span><span id="FluorObj.get_casted_shape-957"><a href="#FluorObj.get_casted_shape-957"><span class="linenos">957</span></a><span class="sd">            If the provided max_pixel_value doesn&#39;t correspond to the provided image type.</span>
</span><span id="FluorObj.get_casted_shape-958"><a href="#FluorObj.get_casted_shape-958"><span class="linenos">958</span></a>
</span><span id="FluorObj.get_casted_shape-959"><a href="#FluorObj.get_casted_shape-959"><span class="linenos">959</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.get_casted_shape-960"><a href="#FluorObj.get_casted_shape-960"><span class="linenos">960</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.get_casted_shape-961"><a href="#FluorObj.get_casted_shape-961"><span class="linenos">961</span></a><span class="sd">        numpy.ndarray | None (designated as Union)</span>
</span><span id="FluorObj.get_casted_shape-962"><a href="#FluorObj.get_casted_shape-962"><span class="linenos">962</span></a><span class="sd">            Returns the cast profile or None if the normalized profile hasn&#39;t been calculated.</span>
</span><span id="FluorObj.get_casted_shape-963"><a href="#FluorObj.get_casted_shape-963"><span class="linenos">963</span></a>
</span><span id="FluorObj.get_casted_shape-964"><a href="#FluorObj.get_casted_shape-964"><span class="linenos">964</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.get_casted_shape-965"><a href="#FluorObj.get_casted_shape-965"><span class="linenos">965</span></a>        <span class="k">if</span> <span class="n">image_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-966"><a href="#FluorObj.get_casted_shape-966"><span class="linenos">966</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided image type &#39;</span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&#39; not in the acceptable list of types: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">UscopeScene</span><span class="o">.</span><span class="n">acceptable_img_types</span><span class="p">))</span>
</span><span id="FluorObj.get_casted_shape-967"><a href="#FluorObj.get_casted_shape-967"><span class="linenos">967</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-968"><a href="#FluorObj.get_casted_shape-968"><span class="linenos">968</span></a>            <span class="k">if</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint8&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-969"><a href="#FluorObj.get_casted_shape-969"><span class="linenos">969</span></a>                <span class="k">if</span> <span class="n">max_pixel_value</span> <span class="o">&gt;</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">max_pixel_value_uint8</span> <span class="ow">or</span> <span class="n">max_pixel_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-970"><a href="#FluorObj.get_casted_shape-970"><span class="linenos">970</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided max pixel value </span><span class="si">{</span><span class="n">max_pixel_value</span><span class="si">}</span><span class="s2"> isn&#39;t compatible with the provided image type: </span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.get_casted_shape-971"><a href="#FluorObj.get_casted_shape-971"><span class="linenos">971</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
</span><span id="FluorObj.get_casted_shape-972"><a href="#FluorObj.get_casted_shape-972"><span class="linenos">972</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="FluorObj.get_casted_shape-973"><a href="#FluorObj.get_casted_shape-973"><span class="linenos">973</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;uint16&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-974"><a href="#FluorObj.get_casted_shape-974"><span class="linenos">974</span></a>                <span class="k">if</span> <span class="n">max_pixel_value</span> <span class="o">&gt;</span> <span class="n">UscopeScene</span><span class="o">.</span><span class="n">max_pixel_value_uint16</span> <span class="ow">or</span> <span class="n">max_pixel_value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-975"><a href="#FluorObj.get_casted_shape-975"><span class="linenos">975</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided max pixel value </span><span class="si">{</span><span class="n">max_pixel_value</span><span class="si">}</span><span class="s2"> isn&#39;t compatible with the provided image type: </span><span class="si">{</span><span class="n">image_type</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.get_casted_shape-976"><a href="#FluorObj.get_casted_shape-976"><span class="linenos">976</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">)</span>
</span><span id="FluorObj.get_casted_shape-977"><a href="#FluorObj.get_casted_shape-977"><span class="linenos">977</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="FluorObj.get_casted_shape-978"><a href="#FluorObj.get_casted_shape-978"><span class="linenos">978</span></a>            <span class="k">elif</span> <span class="n">image_type</span> <span class="o">==</span> <span class="s1">&#39;float&#39;</span> <span class="ow">or</span> <span class="n">image_type</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-979"><a href="#FluorObj.get_casted_shape-979"><span class="linenos">979</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">image_type</span> <span class="o">=</span> <span class="n">image_type</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="n">max_pixel_value</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
</span><span id="FluorObj.get_casted_shape-980"><a href="#FluorObj.get_casted_shape-980"><span class="linenos">980</span></a>                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span><span id="FluorObj.get_casted_shape-981"><a href="#FluorObj.get_casted_shape-981"><span class="linenos">981</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.get_casted_shape-982"><a href="#FluorObj.get_casted_shape-982"><span class="linenos">982</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="kc">None</span><span class="p">;</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span>
</span></pre></div>


            <div class="docstring"><p>Calculate cast from the computed normalized object shape.</p>

<h2 id="parameters">Parameters</h2>

<p>max_pixel_value : int | float (designated as Union)
    Maximum intensity or pixel value of the object.
image_type : Union[str, np.uint8, np.uint16, np.float64], optional
    Type for casting. The default is 'uint8'.</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If the provided max_pixel_value doesn't correspond to the provided image type.</p>

<h2 id="returns">Returns</h2>

<p>numpy.ndarray | None (designated as Union)
    Returns the cast profile or None if the normalized profile hasn't been calculated.</p>
</div>


                            </div>
                            <div id="FluorObj.crop_shape" class="classattr">
                                        <input id="FluorObj.crop_shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">crop_shape</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>:</span></span>

                <label class="view-source-button" for="FluorObj.crop_shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.crop_shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.crop_shape-984"><a href="#FluorObj.crop_shape-984"><span class="linenos"> 984</span></a>    <span class="k">def</span> <span class="nf">crop_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-985"><a href="#FluorObj.crop_shape-985"><span class="linenos"> 985</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.crop_shape-986"><a href="#FluorObj.crop_shape-986"><span class="linenos"> 986</span></a><span class="sd">        Crop zero intensity parts (borders) of the computed profile.</span>
</span><span id="FluorObj.crop_shape-987"><a href="#FluorObj.crop_shape-987"><span class="linenos"> 987</span></a>
</span><span id="FluorObj.crop_shape-988"><a href="#FluorObj.crop_shape-988"><span class="linenos"> 988</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.crop_shape-989"><a href="#FluorObj.crop_shape-989"><span class="linenos"> 989</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.crop_shape-990"><a href="#FluorObj.crop_shape-990"><span class="linenos"> 990</span></a><span class="sd">        numpy.ndarray</span>
</span><span id="FluorObj.crop_shape-991"><a href="#FluorObj.crop_shape-991"><span class="linenos"> 991</span></a><span class="sd">            2D cropped profile.</span>
</span><span id="FluorObj.crop_shape-992"><a href="#FluorObj.crop_shape-992"><span class="linenos"> 992</span></a>
</span><span id="FluorObj.crop_shape-993"><a href="#FluorObj.crop_shape-993"><span class="linenos"> 993</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.crop_shape-994"><a href="#FluorObj.crop_shape-994"><span class="linenos"> 994</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>  <span class="c1"># checking that the profile has been calculated and not cropped yet</span>
</span><span id="FluorObj.crop_shape-995"><a href="#FluorObj.crop_shape-995"><span class="linenos"> 995</span></a>            <span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">i_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j_start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i_end</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span> <span class="n">j_end</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span> <span class="n">border_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FluorObj.crop_shape-996"><a href="#FluorObj.crop_shape-996"><span class="linenos"> 996</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="FluorObj.crop_shape-997"><a href="#FluorObj.crop_shape-997"><span class="linenos"> 997</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-998"><a href="#FluorObj.crop_shape-998"><span class="linenos"> 998</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-999"><a href="#FluorObj.crop_shape-999"><span class="linenos"> 999</span></a>                        <span class="n">border_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj.crop_shape-1000"><a href="#FluorObj.crop_shape-1000"><span class="linenos">1000</span></a>                    <span class="k">continue</span>
</span><span id="FluorObj.crop_shape-1001"><a href="#FluorObj.crop_shape-1001"><span class="linenos">1001</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1002"><a href="#FluorObj.crop_shape-1002"><span class="linenos">1002</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1003"><a href="#FluorObj.crop_shape-1003"><span class="linenos">1003</span></a>                        <span class="n">i_start</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span>
</span><span id="FluorObj.crop_shape-1004"><a href="#FluorObj.crop_shape-1004"><span class="linenos">1004</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1005"><a href="#FluorObj.crop_shape-1005"><span class="linenos">1005</span></a>                        <span class="n">i_end</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span> <span class="k">break</span>
</span><span id="FluorObj.crop_shape-1006"><a href="#FluorObj.crop_shape-1006"><span class="linenos">1006</span></a>            <span class="n">border_found</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FluorObj.crop_shape-1007"><a href="#FluorObj.crop_shape-1007"><span class="linenos">1007</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="FluorObj.crop_shape-1008"><a href="#FluorObj.crop_shape-1008"><span class="linenos">1008</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[:,</span> <span class="n">j</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1009"><a href="#FluorObj.crop_shape-1009"><span class="linenos">1009</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1010"><a href="#FluorObj.crop_shape-1010"><span class="linenos">1010</span></a>                        <span class="n">border_found</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj.crop_shape-1011"><a href="#FluorObj.crop_shape-1011"><span class="linenos">1011</span></a>                    <span class="k">continue</span>
</span><span id="FluorObj.crop_shape-1012"><a href="#FluorObj.crop_shape-1012"><span class="linenos">1012</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1013"><a href="#FluorObj.crop_shape-1013"><span class="linenos">1013</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">border_found</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1014"><a href="#FluorObj.crop_shape-1014"><span class="linenos">1014</span></a>                        <span class="n">j_start</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>
</span><span id="FluorObj.crop_shape-1015"><a href="#FluorObj.crop_shape-1015"><span class="linenos">1015</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1016"><a href="#FluorObj.crop_shape-1016"><span class="linenos">1016</span></a>                        <span class="n">j_end</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span> <span class="k">break</span>
</span><span id="FluorObj.crop_shape-1017"><a href="#FluorObj.crop_shape-1017"><span class="linenos">1017</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_end</span><span class="p">]</span>
</span><span id="FluorObj.crop_shape-1018"><a href="#FluorObj.crop_shape-1018"><span class="linenos">1018</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1019"><a href="#FluorObj.crop_shape-1019"><span class="linenos">1019</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">[</span><span class="n">i_start</span><span class="p">:</span><span class="n">i_end</span><span class="p">,</span> <span class="n">j_start</span><span class="p">:</span><span class="n">j_end</span><span class="p">]</span>
</span><span id="FluorObj.crop_shape-1020"><a href="#FluorObj.crop_shape-1020"><span class="linenos">1020</span></a>            <span class="k">if</span> <span class="n">i_start</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">j_start</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i_end</span> <span class="o">&lt;</span> <span class="n">m</span> <span class="ow">or</span> <span class="n">j_end</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
</span><span id="FluorObj.crop_shape-1021"><a href="#FluorObj.crop_shape-1021"><span class="linenos">1021</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj.crop_shape-1022"><a href="#FluorObj.crop_shape-1022"><span class="linenos">1022</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span>
</span></pre></div>


            <div class="docstring"><p>Crop zero intensity parts (borders) of the computed profile.</p>

<h2 id="returns">Returns</h2>

<p>numpy.ndarray
    2D cropped profile.</p>
</div>


                            </div>
                            <div id="FluorObj.plot_shape" class="classattr">
                                        <input id="FluorObj.plot_shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_shape</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FluorObj.plot_shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.plot_shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.plot_shape-1025"><a href="#FluorObj.plot_shape-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="nf">plot_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">color_map</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">):</span>
</span><span id="FluorObj.plot_shape-1026"><a href="#FluorObj.plot_shape-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.plot_shape-1027"><a href="#FluorObj.plot_shape-1027"><span class="linenos">1027</span></a><span class="sd">        Plot interactively the profile of the object computed by the get_shape() method along with the border of the object.</span>
</span><span id="FluorObj.plot_shape-1028"><a href="#FluorObj.plot_shape-1028"><span class="linenos">1028</span></a>
</span><span id="FluorObj.plot_shape-1029"><a href="#FluorObj.plot_shape-1029"><span class="linenos">1029</span></a><span class="sd">        Please note that the border will be plotted if the shape hadn&#39;t been cropped before.</span>
</span><span id="FluorObj.plot_shape-1030"><a href="#FluorObj.plot_shape-1030"><span class="linenos">1030</span></a>
</span><span id="FluorObj.plot_shape-1031"><a href="#FluorObj.plot_shape-1031"><span class="linenos">1031</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj.plot_shape-1032"><a href="#FluorObj.plot_shape-1032"><span class="linenos">1032</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj.plot_shape-1033"><a href="#FluorObj.plot_shape-1033"><span class="linenos">1033</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="FluorObj.plot_shape-1034"><a href="#FluorObj.plot_shape-1034"><span class="linenos">1034</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="FluorObj.plot_shape-1035"><a href="#FluorObj.plot_shape-1035"><span class="linenos">1035</span></a><span class="sd">        color_map</span>
</span><span id="FluorObj.plot_shape-1036"><a href="#FluorObj.plot_shape-1036"><span class="linenos">1036</span></a><span class="sd">            Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is &#39;viridis&#39;.</span>
</span><span id="FluorObj.plot_shape-1037"><a href="#FluorObj.plot_shape-1037"><span class="linenos">1037</span></a>
</span><span id="FluorObj.plot_shape-1038"><a href="#FluorObj.plot_shape-1038"><span class="linenos">1038</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.plot_shape-1039"><a href="#FluorObj.plot_shape-1039"><span class="linenos">1039</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.plot_shape-1040"><a href="#FluorObj.plot_shape-1040"><span class="linenos">1040</span></a><span class="sd">        None.</span>
</span><span id="FluorObj.plot_shape-1041"><a href="#FluorObj.plot_shape-1041"><span class="linenos">1041</span></a>
</span><span id="FluorObj.plot_shape-1042"><a href="#FluorObj.plot_shape-1042"><span class="linenos">1042</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.plot_shape-1043"><a href="#FluorObj.plot_shape-1043"><span class="linenos">1043</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="FluorObj.plot_shape-1044"><a href="#FluorObj.plot_shape-1044"><span class="linenos">1044</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="FluorObj.plot_shape-1045"><a href="#FluorObj.plot_shape-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1046"><a href="#FluorObj.plot_shape-1046"><span class="linenos">1046</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1047"><a href="#FluorObj.plot_shape-1047"><span class="linenos">1047</span></a>                <span class="n">naming</span> <span class="o">=</span> <span class="s2">&quot;Cropped Shape&quot;</span>
</span><span id="FluorObj.plot_shape-1048"><a href="#FluorObj.plot_shape-1048"><span class="linenos">1048</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1049"><a href="#FluorObj.plot_shape-1049"><span class="linenos">1049</span></a>                <span class="n">naming</span> <span class="o">=</span> <span class="s2">&quot;Shape&quot;</span>
</span><span id="FluorObj.plot_shape-1050"><a href="#FluorObj.plot_shape-1050"><span class="linenos">1050</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1051"><a href="#FluorObj.plot_shape-1051"><span class="linenos">1051</span></a>                <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="FluorObj.plot_shape-1052"><a href="#FluorObj.plot_shape-1052"><span class="linenos">1052</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">naming</span><span class="si">}</span><span class="s2"> with parameters: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span><span class="si">}</span><span class="s2">, center: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">str_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.plot_shape-1053"><a href="#FluorObj.plot_shape-1053"><span class="linenos">1053</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1054"><a href="#FluorObj.plot_shape-1054"><span class="linenos">1054</span></a>                <span class="n">axes_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="FluorObj.plot_shape-1055"><a href="#FluorObj.plot_shape-1055"><span class="linenos">1055</span></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1056"><a href="#FluorObj.plot_shape-1056"><span class="linenos">1056</span></a>                <span class="n">axes_img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">)</span>
</span><span id="FluorObj.plot_shape-1057"><a href="#FluorObj.plot_shape-1057"><span class="linenos">1057</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span><span id="FluorObj.plot_shape-1058"><a href="#FluorObj.plot_shape-1058"><span class="linenos">1058</span></a>            <span class="n">plot_patch</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># flag for plotting the patch (Circle or Ellipse)</span>
</span><span id="FluorObj.plot_shape-1059"><a href="#FluorObj.plot_shape-1059"><span class="linenos">1059</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__profile_cropped</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1060"><a href="#FluorObj.plot_shape-1060"><span class="linenos">1060</span></a>                <span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># image sizes</span>
</span><span id="FluorObj.plot_shape-1061"><a href="#FluorObj.plot_shape-1061"><span class="linenos">1061</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
</span><span id="FluorObj.plot_shape-1062"><a href="#FluorObj.plot_shape-1062"><span class="linenos">1062</span></a>                    <span class="n">m_center</span> <span class="o">=</span> <span class="n">m_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
</span><span id="FluorObj.plot_shape-1063"><a href="#FluorObj.plot_shape-1063"><span class="linenos">1063</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1064"><a href="#FluorObj.plot_shape-1064"><span class="linenos">1064</span></a>                    <span class="n">m_center</span> <span class="o">=</span> <span class="n">m_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="FluorObj.plot_shape-1065"><a href="#FluorObj.plot_shape-1065"><span class="linenos">1065</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">):</span>
</span><span id="FluorObj.plot_shape-1066"><a href="#FluorObj.plot_shape-1066"><span class="linenos">1066</span></a>                    <span class="n">n_center</span> <span class="o">=</span> <span class="n">n_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1.0</span>
</span><span id="FluorObj.plot_shape-1067"><a href="#FluorObj.plot_shape-1067"><span class="linenos">1067</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1068"><a href="#FluorObj.plot_shape-1068"><span class="linenos">1068</span></a>                    <span class="n">n_center</span> <span class="o">=</span> <span class="n">n_center</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="FluorObj.plot_shape-1069"><a href="#FluorObj.plot_shape-1069"><span class="linenos">1069</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1070"><a href="#FluorObj.plot_shape-1070"><span class="linenos">1070</span></a>                <span class="n">plot_patch</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># just prevent the plotting the patch on the cropped images</span>
</span><span id="FluorObj.plot_shape-1071"><a href="#FluorObj.plot_shape-1071"><span class="linenos">1071</span></a>            <span class="k">if</span> <span class="n">plot_patch</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1072"><a href="#FluorObj.plot_shape-1072"><span class="linenos">1072</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;round&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1073"><a href="#FluorObj.plot_shape-1073"><span class="linenos">1073</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Circle</span><span class="p">((</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">))</span>
</span><span id="FluorObj.plot_shape-1074"><a href="#FluorObj.plot_shape-1074"><span class="linenos">1074</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span><span id="FluorObj.plot_shape-1075"><a href="#FluorObj.plot_shape-1075"><span class="linenos">1075</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;ellipse&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_type</span> <span class="o">==</span> <span class="s2">&quot;el&quot;</span><span class="p">:</span>
</span><span id="FluorObj.plot_shape-1076"><a href="#FluorObj.plot_shape-1076"><span class="linenos">1076</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">Ellipse</span><span class="p">((</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span id="FluorObj.plot_shape-1077"><a href="#FluorObj.plot_shape-1077"><span class="linenos">1077</span></a>                                                    <span class="n">angle</span><span class="o">=-</span><span class="bp">self</span><span class="o">.</span><span class="n">typical_sizes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
</span><span id="FluorObj.plot_shape-1078"><a href="#FluorObj.plot_shape-1078"><span class="linenos">1078</span></a>                                                    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.75</span><span class="p">))</span>
</span><span id="FluorObj.plot_shape-1079"><a href="#FluorObj.plot_shape-1079"><span class="linenos">1079</span></a>                    <span class="n">axes_img</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">m_center</span><span class="p">,</span> <span class="n">n_center</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plot interactively the profile of the object computed by the get_shape() method along with the border of the object.</p>

<p>Please note that the border will be plotted if the shape hadn't been cropped before.</p>

<h2 id="parameters">Parameters</h2>

<p>str_id : str, optional
    Unique string id for plotting several plots with unique Figure() names. The default is "".
color_map
    Color map acceptable by matplotlib.pyplot.cm. Fallback is viridis color map. The default is 'viridis'.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="FluorObj.plot_cast_shape" class="classattr">
                                        <input id="FluorObj.plot_cast_shape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plot_cast_shape</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FluorObj.plot_cast_shape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.plot_cast_shape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.plot_cast_shape-1081"><a href="#FluorObj.plot_cast_shape-1081"><span class="linenos">1081</span></a>    <span class="k">def</span> <span class="nf">plot_cast_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">str_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="FluorObj.plot_cast_shape-1082"><a href="#FluorObj.plot_cast_shape-1082"><span class="linenos">1082</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.plot_cast_shape-1083"><a href="#FluorObj.plot_cast_shape-1083"><span class="linenos">1083</span></a><span class="sd">        Plot interactively the cast to the provided type profile of the object computed by the get_casted_shape() method.</span>
</span><span id="FluorObj.plot_cast_shape-1084"><a href="#FluorObj.plot_cast_shape-1084"><span class="linenos">1084</span></a>
</span><span id="FluorObj.plot_cast_shape-1085"><a href="#FluorObj.plot_cast_shape-1085"><span class="linenos">1085</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj.plot_cast_shape-1086"><a href="#FluorObj.plot_cast_shape-1086"><span class="linenos">1086</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj.plot_cast_shape-1087"><a href="#FluorObj.plot_cast_shape-1087"><span class="linenos">1087</span></a><span class="sd">        str_id : str, optional</span>
</span><span id="FluorObj.plot_cast_shape-1088"><a href="#FluorObj.plot_cast_shape-1088"><span class="linenos">1088</span></a><span class="sd">            Unique string id for plotting several plots with unique Figure() names. The default is &quot;&quot;.</span>
</span><span id="FluorObj.plot_cast_shape-1089"><a href="#FluorObj.plot_cast_shape-1089"><span class="linenos">1089</span></a>
</span><span id="FluorObj.plot_cast_shape-1090"><a href="#FluorObj.plot_cast_shape-1090"><span class="linenos">1090</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.plot_cast_shape-1091"><a href="#FluorObj.plot_cast_shape-1091"><span class="linenos">1091</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.plot_cast_shape-1092"><a href="#FluorObj.plot_cast_shape-1092"><span class="linenos">1092</span></a><span class="sd">        None.</span>
</span><span id="FluorObj.plot_cast_shape-1093"><a href="#FluorObj.plot_cast_shape-1093"><span class="linenos">1093</span></a>
</span><span id="FluorObj.plot_cast_shape-1094"><a href="#FluorObj.plot_cast_shape-1094"><span class="linenos">1094</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.plot_cast_shape-1095"><a href="#FluorObj.plot_cast_shape-1095"><span class="linenos">1095</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
</span><span id="FluorObj.plot_cast_shape-1096"><a href="#FluorObj.plot_cast_shape-1096"><span class="linenos">1096</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
</span><span id="FluorObj.plot_cast_shape-1097"><a href="#FluorObj.plot_cast_shape-1097"><span class="linenos">1097</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj.plot_cast_shape-1098"><a href="#FluorObj.plot_cast_shape-1098"><span class="linenos">1098</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">str_id</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FluorObj.plot_cast_shape-1099"><a href="#FluorObj.plot_cast_shape-1099"><span class="linenos">1099</span></a>                <span class="n">str_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
</span><span id="FluorObj.plot_cast_shape-1100"><a href="#FluorObj.plot_cast_shape-1100"><span class="linenos">1100</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Casted shape with parameters: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">explicit_shape_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">border_type</span><span class="si">}</span><span class="s2">, center: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">center_shifts</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">str_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="FluorObj.plot_cast_shape-1101"><a href="#FluorObj.plot_cast_shape-1101"><span class="linenos">1101</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">casted_profile</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Plot interactively the cast to the provided type profile of the object computed by the get_casted_shape() method.</p>

<h2 id="parameters">Parameters</h2>

<p>str_id : str, optional
    Unique string id for plotting several plots with unique Figure() names. The default is "".</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="FluorObj.set_image_sizes" class="classattr">
                                        <input id="FluorObj.set_image_sizes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_image_sizes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">image_sizes</span><span class="p">:</span> <span class="nb">tuple</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FluorObj.set_image_sizes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.set_image_sizes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.set_image_sizes-1104"><a href="#FluorObj.set_image_sizes-1104"><span class="linenos">1104</span></a>    <span class="k">def</span> <span class="nf">set_image_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image_sizes</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">):</span>
</span><span id="FluorObj.set_image_sizes-1105"><a href="#FluorObj.set_image_sizes-1105"><span class="linenos">1105</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.set_image_sizes-1106"><a href="#FluorObj.set_image_sizes-1106"><span class="linenos">1106</span></a><span class="sd">        Set containing this object image sizes packed in the tuple.</span>
</span><span id="FluorObj.set_image_sizes-1107"><a href="#FluorObj.set_image_sizes-1107"><span class="linenos">1107</span></a>
</span><span id="FluorObj.set_image_sizes-1108"><a href="#FluorObj.set_image_sizes-1108"><span class="linenos">1108</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj.set_image_sizes-1109"><a href="#FluorObj.set_image_sizes-1109"><span class="linenos">1109</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj.set_image_sizes-1110"><a href="#FluorObj.set_image_sizes-1110"><span class="linenos">1110</span></a><span class="sd">        image_sizes : tuple</span>
</span><span id="FluorObj.set_image_sizes-1111"><a href="#FluorObj.set_image_sizes-1111"><span class="linenos">1111</span></a><span class="sd">            Expected as (height, width).</span>
</span><span id="FluorObj.set_image_sizes-1112"><a href="#FluorObj.set_image_sizes-1112"><span class="linenos">1112</span></a>
</span><span id="FluorObj.set_image_sizes-1113"><a href="#FluorObj.set_image_sizes-1113"><span class="linenos">1113</span></a><span class="sd">        Raises</span>
</span><span id="FluorObj.set_image_sizes-1114"><a href="#FluorObj.set_image_sizes-1114"><span class="linenos">1114</span></a><span class="sd">        ------</span>
</span><span id="FluorObj.set_image_sizes-1115"><a href="#FluorObj.set_image_sizes-1115"><span class="linenos">1115</span></a><span class="sd">        ValueError</span>
</span><span id="FluorObj.set_image_sizes-1116"><a href="#FluorObj.set_image_sizes-1116"><span class="linenos">1116</span></a><span class="sd">            If image sizes provided less than 2 pixels.</span>
</span><span id="FluorObj.set_image_sizes-1117"><a href="#FluorObj.set_image_sizes-1117"><span class="linenos">1117</span></a>
</span><span id="FluorObj.set_image_sizes-1118"><a href="#FluorObj.set_image_sizes-1118"><span class="linenos">1118</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.set_image_sizes-1119"><a href="#FluorObj.set_image_sizes-1119"><span class="linenos">1119</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.set_image_sizes-1120"><a href="#FluorObj.set_image_sizes-1120"><span class="linenos">1120</span></a><span class="sd">        None.</span>
</span><span id="FluorObj.set_image_sizes-1121"><a href="#FluorObj.set_image_sizes-1121"><span class="linenos">1121</span></a>
</span><span id="FluorObj.set_image_sizes-1122"><a href="#FluorObj.set_image_sizes-1122"><span class="linenos">1122</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.set_image_sizes-1123"><a href="#FluorObj.set_image_sizes-1123"><span class="linenos">1123</span></a>        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">image_sizes</span>  <span class="c1"># expecting packed height, width - also can be called with image.shape (np.ndarray.shape) attribute</span>
</span><span id="FluorObj.set_image_sizes-1124"><a href="#FluorObj.set_image_sizes-1124"><span class="linenos">1124</span></a>        <span class="k">if</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="FluorObj.set_image_sizes-1125"><a href="#FluorObj.set_image_sizes-1125"><span class="linenos">1125</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
</span><span id="FluorObj.set_image_sizes-1126"><a href="#FluorObj.set_image_sizes-1126"><span class="linenos">1126</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.set_image_sizes-1127"><a href="#FluorObj.set_image_sizes-1127"><span class="linenos">1127</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># put the default sizes for always getting False after setting coordinates</span>
</span><span id="FluorObj.set_image_sizes-1128"><a href="#FluorObj.set_image_sizes-1128"><span class="linenos">1128</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Height and width image is expected to be more than 2 pixels&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set containing this object image sizes packed in the tuple.</p>

<h2 id="parameters">Parameters</h2>

<p>image_sizes : tuple
    Expected as (height, width).</p>

<h2 id="raises">Raises</h2>

<p>ValueError
    If image sizes provided less than 2 pixels.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                            </div>
                            <div id="FluorObj.set_coordinates" class="classattr">
                                        <input id="FluorObj.set_coordinates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_coordinates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">coordinates</span><span class="p">:</span> <span class="nb">tuple</span></span><span class="return-annotation">) -> <span class="nb">bool</span>:</span></span>

                <label class="view-source-button" for="FluorObj.set_coordinates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FluorObj.set_coordinates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FluorObj.set_coordinates-1130"><a href="#FluorObj.set_coordinates-1130"><span class="linenos">1130</span></a>    <span class="k">def</span> <span class="nf">set_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coordinates</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="FluorObj.set_coordinates-1131"><a href="#FluorObj.set_coordinates-1131"><span class="linenos">1131</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FluorObj.set_coordinates-1132"><a href="#FluorObj.set_coordinates-1132"><span class="linenos">1132</span></a><span class="sd">        Set coordinates of the left upper coordinates of the profile.</span>
</span><span id="FluorObj.set_coordinates-1133"><a href="#FluorObj.set_coordinates-1133"><span class="linenos">1133</span></a>
</span><span id="FluorObj.set_coordinates-1134"><a href="#FluorObj.set_coordinates-1134"><span class="linenos">1134</span></a><span class="sd">        Parameters</span>
</span><span id="FluorObj.set_coordinates-1135"><a href="#FluorObj.set_coordinates-1135"><span class="linenos">1135</span></a><span class="sd">        ----------</span>
</span><span id="FluorObj.set_coordinates-1136"><a href="#FluorObj.set_coordinates-1136"><span class="linenos">1136</span></a><span class="sd">        coordinates : tuple</span>
</span><span id="FluorObj.set_coordinates-1137"><a href="#FluorObj.set_coordinates-1137"><span class="linenos">1137</span></a><span class="sd">            As i - from rows, j - columns.</span>
</span><span id="FluorObj.set_coordinates-1138"><a href="#FluorObj.set_coordinates-1138"><span class="linenos">1138</span></a>
</span><span id="FluorObj.set_coordinates-1139"><a href="#FluorObj.set_coordinates-1139"><span class="linenos">1139</span></a><span class="sd">        Returns</span>
</span><span id="FluorObj.set_coordinates-1140"><a href="#FluorObj.set_coordinates-1140"><span class="linenos">1140</span></a><span class="sd">        -------</span>
</span><span id="FluorObj.set_coordinates-1141"><a href="#FluorObj.set_coordinates-1141"><span class="linenos">1141</span></a><span class="sd">        bool</span>
</span><span id="FluorObj.set_coordinates-1142"><a href="#FluorObj.set_coordinates-1142"><span class="linenos">1142</span></a><span class="sd">            True if the image containing the profile (even partially).</span>
</span><span id="FluorObj.set_coordinates-1143"><a href="#FluorObj.set_coordinates-1143"><span class="linenos">1143</span></a>
</span><span id="FluorObj.set_coordinates-1144"><a href="#FluorObj.set_coordinates-1144"><span class="linenos">1144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="FluorObj.set_coordinates-1145"><a href="#FluorObj.set_coordinates-1145"><span class="linenos">1145</span></a>        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">external_upper_coordinates</span> <span class="o">=</span> <span class="n">coordinates</span>  <span class="c1"># expecting packed coordinates of the left upper pixel of the profile</span>
</span><span id="FluorObj.set_coordinates-1146"><a href="#FluorObj.set_coordinates-1146"><span class="linenos">1146</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FluorObj.set_coordinates-1147"><a href="#FluorObj.set_coordinates-1147"><span class="linenos">1147</span></a>            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">shape</span><span class="p">;</span> <span class="n">h_image</span><span class="p">,</span> <span class="n">w_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__external_image_sizes</span>
</span><span id="FluorObj.set_coordinates-1148"><a href="#FluorObj.set_coordinates-1148"><span class="linenos">1148</span></a>            <span class="n">i_border_check</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span> <span class="n">j_border_check</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># flags for overall checking</span>
</span><span id="FluorObj.set_coordinates-1149"><a href="#FluorObj.set_coordinates-1149"><span class="linenos">1149</span></a>            <span class="c1"># Below - basic check that the profile still is within image, if even its borders still are in</span>
</span><span id="FluorObj.set_coordinates-1150"><a href="#FluorObj.set_coordinates-1150"><span class="linenos">1150</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">-</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">h_image</span><span class="p">):</span>
</span><span id="FluorObj.set_coordinates-1151"><a href="#FluorObj.set_coordinates-1151"><span class="linenos">1151</span></a>                <span class="n">i_border_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj.set_coordinates-1152"><a href="#FluorObj.set_coordinates-1152"><span class="linenos">1152</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j</span> <span class="o">+</span> <span class="n">w</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">j</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">-</span> <span class="n">w</span> <span class="o">&lt;</span> <span class="n">w_image</span><span class="p">):</span>
</span><span id="FluorObj.set_coordinates-1153"><a href="#FluorObj.set_coordinates-1153"><span class="linenos">1153</span></a>                <span class="n">j_border_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj.set_coordinates-1154"><a href="#FluorObj.set_coordinates-1154"><span class="linenos">1154</span></a>            <span class="c1"># Additional check that pixels of a shape is still not zero within the image (touching the scene only by border pixels)</span>
</span><span id="FluorObj.set_coordinates-1155"><a href="#FluorObj.set_coordinates-1155"><span class="linenos">1155</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="n">h_image</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">w_image</span><span class="p">):</span>
</span><span id="FluorObj.set_coordinates-1156"><a href="#FluorObj.set_coordinates-1156"><span class="linenos">1156</span></a>                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="FluorObj.set_coordinates-1157"><a href="#FluorObj.set_coordinates-1157"><span class="linenos">1157</span></a>                <span class="k">for</span> <span class="n">i_c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="n">h</span><span class="p">):</span>
</span><span id="FluorObj.set_coordinates-1158"><a href="#FluorObj.set_coordinates-1158"><span class="linenos">1158</span></a>                    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FluorObj.set_coordinates-1159"><a href="#FluorObj.set_coordinates-1159"><span class="linenos">1159</span></a>                    <span class="k">for</span> <span class="n">j_c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="n">w</span><span class="p">):</span>
</span><span id="FluorObj.set_coordinates-1160"><a href="#FluorObj.set_coordinates-1160"><span class="linenos">1160</span></a>                        <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="FluorObj.set_coordinates-1161"><a href="#FluorObj.set_coordinates-1161"><span class="linenos">1161</span></a>                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">i_c</span> <span class="o">&lt;</span> <span class="n">h_image</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">j_c</span> <span class="o">&lt;</span> <span class="n">w_image</span><span class="p">:</span>
</span><span id="FluorObj.set_coordinates-1162"><a href="#FluorObj.set_coordinates-1162"><span class="linenos">1162</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">profile</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">m</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="FluorObj.set_coordinates-1163"><a href="#FluorObj.set_coordinates-1163"><span class="linenos">1163</span></a>                                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span> <span class="k">break</span>
</span><span id="FluorObj.set_coordinates-1164"><a href="#FluorObj.set_coordinates-1164"><span class="linenos">1164</span></a>                        <span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FluorObj.set_coordinates-1165"><a href="#FluorObj.set_coordinates-1165"><span class="linenos">1165</span></a>                    <span class="k">if</span> <span class="n">additional_containing_check</span><span class="p">:</span>
</span><span id="FluorObj.set_coordinates-1166"><a href="#FluorObj.set_coordinates-1166"><span class="linenos">1166</span></a>                        <span class="k">break</span>
</span><span id="FluorObj.set_coordinates-1167"><a href="#FluorObj.set_coordinates-1167"><span class="linenos">1167</span></a>                    <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="FluorObj.set_coordinates-1168"><a href="#FluorObj.set_coordinates-1168"><span class="linenos">1168</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.set_coordinates-1169"><a href="#FluorObj.set_coordinates-1169"><span class="linenos">1169</span></a>                <span class="n">additional_containing_check</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FluorObj.set_coordinates-1170"><a href="#FluorObj.set_coordinates-1170"><span class="linenos">1170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span> <span class="o">=</span> <span class="p">(</span><span class="n">i_border_check</span> <span class="ow">and</span> <span class="n">j_border_check</span> <span class="ow">and</span> <span class="n">additional_containing_check</span><span class="p">)</span>
</span><span id="FluorObj.set_coordinates-1171"><a href="#FluorObj.set_coordinates-1171"><span class="linenos">1171</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FluorObj.set_coordinates-1172"><a href="#FluorObj.set_coordinates-1172"><span class="linenos">1172</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># explicit setting flag</span>
</span><span id="FluorObj.set_coordinates-1173"><a href="#FluorObj.set_coordinates-1173"><span class="linenos">1173</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">within_image</span>
</span></pre></div>


            <div class="docstring"><p>Set coordinates of the left upper coordinates of the profile.</p>

<h2 id="parameters">Parameters</h2>

<p>coordinates : tuple
    As i - from rows, j - columns.</p>

<h2 id="returns">Returns</h2>

<p>bool
    True if the image containing the profile (even partially).</p>
</div>


                            </div>
                </section>
                <section id="force_precompilation">
                            <input id="force_precompilation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">force_precompilation</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="force_precompilation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#force_precompilation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="force_precompilation-1225"><a href="#force_precompilation-1225"><span class="linenos">1225</span></a><span class="k">def</span> <span class="nf">force_precompilation</span><span class="p">():</span>
</span><span id="force_precompilation-1226"><a href="#force_precompilation-1226"><span class="linenos">1226</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="force_precompilation-1227"><a href="#force_precompilation-1227"><span class="linenos">1227</span></a><span class="sd">    Force compilation of computing functions for round and ellipse &#39;precise&#39; shaped objects.</span>
</span><span id="force_precompilation-1228"><a href="#force_precompilation-1228"><span class="linenos">1228</span></a>
</span><span id="force_precompilation-1229"><a href="#force_precompilation-1229"><span class="linenos">1229</span></a><span class="sd">    Returns</span>
</span><span id="force_precompilation-1230"><a href="#force_precompilation-1230"><span class="linenos">1230</span></a><span class="sd">    -------</span>
</span><span id="force_precompilation-1231"><a href="#force_precompilation-1231"><span class="linenos">1231</span></a><span class="sd">    None.</span>
</span><span id="force_precompilation-1232"><a href="#force_precompilation-1232"><span class="linenos">1232</span></a>
</span><span id="force_precompilation-1233"><a href="#force_precompilation-1233"><span class="linenos">1233</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="force_precompilation-1234"><a href="#force_precompilation-1234"><span class="linenos">1234</span></a>    <span class="k">if</span> <span class="n">numba_installed</span><span class="p">:</span>
</span><span id="force_precompilation-1235"><a href="#force_precompilation-1235"><span class="linenos">1235</span></a>        <span class="n">probe_obj</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">typical_size</span><span class="o">=</span><span class="mf">2.0</span><span class="p">);</span> <span class="n">probe_obj</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="k">del</span> <span class="n">probe_obj</span>  <span class="c1"># for round shape</span>
</span><span id="force_precompilation-1236"><a href="#force_precompilation-1236"><span class="linenos">1236</span></a>        <span class="n">probe_obj</span> <span class="o">=</span> <span class="n">FluorObj</span><span class="p">(</span><span class="n">shape_type</span><span class="o">=</span><span class="s1">&#39;ellipse&#39;</span><span class="p">,</span> <span class="n">typical_size</span><span class="o">=</span><span class="p">(</span><span class="mf">2.65</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">6.0</span><span class="p">));</span> <span class="n">probe_obj</span><span class="o">.</span><span class="n">get_shape</span><span class="p">(</span><span class="n">accelerated</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span> <span class="k">del</span> <span class="n">probe_obj</span>
</span><span id="force_precompilation-1237"><a href="#force_precompilation-1237"><span class="linenos">1237</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="force_precompilation-1238"><a href="#force_precompilation-1238"><span class="linenos">1238</span></a>        <span class="n">__warn_message</span> <span class="o">=</span> <span class="s2">&quot;Acceleration isn&#39;t possible because &#39;numba&#39; library not installed in the current environment&quot;</span>
</span><span id="force_precompilation-1239"><a href="#force_precompilation-1239"><span class="linenos">1239</span></a>        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">__warn_message</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Force compilation of computing functions for round and ellipse 'precise' shaped objects.</p>

<h2 id="returns">Returns</h2>

<p>None.</p>
</div>


                </section>
    </main>
</body>
</html>